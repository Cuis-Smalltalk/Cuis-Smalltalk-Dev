'From Cuis7.0 [latest update: #6367] on 13 May 2024 at 4:31:51 pm'!


----SNAPSHOT----(13 May 2024 16:31:51) Cuis7.0.image priorSource: 0!

----QUIT----(13 May 2024 16:31:55) Cuis7.1-6367.image priorSource: 68!

----STARTUP---- (6 June 2024 11:37:47) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6367.image!


'From Cuis7.1 [latest update: #6367] on 16 May 2024 at 12:06:13 am'!

TestCase subclass: #SystemOrganizerTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'BaseImageTests-System-Support'!

!classDefinition: #SystemOrganizerTest category: #'BaseImageTests-System-Support' stamp: 'Install-6368-RenameExtentions-Sebastian-2024May16-00h03m-S.V..001.cs.st 6/6/2024 11:37:52'!
TestCase subclass: #SystemOrganizerTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'BaseImageTests-System-Support'!
!Categorizer methodsFor: 'testing' stamp: 'S.V. 5/16/2024 00:04:40'!
             isPackageCategoryExtension: aCategory fromPackage: aPackageName

	^ (self isPackageCategoryExtension: aCategory) and: [ aCategory 	is: aPackageName substringAt: 2 ]! !
!ClassOrganizer methodsFor: 'accessing' stamp: 'S.V. 5/16/2024 00:05:12'!
              renamePackageCategories: oldPackageName to: newPackageName

	self categories do: [ :aCategory |
		(self isPackageCategoryExtension: aCategory fromPackage: oldPackageName) ifTrue: [
			| newCategory |
			newCategory := aCategory copyReplaceFrom: 2 to: (oldPackageName size + 1) with: newPackageName.
			self renameCategory: aCategory to: newCategory.
		]
	]! !
!SystemOrganizerTest methodsFor: 'testing' stamp: 'S.V. 5/16/2024 00:03:44'!
           testRenameSystemCategoryAlsoRenameClassExtensions
	| oldCategoryName oldExtensionName newCategoryName newExtensionName aClassWithCategoryToRename classOrganizer |

	oldCategoryName := 'ACategoryToRename'.
	oldExtensionName := '*ACategoryToRename SubCategory'.
	newCategoryName := 'NewCategoryName'.
	newExtensionName := '*NewCategoryName SubCategory'.
	aClassWithCategoryToRename := Object subclass: #AClassWithCategoryToRename
		instanceVariableNames: ''
		classVariableNames: ''
		poolDictionaries: ''
		category: oldCategoryName.
	classOrganizer := aClassWithCategoryToRename organization.
	classOrganizer addCategory: oldExtensionName.

	self assert: aClassWithCategoryToRename category equals: oldCategoryName.
	self assert: classOrganizer categories includes: oldExtensionName.
	
	SystemOrganization renameSystemCategory: oldCategoryName to: newCategoryName.

	self assert: aClassWithCategoryToRename category equals: newCategoryName.
	self deny: (classOrganizer categories includes: oldExtensionName).
	self assert: (classOrganizer categories includes: newExtensionName).

	SystemOrganization removeSystemCategory: newCategoryName.! !
!SystemOrganizer methodsFor: 'categories' stamp: 'S.V. 5/16/2024 00:05:52' prior: 16970325!
              renameSystemCategory: oldName to: newName.

	"If it's a top category, rename subcategories first:"
	(self withSubCategoriesOf: oldName) reverseDo: [ :each |
		self renameCategory: each to: newName, (each allButFirst: oldName size)].

	Smalltalk classes do: [ :aClass | 
		aClass organization renamePackageCategories: oldName to: newName
	]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6368-RenameExtentions-Sebastian-2024May16-00h03m-S.V..001.cs.st----!

'From Cuis7.1 [latest update: #6368] on 16 May 2024 at 10:02:21 am'!
!ClassOrganizer methodsFor: 'renaming' stamp: 'HAW 5/16/2024 09:41:31'!
                              renamePackageCategoriesFrom: oldPackageName to: newPackageName

	self categories do: [ :aCategory |
		(self isPackageCategoryExtension: aCategory fromPackage: oldPackageName) ifTrue: [
			self renamePackageCategory: aCategory from: oldPackageName to: newPackageName.
		]
	]! !
!ClassOrganizer methodsFor: 'renaming' stamp: 'HAW 5/16/2024 10:01:30'!
   renamePackageCategory: aCategory from: oldPackageName to: newPackageName

	| newCategory |
			
	newCategory := aCategory copyReplaceFrom: 2 to: oldPackageName size + 1 with: newPackageName.
	self renameCategory: aCategory to: newCategory! !
!SystemOrganizer methodsFor: 'categories' stamp: 'HAW 5/16/2024 09:57:40' prior: 50331740!
                    renameSystemCategory: oldName to: newName

	"If it's a top category, rename subcategories first:"
	(self withSubCategoriesOf: oldName) reverseDo: [ :each |
		self renameCategory: each to: newName, (each allButFirst: oldName size)].

	Smalltalk allBehaviorsDo: [ :aClass | 
		aClass organization renamePackageCategoriesFrom: oldName to: newName ]! !

ClassOrganizer removeSelector: #renamePackageCategories:to:!

!methodRemoval: ClassOrganizer #renamePackageCategories:to: stamp: 'Install-6369-RenameExtentions-HernanWilkinson-2024May16-09h38m-HAW.001.cs.st 6/6/2024 11:37:52'!
renamePackageCategories: oldPackageName to: newPackageName

	self categories do: [ :aCategory |
		(self isPackageCategoryExtension: aCategory fromPackage: oldPackageName) ifTrue: [
			| newCategory |
			newCategory := aCategory copyReplaceFrom: 2 to: (oldPackageName size + 1) with: newPackageName.
			self renameCategory: aCategory to: newCategory.
		]
	]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6369-RenameExtentions-HernanWilkinson-2024May16-09h38m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6369] on 16 May 2024 at 4:42:02 pm'!

Smalltalk removeClassNamed: #SystemOrganizerTest!

!classRemoval: #SystemOrganizerTest stamp: 'Install-6370-RenameExtentions-HernanWilkinson-2024May16-16h41m-HAW.001.cs.st 6/6/2024 11:37:52'!
TestCase subclass: #SystemOrganizerTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'BaseImageTests-System-Support'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6370-RenameExtentions-HernanWilkinson-2024May16-16h41m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6370] on 17 May 2024 at 9:30:05 am'!
!SystemDictionary methodsFor: 'code authors' stamp: 'jmv 5/17/2024 09:29:48' prior: 16963725!
               knownInitialsAndNames
	"This list could include people who hasn't contributed code to the Cuis image, but to some optional package."
"
| all ok |
all := Smalltalk allContributors asSet.
ok := (Smalltalk knownInitialsAndNames collect: [ :pair | pair first ]) asSet.
(all copyWithoutAll: ok) print

		initials         				name"
^ #(
	#('ab' 						'Alexandre Bergel')
	#('abc' 						'Colin Putney')
	#('acg' 						'Andrew C. Greenberg')
	#('ads' 						'Adam Spitz')
	#('AFi' 						'Alain Fischer')
	#('ajh' 						'Anthony Hannan')
	#('al' 						'Adrian Lienhard')
	#('and' 						'Alan Dao')
	#('aoy' 						'Andres Otaduy')
	#('apb' 						'Andrew P. Black')
	#('ar' 						'Andreas Raab')
	#('asm' 						'Alejandro Magistrello')
	#('avi' 						'Avi Bryant')
	#('AY'						'Angel Yan')
	#('BAP'						'Barry Perryman')
	#('BenComan' 						'Ben Coman')
	#('bf' 						'Bert Freudenberg')
	#('BG' 						'Boris Gaertner')
	#('bgs' 						'Boris G. Shingarov')
	#('BJP' 						'Bijan Parsia')
	#('bkv' 						'Brent Vukmer')
	#('bolot' 						'Bolot Kerimbaev')
	#('bp' 						'Bernhard Pieber')
	#('BP' 						'Brent Pinkney') 
	#('brp' 						'Brent Pinkney')
	#('cbc' 						'Chris Cunningham')
	#('cbr'						'Casey Ransberger')
	#('ccn' 						'Chris Norton')
	#('chaider'						'Christian Haider')
	#('cmm' 						'Chris Muller')
	#('crl' 						'Craig Latta')
	#('cwp' 						'Colin Putney')
	#('das' 						'David A Smith')
	#('db' 						'Douglas Brebner')
	#('dc' 						'Damien Cassou')
	#('dew' 						'Doug Way')
	#('DF'						'David Faitelson')
	#('dgd' 						'Diego Gomez Deck')
	#('dkh'						'Dale Henrichs')
	#('dhn'	 					'Dan Norton')
	#('dhhi' 						'Dan Ingalls')
	#('di' 						'Dan Ingalls')
	#('djp' 						'David J. Pennell')
	#('DKL'						'Daniel K Lyons')
	#('DM' 						'Duncan Mak')
	#('DSM' 						'Duane Maxwell')
	#('DSG'						'David Graham')
	#('dtl' 						'Dave Lewis')
	#('dvf'	 					'Daniel Vainsencher')
	#('eat' 						'Eric Arseneau Tremblay')
	#('EB'						'Eric Brandwein')
	#('eem'						'Eliot Emilio Miranda')
	#('eliot'						'Eliot Emilio Miranda')
	#('efc' 						'Eddie Cottongim')
	#('em' 						'Ernest Micklei?')
	#('emm' 						'Ernest Micklei')
	#('fbs' 						'Frank Shearar')
	#('FBS' 						'Frank Shearar')
	#('fc' 						'Frank Caggiano')
	#('fcs' 						'Frank Sergeant')
	#('FernandoOlivero' 						'Fernando Olivero')
	#('FernanodOlivero' 						'Fernando Olivero')
	#('FGJ'						'Fernando Gasperi Jabalera')
	#('fgz'						'Felipe Zak')
	#('FJG'				 		'Facundo Javier Gelatti')
	#('GabrielOmarCotelli' 						'Gabriel Omar Cotelli')
	#('GC' 						'Gast√≥n Caruso')
	#('gera' 						'Gerardo Richarte')
	#('gh' 						'Goran Krampe (nee Hultgren)')
	#('gk' 						'Goran Krampe (nee Hultgren)')
	#('gm' 						'German Morales')
	#('go' 						'Georg Gollmann')
	#('gsa' 						'German Arduino')
	#('HAW' 						'Hernan Wilkinson')
	#('HB' 						'Hari Balaraman')
	#('hjh' 						'Hannes Hirzel')
	#('hlsf' 						'Hilaire Fernandes')
	#('hmm' 						'Hans-Martin Mosner')
	#('hsj' 						'Henrik Sperre Johansen')
	#('Igor.Stasenko' 						'Igor Stasenko')
	#('ikp' 						'Ian Piumarta')
	#('jar' 						'Jaromir Matas')
	#('Jb' 						'Jean Baptiste Arnaud')
	#('jcg' 						'Joshua Gargus')
	#('jdr' 						'Javier Diaz-Reinoso')
	#('je' 						'Joern Eyrich')
	#('jf' 						'Julian Fitzell')
	#('JF' 						'Julian Fitzell')
	#('jhm' 						'John Maloney')
	#('jk'						'Jonathan Kelly')
	#('jlb' 						'Jim Benson')
	#('jm' 						'John Maloney')
	#('jmb' 						'Hans Baveco')
	#('JMG'						'Jeff Gonis')
	#('JMM' 						'John McIntosh')
	#('jmv' 						'Juan Vuletich')
	#('JMV' 						'Juan Vuletich')
	#('JO'						'Javier Olaechea')
	#('jp' 						'Joseph Pelrine')
	#('jrm' 						'John-Reed Maffeo')
	#('jrp' 						'John Pierce')
	#('jsp' 						'Jeff Pierce')
	#('KenD' 						'Ken Dickey')
	#('kfr' 						'Karl Ramberg')
	#('KLC'			 			'Ken Causey')
	#('KLG'			 			'Gerald Klix')
	#('kph'						'Keith Hodges')
	#('KTT' 						'Kurt Thams')
	#('laza' 						'Alexander Lazarevic')
	#('LC' 						'Leandro Caniglia')
	#('len' 						'Luciano Esteban Notarfrancesco')
	#('lpc'						'Laura Perez Cerrato')
	#('lr' 						'Lukas Renggli')
	#('Lukas Renggli' 						'Lukas Renggli')
	#('ls' 						'Lex Spoon')
	#('md' 						'Marcus Denker')
	#('MarcusDenker' 						'Marcus Denker')
	#('marcus.denker' 						'Marcus Denker')
	#('mdr' 						'Mike Rutenberg')
	#('MEGL' 						'MarceloLamperti')
	#('mga' 						'Markus Galli')
	#('MGD'						'Mat√≠as Dinota')
	#('MH'						'Mat√≠as Halperin')
	#('mha' 						'Michael Haupt')
	#('mir' 						'Michael Rueger')
	#('mjg' 						'Mark Guzdial')
	#('mk'	 					'Matej Kosik')
	#('MM'	 					'Mariano Montone')
	#('mnqpr'	 					'Szabolcs Komaromi')
	#('MPH'	 					'Michael Hewner')
	#('mpw' 						'Marcel Weiher')
	#('MPW' 						'Marcel Weiher')
	#('mrm' 						'Martin McClure')
	#('mtf' 						'Matthew Fulmer')
	#('mu' 						'Masashi Umezawa')
	#('nb' 						'Naala Brewer')
	#('nice'					 	'Nicolas Cellier')
	#('nk' 						'Ned Konz')
	#('NM' 						'Nicola Mingotti')
	#('NMS'						'Nicol√°s Sarfati')
	#('nop' 						'Jay Carlson')
	#('NS' 						'Nathanael Schaerli')
	#('panda' 						'Michael Rueger')
	#('pau'						'Paula Perez Bianchi')
	#('pb'						'Phil Bellalouna')
	#('PB'						'Paolo Belforte')
	#('pmon'						'Paolo Montrasi')
	#('PHK' 						'Peter Keeler')
	#('PM' 						'Peter Mikkelsen')
	#('Pmm' 						'Philippe Marschall')
	#('pnm' 						'Paul McDonough')
	#('r++' 						'Gerardo Richarte')
	#('raa' 						'Bob Arning')
	#('RAA' 						'Bob Arning')
	#('raok' 						'Richard A. O''Keefe')
	#('rca' 						'Russell Allen')
	#('reThink'				 		'Paul McDonough')
	#('rew' 						'Roger Whitney')
	#('rhi' 						'Robert Hirschfeld')
	#('RJT' 						'Ron Teitelbaum')
	#('RNG' 						'Nahuel Garbezza')
	#('rr' 						'Romain Robbes')
	#('rss' 						'Ron Spengler')
	#('rw' 						'Robert Withers')
	#('rww' 						'Robert Withers')
	#('Sames' 						'Samuel S. Shuster')
	#('sbw' 						'Stephan B. Wessels')
	#('sd' 						'Stephane Ducasse')
	#('SD' 						'Stephane Ducasse')
	#('sge' 						'Steve Elkins')
	#('sjd' 						'Santiago Jose Dandois')
	#('SLD'						'Steve Davies')
	#('sma' 						'Stefan Matthias Aust')
	#('sps' 						'Steven Swerling')
	#('SqR' 						'Andres Valloud')
	#('sqr' 						'Andres Valloud')
	#('Squeak1.0'						'Squeak 1.0, September 20, 1996')
	#('Squeak1.1'						'Squeak 1.1, September 23, 1996')
	#('Squeak1.2'						'Squeak 1.2, June 29, 1997')
	#('Squeak1.3'						'Squeak 1.3, January 16, 1998')
	#('sr' 						'Stephan Rudlof')
	#('ss'						'Sebastian Sujarchuk')
	#('SSC' 						'Santiago Salvador Cubino')
	#('SSS' 						'Samuel S. Shuster')
	#('ST-80'						'Smalltalk-80, version 2, of April 1, 1983')
	#('stephane.ducasse' 						'Stephane Ducasse')
	#('stephaneducasse'	 					'Stephane Ducasse')
	#('stp' 						'Stephen Travis Pope')
	#('sumim' 						'Masato Sumi')
	#('S.V.' 						'Sebasti√°n M. Vinto√±uke')
	#('svc' 						'Sven Van Caekenberghe')
	#('svp' 						'Stephen Vincent Pair')
	#('sw' 						'Scott Wallace')
	#('TAG' 						'Travis Griggs')
	#('tak' 						'Takashi Yamamiya')
	#('tao' 						'Tim Olson')
	#('TBn' 						'Torsten Bergmann')
	#('tfei' 						'The Fourth Estate, Inc.')
	#('tfel' 						'Tim Felgentreff')
	#('th' 						'Torge Husfeldt')
	#('tk' 						'Ted Kaehler')
	#('tlk' 						'Tom Koenig')
	#('tpr' 						'Tim Rowledge')
	#('TPR' 						'Tim Rowledge')
	#('TS' 						'Tom√°s Spognardi')
	#('tsl' 						'Thiago da Silva Lino')
	#('tween' 						'Andy Tween')
	#('ul' 						'Levente Uzonyi')
	#('vb' 						'Vassili Bykov')
	#('ward' 						'Ward Cunningham')
	#('wiz' 						'Jerome Peace')
	#('wod' 						'Bill Dargel')
	#('yo' 						'Yoshiki Ohshima')
	#('zz' 						'Serge Stinckwich'))! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6371-AddSebastianAsKnowAuthor-JuanVuletich-2024May17-09h29m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6367] on 17 May 2024 at 9:18:14 am'!
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:12:17' prior: 16811341!
                    backspace
	"Answer the Character representing a backspace."

	^`Character codePoint: 8`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:11:54' prior: 16811347!
                     cr
	"Answer the Character representing a carriage return."

	^`Character codePoint: 13`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:12:34' prior: 16811353!
                     delete

	^ `Character codePoint: 127`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:12:49' prior: 16811358!
       end

	^ `Character codePoint: 4`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:13:10' prior: 16811362!
            enter
	"Answer the Character representing enter."

	^ `Character codePoint: 3`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:13:24' prior: 16811368!
                              escape
	"Answer the ASCII ESC character"

	^ `Character codePoint: 27`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:13:34' prior: 16811374!
      home

	^ `Character codePoint: 1`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:13:43' prior: 16811378!
           insert

	^ `Character codePoint: 5`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:11:50' prior: 16811382!
         lf
	"Answer the Character representing a linefeed."

	^`Character codePoint: 10`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:14:06' prior: 16811397!
                            newPage
	"Answer the Character representing a form feed."

	^ `Character codePoint: 12`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:14:16' prior: 16811403!
                     null
	"Answer the null Character."

	^ `Character codePoint: 0`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:14:30' prior: 16811408!
             pageDown

	^ `Character codePoint: 12`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:14:40' prior: 16811413!
      pageUp

	^ `Character codePoint: 11`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:14:52' prior: 16811417!
        shortUnderscore
	"Answer the Character representing very short (or invisible) underscore.
	Used to optionally mark subscript in code."

	^ `Character codePoint: 127`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:15:02' prior: 16811426!
       smalltalkDownArrow
	"
	The use of code 31 for a down arrow is not part of the ASCII or Unicode standards.
	This code is generally not used in text.
	Cuis holds a down arrow glyph at this code. This is for possible future use.

	The actual glyph used is decided by the TrueType font. See #mapAndStoreGlyphsUsing:
		and references to FallbackArrowGlyphs.

	Character smalltalkDownArrow
	"
	^ `Character codePoint: 31`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:15:08' prior: 16811443!
             smalltalkLeftArrow
	"
	The use of code 28 for a left arrow is not part of the ASCII or Unicode standards.
	This code is generally not used in text files.

	Cuis holds a left arrow glyph at this code, that is only used to show $_ as a left arrow,
	when used for assignment of a Smalltalk variable.
	Note that it will be replaced by $_ when saving code files or exporting to OS clipboard.
	Browse senders to see how this works.

	The actual glyph used is decided by the TrueType font. See #mapAndStoreGlyphsUsing:
		and references to FallbackArrowGlyphs.

	Character smalltalkLeftArrow
	"
	^ `Character codePoint: 28`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:15:13' prior: 16811466!
     smalltalkRightArrow
	"
	The use of code 30 for a right arrow is not part of the ASCII or Unicode standards.
	This code is generally not used in text.
	Cuis holds a right arrow glyph at this code. This is for possible future use.

	The actual glyph used is decided by the TrueType font. See #mapAndStoreGlyphsUsing:
		and references to FallbackArrowGlyphs.

	Character smalltalkRightArrow
	"
	^ `Character codePoint: 30`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:15:19' prior: 16811483!
         smalltalkUpArrow
	"
	The use of code 29 for an up arrow is not part of the ASCII or Unicode standards.
	This code is generally not used in text files.

	Cuis holds an up arrow glyph at this code, that is only used to show $^ as an up arrow,
	when used for return from a Smalltalk method.
	Note that it will be replaced by $^ when saving code files or exporting to OS clipboard.
	Browse senders to see how this works.

	The actual glyph used is decided by the TrueType font. See #mapAndStoreGlyphsUsing:
		and references to FallbackArrowGlyphs.

	Character smalltalkUpArrow
	"
	^ `Character codePoint: 29`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:15:46' prior: 16811505!
                space
	"Answer the Character representing a space."

	^ `Character codePoint: 32`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:16:04' prior: 16811511!
                           tab
	"Answer the Character representing a tab."

	^ `Character codePoint: 9`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 5/17/2024 09:16:19' prior: 16811516!
zeroWidthSpace

	^ `Character codePoint: 16r200B`! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6372-Character-enh-JuanVuletich-2024May17-09h10m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6372] on 17 May 2024 at 12:21:48 pm'!
!AbstractFont class methodsFor: 'ui' stamp: 'jmv 5/17/2024 12:21:35'!
   fromUser
	"
	Query the user for a Font (FontFamily + pointSize).
	 AbstractFont fromUser
	"
	^self fromUser: FontFamily defaultFamilyAndPointSize ! !
!AbstractFont class methodsFor: 'ui' stamp: 'jmv 5/17/2024 12:21:42'!
    fromUser: priorFont
	"
	Query the user for a Font (FontFamily + pointSize).
	AbstractFont fromUser
	"
	"Present a menu of available fonts, and if one is chosen, return it.
	Otherwise return nil.
	Show only baseFonts i.e. FamilyName, pointSize (but do not include emphasis, such as italic or bold)"

	| fontList fontMenu active ptMenu label spec |
	fontList := FontFamily familyNames.
	fontMenu := MenuMorph new defaultTarget: self.
	fontList do: [:fontName | 
			active := priorFont familyName sameAs: fontName.
			ptMenu := MenuMorph new defaultTarget: self.
			(FontFamily pointSizesFor:fontName ) do: [ :pt | 
					(active and: [pt = priorFont pointSize]) 
						ifTrue: [label := '<on>']
						ifFalse: [label := '<off>'].
					label := label , pt printString , ' pt'.
					ptMenu 
						add: label
						target: fontMenu
						action: #modalSelection:
						argument: { 
								fontName.
								pt}].
			active ifTrue: [label := '<on>'] ifFalse: [label := '<off>'].
			label := label , fontName.
			fontMenu add: label subMenu: ptMenu].
	spec := fontMenu invokeModal.
	spec ifNil: [^nil].
	^FontFamily familyName: spec first pointSize: spec last! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6373-Font-fromUser-JuanVuletich-2024May17-12h19m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6367] on 14 May 2024 at 11:59:26 am'!
!HierarchicalListMorph methodsFor: 'initialization' stamp: 'jmv 5/14/2024 11:45:33'!
     mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel

	mainView := aMainView.
	menuGetter := getMenuSel.
	keystrokeActionSelector := keyActionSel.! !
!HierarchicalListMorph methodsFor: 'initialization' stamp: 'jmv 5/14/2024 11:45:55'!
 model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel

	self model: anObject.
	getListSelector := getListSel.
	getSelectionSelector := getSelectionSel.
	setSelectionSelector := setSelectionSel.
	autoDeselect := true.
	self list: self getList.! !
!PluggableListMorph methodsFor: 'initialization' stamp: 'jmv 5/14/2024 11:46:43'!
             mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel

	mainView := aMainView.
	menuGetter := getMenuSel.
	keystrokeActionSelector := keyActionSel.! !
!PluggableListMorph methodsFor: 'initialization' stamp: 'jmv 5/14/2024 11:49:46'!
    model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel

	self model: anObject.
	getListSelector := getListSel.
	getIndexSelector := getSelectionSel.
	setIndexSelector := setSelectionSel.
	autoDeselect := true.
	self
		updateList;
		initForKeystrokes
! !
!PluggableListMorphOfMany methodsFor: 'initialization' stamp: 'jmv 5/14/2024 11:57:56'!
model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel
	"setup a whole load of pluggability options"
	getSelectionListSelector := getListSel.
	setSelectionListSelector := setListSel.
	self model: anObject listGetter: listSel indexGetter: getSelectionSel indexSetter: setSelectionSel! !
!HierarchicalListMorph class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 11:50:55' prior: 16874858!
                       model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Create a 'pluggable' list view on the given model parameterized by the given message selectors."

	^ self new
		model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel;
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel! !
!PluggableListMorph class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 11:51:09' prior: 16924100!
         model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Create a 'pluggable' list view on the given model parameterized by the given message selectors."

	^ self new
		model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel;
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel! !
!PluggableListMorphOfMany class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 11:58:33' prior: 16924365!
   model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	^self new
		model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel;
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6374-PluggableListsRefactor-p1-JuanVuletich-2024May14-11h41m-jmv.002.cs.st----!

'From Cuis7.1 [latest update: #6368] on 14 May 2024 at 12:18:03 pm'!
!HierarchicalListMorph class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 12:03:23'!
       withModel: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel
	"Create a 'pluggable' list view on the given model parameterized by the given message selectors."

	^ self new
		model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel! !
!PluggableListMorph class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 12:02:58'!
          withModel: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel
	"Create a 'pluggable' list view on the given model parameterized by the given message selectors."

	^ self new
		model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel! !
!PluggableListMorphOfMany class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 12:03:59'!
    withModel: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel
	^self new
		model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel! !
!HierarchicalListMorph class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 12:05:27' prior: 50332392!
                      model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Deprecated. Please inline in senders."

	^ (self withModel: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel)
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel! !
!PluggableListMorph class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 12:05:33' prior: 50332410!
    model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Deprecated. Please inline in senders."

	^ (self withModel: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel)
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel! !
!PluggableListMorphOfMany class methodsFor: 'instance creation' stamp: 'jmv 5/14/2024 12:07:09' prior: 50332428!
                              model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Deprecated. Please inline in senders."

	^(self withModel: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel)
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel! !
!CodePackageListWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:15:53' prior: 16825013!
       buildMorphicWindow
	" 
	CodePackageListWindow open: CodePackageList new
	"
	| names fileNames namesPane fileNamesPane 
	upperRow  description summary labelBackground |
	labelBackground := Theme current background.
	
	names := PluggableListMorph
		withModel: model 
		listGetter: #packageNames
		indexGetter: #selectionIndex
		indexSetter: #selectionIndex:.
	namesPane := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: ' Package Name');
		addMorphUseAll: names.

	fileNames := PluggableListMorph
		withModel: model 
		listGetter: #packageFullNames
		indexGetter: #selectionIndex
		indexSetter: #selectionIndex:.
	fileNames alwaysHideVerticalScrollbar.
	fileNamesPane := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: ' File Name');
		addMorphUseAll: fileNames.

	upperRow := LayoutMorph newRow.
	upperRow
		addMorph: namesPane proportionalWidth: 0.4;
		addAdjusterAndMorph: fileNamesPane proportionalWidth: 0.6.
		
	description := (TextModelMorph
		textProvider: model
		textGetter: #description 
		textSetter: #description:) emptyTextDisplayMessage: 'Please enter a description for this package'.

	summary := (TextModelMorph
		textProvider: model
		textGetter: #summary) emptyTextDisplayMessage: 'Package summary (No package selected?)'.
	
	names scrollSiblings: {fileNames}.
	fileNames scrollSiblings: {names}.

	self layoutMorph
		addMorph: upperRow proportionalHeight: 0.6;
		addAdjusterAndMorph: self buildButtonPane fixedHeight: Theme current buttonPaneHeight;
		addAdjusterAndMorph: summary fixedHeight: 60;
		addAdjusterAndMorph: description proportionalHeight: 0.25;
		addAdjusterAndMorph: self buildRequirementsPane proportionalHeight: 0.15.
	self setLabel: 'Installed Packages'! !
!CodePackageListWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:16:01' prior: 16825077!
                   buildRequirementsPane

	| requirements deleteReqButton "editReqButton" reqLayout buttonLayout updateReqButton |
	requirements := PluggableListMorph
		withModel: (PackageRequirementsList fromCodePackageList: model)
		listGetter: #requirementsStrings
		indexGetter: #selectionIndex
		indexSetter: #selectionIndex:.
		
	deleteReqButton := (PluggableButtonMorph 
							model: requirements model
							action: #deleteSelectedRequirement 
							label: 'delete')
							setBalloonText: 'Remove selected Feature requirement'.
	deleteReqButton color: self widgetsColor.
	updateReqButton := (PluggableButtonMorph 
							model: requirements model
							action: #updateSelectedRequirement 
							label: 'update')
							setBalloonText: 'Update requirement to current Feature revision'.
	updateReqButton color: self widgetsColor.
							
	buttonLayout := LayoutMorph newRow.
	buttonLayout 
		addMorph: deleteReqButton 
		layoutSpec: (LayoutSpec 
						proportionalWidth: 1.0 
						proportionalHeight: 1.0
						offAxisEdgeWeight: #leftOrTop);
		color: self widgetsColor quiteWhiter;
		addMorph: updateReqButton 
		layoutSpec: (LayoutSpec 
						proportionalWidth: 1.0 
						proportionalHeight: 1.0
						offAxisEdgeWeight: #leftOrTop);
		color: self widgetsColor quiteWhiter.
		
	model when: #changed: send: #updateRequirementsFromPackageList to: requirements model.
	self when: #changed: send: #updateRequirementsFromPackageList to: requirements model.
	requirements model when: #changed: send: #verifyContents to: requirements.
	self when: #changed: send: #verifyContents to: requirements.
	
	reqLayout := LayoutMorph newRow.
	^ reqLayout 
		doAdoptWidgetsColor;
		addMorph: requirements 
			layoutSpec: (LayoutSpec 
							proportionalWidth: 0.8
							proportionalHeight: 1.0 
							offAxisEdgeWeight: #leftOrTop);
		addMorph: buttonLayout 
			layoutSpec: (LayoutSpec 
							proportionalWidth: 0.2 
							proportionalHeight: 1.0 
							offAxisEdgeWeight: #rightOrBottom);
		color: `Color transparent`;
		yourself
		! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:07:38' prior: 16799316!
                               buildMorphicClassList

	^(PluggableListMorph
		withModel: model
		listGetter: #classList
		indexGetter: #classListIndex
		indexSetter: #classListIndex:)
			mainView: self
			menuGetter: #classListMenu
			keystrokeAction: #classListKey:from:! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:08:02' prior: 16799337!
                 buildMorphicMessageCatList

	^(PluggableListMorph
		withModel: model
		listGetter: #messageCategoryList
		indexGetter: #messageCategoryListIndex
		indexSetter: #messageCategoryListIndex:)
			mainView: self
			menuGetter: #messageCategoryMenu
			keystrokeAction: #messageCatListKey:from:! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:08:43' prior: 16799349!
   buildMorphicMessageList
	"Build a morphic message list, with #messageList as its list-getter"

	^(PluggableListMorph
		withModel: model
		listGetter: #messageList
		indexGetter: #messageListIndex
		indexSetter: #messageListIndex:)
			mainView: self
			menuGetter: #messageListMenu
			keystrokeAction: #messageListKey:from:! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:09:33' prior: 16799383!
                               buildMorphicSystemCategoryList
	^(HierarchicalListMorph
		withModel: model
		listGetter: #systemCategoryRoots
		indexGetter: #selectedSystemCategory
		indexSetter: #setSelectedSystemCategoryTreeItem:)
			mainView: self menuGetter: #systemCategoryMenu keystrokeAction: #systemCatListKey:from:;
			autoDeselect: true;
			autoExpand: true;
			yourself! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:09:47' prior: 16799434!
     buildNoSysCatMorphicWindow
	"A Browser without the class categories list"

	| mySingletonList upperPanes messageCatList messageList classColumn classList |
	mySingletonList := (PluggableListMorph
				withModel: model
				listGetter: #systemCategorySingleton
				indexGetter: #indexIsOne
				indexSetter: #indexIsOne:)
					mainView: self
					menuGetter: #systemCatSingletonMenu
					keystrokeAction: #systemCatSingletonKey:from:.
	mySingletonList hideScrollBarsIndefinitely.

	classList := self buildMorphicClassList.
	classColumn := self buildMorphicClassColumnWith: classList.
	messageCatList := self buildMorphicMessageCatList.
	messageList := self buildMorphicMessageList.
	
	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: classColumn proportionalWidth: 0.3;
		addAdjusterAndMorph: messageCatList proportionalWidth: 0.3;
		addAdjusterAndMorph: messageList proportionalWidth: 0.4.

	messageList allowItemDrag: true.
	messageCatList
		acceptDropsFrom: messageList
		performing: #categorizeUnderCategoryAt:selector:.

	self layoutMorph
		addMorph: mySingletonList fixedHeight: (Preferences at: #standardCodeFont) lineSpacing + 10;
		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.

	model changed: #editSelection! !
!CodeFileBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:10:07' prior: 16823254 overrides: 16799397!
              buildMorphicWindow
	"Create a pluggable version of all the views for a Browser, using Morphic widgets."

	| sysCatList msgCatList upperPanes clsLayout clsList msgList |
	model setSelectedSystemCategory: model systemCategoryList first.
	sysCatList := (PluggableListMorph
			withModel: model 
			listGetter: #systemCategorySingleton
			indexGetter: #indexIsOne 
			indexSetter: #indexIsOne:)
				mainView: self
				menuGetter: #codeFileListMenu
				keystrokeAction: #codeFileListKey:from:.
	sysCatList hideScrollBarsIndefinitely.
	
	msgCatList := (PluggableListMorph
			withModel: model 
			listGetter: #messageCategoryList
			indexGetter: #messageCategoryListIndex 
			indexSetter: #messageCategoryListIndex:)
				mainView: self
				menuGetter: #messageCategoryMenu
				keystrokeAction: nil.

	clsList := self buildMorphicClassList.
	clsLayout := self buildMorphicClassColumnWith: clsList.
	msgList := self buildMorphicMessageList.

	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: clsLayout proportionalWidth: 0.3;
		addAdjusterAndMorph: msgCatList proportionalWidth: 0.3;
		addAdjusterAndMorph: msgList proportionalWidth: 0.4.

	self layoutMorph
		addMorph: sysCatList fixedHeight: (Preferences at: #standardCodeFont) lineSpacing + 10;
		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.
	model changed: #editSelection! !
!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:06:15' prior: 16805289!
 buildMorphicWindow
	"Open a morphic view for the messageSet, whose label is labelString. 
	The listView may be either single or multiple selection type"

	| listPane desiredExtent desiredHeight wine availableHeight |
	listPane := (PluggableListMorphOfMany
		withModel: model
		listGetter: #list
		primarySelectionGetter: #listIndex
		primarySelectionSetter: #toggleListIndex:
		listSelectionGetter: #listSelectionAt:
		listSelectionSetter: #listSelectionAt:put:)
			mainView: self
			menuGetter: #listMenu
			keystrokeAction: #changeListKey:from:.
	desiredExtent := listPane desiredExtent.
	desiredHeight := desiredExtent y.
	wine := RealEstateAgent standardWindowExtent.
	availableHeight := wine y - self labelHeight - (borderWidth * 2).
	desiredExtent x > wine x ifTrue: [
		desiredHeight := desiredHeight + ScrollBar scrollbarThickness ].
	desiredHeight / availableHeight < 0.4
		ifTrue: [		"Number of items is small enough to make for a fixed list regardless of Window resize"
			self layoutMorph
				addMorph: listPane fixedHeight: desiredHeight;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 1.0 ]
		ifFalse: [		"Number of items is large enough to prefer a list proportional to Window resize"
			self layoutMorph
				addMorph: listPane proportionalHeight: 0.4;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.6.
			listPane limitLayoutHeight ].! !
!VersionsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:10:27' prior: 17003664 overrides: 50332826!
                       buildMorphicWindow
	"Open a morphic view for the messageSet, whose label is labelString. 
	The listView may be either single or multiple selection type"

	| listPane desiredExtent desiredHeight wine availableHeight |
	listPane := (PluggableListMorph
		withModel: model
		listGetter: #list
		indexGetter: #listIndex
		indexSetter: #toggleListIndex:)
			mainView: self
			menuGetter: #listMenu
			keystrokeAction: #changeListKey:from:.
	desiredExtent := listPane desiredExtent.
	desiredHeight := desiredExtent y.
	wine := RealEstateAgent standardWindowExtent.
	availableHeight := wine y - self labelHeight - (borderWidth * 2).
	desiredExtent x > wine x ifTrue: [
		desiredHeight := desiredHeight + ScrollBar scrollbarThickness ].
	desiredHeight / availableHeight < 0.4
		ifTrue: [		"Number of items is small enough to make for a fixed list regardless of Window resize"
			self layoutMorph
				addMorph: listPane fixedHeight: desiredHeight;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 1.0 ]
		ifFalse: [		"Number of items is large enough to prefer a list proportional to Window resize"
			self layoutMorph
				addMorph: listPane proportionalHeight: 0.4;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.6.
			listPane limitLayoutHeight ].! !
!ChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:14:30' prior: 16810171!
buildMorphicWindow
	"Add a set of change sorter views to the given top view offset by the given amount. To create a single change sorter, call this once with an offset of 0@0. To create a dual change sorter, call it twice with offsets of 0@0 and 0.5@0."

	| changeSetList classList changeSetListPane classListPane
	  messageList upperPanes labelBackground |
	labelBackground := Theme current background.
	model myChangeSet ifNil: [
		"Or whatever was last changed, or is top of list, or whatever"
		model myChangeSet: ChangeSet changeSetForBaseSystem ].

	changeSetList := (PluggableListMorphByItem
				withModel: model
				listGetter: #changeSetList
				indexGetter: #currentChangeSetName
				indexSetter: #showChangeSetNamed:)
					mainView: self
					menuGetter: #changeSetMenu
					keystrokeAction: #changeSetListKey:from:;
						autoDeselect: false.
	changeSetListPane := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: 'Change Set name');
		addMorphUseAll: changeSetList.

	classList := (PluggableListMorphByItem
				withModel: model
				listGetter: #classList
				indexGetter: #currentClassName
				indexSetter: #currentClassName:)
					mainView: self
					menuGetter: #classListMenu
					keystrokeAction: #classListKey:from:.
	classListPane := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: 'Classes');
		addMorphUseAll: classList.

	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: changeSetListPane proportionalWidth: 0.6;
		addAdjusterAndMorph: classListPane proportionalWidth: 0.4.
	
	messageList := (PluggableListMorphByItem
				withModel: model
				listGetter: #messageList
				indexGetter: #currentSelector
				indexSetter: #currentSelector:)
					mainView: self
					menuGetter: #messageMenu
					keystrokeAction: #messageListKey:from:.
	messageList := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: 'Methods');
		addMorphUseAll: messageList.

	self layoutMorph
		addMorph: upperPanes proportionalHeight: 0.25;
		addAdjusterAndMorph: messageList proportionalHeight: 0.2;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.55.

	self setLabel: model labelString! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:11:14' prior: 16845109!
                        contextVariableInspector

	^ contextVariableInspector ifNil: [
		contextVariableInspector := (PluggableListMorph
			withModel: model contextVariablesInspector 
			listGetter: #fieldList
			indexGetter: #selectionIndex 
			indexSetter: #toggleIndex:)
				mainView: self
				menuGetter: #contextFieldListMenu
				keystrokeAction: #inspectorKey:from: ]! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:11:30' prior: 16845209!
   receiverInspector

	^ receiverInspector ifNil: [
		receiverInspector := (PluggableListMorph
			withModel: model receiverInspector
			listGetter: #fieldList
			indexGetter: #selectionIndex 
			indexSetter: #toggleIndex:)
				mainView: self
				menuGetter: #receiverFieldListMenu
				keystrokeAction: #inspectorKey:from: ]! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:11:42' prior: 16845234!
stackList

	^ stackList ifNil: [
		stackList := (PluggableListMorph
			withModel: model 
			listGetter: #contextStackList
			indexGetter: #contextStackIndex
			indexSetter: #toggleContextStackIndex:)
				mainView: self
				menuGetter: #contextStackMenu
				keystrokeAction: #contextStackKey:from: ]! !
!MethodSetWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:11:53' prior: 16902012!
                     buildMorphicMessageList
	"Build a morphic message list, with #messageList as its list-getter"

	^(PluggableListMorph
		withModel: model
		listGetter: #messageList
		indexGetter: #messageListIndex
		indexSetter: #messageListIndex:)
			mainView: self
			menuGetter: #messageListMenu
			keystrokeAction: #messageListKey:from:! !
!MessageNamesWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:12:11' prior: 16895228 overrides: 16902025!
      buildMorphicWindow
	"Answer a morphic window with the given initial search string, nil if none"
	"MessageNames open"
	| selectorListView firstRow searchButton secondRow |
	textMorph := (TextModelMorph
		textProvider: model
		textGetter: #searchString
		textSetter: #searchString:
		selectionGetter: #contentsSelection)
		setBalloonText: 'See MessageNames class comment for search string options';
		emptyTextDisplayMessage: 'Type here, then hit Search'.
	textMorph askBeforeDiscardingEdits: false.
	textMorph acceptOnCR: true.
	textMorph hideScrollBarsIndefinitely.
	searchButton := PluggableButtonMorph new
		model: textMorph innerTextMorph;
		label: 'Search';
		action: #acceptContents.
	searchButton setBalloonText: 'Type some letters into the pane at right, and then press this Search button (or hit RETURN) and all method selectors that match what you typed will appear in the list pane below.  Click on any one of them, and all the implementors of that selector will be shown in the right-hand pane, and you can view and edit their code without leaving this tool.'.
	firstRow := LayoutMorph newRow.
	firstRow color: self windowColor.
	firstRow
		doAdoptWidgetsColor;
		
			addMorph: searchButton
			proportionalWidth: 0.25;
		
			addMorph: textMorph
			proportionalWidth: 0.75.
	selectorListView := (PluggableListMorph
		withModel: model
		listGetter: #selectorList
		indexGetter: #selectorListIndex
		indexSetter: #selectorListIndex:)
			mainView: self
			menuGetter: #selectorListMenu
			keystrokeAction: #selectorListKey:from:.
	secondRow := LayoutMorph newRow.
	secondRow
		
			addMorph: selectorListView
			proportionalWidth: 0.5;
		
			addAdjusterAndMorph: self buildMorphicMessageList
			proportionalWidth: 0.5.
	self layoutMorph
		
			addMorph: firstRow
			fixedHeight: self defaultButtonPaneHeight + 4;
		
			addAdjusterAndMorph: secondRow
			proportionalHeight: 0.5;
		
			addAdjusterAndMorph: self buildLowerPanes
			proportionalHeight: 0.5.
	model changed: #editSelection! !
!ProtocolBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:12:26' prior: 16932463!
                    buildSelectiveClassList
	"Define the class hierarchy list pane"

	^(PluggableListMorph
		withModel: model
		listGetter: #selectiveClassList
		indexGetter: #selectiveClassListIndex
		indexSetter: #selectiveClassListIndex:)
			mainView: self 
			menuGetter: #protocolClassListMenu 
			keystrokeAction: #protocolClassListKey:from:! !
!PreDebugWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:12:40' prior: 16927768!
                         buildMorphicWindowMessage: messageString
	| notifyPane |
	model expandStack.
	messageString
		ifNil: [
			notifyPane := PluggableListMorph
				withModel: model
				listGetter: #contextStackList
				indexGetter: #contextStackIndex
				indexSetter: #openFullAt: ]
		ifNotNil: [
			notifyPane := TextModelMorph withText: messageString.
			notifyPane askBeforeDiscardingEdits: false ].
	self layoutMorph
		addMorph: (self buttonRowForPreDebugWindow: model) proportionalHeight: 0.2;
		addAdjusterAndMorph: notifyPane proportionalHeight: 0.8! !
!FileListWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:12:57' prior: 16862711!
         morphicDirectoryTreePane

	^(HierarchicalListMorph
		withModel: model
		listGetter: #topDirectoryWrappers
		indexGetter: #currentDirectorySelected
		indexSetter: #setSelectedDirectoryTo:)
			mainView: self
			menuGetter: #directoryTreeMenu
			keystrokeAction: nil;
				autoDeselect: false;
				yourself! !
!FileListWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:14:41' prior: 16862731!
                  morphicFileListPane

	^(PluggableListMorph
		withModel: model 
		listGetter: #fileList 
		indexGetter: #fileListIndex
		indexSetter: #fileListIndex: )
			mainView: self
			menuGetter: #fileListMenu
			keystrokeAction: #fileListKey:from:! !
!InspectorWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:13:09' prior: 16883043!
                   buildList

	| list |
	
	list := (PluggableListMorph
			withModel: model 
			listGetter: #fieldList
			indexGetter: #selectionIndex
			indexSetter: #toggleIndex:)
				mainView: self
				menuGetter: #fieldListMenu
				keystrokeAction: #inspectorKey:from:.
	list doubleClickSelector: #inspectSelection.
	
	^list! !
!ObjectExplorerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:16:18' prior: 16916477!
      buildMorphicWindow

	| textMorph |
	listMorph := (HierarchicalListMorph
			withModel: model
			listGetter: #getList
			indexGetter: #getCurrentSelection
			indexSetter: #noteNewSelection:)
				mainView: self
				menuGetter: #genericMenu
				keystrokeAction: #explorerKey:from:.
	listMorph autoDeselect: false.
	listMorph doubleClickSelector: #inspectSelection.
	textMorph := ((TextModelMorph textProvider: model)
			askBeforeDiscardingEdits: false;
			emptyTextDisplayMessage: 'Smalltalk expression (self is selected item)').
	self layoutMorph
		addMorph: listMorph proportionalHeight: 0.8;
		addAdjusterAndMorph: textMorph proportionalHeight: 0.2.
	self setLabel: model rootObject shortPrintString.! !
!ProcessBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:13:40' prior: 16930687!
                               buildMorphicWindow
	"Create a pluggable version of me, answer a window"
	| aTextMorph list1 list2 upperRow |
	list1 := (PluggableListMorph
				withModel: model
				listGetter: #processNameList
				indexGetter: #processListIndex
				indexSetter: #processListIndex:)
					mainView: self
					menuGetter: #processListMenu
					keystrokeAction: #processListKey:from:.
	list2 := (PluggableListMorph
				withModel: model
				listGetter: #stackNameList
				indexGetter: #stackListIndex
				indexSetter: #stackListIndex:)
					mainView: self
					menuGetter: #stackListMenu
					keystrokeAction: #stackListKey:from:.
	upperRow := LayoutMorph newRow.
	upperRow
		addMorph: list1 proportionalWidth: 0.5;
		addAdjusterAndMorph: list2 proportionalWidth: 0.5.
	aTextMorph := (TextModelMorph
				textProvider: model
				textGetter: #selectedMethod) emptyTextDisplayMessage: 'Method source (not selected?)'.
	aTextMorph askBeforeDiscardingEdits: false.
	self layoutMorph
		addMorph: upperRow proportionalHeight: 0.5;
		addAdjusterAndMorph: aTextMorph proportionalHeight: 0.5.
	self setLabel: 'Process Browser'! !
!TestRunnerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:13:52' prior: 16976786!
                        buildErrorsList
	^ PluggableListMorph
		withModel: model
		listGetter: #errorsList
		indexGetter: #selectedErrorTest
		indexSetter: #debugErrorTest:! !
!TestRunnerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:14:05' prior: 16976795!
          buildFailuresList
	^ PluggableListMorph
		withModel: model
		listGetter: #failuresList
		indexGetter: #selectedFailureTest
		indexSetter: #debugFailureTest:! !
!TestRunnerWindow methodsFor: 'GUI building' stamp: 'jmv 5/14/2024 12:06:30' prior: 16976923!
  buildUpperControls
	| refreshButton filterButton stopButton runOneButton runButton runProfiledButton buttonsRow theTestsList column |

	runOneButton := self buildRunOneButton.
	runButton := self buildRunButton.
	runProfiledButton := self buildRunProfiledButton.	

	refreshButton := self buildRefreshButton.
	filterButton := self buildFilterButton.
	stopButton := self buildStopButton.

	theTestsList := (PluggableListMorphOfMany
				withModel: model
				listGetter: #tests
				primarySelectionGetter: #selectedSuite
				primarySelectionSetter: #selectedSuite:
				listSelectionGetter: #listSelectionAt:
				listSelectionSetter: #listSelectionAt:put:)
					mainView: self
					menuGetter: #listMenu
					keystrokeAction: #listKey:from:.
	theTestsList autoDeselect: false.
	theTestsList color: self textBackgroundColor.

	buttonsRow := LayoutMorph newRow.
	buttonsRow doAdoptWidgetsColor.
	buttonsRow color: self buttonColor.
	buttonsRow
		addMorphs: {runButton. runOneButton. runProfiledButton};
		addMorphs: {refreshButton. filterButton. stopButton}.

	column := LayoutMorph newColumn.
	column
		addMorph: theTestsList proportionalHeight: 1;
		addMorph: buttonsRow fixedHeight: self defaultButtonPaneHeight.

	^ column! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6375-PluggableListsRefactor-p2-JuanVuletich-2024May14-12h02m-jmv.002.cs.st----!

'From Cuis7.1 [latest update: #6367] on 15 May 2024 at 5:41:01 pm'!
!BrowserWindow methodsFor: 'menu building' stamp: 'jmv 5/15/2024 15:26:15' overrides: 16827435!
             openMessageListMenu
	"Offer the unshifted selector-list menu"

	^ self messageListMenu popUpInWorld! !
!BrowserWindow methodsFor: 'menu building' stamp: 'jmv 5/15/2024 15:26:42' overrides: 16827441!
                         openMessageListMenu2
	"Offer the additional selector-list menu"

	^ self messageListMenu2 popUpInWorld! !
!BrowserWindow methodsFor: 'keyboard shortcuts' stamp: 'jmv 5/15/2024 15:33:24' overrides: 16827570!
                 classListKey: aChar from: view 
	"Respond to a Command key.  I am a model with a list of classes and a 
	code pane, and I also have a listView that has a list of methods.  The 
	view knows how to get the list and selection."

	self flag: #definesKeyboardShortcuts.
	aChar = $r ifTrue: [^ model recent].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $x ifTrue: [^ model removeClass].
	aChar = $t ifTrue: [^ model runClassTests ].
	
	^ self messageListKey: aChar from: view! !
!BrowserWindow methodsFor: 'keyboard shortcuts' stamp: 'jmv 5/15/2024 15:31:14' overrides: 16827588!
                       messageCatListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $o ifTrue: [ ^ model fileOutMessageCategories ].
	aChar = $t ifTrue: [ ^ model runMessageCategoryTests ].
	aChar = $x ifTrue: [ ^ model removeMessageCategory ].
	aChar = $R ifTrue: [ ^ model renameCategory ].
	aChar = $n ifTrue: [ ^ model addCategory ].
	aChar = $N ifTrue: [ ^ model addExtensionCategory ].
	aChar = $e ifTrue: [ ^ model removeEmptyCategories ].
	aChar = $c ifTrue: [ ^ model categorizeAllUncategorizedMethods ].
	aChar = $a ifTrue: [ ^ model alphabetizeMessageCategories ].
	aChar = $r ifTrue: [ ^ model editMessageCategories ]! !
!MethodSetWindow methodsFor: 'menu building' stamp: 'jmv 5/15/2024 15:26:16' overrides: 16827435!
    openMessageListMenu
	"Offer the unshifted selector-list menu"

	^ self messageListMenu popUpInWorld! !
!MethodSetWindow methodsFor: 'menu building' stamp: 'jmv 5/15/2024 15:26:41' overrides: 16827441!
                       openMessageListMenu2
	"Offer the additional selector-list menu"

	^ self messageListMenu2 popUpInWorld! !
!BrowserWindow methodsFor: 'keyboard shortcuts' stamp: 'jmv 5/15/2024 15:30:12' prior: 16799658 overrides: 16827661!
 systemCatListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $r ifTrue: [^ model recent ].
	aChar = $f ifTrue: [ ^ self findClass ].
	aChar = $x ifTrue: [ ^ model removeSystemCategory ].
	aChar = $t ifTrue: [ ^ model runSystemCategoryTests ].
	aChar = $a ifTrue: [ ^ model addSystemCategory ].
	aChar = $A ifTrue: [ ^ model alphabetizeSystemCategories ].
	aChar = $b ifTrue: [ ^ self openSystemCategoryBrowser ].
	aChar = $B ifTrue: [ ^ self browseAllClasses ].
	aChar = $o ifTrue: [ ^ model fileOutSystemCategory ].
	aChar = $u ifTrue: [ ^ model updateSystemCategories ].
	aChar = $R ifTrue: [ ^ model renameSystemCategory ].
	
	^ self classListKey: aChar from: view.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6376-Browser-SmallRefactor-JuanVuletich-2024May15-17h20m-jmv.002.cs.st----!

'From Cuis7.1 [latest update: #6367] on 15 May 2024 at 5:20:24 pm'!
!MessageSend methodsFor: 'evaluating' stamp: 'jmv 5/15/2024 15:51:16' overrides: 16914245!
     valueWithPossibleArgument: anObject

	^selector last = $:
		ifFalse: [ receiver perform: selector ]
		ifTrue: [ receiver perform: selector with: anObject ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6377-MessageSend-enh-JuanVuletich-2024May15-17h20m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6377] on 18 May 2024 at 4:01:29 pm'!
!Morph methodsFor: 'menus' stamp: 'jmv 5/16/2024 09:53:46'!
  getMenu
	^ nil! !
!WorldMorph methodsFor: 'world menu' stamp: 'jmv 5/16/2024 09:55:41' overrides: 50333435!
                    getMenu
	"Put up the world menu, triggered by the passed-in event.
	Perhaps a good place to disable it if needed (by answering nil)"

	^(Preferences at: #worldMenu) getMenuIn: self at: self activeHand.! !
!TaskbarMorph methodsFor: 'menu' stamp: 'jmv 5/16/2024 09:53:01' overrides: 50333435!
                             getMenu

	| menu |
	menu := MenuMorph new defaultTarget: self.
	menu
		addLine;
		add: 'Small Height' action: #scaleSmall;
		add: 'Normal Height' action: #scaleNormal;
		add: 'Scale x 2' action: #scaleX2;
		add: 'Scale x 4' action: #scaleX4.
	^menu! !
!Morph methodsFor: 'event handling' stamp: 'jmv 5/16/2024 09:54:33' prior: 16904468!
               mouseButton2Activity
	"Invoke the menu"
	self getMenu ifNotNil: [ :menu |
		menu popUpInWorld: self world.
		"menu invokeModal" ]! !

TranscriptMorph removeSelector: #mouseButton2Activity!

!methodRemoval: TranscriptMorph #mouseButton2Activity stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
mouseButton2Activity

	"Invoke the menu"
	self getMenu ifNotNil: [ :menu |
		menu popUpInWorld: self world.
		"menu invokeModal" ]!

PluggableScrollPane removeSelector: #mouseButton2Activity!

!methodRemoval: PluggableScrollPane #mouseButton2Activity stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
mouseButton2Activity
	"Invoke the menu"
	self getMenu ifNotNil: [ :menu |
		menu popUpInWorld: self world.
		"menu invokeModal" ]!

PluggableScrollPane removeSelector: #getMenu!

!methodRemoval: PluggableScrollPane #getMenu stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
getMenu
	^ nil!

InnerTextMorph removeSelector: #mouseButton2Activity!

!methodRemoval: InnerTextMorph #mouseButton2Activity stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
mouseButton2Activity
	"Invoke the menu"
	self getMenu ifNotNil: [ :menu |
		menu popUpInWorld: self world.
		"menu invokeModal" ]!

TaskbarMorph removeSelector: #mouseButton2Activity!

!methodRemoval: TaskbarMorph #mouseButton2Activity stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
mouseButton2Activity

	| menu |
	menu := MenuMorph new defaultTarget: self.
	menu
		addLine;
		add: 'Small Height' action: #scaleSmall;
		add: 'Normal Height' action: #scaleNormal;
		add: 'Scale x 2' action: #scaleX2;
		add: 'Scale x 4' action: #scaleX4.
	menu popUpInWorld!

WorldMorph removeSelector: #mouseButton2Activity!

!methodRemoval: WorldMorph #mouseButton2Activity stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
mouseButton2Activity

	^self invokeWorldMenu!

WorldMorph removeSelector: #addCustomMenuItems:hand:!

!methodRemoval: WorldMorph #addCustomMenuItems:hand: stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
addCustomMenuItems: menu hand: aHandMorph 
	"Add morph-specific menu itemns to the menu for the hand"

	super addCustomMenuItems: menu hand: aHandMorph.
	menu 
		add: 'desktop menu...'
		target: self
		action: #invokeWorldMenu.
	menu addLine!

WorldMorph removeSelector: #invokeWorldMenu!

!methodRemoval: WorldMorph #invokeWorldMenu stamp: 'Install-6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:52'!
invokeWorldMenu
	"Put up the world menu, triggered by the passed-in event.
	Perhaps a good place to disable it if needed"

	| menu |
	menu := (Preferences at: #worldMenu) getMenuIn: self at: self activeHand.
	menu popUpInWorld: self!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6378-rightClickMenu-Refactor-JuanVuletich-2024May18-15h45m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6378] on 19 May 2024 at 3:01:44 pm'!

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
SystemOrganization removeEmptyCategories!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6379-RemoveEmptyCategories-JuanVuletich-2024May19-15h01m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6379] on 20 May 2024 at 10:58:25 am'!
!ProgressiveTestRunner methodsFor: 'show result - private' stamp: 'jmv 5/20/2024 10:57:59' prior: 16931943!
                   showDefects
	
	 | defects |
			
	defects := testResult defects.
	"defects size = 1" false
		ifTrue: [ defects anyOne debug ] 
		ifFalse: [ self openTestResultWindow]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6380-ShowOneFailureTheSameAsMany-JuanVuletich-2024May20-10h56m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6379] on 20 May 2024 at 9:54:15 am'!
!PositionableStream methodsFor: 'positioning' stamp: 'jmv 5/19/2024 19:52:39'!
                         matchStart: subCollection
	"Set the access position of the receiver to be past the next occurrence of the subCollection.
	If collection is found, answer match start position. If not, answer nil.
	Answer whether subCollection is found.
	No wildcards, and case does matter."

	| pattern startForNextMatch matchStart p |
	pattern := subCollection readStream.
	startForNextMatch := nil.
	[pattern atEnd] whileFalse: [
		self atEnd ifTrue: [^ nil].
		p := self position.
		(self next) = (pattern next) 
			ifTrue: [
				pattern position = 1 ifTrue: [
					startForNextMatch := self position.
					matchStart := p ]]
			ifFalse: [
				pattern position: 0.
				startForNextMatch ifNotNil: [
					self position: startForNextMatch.
					startForNextMatch := nil ]]].
	^matchStart! !
!PositionableStream methodsFor: 'accessing' stamp: 'jmv 5/19/2024 19:58:28' prior: 16926949!
                             upToAll: aCollection
	"Answer a subcollection from the current access position to the occurrence (if any, but not inclusive) of aCollection. If aCollection is not in the stream, answer the entire rest of the stream."

	| startPos endMatch result |
	startPos := self position.
	(self matchStart: aCollection)
		ifNotNil: [ :matchStart |
			endMatch := self position.
			self position: startPos.
			result := self collectionSpecies streamContents: [ :ws |
				[self position < matchStart] whileTrue: [
					ws nextPut: self next ]].
			self position: endMatch.
			^ result ]
		ifNil: [
			self position: startPos.
			^ self upToEnd ]! !
!PositionableStream methodsFor: 'positioning' stamp: 'jmv 5/19/2024 19:52:59' prior: 16927032!
      match: subCollection
	"Set the access position of the receiver to be past the next occurrence of the subCollection. Answer whether subCollection is found.  No wildcards, and case does matter."

	^(self matchStart: subCollection) notNil
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6381-FileStream-match-fix-JuanVuletich-2024May20-09h53m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6381] on 20 May 2024 at 11:05:54 am'!

ProtocolBrowserWindow removeSelector: #update:!

!methodRemoval: ProtocolBrowserWindow #update: stamp: 'Install-6382-Cleanup-JuanVuletich-2024May20-11h05m-jmv.001.cs.st 6/6/2024 11:37:52'!
update: aSymbol
	"Respond to events of the Dependency Mechanism"
	
	super update: aSymbol.
	aSymbol == #relabel
		ifTrue: [self setLabel: model labelString]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6382-Cleanup-JuanVuletich-2024May20-11h05m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6381] on 20 May 2024 at 11:12:50 am'!
!FileIOAccessor methodsFor: 'actions' stamp: 'jmv 5/19/2024 21:00:26' prior: 16860923!
                        copy: fromFileEntry to: toFileEntry 
	| readStr writeStr |
	[readStr := (self privateReadOnlyFile: fromFileEntry) binary.
	writeStr := (self privateForceNewFile: toFileEntry) binary.
	self copyFile: readStr toFile: writeStr]
		ensure: [
			readStr
				ifNotNil: [ :r | r close ].
			writeStr
				ifNotNil: [ :w | w close ]].
	toFileEntry parent invalidateChildren! !
!DirectoryEntry methodsFor: 'actions-directory' stamp: 'jmv 5/19/2024 21:02:23' prior: 16849000!
                delete
	self fileAccessor deleteDirectory: self pathName.
	self invalidateChildren.
	parent ifNotNil: [ parent invalidateChildren ].! !
!DirectoryEntry methodsFor: 'actions-directory' stamp: 'jmv 5/19/2024 21:04:09' prior: 16849011!
                       rename: newName

	| fileEntry directoryEntry |
	fileEntry := self parent // newName.
	fileEntry exists
		ifTrue: [ Error signal: 'There already exists a file named: ', fileEntry printString ].
	directoryEntry := self parent / newName.
	directoryEntry exists
		ifTrue: [ Error signal: 'There already exists a directory named: ', fileEntry printString ].
	self fileAccessor renameDirectory: self pathName to: directoryEntry pathName.
	self name: newName.
	self parent 	invalidateChildren.! !
!DirectoryEntry methodsFor: 'private' stamp: 'jmv 5/19/2024 21:01:01' prior: 16849028!
                               assureExistenceDirNamed: localName
	
	localName isEmpty ifTrue: [ ^self ]. "Assumed to exist"
	(self fileAccessor fileOrDirectoryExists: localName in: self) ifTrue: [^ self]. "exists"

	"otherwise check parent first and then create local dir"
	self parent ifNotNil: [:p | p assureExistenceDirNamed: self name].

	self fileAccessor createDirectory: (self / localName) pathName.
	self invalidateChildren! !
!DirectoryEntry methodsFor: 'accessing' stamp: 'jmv 5/20/2024 11:10:02' prior: 16849126!
                  children
	(lastChildrenSync isNil or: [
		"This message may be sent many times. Don't call the primitives too often.
		Any time we invalidate children ourselves (by adding / removing / renaming entries) we send #invalidateChildren.
		Still, if directory contents are modified elsewhere (and especially outside Cuis), there will be a delay until we see those changes."
		(DateAndTime now - lastChildrenSync) totalSeconds > 2]) ifTrue: [
			children := nil ].
	children ifNil: [self initChildren].
	^children! !
!FileEntry methodsFor: 'actions-file' stamp: 'jmv 5/19/2024 20:59:36' prior: 16860591!
           delete
	self fileAccessor deleteFile: self pathName.
	self parent invalidateChildren.! !
!FileEntry methodsFor: 'actions-file' stamp: 'jmv 5/19/2024 20:59:40' prior: 16860610!
                rename: newName

	| fileEntry directoryEntry |
	fileEntry := self parent // newName.
	fileEntry exists
		ifTrue: [ Error signal: 'There already exists a file named: ', fileEntry printString ].
	directoryEntry := self parent / newName.
	directoryEntry exists
		ifTrue: [ Error signal: 'There already exists a directory named: ', fileEntry printString ].
	self fileAccessor rename: self pathName to: fileEntry pathName.
	self name: newName.
	self parent invalidateChildren.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6383-DirectoryEntry-invalidateChildren-whenNeeded-JuanVuletich-2024May20-11h05m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6379] on 20 May 2024 at 10:12:52 am'!

ProtocolBrowser removeSelector: #selectedClassOrMetaClass!

!methodRemoval: ProtocolBrowser #selectedClassOrMetaClass stamp: 'Install-6384-ProtocolBrowser-fix-BernhardPieber-2024May20-10h09m-bp.001.cs.st 6/6/2024 11:37:52'!
selectedClassOrMetaClass
	"Answer the class or metaclass that is currently selected. 
	Answer base if no selection exists."
	| className |
	className := (self selectiveClassListIndex = 0) 
					ifTrue:  [self selectiveClassList last]
					ifFalse:  [self selectiveClassList at: self selectiveClassListIndex].
	^ Smalltalk at: ((className findTokens: ' ') first asSymbol)!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6384-ProtocolBrowser-fix-BernhardPieber-2024May20-10h09m-bp.001.cs.st----!

'From Cuis7.1 [latest update: #6380] on 20 May 2024 at 11:07:10 am'!
!ProtocolBrowser methodsFor: 'private' stamp: 'bp 5/20/2024 11:05:55' prior: 16932314!
               hierarchyForClass: aClass
	"Set the class hierarchy for the list pane"
	| tab |

	selectiveClassList := OrderedCollection new.
	tab := ''.
	aClass withAllSuperclasses reverse do: [:ea | 
		selectiveClassList add: tab , ea name.
		tab := tab , '  '].
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6385-ProtocolBrowser-enh-BernhardPieber-2024May20-11h05m-bp.001.cs.st----!

'From Cuis7.1 [latest update: #6384] on 20 May 2024 at 11:50:52 am'!
!Browser methodsFor: 'class list' stamp: 'jmv 5/20/2024 11:48:56' prior: 16797683!
      classListIndex: anInteger 
	"Set anInteger to be the index of the current class selection."

	| className recent canSelectClass classList prevSelectedMessage |

	classList := self classList.
	canSelectClass := classList isInBounds: anInteger.
	selectedClassName := canSelectClass ifTrue: [	| newClassName |
		newClassName := classList at: anInteger ifAbsent: [ nil ].
		newClassName := newClassName ifNotNil: [newClassName withoutLeadingBlanks asSymbol].
		newClassName ].
	self setClassOrganizer.
	prevSelectedMessage := selectedMessage.
	selectedMessage := nil.
	
	self classCommentIndicated ifFalse: [
		self editSelection: (canSelectClass
			ifTrue: [#editClass]
			ifFalse: [ metaClassIndicated | selectedSystemCategory isNil
				ifTrue: [#none]
				ifFalse: [#newClass]])].

	self selectedClass ifNotNil: [
		recent := self class recentClasses.
		className := self selectedClass name.
		(recent includes: className) ifTrue: [recent remove: className].
		recent addFirst: className.
		recent size > 16 ifTrue: [recent removeLast]].

	"Clear selectedMessageCategory if there is no match in the new list of categories"
	(self messageCategoryList indexOf: selectedMessageCategory) = 0 ifTrue: [
		selectedMessageCategory := nil].
		
	"We have to refresh the class list if somebody wants to select a class that does not exist anymore - Hernan"
	anInteger > classList size ifTrue: [ self changed: #classList ].
	self changed: #classSelectionChanged.
	self changed: #classCommentText.
	self changed: #classListIndex.	"update my selection"
	self changed: #messageCategoryList.
	self changed: #messageList.
	self changed: #relabel.
	self acceptedContentsChanged.
	self setSelector: prevSelectedMessage.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6386-KeepSelectedMessageWhenSelectingClass-JuanVuletich-2024May20-11h48m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6386] on 20 May 2024 at 12:22:20 pm'!
!ProtocolBrowserWindow class methodsFor: 'as yet unclassified' stamp: 'jmv 5/20/2024 12:19:34' overrides: 16902303!
          openFullProtocolForClass: aClass
	"Create and schedule a browser for the entire protocol of the class."
	"
	ProtocolBrowserWindow openFullProtocolForClass: Number.
	"

	| aPBrowser label |

	aPBrowser := ProtocolBrowser new on: aClass.
	label := 'Entire protocol of: ', aClass name.

	^self open: aPBrowser label: label! !
!BrowserWindow methodsFor: 'menu building' stamp: 'jmv 5/20/2024 12:13:05' prior: 16799559!
 messageListMenu2
	"Fill aMenu with the items appropriate when the shift key is held down"

	self flag: #assumesKeyboardShortcuts.
	^DynamicMenuBuilder 
		buildTitled: 'Message List' 
		targeting: self 
		collectingMenuOptionsWith: #messageListMenu2Options 
		changingThemWith: [ :options |
			self addExtraMenu2ItemsTo: options.
			model canShowMultipleMessageCategories ifTrue: [	
				options add: `{ 
					#itemGroup 			-> 		40.
					#itemOrder 			-> 		45.		
					#label 			-> 		'show category (C)'.
					#object 			-> 		#model.
					#selector 			-> 		#showHomeCategory.
					#icon 			-> 		#packageIcon
				} asDictionary` ]].
! !
!BrowserWindow class methodsFor: 'browser menues' stamp: 'jmv 5/20/2024 12:12:25' prior: 16800260!
    messageListMenu2Options
	
	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'toggle diffing (D)'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleDiffing.
				#icon 			-> 		#switchIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'implementors of sent messages'.
				#selector 			-> 		#browseAllMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'local senders of...'.
				#selector 			-> 		#browseLocalSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'local implementors of...'.
				#selector 			-> 		#browseLocalImplementors.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'sample instance'.
				#selector 			-> 		#makeSampleInstance.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'inspect instances'.
				#selector 			-> 		#inspectInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'inspect subinstances'.
				#selector 			-> 		#inspectSubInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		40.
				#label 			-> 		'change category...'.
				#object 			-> 		#model.
				#selector 			-> 		#changeCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		50.
				#label 			-> 		'change sets with this method'.
				#selector 			-> 		#findMethodInChangeSets.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		60.
				#label 			-> 		'revert to previous version'.
				#object 			-> 		#model.
				#selector 			-> 		#revertToPreviousVersion.
				#icon 			-> 		#undoIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'more...'.
				#selector 			-> 		#openMessageListMenu.
				#icon 			-> 		#listAddIcon
			} asDictionary.			
		}`! !
!MethodSetWindow methodsFor: 'menu building' stamp: 'jmv 5/20/2024 12:12:46' prior: 16902135!
           messageListMenu2
	"Fill aMenu with the items appropriate when the shift key is held down"

	self flag: #assumesKeyboardShortcuts.
	^DynamicMenuBuilder 
		buildTitled: 'Message Set' 
		targeting: self 
		collectingMenuOptionsWith: #messageSetMenu2Options 
		changingThemWith: [ :options |
			self addExtraMenu2ItemsTo: options.
			model canShowMultipleMessageCategories ifTrue: [	
				options add: `{ 
					#itemGroup 			-> 		40.
					#itemOrder 			-> 		45.		
					#label 			-> 		'show category (C)'.
					#object 			-> 		#model.
					#selector 			-> 		#showHomeCategory.
					#icon 			-> 		#packageIcon
				} asDictionary` ]].

	! !
!MethodSetWindow class methodsFor: 'browser menues' stamp: 'jmv 5/20/2024 12:12:34' prior: 16902386!
  messageSetMenu2Options
	
	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'toggle diffing (D)'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleDiffing.
				#icon 			-> 		#switchIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'implementors of sent messages'.
				#selector 			-> 		#browseAllMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'local senders of...'.
				#selector 			-> 		#browseLocalSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'local implementors of...'.
				#selector 			-> 		#browseLocalImplementors.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'sample instance'.
				#selector 			-> 		#makeSampleInstance.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'inspect instances'.
				#selector 			-> 		#inspectInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'inspect subinstances'.
				#selector 			-> 		#inspectSubInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		40.
				#label 			-> 		'change category...'.
				#object 			-> 		#model.
				#selector 			-> 		#changeCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		50.
				#label 			-> 		'change sets with this method'.
				#selector 			-> 		#findMethodInChangeSets.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		60.
				#label 			-> 		'revert to previous version'.
				#object 			-> 		#model.
				#selector 			-> 		#revertToPreviousVersion.
				#icon 			-> 		#undoIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'more...'.
				#selector 			-> 		#openMessageListMenu.
				#icon 			-> 		#listAddIcon
			} asDictionary.			
		}`! !

MethodSetWindow class removeSelector: #openSubProtocolForClass:!

!methodRemoval: MethodSetWindow class #openSubProtocolForClass: stamp: 'Install-6387-ProtocolBrowser-cleanup-JuanVuletich-2024May20-12h17m-jmv.001.cs.st 6/6/2024 11:37:52'!
openSubProtocolForClass: aClass
	"Create and schedule a browser for the entire protocol of the class."
	"
	ProtocolBrowserWindow openSubProtocolForClass: Number.
	"

	| aPBrowser label |

	aPBrowser := ProtocolBrowser new onSubProtocolOf: aClass.
	label := 'Sub-protocol of: ', aClass name.

	^self open: aPBrowser label: label!

MethodSetWindow class removeSelector: #openFullProtocolForClass:!

!methodRemoval: MethodSetWindow class #openFullProtocolForClass: stamp: 'Install-6387-ProtocolBrowser-cleanup-JuanVuletich-2024May20-12h17m-jmv.001.cs.st 6/6/2024 11:37:52'!
openFullProtocolForClass: aClass
	"Create and schedule a browser for the entire protocol of the class."
	"
	ProtocolBrowserWindow openFullProtocolForClass: Number.
	"

	| aPBrowser label |

	aPBrowser := ProtocolBrowser new on: aClass.
	label := 'Entire protocol of: ', aClass name.

	^self open: aPBrowser label: label!

CodeWindow removeSelector: #browseProtocol!

!methodRemoval: CodeWindow #browseProtocol stamp: 'Install-6387-ProtocolBrowser-cleanup-JuanVuletich-2024May20-12h17m-jmv.001.cs.st 6/6/2024 11:37:52'!
browseProtocol
	"Create and schedule a new protocol browser on the currently selected class or meta."
	| aPBrowser label |
	model selectedClassOrMetaClass ifNotNil: [ :classOrMetaclass |
		aPBrowser := ProtocolBrowser new onSubProtocolOf: classOrMetaclass.
		label :='Sub-protocol of: ', classOrMetaclass name.
		ProtocolBrowserWindow open: aPBrowser label: label ]!

ProtocolBrowser removeSelector: #onSubProtocolOf:!

!methodRemoval: ProtocolBrowser #onSubProtocolOf: stamp: 'Install-6387-ProtocolBrowser-cleanup-JuanVuletich-2024May20-12h17m-jmv.001.cs.st 6/6/2024 11:37:52'!
onSubProtocolOf: aClass
	"Initialize with the entire protocol for the class, aClass,
		but excluding those inherited from Object."
	| selectors |
	selectors := Set new.
	(aClass withAllSuperclassesPreviousTo: Object)
		do: [ :each | selectors addAll: each selectors ].
	self
		initListFrom: selectors asArray sort
		highlighting: aClass.!

MethodSet class removeSelector: #open!

!methodRemoval: MethodSet class #open stamp: 'Install-6387-ProtocolBrowser-cleanup-JuanVuletich-2024May20-12h17m-jmv.001.cs.st 6/6/2024 11:37:52'!
open
	^ MethodSetWindow openFullProtocolForClass: Object!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6387-ProtocolBrowser-cleanup-JuanVuletich-2024May20-12h17m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6387] on 22 May 2024 at 9:11:18 am'!
!PluggableListMorph methodsFor: 'model access' stamp: 'jmv 5/22/2024 09:10:26'!
                 doKeystrokeAction: aChar
	| args |
	keystrokeActionSelector ifNil: [^false].
	args := keystrokeActionSelector numArgs.
	args = 1 ifTrue: [
		mainView perform: keystrokeActionSelector with: aChar.
		^true ].
	args = 2
		ifTrue: [
			mainView
				perform: keystrokeActionSelector
				with: aChar
				with: self.
			^true ].
	^self error: 'keystrokeActionSelector must be a 1- or 2-keyword symbol'.
! !
!PluggableListMorph methodsFor: 'events' stamp: 'jmv 5/21/2024 16:20:01' prior: 16923412 overrides: 16924561!
  keyStroke: aKeyboardEvent 
	"Process keys"
	| aCharacter |
	(self focusKeyboardFor: aKeyboardEvent) ifTrue: [ ^ self ].
	
	(self arrowKey: aKeyboardEvent) ifNotNil: [ ^ self ].
	
	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].
	aKeyboardEvent isDelete ifTrue: [ "delete key" ^ self deleteAction ].
	aKeyboardEvent isBackspace ifTrue: [ "backspace key" ^ self deleteAction ].
	
	aCharacter := aKeyboardEvent keyCharacter.
	
	aKeyboardEvent anyModifierKeyPressed
		ifTrue: [
			(self doKeystrokeAction: aCharacter)
				ifTrue: [ ^self ]].
	^ self keyboardSearch: aCharacter! !

PluggableListMorph removeSelector: #keystrokeAction:!

!methodRemoval: PluggableListMorph #keystrokeAction: stamp: 'Install-6388-AvoidFalsePolymorphism-JuanVuletich-2024May22-09h09m-jmv.001.cs.st 6/6/2024 11:37:52'!
keystrokeAction: aChar 
	| args |
	keystrokeActionSelector ifNil: [^false].
	args := keystrokeActionSelector numArgs.
	args = 1 ifTrue: [
		mainView perform: keystrokeActionSelector with: aChar.
		^true ].
	args = 2 
		ifTrue: [
			mainView 
				perform: keystrokeActionSelector
				with: aChar
				with: self.
			^true ].
	^self error: 'keystrokeActionSelector must be a 1- or 2-keyword symbol'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6388-AvoidFalsePolymorphism-JuanVuletich-2024May22-09h09m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6391] on 22 May 2024 at 1:08:08 pm'!

MethodSet subclass: #ProtocolBrowser
	instanceVariableNames: 'baseClass selectiveClassList selectiveClassListIndex selectedName exclude categoriesList categoriesListIndex '
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-Browser'!

!classDefinition: #ProtocolBrowser category: #'Tools-Browser' stamp: 'Install-6389-ProtocolBrowser-withMessageCategories-MarianoMontone-2024May22-13h04m-MM.001.cs.st 6/6/2024 11:37:52'!
MethodSet subclass: #ProtocolBrowser
	instanceVariableNames: 'baseClass selectiveClassList selectiveClassListIndex selectedName exclude categoriesList categoriesListIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-Browser'!
!ProtocolBrowserWindow commentStamp: 'MM 5/22/2024 13:05:42' prior: 16932436!
                             A view of the messages available to a class from itself upward through the class hierarchy. The viewed protocol can be pruned by selecting a superclass in the class hierarchy pane.

ProtocolBrowserWindow openFullProtocolForClass: Number.!
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 21:18:44'!
          categoriesList
	
	^ categoriesList! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 22:06:52'!
                   categoriesListIndex
	"Answer the value of categoriesListIndex"

	^ categoriesListIndex ifNil: [0] ifNotNil: [categoriesListIndex]! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/21/2024 10:38:38'!
                    categoriesListIndex: anIndex
	"Set the value of categoriesListIndex"

	categoriesListIndex := anIndex isZero ifTrue:  [nil] ifFalse: [anIndex].
	self changed: #categoriesListIndex. "update my selection"
	self changed: #messageList! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 22:04:08' overrides: 16901299!
                           messageList

	^ self selectedCategory ifNil: [ super messageList]
		ifNotNil: [:category |
			messageList select: [:methodRef | methodRef category == category]]! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 21:59:06'!
                     selectedCategory

	^ categoriesListIndex ifNotNil: [categoriesList at: categoriesListIndex]! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 21:55:31'!
                          updateCategoriesList

	"Update the list of categories"
	
	| categories |
	
	categories := Set new.
	messageList do: [:methodRef | categories add: methodRef category].
	
	categoriesList := categories asSortedCollection.
	
	self changed: #categoriesList! !
!ProtocolBrowser methodsFor: 'as yet unclassified' stamp: 'MM 5/21/2024 10:33:44'!
              selectedMessageName: aSelector
	"Make the given selector be the selected message name"

	| anIndex |
	anIndex := self messageList indexOf: aSelector.
	anIndex > 0 ifTrue:
		[self messageListIndex: anIndex]! !
!ProtocolBrowserWindow methodsFor: 'GUI building' stamp: 'MM 5/21/2024 09:44:57'!
                             buildCategoriesList
	"Define the message categories list pane"

	^ PluggableListMorph
		withModel: model
		listGetter: #categoriesList
		indexGetter: #categoriesListIndex
		indexSetter: #categoriesListIndex:! !
!ProtocolBrowserWindow methodsFor: 'as yet unclassified' stamp: 'MM 5/21/2024 10:34:49' overrides: 16902158!
browseCategoryOfCurrentMethod

	model categoryOfCurrentMethod ifNotNil: [:category| |catIndex selectedMessage|
		selectedMessage := model selectedMessageName.
		catIndex := model categoriesList indexOf: category.
		model categoriesListIndex: catIndex.
		model selectedMessageName: selectedMessage]! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 21:45:15' prior: 16932345!
                            on: aClass
	"Initialize the protocol for the class, aClass."
	"Optionally, the upper part of the protocol is excluded."
	| selectors |
	
	selectors := Set new.
	aClass withAllSuperclasses do: [ :each |
		(exclude includes: each name) ifFalse: [selectors addAll: each selectors]].
	self
		initListFrom: selectors asArray sort
		highlighting: aClass.
	self updateCategoriesList.! !
!ProtocolBrowser methodsFor: 'private' stamp: 'MM 5/20/2024 22:24:41' prior: 16932402!
             selectiveClassListIndex: anObject
	"Set the value of selectiveClassListIndex"

	selectiveClassListIndex := anObject.
	categoriesListIndex := nil.
	self protocolFor: selectiveClassListIndex
! !
!ProtocolBrowserWindow methodsFor: 'GUI building' stamp: 'MM 5/20/2024 21:22:51' prior: 16932445 overrides: 16902025!
         buildMorphicWindow
	"Answer a morphic window that can display the receiver with a class hierarchy"
	| topRow |

	topRow := LayoutMorph newRow.
	topRow 
		addMorph: self buildSelectiveClassList proportionalWidth: 0.25;
		addAdjusterMorph;
		addMorph: self buildCategoriesList proportionalWidth: 0.25;
		addAdjusterMorph;
		addMorph: self buildMorphicMessageList proportionalWidth: 0.5.
	self layoutMorph
		addMorph: topRow proportionalHeight: 0.2;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.8.
	model changed: #editSelection! !

MethodSet subclass: #ProtocolBrowser
	instanceVariableNames: 'baseClass selectiveClassList selectiveClassListIndex selectedName exclude categoriesList categoriesListIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-Browser'!

!classDefinition: #ProtocolBrowser category: #'Tools-Browser' stamp: 'Install-6389-ProtocolBrowser-withMessageCategories-MarianoMontone-2024May22-13h04m-MM.001.cs.st 6/6/2024 11:37:52'!
MethodSet subclass: #ProtocolBrowser
	instanceVariableNames: 'baseClass selectiveClassList selectiveClassListIndex selectedName exclude categoriesList categoriesListIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-Browser'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6389-ProtocolBrowser-withMessageCategories-MarianoMontone-2024May22-13h04m-MM.001.cs.st----!

'From Cuis7.1 [latest update: #6391] on 22 May 2024 at 1:30:47 pm'!
!ProtocolBrowser methodsFor: 'private' stamp: 'jmv 5/22/2024 13:29:02' prior: 50334392!
selectiveClassListIndex: anObject
	"Set the value of selectiveClassListIndex"

	| hadSelectedCategoryFor |
	selectiveClassListIndex := anObject.
	hadSelectedCategoryFor := categoriesListIndex notNil ifTrue: [selectedMessage].
	categoriesListIndex := nil.
	self protocolFor: selectiveClassListIndex.
	hadSelectedCategoryFor notNil ifTrue: [
		self categoriesListIndex: (categoriesList indexOf: selectedMessage category) ].
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6390-ProtocolBrowser-KeepCategorySelection-JuanVuletich-2024May22-13h08m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6388] on 22 May 2024 at 8:22:00 pm'!
!MethodInCallStackToBecomeInvalid methodsFor: 'exception handling' stamp: 'jmv 5/22/2024 20:18:03' prior: 16899713 overrides: 16856165!
                     defaultAction
	"defaultAction aborts the become or clas reshape.
	See references to MethodInCallStackToBecomeInvalid.
	To go ahead with the become or class reshape, do something like:
	[
		BoxedMorph subclass: #PluggableMorph
			instanceVariableNames: 'model menuNshortcutsKey newIvarThatBreaksRunningMethods'
			classVariableNames: ''
			poolDictionaries: ''
			category: 'Morphic-Widgets'.
	] on: MethodInCallStackToBecomeInvalid do: [ :ex | ex resume: true ]
	"
	self resume: false! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6391-MethodInCallStackToBecomeInvalid-defaultAction-JuanVuletich-2024May22-20h09m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6397] on 22 May 2024 at 8:50:32 pm'!
!ProtoObject methodsFor: 'system primitives' stamp: 'jmv 5/22/2024 20:50:10' prior: 16932123!
                        become: otherObject 
	"Primitive. Swap the object pointers of the receiver and the argument.
	All variables in the entire system that used to point to the 
	receiver now point to the argument, and vice-versa.
	Fails if either object is a SmallInteger"

	| selfMethod otherObjectMethod selector contextReceiver errorMessage |
	self class == otherObject class ifFalse: [
		Processor 
			processesDo: [ :p | ] withStackFramestDo: [ :process :context |
				contextReceiver := context receiver.
				(self == contextReceiver or: [ otherObject == contextReceiver ]) ifTrue: [
					selector := context method selector.
					selfMethod := self class lookupSelector: selector.
					otherObjectMethod := otherObject class lookupSelector: selector.
					selfMethod = otherObjectMethod ifFalse: [
						errorMessage := contextReceiver class name, ' has some instance running #', selector, 
							'. This CompiledMethod would become invalid.'.
						errorMessage print.
						MethodInCallStackToBecomeInvalid signal ifFalse: [
							'#become: aborted.' print.
							Error signal: errorMessage, ' #become: aborted. Please see Transcript.'.
							^nil ]]]]
			runningProcessSearchStart: thisContext sender.
		].
	{ self } elementsExchangeIdentityWith: { otherObject }! !
!Object methodsFor: 'system primitives' stamp: 'jmv 5/22/2024 20:49:54' prior: 16915106!
                            becomeForward: otherObject 
	"Primitive. All variables in the entire system that used to point
	to the receiver now point to the argument.
	Fails if either argument is a SmallInteger.

	Please see comment at #elementsForwardIdentityTo:
	"

	| newMethod oldMethod selector errorMessage |
	self class == otherObject class ifFalse: [
		Processor 
			processesDo: [ :p | ] withStackFramestDo: [ :process :context |
				self == context receiver ifTrue: [
					selector := context method selector.
					oldMethod := self class lookupSelector: selector.
					newMethod := otherObject class lookupSelector: selector.
					oldMethod = newMethod ifFalse: [
						errorMessage := self class name, ' has some instance running #', selector, 
							'. This CompiledMethod would become invalid.'.
						errorMessage print.
						MethodInCallStackToBecomeInvalid signal ifFalse: [
							'#becomeForward: aborted.' print.
							Error signal: errorMessage, ' #becomeForward: aborted. Please see Transcript.'.
							^nil ]]]]
			runningProcessSearchStart: thisContext sender.
		].
	{ self } elementsForwardIdentityTo: { otherObject }! !
!Object methodsFor: 'system primitives' stamp: 'jmv 5/22/2024 20:50:04' prior: 16915138!
     becomeForward: otherObject copyHash: copyHash
	"Primitive. All variables in the entire system that used to point to the receiver now point to the argument.
	If copyHash is true, the argument's identity hash bits will be set to those of the receiver.
	Fails if either argument is a SmallInteger.

	Please see comment at #elementsForwardIdentityTo:copyHash:
	"

	| newMethod oldMethod selector errorMessage |
	self class == otherObject class ifFalse: [
		Processor 
			processesDo: [ :p | ] withStackFramestDo: [ :proces :context |
				self == context receiver ifTrue: [
					selector := context method selector.
					oldMethod := self class lookupSelector: selector.
					newMethod := otherObject class lookupSelector: selector.
					oldMethod = newMethod ifFalse: [
						errorMessage := self class name, ' has some instance running #', selector, 
							'. This CompiledMethod would become invalid.'.
						errorMessage print.
						MethodInCallStackToBecomeInvalid signal ifFalse: [
							'#becomeForward:copyHash: aborted.' print.
							Error signal: errorMessage, ' #becomeForward:copyHash: aborted. Please see Transcript.'.
							^nil ]]]]
			runningProcessSearchStart: thisContext sender.
		].
	{ self }
		elementsForwardIdentityTo: { otherObject }
		copyHash: copyHash! !
!ClassDescription methodsFor: 'initialization' stamp: 'jmv 5/22/2024 20:45:28' prior: 16819796!
                              canUpdateFrom: oldClass
	"If some compiled method that will become invalid is currently being executed,
	the shape conversion of instances is extremely insecure.
	Answer if migration of instances looks safe"
	| answer newMethod oldMethod selector newActualClass oldActualClass |
	answer := true.
	Processor 
		processesDo: [ :p | ]
		withStackFramestDo: [ :process :context |
			(context receiver isKindOf: oldClass) ifTrue: [
				oldActualClass := context receiver class.
				self withAllSubclassesDo: [ :c |
					c name = oldActualClass name ifTrue: [
						newActualClass := c ]].
				selector := context method selector.
				oldMethod := oldActualClass lookupSelector: selector.
				newMethod := newActualClass lookupSelector: selector.
				oldMethod = newMethod ifFalse: [
					('Class reshaping: ', context receiver class name, ' has some instance running #', selector, '. This CompiledMethod would become invalid.') print.
					answer := false ].
				]]
		runningProcessSearchStart: nil.
	^answer! !
!ClassBuilder methodsFor: 'class definition' stamp: 'jmv 5/22/2024 20:45:17' prior: 16816303!
                   recompile: force from: oldClass to: newClass mutate: forceMutation
	"Do the necessary recompilation after changing oldClass to newClass.
	If required (e.g., when oldClass ~~ newClass) mutate oldClass to newClass
	and all its subclasses. If forceMutation is true force a mutation even
	if oldClass and newClass are the same."

	| compilationSuccess compilationErrorDescription |
	oldClass
		ifNil: [^ newClass].

	(newClass == oldClass and:[force not and:[forceMutation not]]) ifTrue:[
		^newClass].

	currentClassIndex := 0.
	maxClassIndex := oldClass withAllSubclasses size.

	(oldClass == newClass and:[forceMutation not]) ifTrue:[
		"Recompile from newClass without mutating"
		self informUserDuring:[
			newClass withAllSubclassesDo: [ :cl |
				self showProgressFor: cl.
				cl compileAll]].
		^newClass].
	"Recompile oldClass to newClass"
	self informUserDuring: [
		compilationSuccess := true.
		[self createHierarchy: oldClass to: newClass] on: Error do: [ :exception |
			"If compilation failed, don't continue!!"
			compilationErrorDescription := exception printString.
			compilationSuccess := false ].
	].

	compilationSuccess ifFalse: [
		oldClass superclass removeSubclass: newClass.
		Smalltalk garbageCollect.
		Error signal: compilationErrorDescription, '. Please see Transcript.'.
		^ nil ].

	(newClass canUpdateFrom: oldClass) ifFalse: [
		MethodInCallStackToBecomeInvalid signal ifFalse: [
			oldClass superclass removeSubclass: newClass.
			Smalltalk garbageCollect.
			'Class reshaping aborted.' print.
			Error signal: oldClass name, 
				' has some subInstance running a CompiledMethod that would become invalid. Please see Transcript.'.
			^nil ]].

	"Mutate oldClass to newClass"
	self informUserDuring: [
		self mutateInstances: oldClass to: newClass.
	].
	^oldClass "now mutated to newClass"! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6392-betterHandlingOf-MethodInCallStackToBecomeInvalid-JuanVuletich-2024May22-20h40m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6392] on 24 May 2024 at 1:03:52 pm'!
!TestCase methodsFor: 'setUp/tearDown' stamp: 'jmv 5/24/2024 10:43:44' overrides: 16932029!
                               initialize
	assertCount := 0.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6393-TestCase-enh-JuanVuletich-2024May24-13h03m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6393] on 24 May 2024 at 3:31:30 pm'!
!LargePositiveInteger methodsFor: 'testing' stamp: 'ul 1/22/2012 23:56' overrides: 16886385!
  isPowerOfTwo
	"Return true if the receiver is an integral power of two. Optimized version."
	
	| size |
	1 to: (size := self digitLength) do: [ :index |
		| digit |
		(digit := self digitAt: index) = 0 ifFalse: [ 
			^size = index and: [ digit isPowerOfTwo ] ] ].
	^false! !
!LargeNegativeInteger methodsFor: 'testing' stamp: 'ul 1/22/2012 23:57' overrides: 50334744!
                isPowerOfTwo
	"Return true if the receiver is an integral power of two. Optimized version."
	
	^false! !
!Integer methodsFor: 'testing' stamp: 'ul 1/22/2012 23:56' prior: 16886385!
           isPowerOfTwo
	"Return true if the receiver is an integral power of two."
	
	^self > 0 and: [ (self bitAnd: self - 1) = 0 ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6394-isPowerOfTwo-fix-performanceEnhancements-JuanVuletich-2024May24-15h30m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6392] on 24 May 2024 at 1:05:54 pm'!
!Integer methodsFor: 'mathematical functions' stamp: 'nice 5/4/2019 00:26' prior: 16885855!
          nthRootRounded: aPositiveInteger
    "Answer the integer nearest the nth root of the receiver.
http://stackoverflow.com/questions/39794338/precise-nth-root
http://smallissimo.blogspot.com.ar/2011/09/clarifying-and-optimizing.html
http://smallissimo.blogspot.com.ar/2011/09/reviewing-fraction-asfloat.html
"
	| guess |
	self = 0 ifTrue: [^0].
	self negative
		ifTrue: [
			aPositiveInteger even ifTrue: [
				^DomainError signal: 'Negative numbers don''t have even roots.' ].
			^(self negated nthRootRounded: aPositiveInteger) negated ].
	guess := self nthRootTruncated: aPositiveInteger.
	^(2 * guess + 1 raisedToInteger: aPositiveInteger) < (self bitShift: aPositiveInteger)
		ifTrue: [guess + 1]
		ifFalse: [guess].
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6395-nthRootRounded-fix-NicolasCellier-2024May24-13h05m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6395] on 24 May 2024 at 3:35:05 pm'!
!Number methodsFor: 'mathematical functions' stamp: 'jmv 5/24/2024 12:16:10' prior: 16912678!
       log: aNumber
	"Answer the log base aNumber of the receiver.
	Note 1:
		Answer an Integer number if receiver and base are both integer (receiver might also be a fraction of the form 1/Integer), and the correct answer is integer too.
	Note2:
		There are several implementors of #log:, #log, #log2 and #ln in the Number hierarchy. Behavior is not consistent when receiver is a negative value. Some implementors answer Float nan, others raise a DomainError. Another possibility would be to answer the correct Complex number.
		It would be good to pick one and make it consistently followed.
	"

	(self <= 0 and: [ aNumber isFloat not])
		ifTrue: [DomainError signal: 'logarithm is only defined for x > 0'].
	aNumber = 2 ifTrue: [^self log2].
	aNumber isPowerOfTwo ifTrue: [^self log2 / aNumber log2].
	^self asFloat log: aNumber! !
!Integer methodsFor: 'mathematical functions' stamp: 'jmv 5/24/2024 12:18:15' prior: 16885796 overrides: 50334810!
                 log: aNumber
	"Answer the log base aNumber of the receiver.
	(3 raisedTo: 215) log: 3
	((3 raisedTo: 215)+(3 raisedTo: 213)) log: 3
	Answers an integer number if appropriate. Doing this is somewhat expensive. If you care about performance and not about using Floats, do 'aNumber asFloat log: another'.
	"
	| superAnswer roundedAnswer |
	self <= 0 ifTrue: [^DomainError signal: 'logarithm is only defined for x > 0'].
	superAnswer := super log: aNumber.
	superAnswer isFloat ifTrue: [
		roundedAnswer := superAnswer rounded.
		(aNumber raisedToInteger: roundedAnswer) = self
			ifTrue: [ ^roundedAnswer ]].
	^superAnswer.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6396-log-allowForIntegerAnswer-JuanVuletich-2024May24-15h32m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6395] on 24 May 2024 at 3:39:16 pm'!
!LargePositiveInteger methodsFor: 'mathematical functions' stamp: 'nice 7/15/2011 14:06' overrides: 16885753!
                    ln
	"This function is defined because super ln might overflow."
	| res h |
	res := super ln.
	res isFinite ifTrue: [^res].
	h := self highBit.
	^2 ln * h + (self / (1 << h)) asFloat ln! !
!LargeNegativeInteger methodsFor: 'mathematical functions' stamp: 'nice 9/22/2013 00:59' overrides: 50334871!
                      ln
	^DomainError signal: 'ln is only defined for x > 0'! !
!Number methodsFor: 'mathematical functions' stamp: 'jmv 5/24/2024 12:09:43' prior: 16912660!
       ln
	"Answer the natural log of the receiver.
	See comment at #log:"

	self <= 0 ifTrue: [DomainError signal: 'ln is only defined for x > 0'].
	^self asFloat ln! !
!Fraction methodsFor: 'mathematical functions' stamp: 'nice 11/1/2011 18:09' prior: 16870477 overrides: 50334886!
           ln
	"This function is defined because super ln might overflow."
	| res |
	self <= 0 ifTrue: [DomainError signal: 'ln is only defined for x > 0'].
	"Test self < 1 before converting to float in order to avoid precision loss due to gradual underflow."
	numerator < denominator ifTrue: [^self reciprocal ln negated].
	res := super ln.
	res isFinite ifTrue: [^res].
	^numerator ln - denominator ln! !

Integer removeSelector: #ln!

!methodRemoval: Integer #ln stamp: 'Install-6397-ln-fixes-NicolasCellier-2024May24-15h35m-jmv.001.cs.st 6/6/2024 11:37:53'!
ln
	"This function is defined because super ln might overflow."
	| res h |
	self <= 0 ifTrue: [^DomainError signal: 'ln is only defined for x > 0'].
	res := super ln.
	res isFinite ifTrue: [^res].
	h := self highBit.
	^2 ln * h + (self / (1 << h)) asFloat ln!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6397-ln-fixes-NicolasCellier-2024May24-15h35m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6395] on 24 May 2024 at 3:43:08 pm'!
!LargePositiveInteger methodsFor: 'mathematical functions' stamp: 'nice 2/8/2019 18:26' overrides: 16885785!
          log2
	"This function is defined because super log2 might overflow."
	| res h |
	res := super log2.
	res isFinite ifTrue: [^res].
	h := self highBit.
	^h + (self / (1 << h)) asFloat log2! !
!LargeNegativeInteger methodsFor: 'mathematical functions' stamp: 'nice 2/8/2019 18:24' overrides: 50334931!
                      log2
	^DomainError signal: 'log2 is only defined for x > 0'! !
!Number methodsFor: 'mathematical functions' stamp: 'jmv 5/24/2024 11:48:32' prior: 16912672!
   log2
	"Answer the base-2 logarithm of the receiver.
	See comment at #log:"

	self <= 0 ifTrue: [DomainError signal: 'log2 is only defined for x > 0'].
	^self asFloat log2! !
!Float methodsFor: 'mathematical functions' stamp: 'nice 3/4/2021 21:34' prior: 16864251 overrides: 50334946!
    log2
	"Answer the base 2 logarithm of the receiver.
	Arrange to answer exact result in case of exact power of 2."

	|  s  |
	 s := self significand.
	^s > 1.3333333333333333
		ifTrue: [(0.5 * s) ln / Ln2 + (1 + self exponent)]
		ifFalse: [s ln / Ln2 + self exponent]! !
!Fraction methodsFor: 'mathematical functions' stamp: 'nice 2/5/2019 13:58' prior: 16870512 overrides: 50334946!
 log2
	"This function is defined because super log2 might overflow."
	| res |
	self <= 0 ifTrue: [DomainError signal: 'log2 is only defined for x > 0'].
	"Test self < 1 before converting to float in order to avoid precision loss due to gradual underflow.
	Also, give an integer answer if possible."
	numerator < denominator ifTrue: [^self reciprocal log2 negated].
	res := super log2.
	res isFinite ifTrue: [^res].
	^numerator log2 - denominator log2! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6398-log2-enhancements-NicolasCellier-2024May24-15h39m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6391] on 22 May 2024 at 9:45:23 am'!
!Morph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:44:51' prior: 16904174!
       keyStroke: aKeyboardEvent
	"Handle a keystroke event."

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].! !

TextModelMorph removeSelector: #keystrokeAction:!

!methodRemoval: TextModelMorph #keystrokeAction: stamp: 'Install-6399-KeystrokeAction-removeSupport-JuanVuletich-2024May22-09h35m-jmv.001.cs.st 6/6/2024 11:37:53'!
keystrokeAction: aBlock
	
	scroller keystrokeAction: aBlock!

InnerTextMorph removeSelector: #keystrokeAction:!

!methodRemoval: InnerTextMorph #keystrokeAction: stamp: 'Install-6399-KeystrokeAction-removeSupport-JuanVuletich-2024May22-09h35m-jmv.001.cs.st 6/6/2024 11:37:53'!
keystrokeAction: aBlock
	"Sets the action to perform when user presses any key"

	self setProperty: #keyStroke: toValue: aBlock.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6399-KeystrokeAction-removeSupport-JuanVuletich-2024May22-09h35m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6391] on 22 May 2024 at 9:54:22 am'!
!Morph methodsFor: 'events-processing' stamp: 'jmv 5/22/2024 09:49:46' prior: 16904670!
              processKeystroke: aKeyboardEvent
	"System level event handling."

	aKeyboardEvent wasHandled ifTrue: [^self].
	self handlesKeyboard ifFalse: [^self].
	aKeyboardEvent wasHandled: true.
	self keyStroke: aKeyboardEvent! !
!WorldMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:52:17' prior: 17007312 overrides: 50334991!
                               keyStroke: aKeyboardEvent
	self flag: #definesKeyboardShortcuts.

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].

	"Handle a keystroke event."
	(aKeyboardEvent commandAltKeyPressed or: [ aKeyboardEvent controlKeyPressed ])
		ifTrue: [
			aKeyboardEvent keyCharacter = $b ifTrue: [ Browser open ].
			aKeyboardEvent keyCharacter = $f ifTrue: [ BrowserWindow findClass ].
			aKeyboardEvent keyCharacter = $F ifTrue: [ MethodSetWindow findInSourceCode ].
		].
	"aKeyboardEvent keyCharacter print."
! !
!InnerTextMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:50:50' prior: 16881124 overrides: 50334991!
                   keyStroke: aKeyboardEvent

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].

	autoCompleter 
		ifNil: [ self processKeystrokeEvent: aKeyboardEvent ]
		ifNotNil: [
			autoCompleter
				autoCompletionAround: [ self processKeystrokeEvent: aKeyboardEvent ]
				keyStroke: aKeyboardEvent ].
! !
!PluggableScrollPane methodsFor: 'events' stamp: 'jmv 5/22/2024 09:52:30' prior: 16924561 overrides: 50334991!
 keyStroke: aKeyboardEvent

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].

	scroller ifNotNil: [
		scroller keyStroke: aKeyboardEvent ].
! !
!HierarchicalListMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:51:48' prior: 16874218 overrides: 50335069!
                  keyStroke: aKeyboardEvent 
	"Process potential command keys"

	| args |
	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].

	(self arrowKey: aKeyboardEvent) ifNotNil: [ ^ self ].
	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].
	keystrokeActionSelector ifNil: [^self].
	(args := keystrokeActionSelector numArgs) = 1 
		ifTrue: [^mainView perform: keystrokeActionSelector with: aKeyboardEvent keyCharacter].
	args = 2 
		ifTrue: [
			^mainView 
				perform: keystrokeActionSelector
				with: aKeyboardEvent keyCharacter
				with: self].
	^self error: 'The keystrokeActionSelector must be a 1- or 2-keyword symbol'! !
!PluggableListMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:53:20' prior: 50334217 overrides: 50335069!
  keyStroke: aKeyboardEvent 
	"Process keys"
	| aCharacter |
	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].
	
	(self arrowKey: aKeyboardEvent) ifNotNil: [ ^ self ].
	
	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].
	aKeyboardEvent isDelete ifTrue: [ "delete key" ^ self deleteAction ].
	aKeyboardEvent isBackspace ifTrue: [ "backspace key" ^ self deleteAction ].
	
	aCharacter := aKeyboardEvent keyCharacter.
	
	aKeyboardEvent anyModifierKeyPressed
		ifTrue: [
			(self doKeystrokeAction: aCharacter)
				ifTrue: [ ^self ]].
	^ self keyboardSearch: aCharacter! !
!TextModelMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:52:47' prior: 16983062 overrides: 50335069!
                        keyStroke: aKeyboardEvent
	"A keystroke was hit while the receiver had keyboard focus.  Pass the keywtroke on to my textMorph, and and also, if I have an event handler, pass it on to that handler"

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].

	scroller keyStroke: aKeyboardEvent.
! !

InnerTextMorph removeSelector: #processKeystroke:!

!methodRemoval: InnerTextMorph #processKeystroke: stamp: 'Install-6400-keystroke-cleanup-1-JuanVuletich-2024May22-09h45m-jmv.001.cs.st 6/6/2024 11:37:53'!
processKeystroke: aKeyboardEvent
	"System level event handling."

	aKeyboardEvent wasHandled ifTrue:[^self].
	self handlesKeyboard ifFalse: [^ self].
	aKeyboardEvent wasHandled: true.
	self keyStroke: aKeyboardEvent!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6400-keystroke-cleanup-1-JuanVuletich-2024May22-09h45m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6393] on 22 May 2024 at 10:26:23 am'!
!Morph methodsFor: 'events' stamp: 'jmv 5/22/2024 10:24:40' prior: 50334991!
                   keyStroke: aKeyboardEvent
	"Handle a keystroke event.
	Subclasses should call super, and check if the event was handled."

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ aKeyboardEvent wasHandled: true ].
! !
!Morph methodsFor: 'events-processing' stamp: 'jmv 5/22/2024 10:07:02' prior: 50335025!
               processKeystroke: aKeyboardEvent
	"System level event handling."

	aKeyboardEvent wasHandled ifTrue: [^self].
	self handlesKeyboard ifFalse: [^self].
	self keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled: true.! !
!WorldMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 10:10:46' prior: 50335036 overrides: 50335158!
                              keyStroke: aKeyboardEvent

	self flag: #definesKeyboardShortcuts.
	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].

	"Handle a keystroke event."
	(aKeyboardEvent commandAltKeyPressed or: [ aKeyboardEvent controlKeyPressed ])
		ifTrue: [
			aKeyboardEvent keyCharacter = $b ifTrue: [
				Browser open.
				aKeyboardEvent wasHandled: true. ].
			aKeyboardEvent keyCharacter = $f ifTrue: [
				BrowserWindow findClass.
				aKeyboardEvent wasHandled: true. ].
			aKeyboardEvent keyCharacter = $F ifTrue: [
				MethodSetWindow findInSourceCode.
				aKeyboardEvent wasHandled: true. ].
		].
	"aKeyboardEvent keyCharacter print."! !
!InnerTextMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 10:04:53' prior: 50335056 overrides: 50335158!
     keyStroke: aKeyboardEvent

	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].

	autoCompleter 
		ifNil: [ self processKeystrokeEvent: aKeyboardEvent ]
		ifNotNil: [
			autoCompleter
				autoCompletionAround: [ self processKeystrokeEvent: aKeyboardEvent ]
				keyStroke: aKeyboardEvent ].

	aKeyboardEvent wasHandled: true.
! !
!PluggableScrollPane methodsFor: 'events' stamp: 'jmv 5/22/2024 10:11:54' prior: 50335069 overrides: 50335158!
             keyStroke: aKeyboardEvent

	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].

	scroller ifNotNil: [
		scroller keyStroke: aKeyboardEvent ].! !
!HierarchicalListMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 10:15:16' prior: 50335078 overrides: 50335218!
  keyStroke: aKeyboardEvent 
	"Process potential command keys"

	| args |
	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].

	(self arrowKey: aKeyboardEvent) ifNotNil: [
		^ aKeyboardEvent wasHandled: true ].

	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].
	keystrokeActionSelector ifNil: [^self].
	(args := keystrokeActionSelector numArgs) = 1 
		ifTrue: [
			mainView perform: keystrokeActionSelector with: aKeyboardEvent keyCharacter.
			^ aKeyboardEvent wasHandled: true ].
	args = 2 
		ifTrue: [
			mainView 
				perform: keystrokeActionSelector
				with: aKeyboardEvent keyCharacter
				with: self.
			^ aKeyboardEvent wasHandled: true ].
	^self error: 'The keystrokeActionSelector must be a 1- or 2-keyword symbol'! !
!PluggableListMorph methodsFor: 'events' stamp: 'jmv 5/22/2024 10:16:59' prior: 50335102 overrides: 50335218!
   keyStroke: aKeyboardEvent 
	"Process keys"

	| aCharacter |
	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].
	
	(self arrowKey: aKeyboardEvent) ifNotNil: [
		^ aKeyboardEvent wasHandled: true ].

	"All the cases below consume the event."
	aKeyboardEvent wasHandled: true.

	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].
	aKeyboardEvent isDelete ifTrue: [ "delete key" ^ self deleteAction ].
	aKeyboardEvent isBackspace ifTrue: [ "backspace key" ^ self deleteAction ].
	
	aCharacter := aKeyboardEvent keyCharacter.
	aKeyboardEvent anyModifierKeyPressed
		ifTrue: [
			(self doKeystrokeAction: aCharacter)
				ifTrue: [ ^self ]].
	^ self keyboardSearch: aCharacter! !

TextModelMorph removeSelector: #keyStroke:!

!methodRemoval: TextModelMorph #keyStroke: stamp: 'Install-6401-keystroke-cleanup-2-JuanVuletich-2024May22-10h23m-jmv.001.cs.st 6/6/2024 11:37:53'!
keyStroke: aKeyboardEvent
	"A keystroke was hit while the receiver had keyboard focus.  Pass the keywtroke on to my textMorph, and and also, if I have an event handler, pass it on to that handler"

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ self ].

	scroller keyStroke: aKeyboardEvent.
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6401-keystroke-cleanup-2-JuanVuletich-2024May22-10h23m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6401] on 24 May 2024 at 4:36:22 pm'!
!FileIOAccessor methodsFor: 'actions' stamp: 'jmv 5/24/2024 16:30:36' prior: 50333687!
                            copy: fromFileEntry to: toFileEntry 
	| readStr writeStr |
	[readStr := (self privateReadOnlyFile: fromFileEntry) binary.
	writeStr := (self privateForceNewFile: toFileEntry) binary.
	self copyFile: readStr toFile: writeStr]
		ensure: [
			readStr
				ifNotNil: [ :r | r close ].
			writeStr
				ifNotNil: [ :w | w close ]].
	toFileEntry parent invalidateChildren.
	toFileEntry invalidate.! !
!FileIOAccessor methodsFor: 'utilities' stamp: 'jmv 5/24/2024 16:33:41' prior: 16861346!
                              fileSize: fileEntry

	| pathName f size |
	pathName := fileEntry pathName.
	"At least on Linux 64 Cog, opening a directory as a stream and asking #size answers some absurd number: 9223372036854775807"
	(self basicDirectoryExists: pathName) ifTrue: [^ nil ].
	f := UniFileStream new open: pathName forWrite: false.
	f ifNil: [^ nil].
	size := f size.
	f close.
	fileEntry invalidate.
	^ size! !
!FileEntry methodsFor: 'actions-file' stamp: 'jmv 5/24/2024 16:30:58' prior: 50333764!
                               delete
	self fileAccessor deleteFile: self pathName.
	self parent invalidateChildren.
	self invalidate.! !
!FileEntry methodsFor: 'actions-file' stamp: 'jmv 5/24/2024 16:31:43' prior: 50333770!
                              rename: newName

	| fileEntry directoryEntry |
	fileEntry := self parent // newName.
	fileEntry exists
		ifTrue: [ Error signal: 'There already exists a file named: ', fileEntry printString ].
	directoryEntry := self parent / newName.
	directoryEntry exists
		ifTrue: [ Error signal: 'There already exists a directory named: ', fileEntry printString ].
	self fileAccessor rename: self pathName to: fileEntry pathName.
	self name: newName.
	self parent invalidateChildren.
	self invalidate.! !
!FileEntry methodsFor: 'accessing-stream' stamp: 'jmv 5/24/2024 16:32:26' prior: 16860639!
                        appendStreamDo: blockWithArg 
	| stream |
	stream := self appendStream.
	[ blockWithArg value: stream ]
		ensure: [
			stream
				ifNotNil: [ :s | s close ].
			self invalidate ].
! !
!FileEntry methodsFor: 'accessing-stream' stamp: 'jmv 5/24/2024 16:32:46' prior: 16860647!
             forceWriteStreamDo: blockWithArg 
	"If the file already exists, delete it first without asking. Do not raise FileExistsException.
	Creates the directory if it doesn't exist."
	| stream |
	stream := self forceWriteStream.
	[ blockWithArg value: stream ]
		ensure: [
			stream
				ifNotNil: [ :s | s close ].
			self invalidate ].
! !
!FileEntry methodsFor: 'accessing-stream' stamp: 'jmv 5/24/2024 16:33:13' prior: 16860669!
                        writeStreamDo: blockWithArg 
	"If the file already exists raise FileExistsException.
	Creates the directory if it doesn't exist."
	| stream |
	stream := self writeStream.
	[ blockWithArg value: stream ]
		ensure: [
			stream
				ifNotNil: [ :s | s close ].
			self invalidate ].
! !
!FileEntry methodsFor: 'accessing' stamp: 'jmv 5/24/2024 16:28:26' prior: 16860680!
                 appendStream
	"Note: You need to eventually close the stream.
	Usually prefer #appendStreamDo: that closes the file for you."

	self invalidate.
	self exists ifFalse: [
		^ self writeStream ].
	^ (self fileAccessor privateWriteableFile: self) setToEnd! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6402-FileEntry-invalidate-addAFew-JuanVuletich-2024May24-16h28m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6387] on 21 May 2024 at 3:19:31 pm'!

"Postscript:
The MethodInCallStackToBecomeInvalid exception happens because
installing this change set is done during the #performAction of a PluggableButtonMorph.
But no button state will be accessed. In this case, the reshape is safe.
So, resume the MethodInCallStackToBecomeInvalid exception and effectively do the reshape"
	[
		BoxedMorph subclass: #PluggableMorph
			instanceVariableNames: 'model menuNshortcutsKey'
			classVariableNames: ''
			poolDictionaries: ''
			category: 'Morphic-Widgets'.
	] on: MethodInCallStackToBecomeInvalid do: [ :ex | ex resume: true ]
!

!classDefinition: #PluggableMorph category: #'Morphic-Widgets' stamp: 'Install-6403-Add-newIvar-to-PluggableMorph-JuanVuletich-2024May21-15h19m-jmv.003.cs.st 6/6/2024 11:37:54'!
BoxedMorph subclass: #PluggableMorph
	instanceVariableNames: 'model menuNshortcutsKey'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6403-Add-newIvar-to-PluggableMorph-JuanVuletich-2024May21-15h19m-jmv.003.cs.st----!

'From Cuis7.1 [latest update: #6392] on 22 May 2024 at 12:15:29 pm'!

SystemWindow class
	instanceVariableNames: 'menuNshortcutsProviders '!

!classDefinition: 'SystemWindow class' category: #'Morphic-Widgets' stamp: 'Install-6404-SupportForNewMenusAndShortcutsSpecs-JuanVuletich-2024May22-12h11m-jmv.001.cs.st 6/6/2024 11:37:54'!
SystemWindow class
	instanceVariableNames: 'menuNshortcutsProviders'!
!Morph methodsFor: 'events' stamp: 'jmv 5/22/2024 09:59:03'!
keyboardShortcut: aKeyboardEvent
	"Handle a keyboard shortcut."

	| menuNshortcutsSpecs selector shortcutCharacter target widgetKey |
	widgetKey := self menuNshortcutsKey ifNil: [ ^false ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^false ].
	menuNshortcutsSpecs valuesDo: [ :itemSpec |
		itemSpec size >= 5 ifTrue: [
			shortcutCharacter := itemSpec third.
			shortcutCharacter = aKeyboardEvent keyCharacter ifTrue: [
				target := itemSpec fourth
					ifNotNil: [ :targetGetter | self perform: targetGetter ]
					ifNil: [ self ].
				selector := itemSpec fifth.
				target perform: selector.
				^true ]
			]
		].
	^false! !
!Morph methodsFor: 'structure' stamp: 'jmv 5/21/2024 16:02:22'!
                window
	"Return the first enclosing morph that is a kind of Window, or nil if none"
	^self owningWindow! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/16/2024 10:55:14'!
               menuNshortcutsKey
	"
	Nil by default. Specific for each instance for PluggableLists. Maybe class name (and therefore specific for each class) for TextModelMorph or such (^self class name).
	"
	^nil! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/16/2024 10:50:40'!
                 menuNshortcutsSpec: aWidgetKey for: aWidget
	"menuSpec is the Spec for the menu and shortcut keys.
	It is an Array where each entry is
		#(itemNumber 'menu item label'    shortcut    receiver    selector     iconOrNil(optional)    'help text (optional)')
		- itemNumber is an integer or float number, and is only used for ordering of menu items
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiver is either #w (window) or #m (model)
		- selector is #aSymbol. No arguments.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	self withAllOwnersReverseDo: [ :o |
		o ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/15/2024 15:13:03'!
ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs.
	See, for instance, SystemWindow."! !
!PluggableMorph methodsFor: 'access' stamp: 'jmv 5/16/2024 10:52:33' overrides: 50335491!
                       menuNshortcutsKey
	"See senders"
	^menuNshortcutsKey! !
!PluggableMorph methodsFor: 'access' stamp: 'jmv 5/15/2024 15:18:45'!
  menuNshortcutsKey: aSymbol
	"See senders"
	menuNshortcutsKey := aSymbol.! !
!SystemWindow methodsFor: 'submorphs-menus' stamp: 'jmv 5/16/2024 10:44:18' overrides: 50335545!
                   ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs."

	(self perform: aWidgetKey) do: [ :eachSpec |
		aBlock value: eachSpec ].

	(self class registeredMenuAndShortcutsSpecProviders: aWidgetKey) ifNotNil: [ :providers |
		providers do: [ :eachMessageSend |
			(eachMessageSend valueWithPossibleArgument: aWidget) do: aBlock ]].! !
!SystemWindow class methodsFor: 'menu and shortcuts' stamp: 'jmv 5/15/2024 11:23:29'!
          at: aWidgetKey registerMenuAndShortcutsSpecProvider: aMessageSend
	menuNshortcutsProviders ifNil: [ menuNshortcutsProviders := Dictionary new ].
	(menuNshortcutsProviders at: aWidgetKey ifAbsentPut: [ OrderedCollection new ])
		add: aMessageSend! !
!SystemWindow class methodsFor: 'menu and shortcuts' stamp: 'jmv 5/15/2024 12:22:29'!
                 registeredMenuAndShortcutsSpecProviders: aWidgetKey
	menuNshortcutsProviders ifNil: [ ^nil ].
	^menuNshortcutsProviders at: aWidgetKey ifAbsent: nil.! !
!Morph methodsFor: 'events' stamp: 'jmv 5/22/2024 10:02:32' prior: 50335158!
                          keyStroke: aKeyboardEvent
	"Handle a keystroke event.
	Subclasses should call super, and check if the event was handled."

	(self focusKeyboardFor: aKeyboardEvent)
		ifTrue: [ ^ aKeyboardEvent wasHandled: true ].

	aKeyboardEvent anyModifierKeyPressed ifTrue: [
		(self keyboardShortcut: aKeyboardEvent)
			ifTrue: [ ^ aKeyboardEvent wasHandled: true ]].! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/21/2024 16:04:10' prior: 50333435!
    getMenu
	"Answer the right-click (contextual) menu."

	| widgetKey menuNshortcutsSpecs itemSpec label menu menuItem shortcutCharacter target selector iconSymbol helpText |
	widgetKey := self menuNshortcutsKey ifNil: [ ^nil ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].

	menu := MenuMorph new.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2
			ifTrue: [ menu addLine ]
			ifFalse: [
				label := itemSpec second.
				shortcutCharacter := itemSpec third.
				target := itemSpec fourth
					ifNotNil: [ :targetGetter | self perform: targetGetter ]
					ifNil: [ self ].
				selector := itemSpec fifth.
				iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
				helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
				menuItem := label isSymbol
					ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
					ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
				iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
				helpText ifNotNil: [ menuItem setBalloonText: helpText ]
				]
		].
	^ menu! !
!HierarchicalListMorph methodsFor: 'menu' stamp: 'jmv 5/16/2024 11:00:00' prior: 16874525 overrides: 50335615!
                        getMenu
	"Answer the menu for this view"

	"Use the new mechanism if provided. See #menuNshortcutsKey"
	super getMenu ifNotNil: [ :menu | 
		^menu ].

	"Fallback to the old way. See #mainView:menuGetter:keystrokeAction:	"
	menuGetter ifNil: [^ nil].
	(menuGetter is: #MessageSend) ifTrue: [
		^menuGetter value ].
	menuGetter numArgs = 0 ifTrue: [
		^ mainView perform: menuGetter ].
	^ self error: 'The menuGetter has an unsupported number of arguments'! !
!PluggableListMorph methodsFor: 'menu' stamp: 'jmv 5/16/2024 11:00:29' prior: 16923729 overrides: 50335615!
          getMenu
	"Answer the menu for this view"

	"Use the new mechanism if provided. See #menuNshortcutsKey"
	super getMenu ifNotNil: [ :menu | 
		^menu ].

	"Fallback to the old way. See #mainView:menuGetter:keystrokeAction:	"
	menuGetter ifNil: [^ nil].
	(menuGetter is: #MessageSend) ifTrue: [
		^menuGetter value ].
	menuGetter numArgs = 0 ifTrue: [
		^ mainView perform: menuGetter ].
	^ self error: 'The menuGetter has an unsupported number of arguments'! !

Morph removeSelector: #model!

SystemWindow class
	instanceVariableNames: 'menuNshortcutsProviders'!

!classDefinition: 'SystemWindow class' category: #'Morphic-Widgets' stamp: 'Install-6404-SupportForNewMenusAndShortcutsSpecs-JuanVuletich-2024May22-12h11m-jmv.001.cs.st 6/6/2024 11:37:54'!
SystemWindow class
	instanceVariableNames: 'menuNshortcutsProviders'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6404-SupportForNewMenusAndShortcutsSpecs-JuanVuletich-2024May22-12h11m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6377] on 18 May 2024 at 3:44:09 pm'!

PluggableListMorphOfMany removeSelector: #model:listGetter:primarySelectionGetter:primarySelectionSetter:listSelectionGetter:listSelectionSetter:mainView:menuGetter:keystrokeAction:!

!methodRemoval: PluggableListMorphOfMany #model:listGetter:primarySelectionGetter:primarySelectionSetter:listSelectionGetter:listSelectionSetter:mainView:menuGetter:keystrokeAction: stamp: 'Install-6405-removalsForProtocolsDeprecatedIn-6374-JuanVuletich-2024May18-15h43m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"setup a whole load of pluggability options"
	getSelectionListSelector := getListSel.
	setSelectionListSelector := setListSel.
	self 
		model: anObject
		listGetter: listSel
		indexGetter: getSelectionSel
		indexSetter: setSelectionSel
		mainView: aMainView
		menuGetter: getMenuSel
		keystrokeAction: keyActionSel!

PluggableListMorph removeSelector: #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction:!

!methodRemoval: PluggableListMorph #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction: stamp: 'Install-6405-removalsForProtocolsDeprecatedIn-6374-JuanVuletich-2024May18-15h43m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel

	self model: anObject.
	getListSelector := getListSel.
	getIndexSelector := getSelectionSel.
	setIndexSelector := setSelectionSel.
	mainView := aMainView.
	menuGetter := getMenuSel.
	keystrokeActionSelector := keyActionSel.
	autoDeselect := true.
	self
		updateList;
		initForKeystrokes
!

HierarchicalListMorph removeSelector: #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction:!

!methodRemoval: HierarchicalListMorph #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction: stamp: 'Install-6405-removalsForProtocolsDeprecatedIn-6374-JuanVuletich-2024May18-15h43m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel

	self model: anObject.
	getListSelector := getListSel.
	getSelectionSelector := getSelectionSel.
	setSelectionSelector := setSelectionSel.
	mainView := aMainView.
	menuGetter := getMenuSel.
	keystrokeActionSelector := keyActionSel.
	autoDeselect := true.
	self list: self getList.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6405-removalsForProtocolsDeprecatedIn-6374-JuanVuletich-2024May18-15h43m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6377] on 18 May 2024 at 3:45:28 pm'!

PluggableListMorphOfMany class removeSelector: #model:listGetter:primarySelectionGetter:primarySelectionSetter:listSelectionGetter:listSelectionSetter:mainView:menuGetter:keystrokeAction:!

!methodRemoval: PluggableListMorphOfMany class #model:listGetter:primarySelectionGetter:primarySelectionSetter:listSelectionGetter:listSelectionSetter:mainView:menuGetter:keystrokeAction: stamp: 'Install-6406-removalsForProtocolsDeprecatedIn-6375-JuanVuletich-2024May18-15h44m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Deprecated. Please inline in senders."

	^(self withModel: anObject listGetter: listSel primarySelectionGetter: getSelectionSel primarySelectionSetter: setSelectionSel listSelectionGetter: getListSel listSelectionSetter: setListSel)
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel!

PluggableListMorph class removeSelector: #model:listGetter:indexGetter:indexSetter:!

!methodRemoval: PluggableListMorph class #model:listGetter:indexGetter:indexSetter: stamp: 'Install-6406-removalsForProtocolsDeprecatedIn-6375-JuanVuletich-2024May18-15h44m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel
	"Create a 'pluggable' list view on the given model parameterized by the given message selectors."
	^self model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: nil menuGetter: nil keystrokeAction: nil!

PluggableListMorph class removeSelector: #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction:!

!methodRemoval: PluggableListMorph class #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction: stamp: 'Install-6406-removalsForProtocolsDeprecatedIn-6375-JuanVuletich-2024May18-15h44m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Deprecated. Please inline in senders."

	^ (self withModel: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel)
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel!

HierarchicalListMorph class removeSelector: #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction:!

!methodRemoval: HierarchicalListMorph class #model:listGetter:indexGetter:indexSetter:mainView:menuGetter:keystrokeAction: stamp: 'Install-6406-removalsForProtocolsDeprecatedIn-6375-JuanVuletich-2024May18-15h44m-jmv.001.cs.st 6/6/2024 11:37:54'!
model: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel
	"Deprecated. Please inline in senders."

	^ (self withModel: anObject listGetter: getListSel indexGetter: getSelectionSel indexSetter: setSelectionSel)
		mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6406-removalsForProtocolsDeprecatedIn-6375-JuanVuletich-2024May18-15h44m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6377] on 18 May 2024 at 3:45:57 pm'!

CodeWindow removeSelector: #openMessageListMenu!

!methodRemoval: CodeWindow #openMessageListMenu stamp: 'Install-6407-removalsForProtocolsDeprecatedIn-6376-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:54'!
openMessageListMenu
	"Offer the unshifted selector-list menu"

	^ self messageListMenu popUpInWorld!

CodeWindow removeSelector: #systemCatListKey:from:!

!methodRemoval: CodeWindow #systemCatListKey:from: stamp: 'Install-6407-removalsForProtocolsDeprecatedIn-6376-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:54'!
systemCatListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also have a listView that has a list of methods.  The view knows how to get the list and selection."

	self flag: #definesKeyboardShortcuts.
	aChar = $f ifTrue: [ ^ self findClass ].
	aChar = $x ifTrue: [ ^ model removeSystemCategory ].
	aChar = $t ifTrue: [ ^ model runSystemCategoryTests ].
	aChar = $a ifTrue: [ ^ model addSystemCategory ].
	aChar = $A ifTrue: [ ^ model alphabetizeSystemCategories ].
	aChar = $b ifTrue: [ ^ self openSystemCategoryBrowser ].
	aChar = $B ifTrue: [ ^ self browseAllClasses ].
	aChar = $o ifTrue: [ ^ model fileOutSystemCategory ].
	aChar = $u ifTrue: [ ^ model updateSystemCategories ].
	aChar = $R ifTrue: [ ^ model renameSystemCategory ].
	
	^ self classListKey: aChar from: view.!

CodeWindow removeSelector: #openMessageListMenu2!

!methodRemoval: CodeWindow #openMessageListMenu2 stamp: 'Install-6407-removalsForProtocolsDeprecatedIn-6376-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:54'!
openMessageListMenu2
	"Offer the additional selector-list menu"

	^ self messageListMenu2 popUpInWorld!

CodeWindow removeSelector: #classListKey:from:!

!methodRemoval: CodeWindow #classListKey:from: stamp: 'Install-6407-removalsForProtocolsDeprecatedIn-6376-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:54'!
classListKey: aChar from: view 
	"Respond to a Command key.  I am a model with a list of classes and a 
	code pane, and I also have a listView that has a list of methods.  The 
	view knows how to get the list and selection."

	self flag: #definesKeyboardShortcuts.
	aChar = $r ifTrue: [^ model recent].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $x ifTrue: [^ model removeClass].
	aChar = $t ifTrue: [^ model runClassTests ].
	
	^ self messageListKey: aChar from: view!

CodeWindow removeSelector: #messageCatListKey:from:!

!methodRemoval: CodeWindow #messageCatListKey:from: stamp: 'Install-6407-removalsForProtocolsDeprecatedIn-6376-JuanVuletich-2024May18-15h45m-jmv.001.cs.st 6/6/2024 11:37:54'!
messageCatListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $o ifTrue: [ ^ model fileOutMessageCategories ].
	aChar = $t ifTrue: [ ^ model runMessageCategoryTests ].
	aChar = $x ifTrue: [ ^ model removeMessageCategory ].
	aChar = $R ifTrue: [ ^ model renameCategory ].
	aChar = $n ifTrue: [ ^ model addCategory ].
	aChar = $N ifTrue: [ ^ model addExtensionCategory ].
	aChar = $e ifTrue: [ ^ model removeEmptyCategories ].
	aChar = $c ifTrue: [ ^ model categorizeAllUncategorizedMethods ].
	aChar = $a ifTrue: [ ^ model alphabetizeMessageCategories ].
	aChar = $r ifTrue: [ ^ model editMessageCategories ]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6407-removalsForProtocolsDeprecatedIn-6376-JuanVuletich-2024May18-15h45m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6392] on 24 May 2024 at 1:39:27 pm'!
!TileResizeMorph class methodsFor: 'as yet unclassified' stamp: 'MM 5/24/2024 13:36:04'!
  allowedArea
	^(RealEstateAgent maximumUsableAreaInWorld: self runningWorld) insetBy: Theme current fullScreenDeskMargin! !
!SystemWindow methodsFor: 'resize/collapse' stamp: 'MM 5/24/2024 13:32:21' prior: 16971370!
         resizeLeft
	self resize: (self allowedArea right: self allowedArea center x)! !
!SystemWindow methodsFor: 'resize/collapse' stamp: 'MM 5/24/2024 13:32:38' prior: 16971376!
                    resizeRight
	self resize: (self allowedArea left: self allowedArea center x)! !
!TileResizeMorph class methodsFor: 'as yet unclassified' stamp: 'MM 5/24/2024 13:35:48' prior: 16986724!
       calculateTileRegions: aNumber
	
	^ self calculateTileRegionsIn: self allowedArea by: aNumber! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6408-TileResizeAdjustments-MarianoMontone-2024May24-13h13m-MM.001.cs.st----!

'From Cuis7.1 [latest update: #6393] on 24 May 2024 at 1:48:01 pm'!
!SystemWindow methodsFor: 'resize/collapse' stamp: 'MM 5/24/2024 13:46:46' prior: 16971348!
                          resizeBottom
	self resize: (self allowedArea top: self allowedArea center y)! !
!SystemWindow methodsFor: 'resize/collapse' stamp: 'MM 5/24/2024 13:46:28' prior: 16971382!
                    resizeTop
	self resize: (self allowedArea bottom: self allowedArea center y)! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6409-MoreResizeFixes-MarianoMontone-2024May24-13h46m-MM.001.cs.st----!

'From Cuis7.1 [latest update: #6409] on 27 May 2024 at 2:33:31 pm'!
!Debugger methodsFor: 'context stack menu' stamp: 'jmv 5/27/2024 14:07:40' prior: 16843680!
                fullStack
	"Change from displaying the minimal stack to a full one."

	self contextStackList size > self class defaultDebugStackSize "Already expanded"
		ifTrue:
			[self changed: #flash]
		ifFalse:
			[self contextStackIndex = 0 ifFalse: [
				self toggleContextStackIndex: self contextStackIndex].
			self fullyExpandStack]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6410-Debugger-fix-JuanVuletich-2024May27-14h33m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6410] on 27 May 2024 at 11:09:43 am'!
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/27/2024 10:29:09' prior: 50335615!
getMenu
	"Answer the right-click (contextual) menu."

	| widgetKey menuNshortcutsSpecs itemSpec label menu menuItem shortcutCharacter target selector iconSymbol helpText |
	widgetKey := self menuNshortcutsKey ifNil: [ ^nil ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].

	menu := MenuMorph new.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2
			ifTrue: [ menu addLine ]
			ifFalse: [
				itemSpec size = 3
					ifTrue: [
						menu addTitle: itemSpec second.
						itemSpec third ifTrue: [ menu addStayUpIcons ]]
					ifFalse: [
						label := itemSpec second.
						shortcutCharacter := itemSpec third.
						target := itemSpec fourth
							ifNotNil: [ :targetGetter | self perform: targetGetter ]
							ifNil: [ self ].
						selector := itemSpec fifth.
						iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
						helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
						menuItem := label isSymbol
							ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
							ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
						iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
						helpText ifNotNil: [ menuItem setBalloonText: helpText ]
					]
				]
		].
	^ menu! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/27/2024 10:23:02' prior: 50335500!
                               menuNshortcutsSpec: aWidgetKey for: aWidget
	"menuSpec is the Spec for the menu and shortcut keys.
	It is an Array where each entry is
		#(itemNumber 'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemNumber is an integer or float number, and is only used for ordering of menu items
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	self withAllOwnersReverseDo: [ :o |
		o ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6411-NewMenuSpec-allowTitle-JuanVuletich-2024May27-11h08m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6410] on 27 May 2024 at 2:38:19 pm'!
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/27/2024 12:02:36' prior: 50336094!
                           getMenu
	"Answer the right-click (contextual) menu."
	"Spec for the menu and shortcut keys the changesets list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"

	| widgetKey menuNshortcutsSpecs itemSpec label menu menuItem shortcutCharacter target selector isEnabledSelector iconSymbol helpText |
	widgetKey := self menuNshortcutsKey ifNil: [ ^nil ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].

	menu := MenuMorph new.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2
			ifTrue: [ menu addLine ]
			ifFalse: [
				itemSpec size = 3
					ifTrue: [
						menu addTitle: itemSpec second.
						itemSpec third ifTrue: [ menu addStayUpIcons ]]
					ifFalse: [
						label := itemSpec second.
						shortcutCharacter := itemSpec third.
						target := itemSpec fourth
							ifNotNil: [ :targetGetter | self perform: targetGetter ]
							ifNil: [ self ].
						selector := itemSpec fifth.
						isEnabledSelector := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
						iconSymbol := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
						helpText := itemSpec size >= 8 ifTrue: [ itemSpec eighth ].
						menuItem := label isSymbol
							ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
							ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
						isEnabledSelector ifNotNil: [ menuItem isEnabled: (target perform: isEnabledSelector) ].
						iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
						helpText ifNotNil: [ menuItem setBalloonText: helpText ]
					]
				]
		].
	^ menu! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6412-NewMenuSpec-allowDisabledMenuItems-JuanVuletich-2024May27-14h37m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6411] on 27 May 2024 at 2:43:19 pm'!
!ChangeListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 11:52:37'!
                     listMenuSpec
	"Spec for the menu and shortcut keys the changes list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(0 		'Change List' 									true)
		#(10		'fileIn selections' 									nil 	model 			fileInSelections 										nil 		nil
					'import the selected items into the image')
		#(20		'fileOut selections...	' 								nil 	model 			fileOutSelections 										nil 		nil
		 			'create a new file containing the selected items')
		#(30		'fileOut current version of selections...' 					nil 					model 			fileOutCurrentVersionsOfSelections 										nil 		nil
 					'create a new file containing the current (in-image) counterparts of the selected methods')
		#(40 		'-----')
		#(50		'compare to current' 									nil 	model 			compareToCurrentVersion 										nil 		nil
 					'open a separate window which shows the text differences between the on-file version and the in-image version.')
		#(60		'toggle diffing (D)' 									$D 	model 			toggleDiffing 										nil 		nil
 					'start or stop showing diffs in the code pane.')
		#(70 		'-----')
		#(80		'select new methods' 									nil 	model 			selectNewMethods 										nil 		nil
 					'select methods in the file that do not currently exist in the image')
		#(90		'select changes for absent classes' 									nil 	model 			selectAllForAbsentClasses 										nil 		nil
					'select methods in the file for classes that are not defined in the image')
		#(100		'select all changes for this class' 									nil 	model 			selectAllForThisClass 										nil 		nil
					'select all methods in the file that belong to the currently-selected class')
		#(110		'select unchanged methods' 									nil 	model 			selectUnchangedMethods 										nil 		nil
					'select methods in the file whose in-image versions are the same as their in-file counterparts')
		#(120		'select methods equivalent to current' 									nil 	model 			selectEquivalentMethods 										nil 		nil
					'select methods in the file whose in-image versions have the same behavior as their in-file counterparts')
		#(130		'select methods older than current' 									nil 	model 			selectMethodsOlderThanCurrent 										nil 		nil
					'select methods in the file that are older than the one currently in the image')
		#(140		'select removals of sent methods' 									nil 	model 			selectRemovalsOfSent 										nil 		nil
					'select all method removals of methods that have some sender in the image')
		#(150 		'-----')
		#(160		'select all (a)' 									$a 	model 			selectAll 										nil 		nil
					'select all the items in the list')
		#(170		'deselect all (A)' 									$A 	model 			deselectAll 										nil 		nil
					'deselect all the items in the list')
		#(180		'invert selections' 									nil 	model 			invertSelections 										nil 		nil
					'select every item that is not currently selected, and deselect every item that *is* currently selected')
		#(190 		'-----')
		#(200		'browse class and method' 									nil 	window 			browseMethodFull 										nil 		nil
					'open a full browser showing the selected method')
		#(210		'browse all versions of single selection' 									nil 	window 			browseVersions 										nil 		nil
					'open a version browser showing the versions of the currently selected method')
		#(220		'browse current versions of selections' 									nil 	window 			browseCurrentVersionsOfSelections 										nil 		nil
					'open a message-list browser showing the current (in-image) counterparts of the selected methods')
		#(230		'destroy current methods of selections' 									nil 	model 			destroyCurrentCodeOfSelections 										nil 		nil
					'remove (*destroy*) the in-image counterparts of all selected methods')
		#(240 		'-----')
		#(250		'remove doIts' 									nil 	model 			removeDoIts 										nil 		nil
					'remove all items that are doIts rather than definitions')
		#(260		'remove older versions' 									nil 	model 			removeOlderMethodVersions 										nil 		nil
					'remove all but the most recent versions of methods in the list')
		#(270		'remove up-to-date versions' 									nil 	model 			removeUpToDate 										nil 		nil
					'remove all items whose code is the same as the counterpart in-image code')
		#(280		'remove empty class comments' 									nil 	model 			removeEmptyClassComments 										nil 		nil
					'remove all empty class comments')
		#(290		'remove selected items' 									nil 	model 			removeSelections 										nil 		nil
					'remove the selected items from the change-list')
		#(300		'remove unselected items' 									nil 	model 			removeNonSelections 										nil 		nil
					'remove all the items not currently selected from the change-list')
	)! !
!VersionsBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 11:53:55'!
            classCommentVersionsMenuSpec
	"Spec for the menu and shortcut keys for a class comment version in the versions list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(0 		'Versions' 							true)
		#(10		'compare to current' 							nil 	model 			compareToCurrentVersion 										nil 		nil
					'compare selected version to the current version')
		#(20		'revert to selected version' 							nil 	model 			fileInSelections 										nil 		nil
					'resubmit the selected version, so that it becomes the current version')
		#(30 		'-----')
		#(40		'toggle diffing (D)' 							$D 	model 			toggleDiffing 										nil 		nil
					'toggle whether or not diffs should be shown here')
		#(50		'update list' 							nil 	model 			reformulateList 										nil 		nil
					'reformulate the list of versions, in case it somehow got out of synch with reality')
		#(60 		'-----')
		#(70		'help...' 							nil 	model 			offerVersionsHelp 										nil 		nil
					'provide an explanation of the use of this tool')
	)! !
!VersionsBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 11:01:52' overrides: 50336292!
                   listMenuSpec
	"Spec for the menu and shortcut keys the versions list."
	^model classCommentIndicated
		ifTrue: [ self classCommentVersionsMenuSpec ]
		ifFalse: [ self methodVersionsMenuSpec ]! !
!VersionsBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 11:54:09'!
  methodVersionsMenuSpec
	"Spec for the menu and shortcut keys for a method version in the versions list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| answer |
	answer := #(
				#(0 		'Versions' 									true)
	).
	model listIndex > 0 ifTrue: [
		(model list size > 1 ) ifTrue: [
			answer := answer, #(
				#(10		'compare to current' 									nil 	model 			compareToCurrentVersion 									nil 		nil
							'compare selected version to the current version')
				#(20		'compare to version...' 									nil 	model 			compareToOtherVersion 									nil 		nil
							'compare selected version to another selected version'))].
		answer := answer, #(
				#(30		'revert to selected version (z)' 									$z 	model 			fileInSelections 									nil 		nil
							'resubmit the selected version, so that it becomes the current version'))].
	answer := answer, #(
				#(40		'edit current method (O)' 									$O 	window 			openSingleMessageBrowser 									nil 		nil
							'open a single-message browser on the current version of this method')
				#(50 		'-----')
				#(60		'toggle diffing (D)' 									$D 	model 			toggleDiffing 									nil 		nil
							'toggle whether or not diffs should be shown here')
				#(70		'update list' 									nil 	model 			reformulateList 									nil 		nil
							'reformulate the list of versions, in case it somehow got out of synch with reality')
				#(80 		'-----')
				#(90		'senders (n)' 									$n 	window 			browseSenders 									nil 		nil
							'browse all senders of this selector')
				#(100		'implementors (m)' 									$m 	window 			browseImplementors 									nil 		nil
							'browse all implementors of this selector')
				#(110 		'-----')
				#(120		'help...' 									nil 	model 			offerVersionsHelp 									nil 		nil
							'provide an explanation of the use of this tool')
	).
	^answer! !
!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 5/27/2024 11:01:18' prior: 50332826!
     buildMorphicWindow
	"Open a morphic view for the messageSet, whose label is labelString. 
	The listView may be either single or multiple selection type"

	| listPane desiredExtent desiredHeight wine availableHeight |
	listPane := (PluggableListMorphOfMany
		withModel: model
		listGetter: #list
		primarySelectionGetter: #listIndex
		primarySelectionSetter: #toggleListIndex:
		listSelectionGetter: #listSelectionAt:
		listSelectionSetter: #listSelectionAt:put:)
			menuNshortcutsKey: #listMenuSpec.
	desiredExtent := listPane desiredExtent.
	desiredHeight := desiredExtent y.
	wine := RealEstateAgent standardWindowExtent.
	availableHeight := wine y - self labelHeight - (borderWidth * 2).
	desiredExtent x > wine x ifTrue: [
		desiredHeight := desiredHeight + ScrollBar scrollbarThickness ].
	desiredHeight / availableHeight < 0.4
		ifTrue: [		"Number of items is small enough to make for a fixed list regardless of Window resize"
			self layoutMorph
				addMorph: listPane fixedHeight: desiredHeight;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 1.0 ]
		ifFalse: [		"Number of items is large enough to prefer a list proportional to Window resize"
			self layoutMorph
				addMorph: listPane proportionalHeight: 0.4;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.6.
			listPane limitLayoutHeight ].! !
!VersionsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/27/2024 11:01:29' prior: 50332874 overrides: 50336626!
       buildMorphicWindow
	"Open a morphic view for the messageSet, whose label is labelString. 
	The listView may be either single or multiple selection type"

	| listPane desiredExtent desiredHeight wine availableHeight |
	listPane := (PluggableListMorph
		withModel: model
		listGetter: #list
		indexGetter: #listIndex
		indexSetter: #toggleListIndex:)
			menuNshortcutsKey: #listMenuSpec.
	desiredExtent := listPane desiredExtent.
	desiredHeight := desiredExtent y.
	wine := RealEstateAgent standardWindowExtent.
	availableHeight := wine y - self labelHeight - (borderWidth * 2).
	desiredExtent x > wine x ifTrue: [
		desiredHeight := desiredHeight + ScrollBar scrollbarThickness ].
	desiredHeight / availableHeight < 0.4
		ifTrue: [		"Number of items is small enough to make for a fixed list regardless of Window resize"
			self layoutMorph
				addMorph: listPane fixedHeight: desiredHeight;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 1.0 ]
		ifFalse: [		"Number of items is large enough to prefer a list proportional to Window resize"
			self layoutMorph
				addMorph: listPane proportionalHeight: 0.4;
				addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.6.
			listPane limitLayoutHeight ].! !

VersionsBrowserWindow removeSelector: #classCommentVersionsMenu!

!methodRemoval: VersionsBrowserWindow #classCommentVersionsMenu stamp: 'Install-6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st 6/6/2024 11:37:54'!
classCommentVersionsMenu
	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: model.				"all commands are implemented by the model, not the view"
	aMenu addTitle: 'versions'.
	aMenu addStayUpIcons.
	aMenu addItemsFromDictionaries: `{
		{
			#label 			-> 		'compare to current'.
			#selector 			-> 		#compareToCurrentVersion.
			#balloonText 	-> 			'compare selected version to the current version'
		} asDictionary.
		{
			#label 			-> 		'revert to selected version'.
			#selector 			-> 		#fileInSelections.
			#balloonText 	-> 			'resubmit the selected version, so that it becomes the current version'
		} asDictionary.
		nil.
		{
			#label 			-> 		'toggle diffing (D)'.
			#selector 			-> 		#toggleDiffing.
			#balloonText 	-> 			'toggle whether or not diffs should be shown here'
		} asDictionary.
		{
			#label 			-> 		'update list'.
			#selector 			-> 		#reformulateList.
			#balloonText 	-> 			'reformulate the list of versions, in case it somehow got out of synch with reality'
		} asDictionary.
		nil.
		{
			#label 			-> 		'help...'.
			#selector 			-> 		#offerVersionsHelp.
			#balloonText 	-> 			'provide an explanation of the use of this tool'
		} asDictionary.
	}`.
	^aMenu!

VersionsBrowserWindow removeSelector: #changeListKey:from:!

!methodRemoval: VersionsBrowserWindow #changeListKey:from: stamp: 'Install-6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st 6/6/2024 11:37:54'!
changeListKey: aChar from: view
	"Respond to a Command key in the list pane. of the versions browser"

	self flag: #definesKeyboardShortcuts.
	aChar = $z ifTrue: [^ model fileInSelections].
	^ self messageListKey: aChar from: view!

VersionsBrowserWindow removeSelector: #listMenu!

!methodRemoval: VersionsBrowserWindow #listMenu stamp: 'Install-6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st 6/6/2024 11:37:54'!
listMenu
	^model classCommentIndicated
		ifTrue: [ self classCommentVersionsMenu ]
		ifFalse: [ self methodVersionsMenu]!

VersionsBrowserWindow removeSelector: #methodVersionsMenu!

!methodRemoval: VersionsBrowserWindow #methodVersionsMenu stamp: 'Install-6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st 6/6/2024 11:37:54'!
methodVersionsMenu
	"Fill aMenu with menu items appropriate to the receiver"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Versions'.
	aMenu addStayUpIcons.
	model listIndex > 0 ifTrue:[
		(model list size > 1 ) ifTrue: [
			aMenu addItemsFromDictionaries: `{
				{
					#label 			-> 			'compare to current'.
					#object 			-> 			#model.
					#selector 			-> 			#compareToCurrentVersion.
					#balloonText 	-> 			'compare selected version to the current version'
				} asDictionary.
				{
					#label 			-> 			'compare to version...'.
					#object 			-> 			#model.
					#selector 			-> 			#compareToOtherVersion.
					#balloonText 	-> 			'compare selected version to another selected version'
				} asDictionary.
			}` ].
		"Note: Revert to selected should be visible for lists of length one for having the ability to revert to an accidentally deleted method"
		aMenu addItemsFromDictionaries: `{
			{
				#label 			-> 			'revert to selected version (z)'.
				#object 			-> 			#model.
				#selector 			-> 			#fileInSelections.
				#balloonText 	-> 			'resubmit the selected version, so that it becomes the current version'
			} asDictionary.
		}` ].

	aMenu addItemsFromDictionaries: `{
		{
			#label 			-> 			'edit current method (O)'.
			#selector 			-> 			#openSingleMessageBrowser.
			#balloonText 	-> 			'open a single-message browser on the current version of this method'
		} asDictionary.
		nil.
		{
			#label 			-> 			'toggle diffing (D)'.
			#object 			-> 			#model.
			#selector 			-> 			#toggleDiffing.
			#balloonText 	-> 			'toggle whether or not diffs should be shown here'
		} asDictionary.
		{
			#label 			-> 			'update list'.
			#object 			-> 			#model.
			#selector 			-> 			#reformulateList.
			#balloonText 	-> 			'reformulate the list of versions, in case it somehow got out of synch with reality'
		} asDictionary.
		nil.
		{
			#label 			-> 			'senders (n)'.
			#selector 			-> 			#browseSenders.
			#balloonText 	-> 			'browse all senders of this selector'
		} asDictionary.
		{
			#label 			-> 			'implementors (m)'.
			#selector 			-> 			#browseImplementors.
			#balloonText 	-> 			'browse all implementors of this selector'
		} asDictionary.
		nil.
		{
			#label 			-> 			'help...'.
			#object 			-> 			#model.
			#selector 			-> 			#offerVersionsHelp.
			#balloonText 	-> 			'provide an explanation of the use of this tool'
		} asDictionary.
	}`.
	^aMenu!

ChangeListWindow removeSelector: #changeListKey:from:!

!methodRemoval: ChangeListWindow #changeListKey:from: stamp: 'Install-6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st 6/6/2024 11:37:54'!
changeListKey: aChar from: view
	"Respond to a Command key in the list pane."

	self flag: #definesKeyboardShortcuts.
	aChar = $D ifTrue: [^ model toggleDiffing].
	aChar = $a ifTrue: [^ model selectAll].
	aChar = $A ifTrue: [^ model deselectAll]!

ChangeListWindow removeSelector: #listMenu!

!methodRemoval: ChangeListWindow #listMenu stamp: 'Install-6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st 6/6/2024 11:37:54'!
listMenu
	"Fill aMenu up so that it comprises the primary changelist-browser menu"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Change List'.
	aMenu addStayUpIcons.
	aMenu
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'fileIn selections'.
				#object 			-> 		#model.
				#selector 			-> 		#fileInSelections.
				#balloonText 		-> 		'import the selected items into the image'.
			} asDictionary.
			{
				#label 			-> 		'fileOut selections...	'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutSelections.
				#balloonText 		-> 		'create a new file containing the selected items'.
			} asDictionary.
			{
				#label 			-> 		'fileOut current version of selections...'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutCurrentVersionsOfSelections.
				#balloonText 		-> 		'create a new file containing the current (in-image) counterparts of the selected methods'.
			} asDictionary.
			nil.
			{
				#label 			-> 		'compare to current'.
				#object 			-> 		#model.
				#selector 			-> 		#compareToCurrentVersion.
				#balloonText 		-> 		'open a separate window which shows the text differences between the on-file version and the in-image version.'.
			} asDictionary.
			{
				#label 			-> 		'toggle diffing (D)'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleDiffing.
				#balloonText 	-> 			'start or stop showing diffs in the code pane.'.
			} asDictionary.
			nil.
			{
				#label 			-> 		'select new methods'.
				#object 			-> 		#model.
				#selector 			-> 		#selectNewMethods.
				#balloonText 	-> 			'select methods in the file that do not currently exist in the image'.
			} asDictionary.
			{
				#label 			-> 		'select changes for absent classes'.
				#object 			-> 		#model.
				#selector 			-> 		#selectAllForAbsentClasses.
				#balloonText 	-> 			'select methods in the file for classes that are not defined in the image'.
			} asDictionary.
			{
				#label 			-> 		'select all changes for this class'.
				#object 			-> 		#model.
				#selector 			-> 		#selectAllForThisClass.
				#balloonText 	-> 			'select all methods in the file that belong to the currently-selected class'.
			} asDictionary.
			{
				#label 			-> 		'select unchanged methods'.
				#object 			-> 		#model.
				#selector 		-> 		#selectUnchangedMethods.
				#balloonText 	-> 		'select methods in the file whose in-image versions are the same as their in-file counterparts'.
			} asDictionary.
			{
				#label 			-> 		'select methods equivalent to current'.
				#object 			-> 		#model.
				#selector 			-> 		#selectEquivalentMethods.
				#balloonText 	-> 			'select methods in the file whose in-image versions have the same behavior as their in-file counterparts'.
			} asDictionary.
			{
				#label 			-> 		'select methods older than current'.
				#object 			-> 		#model.
				#selector 			-> 		#selectMethodsOlderThanCurrent.
				#balloonText 	-> 			'select methods in the file that are older than the one currently in the image'.
			} asDictionary.
			{
				#label 			-> 		'select removals of sent methods'.
				#object 			-> 		#model.
				#selector 			-> 		#selectRemovalsOfSent.
				#balloonText 	-> 			'select all method removals of methods that have some sender in the image'.
			} asDictionary.
			nil.
			{
				#label 			-> 		'select all (a)'.
				#object 			-> 		#model.
				#selector 			-> 		#selectAll.
				#balloonText 	-> 			'select all the items in the list'.
			} asDictionary.
			{
				#label 			-> 		'deselect all (A)'.
				#object 			-> 		#model.
				#selector 			-> 		#deselectAll.
				#balloonText 	-> 			'deselect all the items in the list'.
			} asDictionary.
			{
				#label 			-> 		'invert selections'.
				#object 			-> 		#model.
				#selector 			-> 		#invertSelections.
				#balloonText 	-> 			'select every item that is not currently selected, and deselect every item that *is* currently selected'.
			} asDictionary.
			nil.
			{
				#label 			-> 		'browse class and method'.
				#selector 			-> 		#browseMethodFull.
				#balloonText 	-> 			'open a full browser showing the selected method'.
			} asDictionary.
			{
				#label 			-> 		'browse all versions of single selection'.
				#selector 			-> 		#browseVersions.
				#balloonText 	-> 			'open a version browser showing the versions of the currently selected method'.
			} asDictionary.
			{
				#label 			-> 		'browse current versions of selections'.
				#selector 			-> 		#browseCurrentVersionsOfSelections.
				#balloonText 	-> 			'open a message-list browser showing the current (in-image) counterparts of the selected methods'.
			} asDictionary.
			{
				#label 			-> 		'destroy current methods of selections'.
				#object 			-> 		#model.
				#selector 			-> 		#destroyCurrentCodeOfSelections.
				#balloonText 	-> 			'remove (*destroy*) the in-image counterparts of all selected methods'.
			} asDictionary.
			nil.
			{
				#label 			-> 		'remove doIts'.
				#object 			-> 		#model.
				#selector 			-> 		#removeDoIts.
				#balloonText 	-> 			'remove all items that are doIts rather than definitions'.
			} asDictionary.
			{
				#label 			-> 		'remove older versions'.
				#object 			-> 		#model.
				#selector 			-> 		#removeOlderMethodVersions.
				#balloonText 	-> 			'remove all but the most recent versions of methods in the list'.
			} asDictionary.
			{
				#label 			-> 		'remove up-to-date versions'.
				#object 			-> 		#model.
				#selector 			-> 		#removeUpToDate.
				#balloonText 	-> 			'remove all items whose code is the same as the counterpart in-image code'.
			} asDictionary.
			{
				#label 			-> 		'remove empty class comments'.
				#object 			-> 		#model.
				#selector 			-> 		#removeEmptyClassComments.
				#balloonText 	-> 			'remove all empty class comments'.
			} asDictionary.
			{
				#label 			-> 		'remove selected items'.
				#object 			-> 		#model.
				#selector 			-> 		#removeSelections.
				#balloonText 	-> 			'remove the selected items from the change-list'.
			} asDictionary.
			{
				#label 			-> 		'remove unselected items'.
				#object 			-> 		#model.
				#selector 			-> 		#removeNonSelections.
				#balloonText 	-> 			'remove all the items not currently selected from the change-list'.
			} asDictionary.
		}`.
	^ aMenu!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6413-UseNewMenuSpec-ChangeList-VersionsBrowser-JuanVuletich-2024May27-14h40m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6413] on 27 May 2024 at 4:27:31 pm'!
!ChangeSorter methodsFor: 'access' stamp: 'jmv 5/27/2024 11:57:32'!
                         csIsForBase
	^ myChangeSet isForBaseSystem! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 15:54:34'!
                          changeSetListMenuSpec
	"Spec for the menu and shortcut keys the changesets list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| answer |
	answer := #(
			#(0 		'Change Set' 						true)
			#(10 		'File out and remove (o)' 							$o 	model 			fileOutAndRemove 							nil 				fileOutIcon)
			#(20 		'File out and keep (k)' 							$k 	model 			fileOutAndKeep 							nil 				fileOutIcon)
			#(30 		'-----')
			#(40 		'Rename change set (R)' 					 		$R 	model 			rename 							csIsForBase 				saveAsIcon)
			#(50 		'Destroy change set (x)' 			 				$x 	model 			remove 							csIsForBase 				warningIcon)
	).
	model currentCanHavePreambleAndPostscript ifTrue: [
		model currentHasPreamble
			ifTrue: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Edit preamble (p)' 					$p 	model 			addPreamble 							nil 				textEditorIcon)
				#(80 		'Remove preamble' 					nil 	model 			removePreamble 							nil 				listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Add preamble (p)' 					$p 	model 			addPreamble 							nil 				listAddIcon) )].
		model currentHasPostscript
			ifTrue: [ answer  := answer, #(
				#(90 		'Edit postscript...' 					nil 	model 			editPostscript 							nil 				textEditorIcon)
				#(100 		'Remove postscript' 					nil 	model 			removePostscript 							nil 				listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(90 		'Add postscript...' 					nil 	model 			editPostscript 							nil 				listAddIcon) )].
	].

	answer  := answer, #(
		#(110 		'-----')
		#(120 		'conflicts with other change sets' 								nil 	window			browseMethodConflicts 							nil 				emblemImportantIcon
			'Browse all methods that occur both in this change set and in at least one other change set.')
		#(130 		'-----')
		#(140 		'trim history' 								nil 	model			trimHistory 							csIsForBase 				clockIcon
			'Drops any methods added and then removed, as well as renaming and reorganization of newly-added classes.
 NOTE: can cause confusion if later filed in over an earlier version of these changes.')
		#(150 		'view affected class categories' 								nil 	model 			viewAffectedClassCategories 								nil 			packageIcon
			'Show class categories affected by any contained change')
	).
	^answer! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 16:00:14'!
                   classListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
			#(0 		'Class List' 						false)
			#(10 		'delete class from change set (d)' 								$d 	model 			forgetClass 						nil 	warningIcon)
			#(20 		'remove class from system (x)' 								$x 	model 			removeClass 						nil 	deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 								$b 	window 			browseMethodFull 						nil 	editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 								$h 	window 			browseHierarchy 						nil 	goTopIcon)
			#(60 		'browse protocol (p)' 								$p 	window 			browseFullProtocol 						nil 	spreadsheetIcon)
			#(70 		'-----')		
			#(80 		'inst var refs...' 								nil 	window 			browseInstVarRefs 						nil 	instanceIcon)
			#(90 		'inst var defs...' 								nil 	window 			browseInstVarDefs 						nil 	instanceIcon)
			#(100 		'class var refs...' 								nil 	window 			browseClassVarRefs 						nil 	classIcon)
			#(110 		'class vars' 								nil 	window 			browseClassVariables 						nil 	classIcon)
			#(120 		'class refs (N)' 								$N 	window 			browseClassRefs 						nil 	classIcon)
	).
! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/27/2024 16:12:37'!
                messageListMenuSpec
	"Spec for the menu and shortcut keys the message list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
			#(0 		'Message List' 						true)
			#(10 		'delete method from change set (d)' 									$d 	model 			forget 								nil 	warningIcon)
			#(20 		'remove method from system (x)' 									$x 	model 			removeMessage 								nil 	deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 									$b 	window 			browseMethodFull 								nil 	editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 									$h 	window 			browseHierarchy 								nil 	goTopIcon)
			#(60 		'browse method (O)' 									$O 	window 			openSingleMessageBrowser 								nil 	scriptIcon)
			#(70 		'browse protocol (p)' 									$p 	window 			browseFullProtocol 								nil 	spreadsheetIcon)
			#(80 		'-----')		
			#(90 		'fileOut (o)' 									$o 	model 			fileOutMessage 								nil 	fileOutIcon)
			#(100 		'-----')		
			#(110 		'senders of... (n)' 									$n 	window 			browseSendersOfMessages 								nil 	mailForwardIcon)
			#(120 		'implementors of... (m)' 									$m 	window 			browseMessages 								nil 	developmentIcon)
			#(130 		'inheritance (i)' 									$i 	window 			methodInheritance 								nil 	goDownIcon)
			#(140 		'versions (v)' 									$v 	window 			browseVersions 								nil 	clockIcon)
	).
! !
!ChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 5/27/2024 16:08:48' prior: 50332917!
     buildMorphicWindow
	"Add a set of change sorter views to the given top view offset by the given amount. To create a single change sorter, call this once with an offset of 0@0. To create a dual change sorter, call it twice with offsets of 0@0 and 0.5@0."

	| changeSetList classList changeSetListPane classListPane
	  messageList upperPanes labelBackground |
	labelBackground := Theme current background.
	model myChangeSet ifNil: [
		"Or whatever was last changed, or is top of list, or whatever"
		model myChangeSet: ChangeSet changeSetForBaseSystem ].

	changeSetList := (PluggableListMorphByItem
				withModel: model
				listGetter: #changeSetList
				indexGetter: #currentChangeSetName
				indexSetter: #showChangeSetNamed:)
					menuNshortcutsKey: #changeSetListMenuSpec;
					autoDeselect: false.
	changeSetListPane := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: 'Change Set name');
		addMorphUseAll: changeSetList.

	classList := (PluggableListMorphByItem
				withModel: model
				listGetter: #classList
				indexGetter: #currentClassName
				indexSetter: #currentClassName:)
					menuNshortcutsKey: #classListMenuSpec.
	classListPane := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: 'Classes');
		addMorphUseAll: classList.

	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: changeSetListPane proportionalWidth: 0.6;
		addAdjusterAndMorph: classListPane proportionalWidth: 0.4.
	
	messageList := (PluggableListMorphByItem
				withModel: model
				listGetter: #messageList
				indexGetter: #currentSelector
				indexSetter: #currentSelector:)
					menuNshortcutsKey: #messageListMenuSpec.
	messageList := LayoutMorph newColumn
		color: labelBackground;
		addMorph: (BoxedMorph new noBorder color: `Color transparent`) fixedHeight: 4;
		addMorphKeepMorphHeight: (LabelMorph new contents: 'Methods');
		addMorphUseAll: messageList.

	self layoutMorph
		addMorph: upperPanes proportionalHeight: 0.25;
		addAdjusterAndMorph: messageList proportionalHeight: 0.2;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.55.

	self setLabel: model labelString! !

ChangeSorterWindow removeSelector: #classListKey:from:!

!methodRemoval: ChangeSorterWindow #classListKey:from: stamp: 'Install-6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st 6/6/2024 11:37:54'!
classListKey: aChar from: view
	"Respond to a Command key in the class-list pane."

	self flag: #definesKeyboardShortcuts.
	aChar = $x ifTrue: [^ model removeClass].
	aChar = $d ifTrue: [^ model forgetClass]. 

	^ self messageListKey: aChar from: view "picks up b,h,p"!

ChangeSorterWindow removeSelector: #messageListKey:from:!

!methodRemoval: ChangeSorterWindow #messageListKey:from: stamp: 'Install-6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st 6/6/2024 11:37:54'!
messageListKey: aChar from: view
	"Respond to a Command key in the message-list pane."

	self flag: #definesKeyboardShortcuts.
	aChar = $d ifTrue: [^ model forget].
	super messageListKey: aChar from: view!

ChangeSorterWindow removeSelector: #classListMenu!

!methodRemoval: ChangeSorterWindow #classListMenu stamp: 'Install-6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st 6/6/2024 11:37:54'!
classListMenu
	"Fill aMenu with items appropriate for the class list"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Class List'.
	aMenu 
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'delete class from change set (d)'.
				#object 			-> 		#model.
				#selector 			-> 		#forgetClass.
				#icon 			-> 		#warningIcon
			} asDictionary.
			{
				#label 			-> 		'remove class from system (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeClass.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			nil.
			{
				#label 			-> 		'browse full (b)'.
				#selector 			-> 		#browseMethodFull.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#browseHierarchy.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#label 			-> 		'browse protocol (p)'.
				#selector 			-> 		#browseFullProtocol.
				#icon 			-> 		#spreadsheetIcon
			} asDictionary.
			nil.
			{
				#label 			-> 		'inst var refs...'.
				#selector 			-> 		#browseInstVarRefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#label 			-> 		'inst var defs...'.
				#selector 			-> 		#browseInstVarDefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#label 			-> 		'class var refs...'.
				#selector 			-> 		#browseClassVarRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#label 			-> 		'class vars'.
				#selector 			-> 		#browseClassVariables.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#label 			-> 		'class refs (N)'.
				#selector 			-> 		#browseClassRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
		}`.
	^ aMenu!

ChangeSorterWindow removeSelector: #changeSetMenu!

!methodRemoval: ChangeSorterWindow #changeSetMenu stamp: 'Install-6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st 6/6/2024 11:37:54'!
changeSetMenu
	"Set up aMenu to hold commands for the change-set-list pane.  This could be for a single or double changeSorter"

	| aMenu isForBaseSystem |
	self flag: #assumesKeyboardShortcuts.
	isForBaseSystem := model changeSet isForBaseSystem.
	aMenu := MenuMorph new defaultTarget: model.
	aMenu addTitle: 'Change Set'.
	aMenu addStayUpIcons.

	aMenu add: 'File out and remove (o)' 			action: #fileOutAndRemove 	icon: #fileOutIcon.
	aMenu add: 'File out and keep (k)' 				action: #fileOutAndKeep 		icon: #fileOutIcon.
	aMenu addLine.

	aMenu add: 'Rename change set (R)' 			action: #rename 					icon: #saveAsIcon 	enabled: isForBaseSystem.
	aMenu add: 'Destroy change set (x)' 			action: #remove 					icon: #warningIcon 	enabled: isForBaseSystem.
	aMenu addLine.
	model currentCanHavePreambleAndPostscript ifTrue: [
		aMenu addLine.
		model currentHasPreamble
			ifTrue: [
				aMenu add: 'Edit preamble (p)' 		action: #addPreamble 			icon: #textEditorIcon.
				aMenu add: 'Remove preamble' 	action: #removePreamble 		icon: #listRemoveIcon ]
			ifFalse: [
				aMenu add: 'Add preamble (p)' 	action: #addPreamble 			icon: #listAddIcon ].
		model currentHasPostscript
			ifTrue: [
				aMenu add: 'Edit postscript...' 		action: #editPostscript 			icon: #textEditorIcon .
				aMenu add: 'Remove postscript' 	action: #removePostscript 		icon: #listRemoveIcon ]
			ifFalse: [
				aMenu add: 'Add postscript...' 		action: #editPostscript 			icon: #listAddIcon ].
	].
	aMenu addLine.

	"CONFLICTS SECTION"
	(aMenu add: 'conflicts with other change sets' 	target: self 	action: #browseMethodConflicts 	icon: #emblemImportantIcon)
		setBalloonText: 'Browse all methods that occur both in this change set and in at least one other change set.'.
	aMenu addLine.

	"CHECKS SECTION"
	(aMenu add: 'trim history' 						action: #trimHistory 				icon: #clockIcon 		enabled: isForBaseSystem)
		setBalloonText: ' Drops any methods added and then removed, as well as renaming and reorganization of newly-added classes.
 NOTE: can cause confusion if later filed in over an earlier version of these changes.'.

	(aMenu add: 'view affected class categories' action: #viewAffectedClassCategories icon: #packageIcon)
		setBalloonText: ' Show class categories affected by any contained change'.

	^ aMenu!

ChangeSorterWindow removeSelector: #messageMenu!

!methodRemoval: ChangeSorterWindow #messageMenu stamp: 'Install-6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st 6/6/2024 11:37:54'!
messageMenu
	"Fill aMenu with items appropriate for the message list; could be for a single or double changeSorter"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'message list'.
	aMenu addStayUpIcons.
	aMenu 
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'delete method from changeSet (d)'.
				#object 			-> 		#model.
				#selector 			-> 		#forget.
				#icon 			-> 		#warningIcon
			} asDictionary.
			nil.
			{
				#label 			-> 		'remove method from system (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeMessage.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			nil.
			{
				#label 			-> 		'browse full (b)'.
				#selector 			-> 		#browseMethodFull.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#browseHierarchy.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#label 			-> 		'browse method (O)'.
				#selector 			-> 		#openSingleMessageBrowser.
				#icon 			-> 		#scriptIcon
			} asDictionary.
			{
				#label 			-> 		'browse protocol (p)'.
				#selector 			-> 		#browseFullProtocol.
				#icon 			-> 		#spreadsheetIcon
			} asDictionary.
			nil.
			{
				#label 			-> 		'fileOut'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutMessage.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			nil.
			{
				#label 			-> 		'senders of... (n)'.
				#selector 			-> 		#browseSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#label 			-> 		'implementors of... (m)'.
				#selector 			-> 		#browseMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#label 			-> 		'inheritance (i)'.
				#selector 			-> 		#methodInheritance.
				#icon 			-> 		#goDownIcon
			} asDictionary.
			{
				#label 			-> 		'versions (v)'.
				#selector 			-> 		#browseVersions.
				#icon 			-> 		#clockIcon
			} asDictionary.
		}`.
	^ aMenu!

ChangeSorterWindow removeSelector: #changeSetListKey:from:!

!methodRemoval: ChangeSorterWindow #changeSetListKey:from: stamp: 'Install-6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st 6/6/2024 11:37:54'!
changeSetListKey: aChar from: view
	"Respond to a Command key.  I am a model with a listView that has a list of changeSets."

	self flag: #definesKeyboardShortcuts.
	aChar = $D ifTrue: [^ model toggleDiffing]. 
	aChar = $o ifTrue: [^ model fileOutAndRemove].
	aChar = $k ifTrue: [^ model fileOutAndKeep].
	aChar = $R ifTrue: [^ model rename].
	aChar = $x ifTrue: [^ model remove].

	^ self messageListKey: aChar from: view!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6414-UseNewMenuSpec-ChangeSorter-JuanVuletich-2024May27-16h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6414] on 28 May 2024 at 4:02:03 pm'!
!DebuggerWindow methodsFor: 'menu commands' stamp: 'jmv 5/28/2024 15:58:43'!
                       contextClassBrowse

	BrowserWindow
		fullOnClass: model contextVariablesInspector selectedClassOrMetaClass! !
!DebuggerWindow methodsFor: 'menu commands' stamp: 'jmv 5/28/2024 15:57:09'!
     contextClassProtocol

	ProtocolBrowserWindow
		openFullProtocolForClass: model contextVariablesInspector selectedClassOrMetaClass! !
!DebuggerWindow methodsFor: 'menu commands' stamp: 'jmv 5/28/2024 15:53:36'!
              inspectContextSelection

	model contextVariablesInspector selectionIndex = 0 ifTrue: [^ self flash].
	^ model contextVariablesInspector selection inspect! !
!DebuggerWindow methodsFor: 'menu commands' stamp: 'jmv 5/28/2024 15:53:44'!
                      inspectReceiverSelection
	model receiverInspector selectionIndex = 0 ifTrue: [^ self flash].
	^ model receiverInspector  selection inspect! !
!DebuggerWindow methodsFor: 'menu commands' stamp: 'jmv 5/28/2024 15:58:37'!
     receiverClassBrowse

	BrowserWindow
		fullOnClass: model receiverInspector selectedClassOrMetaClass! !
!DebuggerWindow methodsFor: 'menu commands' stamp: 'jmv 5/28/2024 15:57:21'!
            receiverClassProtocol

	ProtocolBrowserWindow
		openFullProtocolForClass: model receiverInspector selectedClassOrMetaClass! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/28/2024 15:13:26'!
              contextStackMenuSpec
	"Spec for the menu and shortcut keys for a class comment version in the versions list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(10		'fullStack (f)' 						$f 	window 			fullStack 						nil 	nil 	'show the complete call stack')
		#(20		'proceed (p)' 						$p 	window 			proceed 						nil 	nil 	'close the debugger and proceed')
		#(30		'restart (r)' 						$r 	window 			restart 						nil 	nil 	'reset this context to its start')
		#(40		'step into send (e)' 						$e 	window 			send 						nil 	nil 	'step into message sends')
		#(50		'step over send (t)' 						$t 	window 			doStep 						nil 	nil 	'step over message sends')
		#(60		'step into block (T)' 						$T 	window 			stepIntoBlock 						nil 	nil 	'step into a code block')
		#(70		'run to cursor' 						nil 	window 			runToCursor 						nil 	nil 	'run to cursor')
		#(80		'where (w)' 						$w 	window 			where 						nil 	nil 	'select current pc range')
		#(90		'peel to first like this' 						nil 	window 			peelToFirst 						nil 	nil 	'peel stack back to the second occurance of selected message')
		#(100 		'-----')
		#(110		'return entered value' 						nil 	window 			returnValue 						nil 	nil 	'lets you enter an expression and return method answering result')
		#(120		'toggle break on entry' 						nil 	model 			toggleBreakOnEntry 						nil 	nil 	'install or uninstall a breakpoint on method entry')
	)! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/28/2024 15:56:01'!
 contextVariablesListMenuSpec
	"Spec for the menu and shortcut keys for the list of variables in this context.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(10		'inspect (i)' 						$i 	window 			inspectContextSelection 							nil 	inspectIcon)
		#(20		'explore (I)' 						$I 	window 			exploreContextSelection 							nil 	exploreIcon)
		#(30 		'-----')
		#(40		'browser full (b)' 						$b 	window 			contextClassBrowse 							nil 	editFindReplaceIcon)
		#(50		'browser hierarch (h)' 						$h 	window 			contextClassHierarchy 							nil 	goTopIcon)
		#(60		'browser protocol (p)' 						$p 	window 			contextClassProtocol 							nil 	spreadsheetIcon)
	)! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/28/2024 15:55:58'!
      receiverVariablesListMenuSpec
	"Spec for the menu and shortcut keys for the list of instance variables in the receiver.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(10		'inspect (i)' 						$i 	window 			inspectReceiverSelection 							nil 	inspectIcon)
		#(20		'explore (I)' 						$I 	window 			exploreReceiverSelection 							nil 	exploreIcon)
		#(30 		'-----')
		#(40		'browser full (b)' 						$b 	window 			receiverClassBrowse 							nil 	editFindReplaceIcon)
		#(50		'browser hierarch (h)' 						$h 	window 			receiverClassHierarchy 							nil 	goTopIcon)
		#(60		'browser protocol (p)' 						$p 	window 			receiverClassProtocol 							nil 	spreadsheetIcon)
	)! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 5/28/2024 15:59:15' prior: 50332999!
               contextVariableInspector

	^ contextVariableInspector ifNil: [
		contextVariableInspector := (PluggableListMorph
			withModel: model contextVariablesInspector 
			listGetter: #fieldList
			indexGetter: #selectionIndex 
			indexSetter: #toggleIndex:)
				menuNshortcutsKey: #contextVariablesListMenuSpec ].		! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 5/28/2024 15:59:10' prior: 50333013!
             receiverInspector

	^ receiverInspector ifNil: [
		receiverInspector := (PluggableListMorph
			withModel: model receiverInspector
			listGetter: #fieldList
			indexGetter: #selectionIndex 
			indexSetter: #toggleIndex:)
				menuNshortcutsKey: #receiverVariablesListMenuSpec ].! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 5/28/2024 15:15:17' prior: 50333026!
            stackList

	^ stackList ifNil: [
		stackList := (PluggableListMorph
			withModel: model 
			listGetter: #contextStackList
			indexGetter: #contextStackIndex
			indexSetter: #toggleContextStackIndex:)
				menuNshortcutsKey: #contextStackMenuSpec ].
! !

DebuggerWindow removeSelector: #exploreSelectionIn:!

!methodRemoval: DebuggerWindow #exploreSelectionIn: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
exploreSelectionIn: anInspector
	"Create and schedule an Explorer on the receiver's model's currently selected object."

	^ anInspector selection explore!

DebuggerWindow removeSelector: #browseClassRefsIn:!

!methodRemoval: DebuggerWindow #browseClassRefsIn: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
browseClassRefsIn: anInspector

	anInspector selectedClass ifNotNil: [ :cls | 
		Smalltalk browseAllCallsOnClass: cls theNonMetaClass]!

DebuggerWindow removeSelector: #browseHierarchyIn:!

!methodRemoval: DebuggerWindow #browseHierarchyIn: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
browseHierarchyIn: anInspector
	"Create and schedule a class list browser on the receiver's hierarchy."

	HierarchyBrowserWindow
		onClass: anInspector selectedClassOrMetaClass
		selector: nil!

DebuggerWindow removeSelector: #inspectorKey:from:!

!methodRemoval: DebuggerWindow #inspectorKey:from: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
inspectorKey: aChar from: view
	"Respond to a Command key issued while the cursor is over my field list"

	self flag: #definesKeyboardShortcuts.
	aChar = $i ifTrue: [^ self inspectSelectionIn: view model ].
	aChar = $I ifTrue: [^ self exploreSelectionIn: view model ].
	aChar = $b ifTrue:[^ self browseMethodFullIn: view model ].
	aChar = $h ifTrue:[^ self browseHierarchyIn: view model].
	aChar = $p ifTrue: [^ self browseFullProtocolIn: view model].
	aChar = $N ifTrue: [^ self browseClassRefsIn: view model].!

DebuggerWindow removeSelector: #contextStackKey:from:!

!methodRemoval: DebuggerWindow #contextStackKey:from: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
contextStackKey: aChar from: view
	"Respond to a keystroke in the context list"

	self flag: #definesKeyboardShortcuts.
	aChar = $e ifTrue: [^ self send].
	aChar = $t ifTrue: [^ self doStep].
	aChar = $T ifTrue: [^ self stepIntoBlock].
	aChar = $p ifTrue: [^ self proceed].
	aChar = $r ifTrue: [^ self restart].
	aChar = $f ifTrue: [^ self fullStack].
	aChar = $w ifTrue: [^ self where].

	^ self messageListKey: aChar from: view!

DebuggerWindow removeSelector: #contextFieldListMenu!

!methodRemoval: DebuggerWindow #contextFieldListMenu stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
contextFieldListMenu
	"Arm the supplied menu with items for the field-list of the receiver"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'explore (I)'.
				#selector 			-> 		#exploreContextSelection
			} asDictionary.
			nil.
			{
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#contextClassHierarchy
			} asDictionary.
		}`.
	^ aMenu!

DebuggerWindow removeSelector: #receiverFieldListMenu!

!methodRemoval: DebuggerWindow #receiverFieldListMenu stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
receiverFieldListMenu
	"Arm the supplied menu with items for the field-list of the receiver"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'explore (I)'.
				#selector 			-> 		#exploreReceiverSelection
			} asDictionary.
			nil.
			{
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#receiverClassHierarchy
			} asDictionary.
		}`.
	^ aMenu!

DebuggerWindow removeSelector: #browseMethodFullIn:!

!methodRemoval: DebuggerWindow #browseMethodFullIn: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
browseMethodFullIn: anInspector
	"Create and schedule a full Browser and then select the current class and message."

	|  myClass |
	(myClass := anInspector selectedClassOrMetaClass) ifNotNil: [
		BrowserWindow fullOnClass: myClass selector: nil]!

DebuggerWindow removeSelector: #contextStackMenu!

!methodRemoval: DebuggerWindow #contextStackMenu stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
contextStackMenu
	"Set up the menu appropriately for the context-stack-list, either shifted or unshifted as per the parameter provided"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'fullStack (f)'.
				#selector 			-> 		#fullStack
			} asDictionary.
			{
				#label 			-> 		'restart (r)'.
				#selector 			-> 		#restart
			} asDictionary.
			{
				#label 			-> 		'proceed (p)'.
				#selector 			-> 		#proceed
			} asDictionary.
			{
				#label 			-> 		'step (t)'.
				#selector 			-> 		#doStep
			} asDictionary.
			{
				#label 			-> 		'step through (T)'.
				#selector 			-> 		#stepIntoBlock
			} asDictionary.
			{
				#label 			-> 		'send (e)'.
				#selector 			-> 		#send
			} asDictionary.
			{
				#label 			-> 		'where (w)'.
				#selector 			-> 		#where
			} asDictionary.
			{
				#label 			-> 		'peel to first like this'.
				#selector 			-> 		#peelToFirst
			} asDictionary.
			nil.
			{
				#label 			-> 		'return entered value'.
				#selector 			-> 		#returnValue
			} asDictionary.
			{
				#label 			-> 		'toggle break on entry'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleBreakOnEntry
			} asDictionary.
		}`.
	^aMenu!

DebuggerWindow removeSelector: #inspectSelectionIn:!

!methodRemoval: DebuggerWindow #inspectSelectionIn: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
inspectSelectionIn: anInspector
	"Create and schedule an Inspector on the receiver's model's currently selected object."

	^ anInspector selection inspect!

DebuggerWindow removeSelector: #browseFullProtocolIn:!

!methodRemoval: DebuggerWindow #browseFullProtocolIn: stamp: 'Install-6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
browseFullProtocolIn: anInspector
	"Spawn a window showing full protocol for the receiver's selection"

	ProtocolBrowserWindow
		openFullProtocolForClass: anInspector selectedClassOrMetaClass!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6415-UseNewMenuSpec-Debugger-JuanVuletich-2024May28-14h44m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6414] on 28 May 2024 at 4:38:57 pm'!
!Inspector methodsFor: 'user interface support' stamp: 'jmv 5/28/2024 16:12:30'!
                             objectSpecificMenuSpecFrom: aWindow

	^nil! !
!DictionaryInspector methodsFor: 'user interface support' stamp: 'jmv 5/28/2024 16:13:06' overrides: 50338142!
   objectSpecificMenuSpecFrom: aWindow

	^aWindow menuSpecForDictionary! !
!SetInspector methodsFor: 'user interface support' stamp: 'jmv 5/28/2024 16:13:26' overrides: 50338142!
                objectSpecificMenuSpecFrom: aWindow

	^aWindow menuSpecForSet! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/28/2024 16:33:29'!
          fieldListMenuSpec
	"Spec for the menu and shortcut keys for the list of variables in our object.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| answer |
	answer := #(
		#(10		'inspect (i)' 						$i 	window 			inspectSelection 							nil 	inspectIcon)
		#(20		'explore (I)' 						$I 	window 			exploreSelection 							nil 	exploreIcon)
		#(30		'copy to clipboard (c)' 						$c 	window 			copySelectionToClipboard 							nil 	copyIcon)
		#(40		'basic inspect' 						nil 	window 			inspectBasic 							nil 	inspectIcon)
		#(50		'references finder' 						nil 	window 			openReferencesFinder 							nil 	exploreIcon)
		#(60		'weight explorer' 						nil 	window 			openWeightExplorer 							nil 	exploreIcon)
	).
	(self model objectSpecificMenuSpecFrom: self) ifNotNil: [ :spec |
		answer := answer, spec ].
	answer := answer, #(
		#(210 		'-----')
		#(220		'browser full (b)' 						$b 	window 			browseMethodFull 							nil 	editFindReplaceIcon)
		#(230		'browser hierarch (h)' 						$h 	window 			browseHierarchy 							nil 	goTopIcon)
		#(240		'browser protocol (p)' 						$p 	window 			browseFullProtocol 							nil 	spreadsheetIcon)
	).
	^answer! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/28/2024 16:19:55'!
                              menuSpecForDictionary
	"Spec for the menu and shortcut keys for the list of variables in our object.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(100 		'-----')
		#(110		'inspect key' 					nil 	window 			inspectSelectedKey 							nil 	findIcon)
		#(120		'senders of this key' 					nil 	window 			sendersOfSelectedKey 							nil 	mailForwardIcon)
		#(130		'add key' 					nil 	window 			addEntry 							nil 	listAddIcon)
		#(140		'rename key' 					nil 	window 			renameEntry 							nil 	saveAsIcon)
		#(150		'remove' 					nil 	model 			removeSelection 							nil 	listRemoveIcon)
	)! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/28/2024 16:17:59'!
          menuSpecForSet
	"Spec for the menu and shortcut keys for the list of variables in our object.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(100 		'-----')
		#(110		'remove' 			nil 	model 			removeSelection 					nil 	listRemoveIcon)
	)! !
!InspectorWindow methodsFor: 'GUI building' stamp: 'jmv 5/28/2024 16:32:31' prior: 50333177!
                             buildList

	| list |
	
	list := (PluggableListMorph
			withModel: model 
			listGetter: #fieldList
			indexGetter: #selectionIndex
			indexSetter: #toggleIndex:)
				menuNshortcutsKey: #fieldListMenuSpec.
	list doubleClickSelector: #inspectSelection.
	^list! !

InspectorWindow removeSelector: #basicMenuOptions!

!methodRemoval: InspectorWindow #basicMenuOptions stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
basicMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^ `{
		{
			#label 			-> 		'inspect (i)'.
			#selector 			-> 		#inspectSelection.
			#icon 			-> 		#inspectIcon
		} asDictionary.
		{
			#label 			-> 		'explore (I)'.
			#selector 			-> 		#exploreSelection.
			#icon 			-> 		#exploreIcon
		} asDictionary.
		{
			#label 			-> 		'copy to clipboard (c)'.
			#selector 			-> 		#copySelectionToClipboard.
			#icon 			-> 		#copyIcon
		} asDictionary.
		{
			#label 			-> 		'basic inspect'.
			#selector 			-> 		#inspectBasic.
			#icon 			-> 		#inspectIcon
		} asDictionary.
		{
			#label 			-> 		'references finder'.
			#selector 			-> 		#openReferencesFinder.
			#icon 			-> 		#exploreIcon
		} asDictionary.
		{
			#label 			-> 		'weight explorer'.
			#selector 			-> 		#openWeightExplorer.
			#icon 			-> 		#exploreIcon
		} asDictionary.
	}`.!

InspectorWindow removeSelector: #fieldListMenu!

!methodRemoval: InspectorWindow #fieldListMenu stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
fieldListMenu
	"Arm the supplied menu with items for the field-list of the receiver"

	| aMenu |
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addItemsFromDictionaries: self basicMenuOptions.
	self model suggestObjectSpecificMenuItemsFor: aMenu from: self.
	aMenu addItemsFromDictionaries: self menuOptionsForBrowsing.
	^ aMenu!

InspectorWindow removeSelector: #menuOptionsForBrowsing!

!methodRemoval: InspectorWindow #menuOptionsForBrowsing stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
menuOptionsForBrowsing

	self flag: #assumesKeyboardShortcuts.
	^ `{
		nil.
		{
			#label 			-> 		'browse full (b)'.
			#selector 			-> 		#browseMethodFull.
			#icon 			-> 		#editFindReplaceIcon
		} asDictionary.
		{
			#label 			-> 		'browse hierarchy (h)'.
			#selector 			-> 		#browseHierarchy.
			#icon 			-> 		#goTopIcon
		} asDictionary.
		{
			#label 			-> 		'browse protocol (p)'.
			#selector 			-> 		#browseFullProtocol.
			#icon 			-> 		#spreadsheetIcon
		} asDictionary.
	}`!

InspectorWindow removeSelector: #inspectorKey:from:!

!methodRemoval: InspectorWindow #inspectorKey:from: stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
inspectorKey: aChar from: view
	"Respond to a Command key issued while the cursor is over my field list"

	self flag: #definesKeyboardShortcuts.
	aChar = $i ifTrue: [^ self inspectSelection].
	aChar = $I ifTrue: [^ self exploreSelection].
	aChar = $b ifTrue:[^ self browseMethodFull].
	aChar = $h ifTrue:[^ self browseHierarchy].
	aChar = $p ifTrue: [^ self browseFullProtocol].
	aChar = $N ifTrue: [^ self browseClassRefs].!

InspectorWindow removeSelector: #browseClassRefs!

!methodRemoval: InspectorWindow #browseClassRefs stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
browseClassRefs

	model selectedClass ifNotNil: [ :cls | 
		Smalltalk browseAllCallsOnClass: cls theNonMetaClass]!

InspectorWindow removeSelector: #menuOptionsForDictionary!

!methodRemoval: InspectorWindow #menuOptionsForDictionary stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
menuOptionsForDictionary

	^ `{
		nil.
		{
			#label 			-> 		'inspect key'.
			#selector 			-> 		#inspectSelectedKey.
			#icon 			-> 		#findIcon
		} asDictionary.
		{
			#label 			-> 		'senders of this key'.
			#selector 			-> 		#sendersOfSelectedKey.
			#icon 			-> 		#mailForwardIcon
		} asDictionary.
		{
			#label 			-> 		'add key'.
			#selector 			-> 		#addEntry.
			#icon 			-> 		#listAddIcon
		} asDictionary.
		{
			#label 			-> 		'rename key'.
			#selector 			-> 		#renameEntry.
			#icon 			-> 		#saveAsIcon
		} asDictionary.
		{
			#label 			-> 		'remove'.
			#object 			-> 		#model.
			#selector 			-> 		#removeSelection.
			#icon 			-> 		#listRemoveIcon
		} asDictionary.
	}`!

InspectorWindow removeSelector: #menuOptionsForSet!

!methodRemoval: InspectorWindow #menuOptionsForSet stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
menuOptionsForSet

	^ `{
		nil.
		{
			#label 			-> 		'remove'.
			#object 			-> 		#model.
			#selector 			-> 		#removeSelection.
			#icon 			-> 		#listRemoveIcon
		} asDictionary.
	}`!

SetInspector removeSelector: #suggestObjectSpecificMenuItemsFor:from:!

!methodRemoval: SetInspector #suggestObjectSpecificMenuItemsFor:from: stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
suggestObjectSpecificMenuItemsFor: aMenu from: aWindow

	aMenu addItemsFromDictionaries: aWindow menuOptionsForSet!

DictionaryInspector removeSelector: #suggestObjectSpecificMenuItemsFor:from:!

!methodRemoval: DictionaryInspector #suggestObjectSpecificMenuItemsFor:from: stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
suggestObjectSpecificMenuItemsFor: aMenu from: aWindow

	aMenu addItemsFromDictionaries: aWindow menuOptionsForDictionary!

Inspector removeSelector: #suggestObjectSpecificMenuItemsFor:from:!

!methodRemoval: Inspector #suggestObjectSpecificMenuItemsFor:from: stamp: 'Install-6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st 6/6/2024 11:37:55'!
suggestObjectSpecificMenuItemsFor: aMenu from: aWindow

	^self!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6416-UseNewMenuSpec-Inspector-JuanVuletich-2024May28-16h02m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6414] on 29 May 2024 at 11:07:25 am'!
!ObjectExplorer methodsFor: 'monitoring' stamp: 'jmv 5/29/2024 10:56:12'!
                          isMonitoring
	^monitorList isEmptyOrNil not! !
!ObjectExplorerWindow methodsFor: 'menu commands' stamp: 'jmv 5/29/2024 10:50:22'!
                              addHaloToSelection
	model getCurrentSelection item addHalo! !
!ObjectExplorerWindow methodsFor: 'menu commands' stamp: 'jmv 5/29/2024 10:54:57'!
               monitorChanges
	"Start stepping and watching the given wrapper for changes."

	model getCurrentSelection ifNotNil: [ :wrapper |
		model monitorList at: wrapper put: wrapper asString.
		self startSteppingStepTime: 200 ]! !
!ObjectExplorerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 11:05:49'!
        listMenuSpec
	"Spec for the menu and shortcut keys for our tree nodes.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| answer |
	model getCurrentSelection
		ifNil: [^#()]
		ifNotNil: [ :currSel |
			answer := #(
				#(10		'inspect (i)' 						$i 	window 			inspectSelection 							nil 	inspectIcon)
				#(20		'explore (I)' 						$I 	window 			exploreSelection 							nil 	exploreIcon)
				#(30		'copy to clipboard (c)' 						$c 	window 			copySelectionToClipboard 							nil 	copyIcon)
				#(40		'basic inspect' 						nil 	window 			inspectBasic 							nil 	inspectIcon)
				#(50		'references finder' 						nil 	window 			openReferencesFinder 							nil 	exploreIcon)
				#(60		'weight explorer' 						nil 	window 			openWeightExplorer 							nil 	exploreIcon)
				#(70 		'-----')
				#(80		'browser full (b)' 						$b 	window 			browseMethodFull 							nil 	editFindReplaceIcon)
				#(90		'browser hierarch (h)' 						$h 	window 			browseHierarchy 							nil 	goTopIcon)
				#(100		'browser protocol (p)' 						$p 	window 			browseFullProtocol 							nil 	spreadsheetIcon)).
			(currSel item is: #Morph) ifTrue: [ answer := answer, #(
				#(110 		'-----')
				#(120		'show morph halo' 						nil 	window 			addHaloToSelection 							nil 	editFindReplaceIcon)) ].
			model class == ReferencesExplorer ifTrue: [ answer := answer, #(
				#(210 		'-----')
				#(220		'rescan' 						nil 	window 			rescan 							nil 	editFindReplaceIcon)) ].
			answer := answer, #(
				#(310 		'-----')
				#(320		'monitor changes' 						nil 	window 			monitorChanges 							nil 	editFindReplaceIcon)).
			model isMonitoring ifTrue: [ answer := answer, #(
				#(410 		'-----')
				#(420		'stop monitoring all' 						nil 	window 			stopMonitoring 							nil 	editFindReplaceIcon)) ].
			^answer ].! !
!ObjectExplorerWindow methodsFor: 'GUI building' stamp: 'jmv 5/29/2024 11:06:54' prior: 50333190!
                            buildMorphicWindow

	| textMorph |
	listMorph := (HierarchicalListMorph
			withModel: model
			listGetter: #getList
			indexGetter: #getCurrentSelection
			indexSetter: #noteNewSelection:)
				menuNshortcutsKey: #listMenuSpec.
	listMorph autoDeselect: false.
	listMorph doubleClickSelector: #inspectSelection.
	textMorph := ((TextModelMorph textProvider: model)
			askBeforeDiscardingEdits: false;
			emptyTextDisplayMessage: 'Smalltalk expression (self is selected item)').
	self layoutMorph
		addMorph: listMorph proportionalHeight: 0.8;
		addAdjusterAndMorph: textMorph proportionalHeight: 0.2.
	self setLabel: model rootObject shortPrintString.
! !

ObjectExplorerWindow removeSelector: #genericMenu!

!methodRemoval: ObjectExplorerWindow #genericMenu stamp: 'Install-6417-UseNewMenuSpec-Explorer-JuanVuletich-2024May28-16h38m-jmv.001.cs.st 6/6/2024 11:37:55'!
genericMenu
	"Borrow a menu from my inspector"
	
	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	model getCurrentSelection
		ifNil: [
			aMenu
				add: '*nothing selected*'
				target: self
				action: #yourself]
		ifNotNil: [
			aMenu
				addItemsFromDictionaries: `{
					{
						#label 			-> 		'inspect (i)'.
						#selector 			-> 		#inspectSelection.
						#icon 			-> 		#inspectIcon
					} asDictionary.
					{
						#label 			-> 		'explore (I)'.
						#selector 			-> 		#exploreSelection.
						#icon 			-> 		#exploreIcon
					} asDictionary.
					{
						#label 			-> 		'copy to clipboard (c)'.
						#selector 			-> 		#copySelectionToClipboard.
						#icon 			-> 		#copyIcon
					} asDictionary.
					{
						#label 			-> 		'basic inspect'.
						#selector 			-> 		#inspectBasic.
						#icon 			-> 		#inspectIcon
					} asDictionary.
					{
						#label 			-> 		'references finder'.
						#selector 			-> 		#openReferencesFinder.
						#icon 			-> 		#exploreIcon
					} asDictionary.
					{
						#label 			-> 		'weight explorer'.
						#selector 			-> 		#openWeightExplorer.
						#icon 			-> 		#exploreIcon
					} asDictionary.
					nil.
					{
						#label 			-> 		'browse full (b)'.
						#selector 			-> 		#browseMethodFull.
						#icon 			-> 		#editFindReplaceIcon
					} asDictionary.
					{
						#label 			-> 		'browse hierarchy (h)'.
						#selector 			-> 		#browseHierarchy.
						#icon 			-> 		#goTopIcon
					} asDictionary.
					{
						#label 			-> 		'browse protocol (p)'.
						#selector 			-> 		#browseFullProtocol.
						#icon 			-> 		#spreadsheetIcon
					} asDictionary.
				}`.
			model getCurrentSelection ifNotNil: [ :currSel |
				(currSel item is: #Morph) ifTrue: [
					aMenu addLine.
					aMenu add: 'show morph halo' target: currSel item action: #addHalo]].
			aMenu addLine;
				add: 'monitor changes'
				target: self
				action: #monitor:
				argument: model getCurrentSelection.
			model class == ReferencesExplorer ifTrue: [
				aMenu addLine;
					add: 'rescan'
					target: self
					action: #rescan ]].
	model basicMonitorList isEmptyOrNil
		ifFalse: [
			aMenu addLine;
				add: 'stop monitoring all'
				target: self
				action: #stopMonitoring ].
	^ aMenu!

ObjectExplorerWindow removeSelector: #explorerKey:from:!

!methodRemoval: ObjectExplorerWindow #explorerKey:from: stamp: 'Install-6417-UseNewMenuSpec-Explorer-JuanVuletich-2024May28-16h38m-jmv.001.cs.st 6/6/2024 11:37:55'!
explorerKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	model getCurrentSelection ifNotNil: [

		aChar = $i ifTrue: [^ self inspectSelection].
		aChar = $I ifTrue: [^ self exploreSelection].

		aChar = $b ifTrue: [^ self browseMethodFull].
		aChar = $h ifTrue: [^ self browseHierarchy].
		aChar = $p ifTrue: [^ self browseFullProtocol].
		aChar = $N ifTrue: [^ self browseClassRefs]].!

ObjectExplorerWindow removeSelector: #monitor:!

!methodRemoval: ObjectExplorerWindow #monitor: stamp: 'Install-6417-UseNewMenuSpec-Explorer-JuanVuletich-2024May28-16h38m-jmv.001.cs.st 6/6/2024 11:37:55'!
monitor: anObjectExplorerWrapper
	"Start stepping and watching the given wrapper for changes."

	anObjectExplorerWrapper ifNotNil: [
		model monitorList at: anObjectExplorerWrapper put: anObjectExplorerWrapper asString.
		self startSteppingStepTime: 200 ]!

ObjectExplorer removeSelector: #basicMonitorList!

!methodRemoval: ObjectExplorer #basicMonitorList stamp: 'Install-6417-UseNewMenuSpec-Explorer-JuanVuletich-2024May28-16h38m-jmv.001.cs.st 6/6/2024 11:37:55'!
basicMonitorList
	^monitorList!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6417-UseNewMenuSpec-Explorer-JuanVuletich-2024May28-16h38m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6417] on 29 May 2024 at 12:24:07 pm'!
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 11:30:19' prior: 50337100!
            changeSetListMenuSpec
	"Spec for the menu and shortcut keys the changesets list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| answer |
	answer := #(
			#(0 		'Change Set' 						true)
			#(10 		'File out and remove (o)' 							$o 	model 			fileOutAndRemove 							nil 				fileOutIcon)
			#(20 		'File out and keep (k)' 							$k 	model 			fileOutAndKeep 							nil 				fileOutIcon)
			#(30 		'-----')
			#(40 		'Rename change set (R)' 					 		$R 	model 			rename 							csIsForBase 				saveAsIcon)
			#(50 		'Destroy change set (x)' 			 				$x 	model 			remove 							csIsForBase 				warningIcon)
	).
	model currentCanHavePreambleAndPostscript ifTrue: [
		model currentHasPreamble
			ifTrue: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Edit preamble (p)' 						$p 	model 			addPreamble 							nil 				textEditorIcon)
				#(80 		'Remove preamble' 						nil 	model 			removePreamble 							nil 				listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Add preamble (p)' 						$p 	model 			addPreamble 							nil 				listAddIcon) )].
		model currentHasPostscript
			ifTrue: [ answer  := answer, #(
				#(90 		'Edit postscript...' 						nil 	model 			editPostscript 							nil 				textEditorIcon)
				#(100 		'Remove postscript' 						nil 	model 			removePostscript 							nil 				listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(90 		'Add postscript...' 						nil 	model 			editPostscript 							nil 				listAddIcon) )].
	].

	answer  := answer, #(
		#(110 		'-----')
		#(120 		'conflicts with other change sets' 								nil 	window			browseMethodConflicts 							nil 				emblemImportantIcon
			'Browse all methods that occur both in this change set and in at least one other change set.')
		#(130 		'-----')
		#(140 		'trim history' 								nil 	model			trimHistory 							csIsForBase 				clockIcon
			'Drops any methods added and then removed, as well as renaming and reorganization of newly-added classes.
 NOTE: can cause confusion if later filed in over an earlier version of these changes.')
		#(150 		'view affected class categories' 								nil 	model 			viewAffectedClassCategories 								nil 			packageIcon
			'Show class categories affected by any contained change')
	).
	^answer! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6418-tweak-JuanVuletich-2024May29-12h23m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6418] on 29 May 2024 at 12:27:18 pm'!
!FileListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 12:05:06'!
                       directoryTreeMenuSpec
	"Spec for the menu and shortcut keys for our tree nodes.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| showHiddenTogleAndLabel |
	showHiddenTogleAndLabel := model showHidden asMenuItemTextPrefix, 'show hidden folders and files'.
	^{
		{10. 'delete directory...'. 								nil. 	#model. 			#deleteDirectory. 							nil. 	#warningIcon.
			'Delete the selected directory'}.
		{20. 	showHiddenTogleAndLabel. 							nil. 	#model. 			#toggleShowHidden. 							nil. 	nil.
			'show or hide files and directories that begin with a dot'}.
		{30. 	'show Cuis top as tree root'. 							nil. 	#window. 			#useCuisTopAsTreeRoot. 							nil. 	nil.
			'use the default Cuis top directory'}.
		{40. 'show OS roots as tree root'. 								nil. 	#window. 			#useOSrootsAsTreeRoot. 							nil. 	nil.
			'use the host OS root directories. Drives on Windows; "/" on Unix'}
	}! !
!FileListWindow methodsFor: 'menu commands' stamp: 'jmv 5/29/2024 11:58:59'!
                   useCuisTopAsTreeRoot
	Preferences at: #initialFileListDirectories put: #cuis.
	Preferences saveToDisk: #initialFileListDirectories.

	model changed: #topDirectoryWrappers.
	model updateDirectory.
	model updateFileList.! !
!FileListWindow methodsFor: 'menu commands' stamp: 'jmv 5/29/2024 11:59:02'!
                     useOSrootsAsTreeRoot
	Preferences at: #initialFileListDirectories put: #roots.
	Preferences saveToDisk: #initialFileListDirectories.

	model changed: #topDirectoryWrappers.
	model updateDirectory.
	model updateFileList.! !
!FileListWindow methodsFor: 'GUI building' stamp: 'jmv 5/29/2024 11:48:54' prior: 50333153!
     morphicDirectoryTreePane

	^(HierarchicalListMorph
		withModel: model
		listGetter: #topDirectoryWrappers
		indexGetter: #currentDirectorySelected
		indexSetter: #setSelectedDirectoryTo:)
			menuNshortcutsKey: #directoryTreeMenuSpec;
			autoDeselect: false;
			yourself! !

FileListWindow removeSelector: #directoryTreeMenu!

!methodRemoval: FileListWindow #directoryTreeMenu stamp: 'Install-6419-UseNewMenuSpec-FileListTree-JuanVuletich-2024May29-12h25m-jmv.001.cs.st 6/6/2024 11:37:55'!
directoryTreeMenu
	| aMenu initialDirectoriesMenu  |
	aMenu := MenuMorph new defaultTarget: model.
	(aMenu
		add: 'delete directory...'
		action: #deleteDirectory
		icon: #warningIcon)
			setBalloonText: 'Delete the selected directory'.
	(aMenu
		add: model showHidden asMenuItemTextPrefix, 'show hidden folders and files'
		action: #toggleShowHidden)
			setBalloonText: 'show or hide files and directories that begin with a dot'.
	initialDirectoriesMenu := MenuMorph new.
	#(
		(cuis  		'Cuis top' 'Use the default Cuis top directory')
		(roots  		'OS roots' 'Use the host OS root directories. Drives on Windows; "/" on Unix')
	)
		do: [ :entry |
			(initialDirectoriesMenu
				add: entry second
				target: self
				action: #initialFileListDirectories:
				argument: entry first)
					setBalloonText: entry third ].
	aMenu add: 'default initial directories' subMenu: initialDirectoriesMenu.
	^ aMenu!

FileListWindow removeSelector: #initialFileListDirectories:!

!methodRemoval: FileListWindow #initialFileListDirectories: stamp: 'Install-6419-UseNewMenuSpec-FileListTree-JuanVuletich-2024May29-12h25m-jmv.001.cs.st 6/6/2024 11:37:55'!
initialFileListDirectories: aSymbol
	Preferences at: #initialFileListDirectories put: aSymbol.
	Preferences saveToDisk: #initialFileListDirectories.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6419-UseNewMenuSpec-FileListTree-JuanVuletich-2024May29-12h25m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6418] on 29 May 2024 at 3:44:40 pm'!
!ProcessBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 15:08:43'!
     processListMenuSpec
	"Spec for the menu and shortcut keys for the list of processes.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| rules answer |
	answer := #().
	model selectedProcess ifNotNil: [ :selectedProcess |
		rules := model class rulesFor: model selectedProcess.
		answer := answer, #(
				#(10		'inspect (i)' 						$i 	window 			inspectProcess 						nil 	inspectIcon)
				#(20		'explore (I)' 						$I 	window 			exploreProcess 						nil 	exploreIcon)
				#(30		'references finder (P)' 						$P 	window 			openReferencesFinder 					nil 		exploreIcon)).
		rules first ifTrue: [
			answer := answer, 
				#((40		'terminate (t)' 						$t 	model 			terminateProcess 						nil 	cancelIcon)).
			selectedProcess isSuspended ifTrue: [ answer := answer,
				#((50		'resume (r)' 						$r 	model 			resumeProcess 						nil 	mediaPlaybackStartIcon))]
			ifFalse: [ answer := answer, 
				#((50 		'suspend (s)' 						$s 	model 			suspendProcess 						nil 	chatIcon))]].
		rules second ifTrue: [ answer := answer, #(
				#(60 		'change priority (p)' 						$p 	window 			changePriority 						nil 	systemMonitorIcon)
				#(70 		'debug (d)' 						$d 	window 			debugProcess 						nil 	debugIcon))].
		(selectedProcess suspendingList isKindOf: Semaphore) ifTrue: [ answer := answer,
				#((80 		'signal Semaphore (S)' 						$S 	model 			signalSemaphore 						nil 	haloHelpIcon))].
		answer := answer, #(
				#(90		'full stack (k)' 						$k 	model 			moreStack 						nil 	systemIcon)
				#(100 		'-----'))].
	answer := answer, #(
				#(110		'find context... (f)' 						$f 	window 			findContext 						nil 	findIcon)
				#(120		'find again (g)' 						$g 	model 			nextContext 						nil 	systemIcon)
				#(130 		'-----')).
	answer := answer, (isStepping ifTrue: [
				#((140		'turn off auto-update (a)' 						$a 	window 			toggleAutoUpdate 						nil 	cancelIcon)) ]
			ifFalse: [
				#((140		'turn on auto-update (a)' 						$a 	window 			toggleAutoUpdate 						nil 	updateIcon)) ]).
	answer := answer, #(
				#(150		'update list (u)' 						$u 	model 			updateProcessList 						nil 	updateIcon)
				#(160 		'-----')).
	answer := answer, (CPUWatcher isMonitoring ifTrue: [
				#((170		'stop CPUWatcher' 						nil 	model 			stopCPUWatcher 						nil 	inspectIcon)) ]
			ifFalse: [
				#((170		'start CPUWatcher' 						nil 	model 			startCPUWatcher 						nil 	inspectIcon)) ]).
	answer := answer, (StackSizeWatcher isWatching ifTrue: [
				#((180		'stop StackSizeWatcher' 						nil 	model 			stopStackSizeWatcher 						nil 	inspectIcon)) ]
			ifFalse: [
				#((180		'start StackSizeWatcher' 						nil 	model 			startStackSizeWatcher 						nil 	inspectIcon)) ]).
	^answer! !
!ProcessBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 12:55:56'!
                  stackMenuSpec
	"Spec for the menu and shortcut keys for the list of stack frames.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^ #(
		#(10		'inspect context (c)' 					$c 	window 			inspectContext 					nil 	inspectIcon)
		#(20		'explore context (C)' 					$C 	window 			exploreContext 					nil 	exploreIcon)
		#(30		'inspect receiver (i)' 					$i 	window 			inspectReceiver 					nil 	inspectIcon)
		#(40		'explore receiver (I)' 					$I 	window 			exploreReceiver 					nil 	exploreIcon)
		#(50		'browse context (b)' 					$b 	window 			browseContext 					nil 	editFindReplaceIcon)
	).! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 12:54:27' prior: 50337718!
   contextStackMenuSpec
	"Spec for the menu and shortcut keys for call stack list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(10		'fullStack (f)' 						$f 	window 			fullStack 						nil 	nil 	'show the complete call stack')
		#(20		'proceed (p)' 						$p 	window 			proceed 						nil 	nil 	'close the debugger and proceed')
		#(30		'restart (r)' 						$r 	window 			restart 						nil 	nil 	'reset this context to its start')
		#(40		'step into send (e)' 						$e 	window 			send 						nil 	nil 	'step into message sends')
		#(50		'step over send (t)' 						$t 	window 			doStep 						nil 	nil 	'step over message sends')
		#(60		'step into block (T)' 						$T 	window 			stepIntoBlock 						nil 	nil 	'step into a code block')
		#(70		'run to cursor' 						nil 	window 			runToCursor 						nil 	nil 	'run to cursor')
		#(80		'where (w)' 						$w 	window 			where 						nil 	nil 	'select current pc range')
		#(90		'peel to first like this' 						nil 	window 			peelToFirst 						nil 	nil 	'peel stack back to the second occurance of selected message')
		#(100 		'-----')
		#(110		'return entered value' 						nil 	window 			returnValue 						nil 	nil 	'lets you enter an expression and return method answering result')
		#(120		'toggle break on entry' 						nil 	model 			toggleBreakOnEntry 						nil 	nil 	'install or uninstall a breakpoint on method entry')
	)! !
!ProcessBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/29/2024 15:41:00' prior: 50333216!
                buildMorphicWindow
	"Create a pluggable version of me, answer a window"
	| aTextMorph list1 list2 upperRow |
	list1 := (PluggableListMorph
				withModel: model
				listGetter: #processNameList
				indexGetter: #processListIndex
				indexSetter: #processListIndex:)
					menuNshortcutsKey: #processListMenuSpec.
	list2 := (PluggableListMorph
				withModel: model
				listGetter: #stackNameList
				indexGetter: #stackListIndex
				indexSetter: #stackListIndex:)
					menuNshortcutsKey: #stackMenuSpec.
	upperRow := LayoutMorph newRow.
	upperRow
		addMorph: list1 proportionalWidth: 0.5;
		addAdjusterAndMorph: list2 proportionalWidth: 0.5.
	aTextMorph := (TextModelMorph
				textProvider: model
				textGetter: #selectedMethod) emptyTextDisplayMessage: 'Method source (not selected?)'.
	aTextMorph askBeforeDiscardingEdits: false.
	self layoutMorph
		addMorph: upperRow proportionalHeight: 0.5;
		addAdjusterAndMorph: aTextMorph proportionalHeight: 0.5.
	self setLabel: 'Process Browser'! !
!ProcessBrowserWindow methodsFor: 'open/close' stamp: 'jmv 5/29/2024 15:06:07' prior: 16930983 overrides: 16970932!
              openInWorld
	
	super openInWorld.
	self startAutoUpdate.
	model startCPUWatcher! !

ProcessBrowserWindow removeSelector: #processListMenu!

!methodRemoval: ProcessBrowserWindow #processListMenu stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
processListMenu

	| menu rules |
	self flag: #assumesKeyboardShortcuts.
	menu := MenuMorph new defaultTarget: self.

	model selectedProcess
		ifNotNil: [ :selectedProcess |
			rules := model class rulesFor: model selectedProcess.
			menu
				add: 'inspect (i)'				action: #inspectProcess 				icon: #inspectIcon;
				add: 'explore (I)'				action: #exploreProcess 				icon: #exploreIcon;
				add: 'references finder'	action: #openReferencesFinder 		icon: #exploreIcon.
			rules first
				ifTrue: [
					menu add: 'terminate (t)' target: model action: #terminateProcess icon: #cancelIcon.
					selectedProcess isSuspended
						ifTrue: [menu add: 'resume (r)' target: model action: #resumeProcess icon: #mediaPlaybackStartIcon]
						ifFalse: [menu add: 'suspend (s)' target: model action: #suspendProcess icon: #chatIcon]].
			rules second
				ifTrue: [
					menu
						add: 'change priority (p)'	action: #changePriority 	icon: #systemMonitorIcon;
						add: 'debug (d)'				action: #debugProcess 	icon: #debugIcon ].
			(selectedProcess suspendingList isKindOf: Semaphore)
				ifTrue: [menu add: 'signal Semaphore (S)' target: model action: #signalSemaphore icon: #haloHelpIcon ].
			menu add: 'full stack (k)' target: model action: #moreStack icon: #systemIcon.
			menu addLine].

	menu
		add: 'find context... (f)'					action: #findContext 	icon: #findIcon;
		add: 'find again (g)'	target: model 	action: #nextContext 	icon: #systemIcon.
	menu addLine.

	isStepping
		ifTrue: [ 	menu add: 'turn off auto-update (a)' 	action: #toggleAutoUpdate icon: #cancelIcon ]
		ifFalse: [ 	menu add: 'turn on auto-update (a)' 	action: #toggleAutoUpdate icon: #updateIcon ].
		
	menu add: 'update list (u)' target: model action: #updateProcessList icon: #updateIcon.

	menu addLine.
	CPUWatcher isMonitoring
			ifTrue: [ menu add: 'stop CPUWatcher' action: #stopCPUWatcher icon: #inspectIcon ]
			ifFalse: [ menu add: 'start CPUWatcher' action: #startCPUWatcher icon: #inspectIcon ].
	StackSizeWatcher isWatching
			ifTrue: [ menu add: 'stop StackSizeWatcher' action: #stopStackSizeWatcher icon: #inspectIcon ]
			ifFalse: [ menu add: 'start StackSizeWatcher' action: #startStackSizeWatcher  icon: #inspectIcon ].

	^ menu!

ProcessBrowserWindow removeSelector: #stackListKey:from:!

!methodRemoval: ProcessBrowserWindow #stackListKey:from: stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
stackListKey: aKey from: aView 

	self flag: #definesKeyboardShortcuts.
	^ aKey caseOf: {
		[$c] -> [self inspectContext].
		[$C] -> [self exploreContext].
		[$i] -> [self inspectReceiver].
		[$I] -> [self exploreReceiver].
		[$b] -> [self browseContext]}
		 otherwise: [].!

ProcessBrowserWindow removeSelector: #processListKey:from:!

!methodRemoval: ProcessBrowserWindow #processListKey:from: stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
processListKey: aKey from: aView

	self flag: #definesKeyboardShortcuts.
	^ aKey caseOf: {
		[$i] -> [self inspectProcess].
		[$I] -> [self exploreProcess].
		[$P] -> [self openReferencesFinder].
		[$t] -> [model terminateProcess].
		[$r] -> [model resumeProcess].
		[$s] -> [model suspendProcess].
		[$d] -> [self debugProcess].
		[$p] -> [self changePriority].
		[$f] -> [self findContext].
		[$g] -> [model nextContext].
		[$a] -> [self toggleAutoUpdate].
		[$u] -> [model updateProcessList].
		[$S] -> [model signalSemaphore].
		[$k] -> [model moreStack]}
		 otherwise: []!

ProcessBrowserWindow removeSelector: #stopCPUWatcher!

!methodRemoval: ProcessBrowserWindow #stopCPUWatcher stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
stopCPUWatcher
	model stopCPUWatcher!

ProcessBrowserWindow removeSelector: #stackListMenu!

!methodRemoval: ProcessBrowserWindow #stackListMenu stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
stackListMenu
	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	model selectedContext
		ifNil: [^ aMenu].
	aMenu
		add: 'inspect context (c)' 		action: #inspectContext icon: #inspectIcon;
		add: 'explore context (C)' 		action: #exploreContext icon: #exploreIcon;
		add: 'inspect receiver (i)' 		action: #inspectReceiver icon: #inspectIcon;
		add: 'explore receiver (I)' 		action: #exploreReceiver icon: #exploreIcon;
		add: 'browse (b)' 				action: #browseContext icon: #editFindReplaceIcon.
	^aMenu!

ProcessBrowserWindow removeSelector: #startCPUWatcher!

!methodRemoval: ProcessBrowserWindow #startCPUWatcher stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
startCPUWatcher

	model startCPUWatcher!

ProcessBrowserWindow removeSelector: #stopStackSizeWatcher!

!methodRemoval: ProcessBrowserWindow #stopStackSizeWatcher stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
stopStackSizeWatcher
	model stopStackSizeWatcher!

ProcessBrowserWindow removeSelector: #startStackSizeWatcher!

!methodRemoval: ProcessBrowserWindow #startStackSizeWatcher stamp: 'Install-6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st 6/6/2024 11:37:55'!
startStackSizeWatcher

	model startStackSizeWatcher!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6420-UseNewMenuspec-ProcessBrowser-JuanVuletich-2024May29-12h27m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6418] on 29 May 2024 at 4:15:20 pm'!
!TestRunnerWindow methodsFor: 'menu commands' stamp: 'jmv 5/29/2024 16:09:21'!
             browseSelected
	| cls |
	cls := (model tests at: model selectedSuite ifAbsent: ['']) copyUpTo: Character space.
	cls := cls asSymbol.
	cls := (Smalltalk at: cls ifAbsent: nil).
	cls ifNotNil: [
		BrowserWindow fullOnClass: cls selector: nil ]! !
!TestRunnerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/29/2024 16:13:10'!
                    listMenuSpec
	"Spec for the menu and shortcut keys for the list of test classes.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	| answer |
	answer := #(
		#(0 		'Test Cases Set' 						false)
		#(10		'select all (a)' 					$a 	model 			selectAll 					nil 	selectAllIcon)
		#(20		'deselect all (A)' 					$A 	model 			deselectAll 					nil 	selectAllIcon)
		#(30		'invert selections' 					nil 	model 			invertSelections 					nil 	switchIcon)
		#(40		'filter (f)' 					$f 	model 			setFilter 					nil 	findIcon)
		#(50		'refresh (u)' 					$u 	model 			refreshTests 					nil 	refreshIcon)
		#(60 		'-----')).
	model isRunning ifTrue: [ answer := answer, #(
		#(70		'stop (l)' 					$l 	model 			interruptRun 					nil 	stopIcon))]
	ifFalse: [ answer := answer, #(
		#(70		'run (r)' 					$r 	model 			runTests 					nil 	playIcon)
		#(80		'run one (o)' 					$o 	model 			runOneTest 					nil 	playIcon)
		#(90		'run profiled (p)' 					$p 	model 			runProfiledTests 					nil 	playIcon))].
	model selectedSuite > 0 ifTrue: [ answer := answer, #(
		#(100 		'-----')
		#(110		'browse' 					nil 	window 			browseSelected 					nil 	editFindReplaceIcon))].
	answer := answer, #(
		#(100 		'-----')
		#(110		'log to Transcript' 					nil 	model 			showResult 					nil 	printerIcon)).
	^answer! !
!TestRunnerWindow methodsFor: 'GUI building' stamp: 'jmv 5/29/2024 16:12:07' prior: 50333270!
                        buildUpperControls
	| refreshButton filterButton stopButton runOneButton runButton runProfiledButton buttonsRow theTestsList column |

	runOneButton := self buildRunOneButton.
	runButton := self buildRunButton.
	runProfiledButton := self buildRunProfiledButton.	

	refreshButton := self buildRefreshButton.
	filterButton := self buildFilterButton.
	stopButton := self buildStopButton.

	theTestsList := (PluggableListMorphOfMany
				withModel: model
				listGetter: #tests
				primarySelectionGetter: #selectedSuite
				primarySelectionSetter: #selectedSuite:
				listSelectionGetter: #listSelectionAt:
				listSelectionSetter: #listSelectionAt:put:)
					menuNshortcutsKey: #listMenuSpec.
	theTestsList autoDeselect: false.
	theTestsList color: self textBackgroundColor.

	buttonsRow := LayoutMorph newRow.
	buttonsRow doAdoptWidgetsColor.
	buttonsRow color: self buttonColor.
	buttonsRow
		addMorphs: {runButton. runOneButton. runProfiledButton};
		addMorphs: {refreshButton. filterButton. stopButton}.

	column := LayoutMorph newColumn.
	column
		addMorph: theTestsList proportionalHeight: 1;
		addMorph: buttonsRow fixedHeight: self defaultButtonPaneHeight.

	^ column! !

TestRunnerWindow removeSelector: #listMenu!

!methodRemoval: TestRunnerWindow #listMenu stamp: 'Install-6421-UseNewMenuSpec-TestRunner-JuanVuletich-2024May29-15h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
listMenu
	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Test Cases';
		add: 'select all (a)' target: model action: #selectAll icon: #selectAllIcon;
		add: 'deselect all (A)' target: model action: #deselectAll icon: #selectAllIcon;
		add: 'invert selections' target: model action: #invertSelections icon: #switchIcon;
		add: 'filter (f)' target: model action: #setFilter icon: #findIcon;
		add: 'refresh (u)' target: model action: #refreshTests icon: #refreshIcon;
		addLine.
	model isRunning
		ifTrue:
			[aMenu add: 'stop (l)' target: model action: #interruptRun icon: #stopIcon]
		ifFalse:
			[aMenu add: 'run (r)' target: model action: #runTests icon: #playIcon;
				add: 'run one (o)' target: model action: #runOneTest icon: #playIcon;
				add: 'run profiled (p)' target: model action: #runProfiledTests icon: #playIcon].
	model selectedSuite > 0 ifTrue: [ | cls |
		cls := (model tests at: model selectedSuite ifAbsent: ['']) copyUpTo: Character space.
		cls := cls asSymbol.
		cls := (Smalltalk at: cls ifAbsent: nil).
		cls ifNotNil: [
			aMenu addLine.
			(aMenu add: 'browse' target: self action: #browse: argument: cls)
				setIcon: #editFindReplaceIcon.
		].
	].
	aMenu addLine.
	aMenu add: 'log to Transcript' target: model action: #showResult icon: #printerIcon.
	^aMenu!

TestRunnerWindow removeSelector: #listKey:from:!

!methodRemoval: TestRunnerWindow #listKey:from: stamp: 'Install-6421-UseNewMenuSpec-TestRunner-JuanVuletich-2024May29-15h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
listKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $a ifTrue: [^ model selectAll].
	aChar = $A ifTrue: [^ model deselectAll].
	aChar = $u ifTrue: [^ self refreshTests].
	aChar = $f ifTrue: [^ model setFilter].
	aChar = $r ifTrue: [^ model runTests].
	aChar = $o ifTrue: [^ model runOneTest].
	aChar = $p ifTrue: [^ model runProfiledTests].
	aChar = $l ifTrue: [^ model interruptRun].!

TestRunnerWindow removeSelector: #browse:!

!methodRemoval: TestRunnerWindow #browse: stamp: 'Install-6421-UseNewMenuSpec-TestRunner-JuanVuletich-2024May29-15h44m-jmv.001.cs.st 6/6/2024 11:37:55'!
browse: aClass
	BrowserWindow fullOnClass: aClass selector: nil!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6421-UseNewMenuSpec-TestRunner-JuanVuletich-2024May29-15h44m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6421] on 31 May 2024 at 3:17:38 pm'!
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:57:35'!
                     addAsSubclassResponsabilitySelector

	self selectedMessageName ifNotNil: [ :selectedSelector |
		(AddAsSubclassResponsabilityApplier
			on: self for: self selectedClassOrMetaClass>>selectedSelector)
				value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:24:58'!
    addInstVar

	self selectedClassOrMetaClass ifNotNil: [ :aClass |
		(AddInstanceVariableApplier on: self for: aClass) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:58:41'!
                          addParameter

	self selectedMessageName ifNotNil: [ :oldSelector | 
		RefactoringApplier addParameterApplier
			createAndValueHandlingExceptionsOn: self for: oldSelector in: self selectedClassOrMetaClass ]! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:00:19'!
          changeKeywordOrder

	self selectedMessageName ifNotNil: [ :oldSelector |
		ChangeKeywordsSelectorOrderApplier createAndValueHandlingExceptions: [
			ChangeKeywordsSelectorOrderApplier
				on: self for: oldSelector in: self selectedClassOrMetaClass ]].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:00:47'!
                            inlineMethod

	self selectedMessageName ifNotNil: [ :selectorToInline |
		RefactoringApplier inlineMethodApplier
			createAndValueHandlingExceptionsOn: self
			forMethod: (MethodReference class: self selectedClassOrMetaClass selector: selectorToInline )]! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:01:50'!
                         moveToInstanceOrClassMethod

	self selectedMessageName ifNotNil: [ :selectedSelector |
		(MoveToInstanceOrClassMethodApplier
			on: self
			for: self selectedClassOrMetaClass>>selectedSelector) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:34:13'!
             pushDownInstanceVariable

	self selectedClassOrMetaClass ifNotNil: [ :aClass |
		(PushDownInstanceVariableApplier on: self at: aClass ) value].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:02:52'!
        pushDownSelectorToOneSubclass

	self selectedMessageName ifNotNil: [ :selectedSelector |
		(PushDownMethodToOneSubclassApplier
			on: self for: self selectedClassOrMetaClass>>selectedSelector) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:03:36'!
              pushDownSelectorToSubclasses

	self selectedMessageName ifNotNil: [ :selectedSelector |
		(PushDownMethodToSubclassesApplier
			on: self for: self selectedClassOrMetaClass>>selectedSelector) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:32:46'!
                pushUpInstanceVariable

	self selectedClassOrMetaClass ifNotNil: [ :aClass |
		(PushUpInstanceVariableApplier on: self at: aClass ) value].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:04:20'!
            pushUpSelector

	self selectedMessageName ifNotNil: [ :selectedSelector |
		(PushUpMethodApplier
			on: self for: self selectedClassOrMetaClass>>selectedSelector)
				value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:31:35'!
        removeAllUnreferencedInstVar

	self selectedClassOrMetaClass ifNotNil: [ :aClass |
		(RemoveAllUnreferencedInstanceVariablesApplier on: self for: aClass) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:29:58'!
                     removeInstVar

	self selectedClassOrMetaClass ifNotNil: [ :aClass |
		(RemoveInstanceVariableApplier on: self for: aClass) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:05:37'!
                    removeParameter

	self selectedMessageName ifNotNil: [ :oldSelector |
		RefactoringApplier removeParameterApplier
			createAndValueHandlingExceptionsOn: self
			for: oldSelector
			in: self selectedClassOrMetaClass ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 11:28:11'!
                              renameInstVar

	self selectedClassOrMetaClass ifNotNil: [ :aClass |
		(RenameInstanceVariableApplier on: self at: aClass) value ].! !
!Browser methodsFor: 'refactorings' stamp: 'jmv 5/31/2024 12:06:22'!
                     renameSelector

	self selectedMessageName ifNotNil: [ :oldSelector |
		RefactoringApplier renameSelectorApplier
			createAndValueHandlingExceptionsOn: self
			for: oldSelector
			in: self selectedClassOrMetaClass ].! !
!BrowserWindow methodsFor: 'keyboard shortcuts' stamp: 'jmv 5/31/2024 12:06:28' prior: 16799635 overrides: 16827611!
                messageListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also
	have a listView that has a list of methods.  The view knows how to get
	the list and selection."

	| sel |
	self flag: #definesKeyboardShortcuts.
	sel := model selectedMessageName.
	sel
		ifNotNil: [
			"The following require a method selection"
			aChar = $c ifTrue: [ ^ self browseCategoryOfCurrentMethod ].
			aChar = $R ifTrue: [^ model renameSelector].
			aChar = $A ifTrue: [^ model addParameter ].
			aChar = $S ifTrue: [^ model removeParameter ].
			aChar = $F ifTrue: [^ model inlineMethod ]].
	super messageListKey: aChar from: view! !
!RefactoringMenues class methodsFor: 'browser menues' stamp: 'jmv 5/31/2024 11:33:49' prior: 16936696!
              classListMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^ `{
			{
				#itemGroup 				-> 		5.
				#itemOrder 				-> 		10.
				#label 				-> 		RefactoringMenues refactoringsLabel.
				#selector 				-> 		#yourself.
				#icon 				-> 		#listAddIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		10.
				#itemOrder 				-> 		20.
				#label 				-> 		'insert superclass...'.
				#object 				-> 		#model.
				#selector 				-> 		#insertSuperclass.
				#icon 				-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		10.
				#label 				-> 		'add inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#addInstVar.
				#icon 				-> 		#listAddIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		20.
				#label 				-> 		'rename inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#renameInstVar.
				#icon 				-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		30.
				#label 				-> 		'remove inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#removeInstVar.
				#icon 				-> 		#deleteIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		40.
				#label 				-> 		'remove all unreferenced inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#removeAllUnreferencedInstVar.
				#icon 				-> 		#deleteIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		50.
				#label 				-> 		'push up inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#pushUpInstanceVariable.
				#icon 				-> 		#goTopIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		60.
				#label 				-> 		'push down inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#pushDownInstanceVariable.
				#icon 				-> 		#goBottomIcon
			} asDictionary.				
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		30.
				#itemOrder 				-> 		10.
				#label 				-> 		'rename global...'.
				#object 				-> 		#model.
				#selector 				-> 		#renameGlobal.
				#icon 				-> 		#saveAsIcon
			} asDictionary.
	}`.! !
!RefactoringMenues class methodsFor: 'browser menues' stamp: 'jmv 5/31/2024 12:06:33' prior: 16936793!
                          messageListMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^ `{
		{
			#itemGroup 			-> 		5.
			#itemOrder 			-> 		10.
			#label 			-> 		RefactoringMenues refactoringsLabel.
			#selector 			-> 		#yourself.
			#icon 			-> 		#listAddIcon
		} asDictionary.
			{
				#submenuOf 	-> 				RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'rename... (R)'.
				#object 			-> 		#model.
				#selector 			-> 		#renameSelector.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		15.
				#label 			-> 		'change keyword order...'.
				#object 			-> 		#model.
				#selector 			-> 		#changeKeywordOrder.
				#icon 			-> 		#sendReceiveIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'add parameter...(A)'.
				#object 			-> 		#model.
				#selector 			-> 		#addParameter.
				#icon 			-> 		#listAddIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		30.
				#label 			-> 		'remove parameter...(S)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeParameter.
				#icon 			-> 		#listRemoveIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'inline method... (F)'.
				#object 			-> 		#model.
				#selector 			-> 		#inlineMethod.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'move to instance/class method'.
				#object 			-> 		#model.
				#selector 			-> 		#moveToInstanceOrClassMethod.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'push up'.
				#object 			-> 		#model.
				#selector 			-> 		#pushUpSelector.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		40.
				#label 			-> 		'add in superclass as subclassResponsability'.
				#object 			-> 		#model.
				#selector 			-> 		#addAsSubclassResponsabilitySelector.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		50.
				#label 			-> 		'push down to subclasses'.
				#object 			-> 		#model.
				#selector 			-> 		#pushDownSelectorToSubclasses.
				#icon 			-> 		#goBottomIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		60.
				#label 			-> 		'push down to one subclass'.
				#object 			-> 		#model.
				#selector 			-> 		#pushDownSelectorToOneSubclass.
				#icon 			-> 		#goBottomIcon
			} asDictionary.
			
		}`.
	! !

BrowserWindow removeSelector: #addParameter!

!methodRemoval: BrowserWindow #addParameter stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
addParameter

	model selectedMessageName ifNotNil: [ :oldSelector | 
		RefactoringApplier addParameterApplier createAndValueHandlingExceptionsOn: model for: oldSelector in: model selectedClassOrMetaClass ]!

BrowserWindow removeSelector: #pushUpInstanceVariable!

!methodRemoval: BrowserWindow #pushUpInstanceVariable stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
pushUpInstanceVariable

	model selectedClassOrMetaClass ifNotNil: [ :aClass |
		(PushUpInstanceVariableApplier on: model at: aClass ) value].!

BrowserWindow removeSelector: #removeInstVar!

!methodRemoval: BrowserWindow #removeInstVar stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
removeInstVar

	model selectedClassOrMetaClass ifNotNil: [ :aClass |
		(RemoveInstanceVariableApplier on: model for: aClass) value ].!

BrowserWindow removeSelector: #renameSelector!

!methodRemoval: BrowserWindow #renameSelector stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
renameSelector

	model selectedMessageName ifNotNil: [ :oldSelector |
		RefactoringApplier renameSelectorApplier createAndValueHandlingExceptionsOn: model for: oldSelector in: model selectedClassOrMetaClass ]!

BrowserWindow removeSelector: #changeKeywordOrder!

!methodRemoval: BrowserWindow #changeKeywordOrder stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
changeKeywordOrder

	model selectedMessageName ifNotNil: [ :oldSelector |
		ChangeKeywordsSelectorOrderApplier createAndValueHandlingExceptions: [
			ChangeKeywordsSelectorOrderApplier on: model for: oldSelector in: model selectedClassOrMetaClass ]].!

BrowserWindow removeSelector: #removeParameter!

!methodRemoval: BrowserWindow #removeParameter stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
removeParameter

	model selectedMessageName ifNotNil: [ :oldSelector |
		RefactoringApplier removeParameterApplier createAndValueHandlingExceptionsOn: model for: oldSelector in: model selectedClassOrMetaClass ].
		
		!

BrowserWindow removeSelector: #pushDownSelectorToSubclasses!

!methodRemoval: BrowserWindow #pushDownSelectorToSubclasses stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
pushDownSelectorToSubclasses

	model selectedMessageName ifNotNil: [ :selectedSelector |
		(PushDownMethodToSubclassesApplier on: model for: model selectedClassOrMetaClass>>selectedSelector) value ].!

BrowserWindow removeSelector: #addAsSubclassResponsabilitySelector!

!methodRemoval: BrowserWindow #addAsSubclassResponsabilitySelector stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
addAsSubclassResponsabilitySelector

	model selectedMessageName ifNotNil: [ :selectedSelector |
		(AddAsSubclassResponsabilityApplier on: model for: model selectedClassOrMetaClass>>selectedSelector) value ].!

BrowserWindow removeSelector: #inlineMethod!

!methodRemoval: BrowserWindow #inlineMethod stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
inlineMethod

	model selectedMessageName ifNotNil: [ :selectorToInline |
		RefactoringApplier inlineMethodApplier
			createAndValueHandlingExceptionsOn: model
			forMethod: (MethodReference class: model selectedClassOrMetaClass selector: selectorToInline )]!

BrowserWindow removeSelector: #renameInstVar!

!methodRemoval: BrowserWindow #renameInstVar stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
renameInstVar

	model selectedClassOrMetaClass ifNotNil: [ :aClass |
		(RenameInstanceVariableApplier on: model at: aClass) value ].!

BrowserWindow removeSelector: #addInstVar!

!methodRemoval: BrowserWindow #addInstVar stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
addInstVar

	model selectedClassOrMetaClass ifNotNil: [ :aClass |
		(AddInstanceVariableApplier on: model for: aClass) value ].!

BrowserWindow removeSelector: #pushUpSelector!

!methodRemoval: BrowserWindow #pushUpSelector stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
pushUpSelector

	model selectedMessageName ifNotNil: [ :selectedSelector |
		(PushUpMethodApplier on: model for: model selectedClassOrMetaClass>>selectedSelector) value ].!

BrowserWindow removeSelector: #pushDownInstanceVariable!

!methodRemoval: BrowserWindow #pushDownInstanceVariable stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
pushDownInstanceVariable

	model selectedClassOrMetaClass ifNotNil: [ :aClass |
		(PushDownInstanceVariableApplier on: model at: aClass ) value].!

BrowserWindow removeSelector: #pushDownSelectorToOneSubclass!

!methodRemoval: BrowserWindow #pushDownSelectorToOneSubclass stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
pushDownSelectorToOneSubclass

	model selectedMessageName ifNotNil: [ :selectedSelector |
		(PushDownMethodToOneSubclassApplier on: model for: model selectedClassOrMetaClass>>selectedSelector) value ].!

BrowserWindow removeSelector: #removeAllUnreferencedInstVar!

!methodRemoval: BrowserWindow #removeAllUnreferencedInstVar stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
removeAllUnreferencedInstVar

	model selectedClassOrMetaClass ifNotNil: [ :aClass |
		(RemoveAllUnreferencedInstanceVariablesApplier on: model for: aClass) value ].!

BrowserWindow removeSelector: #moveToInstanceOrClassMethod!

!methodRemoval: BrowserWindow #moveToInstanceOrClassMethod stamp: 'Install-6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st 6/6/2024 11:37:55'!
moveToInstanceOrClassMethod

	model selectedMessageName ifNotNil: [ :selectedSelector |
		(MoveToInstanceOrClassMethodApplier on: model for: model selectedClassOrMetaClass>>selectedSelector) value ].!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6422-MoveRefactoringApplicationFromWindowToModel-JuanVuletich-2024May31-15h13m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6421] on 31 May 2024 at 3:19:27 pm'!
!SystemDictionary methodsFor: 'retrieving' stamp: 'jmv 5/31/2024 11:39:29' prior: 16964670!
                  allCallsOn: aLiteral   "Smalltalk browseAllCallsOn: #open:label:."
	"Answer a Collection of all the methods that call on aLiteral."
	| aCollection specialFlag specialByte |

	#(23 48 'fred' (new open:label:)) size.
	"Example above should find #open:label:, though it is deeply embedded here."

	aCollection := OrderedCollection new.
	specialFlag := self hasSpecialSelector: aLiteral ifTrueSetByte: [:b | specialByte := b ].
	self allBehaviorsDo: [ :class |
		class addMethodsTo: aCollection thatReferenceTo: aLiteral special: specialFlag byte: specialByte ].
	
	^ aCollection! !
!SystemDictionary methodsFor: 'retrieving' stamp: 'jmv 5/31/2024 11:46:31' prior: 16965286!
 numberOfSendersOf: aSymbol
	"Answer the count of all the methods that call on aLiteral.
	[ (Smalltalk numberOfSendersOf: #open:label:) ] timeToRun
	[ (Smalltalk numberOfSendersOf: #==) ] timeToRun
	"
	| count specialFlag specialByte |
	count := 0.
	specialFlag := self hasSpecialSelector: aSymbol ifTrueSetByte: [ :b | specialByte := b ].
	self allBehaviorsDo: [ :class |
		count := count + (class whichSelectorsReferTo: aSymbol special: specialFlag byte: specialByte) size ].
	^ count! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6423-NumberOfSendersOf-fix-JuanVuletich-2024May31-15h17m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6421] on 31 May 2024 at 3:23:58 pm'!
!CodeWindow methodsFor: 'keyboard shortcuts' stamp: 'jmv 5/31/2024 14:28:07' prior: 16827611!
                messageListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also
	have a listView that has a list of methods.  The view knows how to get
	the list and selection."

	| sel class |
	self flag: #definesKeyboardShortcuts.
	aChar = $D ifTrue: [^ model toggleDiffing].

	sel := model selectedMessageName.
	aChar = $m ifTrue: [  "These next two put up a type in if no message selected"
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllImplementorsOf: to: Smalltalk].
	aChar = $n ifTrue: [
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllCallsOn: to: Smalltalk].

	"The following require a class selection"
	(class := model selectedClassOrMetaClass) ifNil: [^ self ].
	aChar = $b ifTrue: [^ BrowserWindow fullOnClass: class selector: sel].
	aChar = $N ifTrue: [^ self browseClassRefs].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $p ifTrue: [^ self browseFullProtocol].

	sel
		ifNotNil: [
			"The following require a method selection"
			aChar = $i ifTrue: [^ self methodInheritance].
			aChar = $o ifTrue: [^ model fileOutMessage].
			aChar = $c ifTrue: [^ model copySelector].
			aChar = $v ifTrue: [^ self browseVersions].
			aChar = $C ifTrue: [^ model showHomeCategory].
			aChar = $O ifTrue: [^ self openSingleMessageBrowser].
			aChar = $x ifTrue: [^ model removeMessage].
			aChar = $t ifTrue: [^ model runMethodTest].
			aChar = $r ifTrue: [^ model debugMethodTest]]
		ifNil: [
			aChar = $R ifTrue: [^ model renameClass]]! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/31/2024 14:15:24' prior: 50338224!
                        menuSpecForDictionary
	"Spec for the menu and shortcut keys for the list of variables in our object.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(100 		'-----')
		#(110		'inspect key' 					nil 	window 			inspectSelectedKey 							nil 	editFindReplaceIcon)
		#(120		'senders of this key' 					nil 	window 			sendersOfSelectedKey 							nil 	mailForwardIcon)
		#(130		'add key' 					nil 	window 			addEntry 							nil 	listAddIcon)
		#(140		'rename key' 					nil 	window 			renameEntry 							nil 	saveAsIcon)
		#(150		'remove' 					nil 	model 			removeSelection 							nil 	listRemoveIcon)
	)! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6424-tweaks-JuanVuletich-2024May31-15h19m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6421] on 31 May 2024 at 3:29:33 pm'!
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/31/2024 12:57:17'!
                    addItemTo: topMenu fromSpec: itemSpec submenus: submenusDictionary
	| submenuId menu label target selector isEnabledSelector iconSymbol helpText menuItem |
	label := itemSpec second.
	label ifNil: [ ^self ]. "Only a keyboard shortcut, not a real menu item."
	submenuId := itemSpec first // 1000.
	menu := submenuId = 0 ifTrue: [ topMenu ] ifFalse: [ submenusDictionary at: submenuId ].
	target := itemSpec fourth
		ifNotNil: [ :targetGetter | self perform: targetGetter ]
		ifNil: [ self ].
	selector := itemSpec fifth.
	isEnabledSelector := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	iconSymbol := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	helpText := itemSpec size >= 8 ifTrue: [ itemSpec eighth ].
	menuItem := label isSymbol
		ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
		ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
	isEnabledSelector ifNotNil: [ menuItem isEnabled: (target perform: isEnabledSelector) ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/31/2024 12:58:33'!
                          addLineTo: topMenu fromSpec: itemSpec submenus: submenusDictionary
	| submenuId menu |
	submenuId := itemSpec first // 1000.
	menu := submenuId = 0 ifTrue: [ topMenu ] ifFalse: [ submenusDictionary at: submenuId ].
	menu addLine.! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/31/2024 12:57:04'!
                 addSubmenuTo: menu fromSpec: itemSpec submenus: submenusDictionary
	| submenu label submenuId target isEnabledSelector iconSymbol helpText menuItem |
	submenu := MenuMorph new.
	label := itemSpec second.
	target := itemSpec fourth
		ifNotNil: [ :targetGetter | self perform: targetGetter ]
		ifNil: [ self ].
	submenuId := itemSpec fifth // 1000.
	isEnabledSelector := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	iconSymbol := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	helpText := itemSpec size >= 8 ifTrue: [ itemSpec eighth ].
	menuItem := menu add: label subMenu: submenu.
	isEnabledSelector ifNotNil: [ menuItem isEnabled: (target perform: isEnabledSelector) ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].
	submenusDictionary at: submenuId put: submenu! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/31/2024 12:14:20'!
               addTitleTo: menu fromSpec: itemSpec
	menu addTitle: itemSpec second.
	itemSpec third ifTrue: [ menu addStayUpIcons ]! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 5/31/2024 12:59:27' prior: 50336202!
                  getMenu
	"Answer the right-click (contextual) menu."
	"Spec for the menu and shortcut keys the changesets list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"

	| widgetKey menuNshortcutsSpecs itemSpec menu submenus |
	widgetKey := self menuNshortcutsKey ifNil: [ ^nil ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].
	menu := MenuMorph new.
	submenus := nil.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2 ifTrue: [
				self addLineTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [ itemSpec size = 3 ifTrue: [
				self addTitleTo: menu fromSpec: itemSpec ]
			ifFalse: [ itemSpec fifth isNumber ifTrue: [
				submenus ifNil: [submenus := Dictionary new ].
				self addSubmenuTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [
				self addItemTo: menu fromSpec: itemSpec submenus: submenus ]]]].
	^ menu! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6425-NewMenuSpecs-AllowSubmenus-JuanVuletich-2024May31-15h23m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6421] on 31 May 2024 at 4:20:25 pm'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/31/2024 16:04:28'!
                  classListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments. If a Number (multiple of 1000), indicates a subMenu. Indexes of items must be in range.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 							$b 	window 			browseMethodFull 									nil 		editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									nil 		goTopIcon)
		#(30		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									nil 		spreadsheetIcon)
		#(40 		'-----')
		#(50		'fileOut' 							nil 	model 			fileOutClass 									nil 		fileOutIcon)
		#(60		'run tests (t)' 							$t 	model 			runClassTests 									nil 		weatherFewCloudsIcon)
		#(70 		'-----')
		#(80		'rename class... (R)' 							$R 	model 			renameClass 									nil 		saveAsIcon)
		#(90		'refactorings' 							nil 	nil 			1000 									nil 		listAddIcon)
		#(100		'copy class...' 							nil 	model 			copyClass 									nil 		copyIcon)
		#(110		'remove class (x)' 							$x 	model 			removeClass 									nil 		deleteIcon)
		#(120 		'-----')
		#(130		'show classes hierarchically' 							nil 	model 			enableListClassesHierarchically 									nil 		goTopIcon)
		#(140		'show classes alphabetically' 							nil 	model 			enableListClassesAlphabetically 									nil 		sendReceiveIcon)
		#(150		'show definition' 							nil 	model 			editClass 									nil 		editFindReplaceIcon)
		#(160		'show comment' 							nil 	model 			editComment 									nil 		editFindReplaceIcon)
		#(170 		'-----')
		#(180		'inst var refs...' 							nil 	window 			browseInstVarRefs 									nil 		instanceIcon)
		#(190		'inst var defs...' 							nil 	window 			browseInstVarDefs 									nil 		instanceIcon)
		#(200 		'-----')
		#(210		'class var refs...' 							nil 	window 			browseClassVarRefs 									nil 		classIcon)
		#(220		'class vars' 							nil 	window 			browseClassVariables 									nil 		classIcon)
		#(230		'class refs (N)' 							$N 	window 			browseClassRefs 									nil 		classIcon)
		#(240 		'-----')
		#(250		'more' 							nil 	nil 			2000 									nil 		listAddIcon)
		#(260		nil 							$r 	model 			recent) "Shortcut only. No menu entry."

		" 'refactorings' SubMenu"
		#(1010		'insert superclass...' 							nil 	model 			insertSuperclass 									nil 		saveAsIcon)
		#(1020 		'-----')
		#(1030		'add inst var...' 							nil 	model 			addInstVar 									nil 		listAddIcon)
		#(1040		'rename inst var...' 							nil 	model 			renameInstVar 									nil 		saveAsIcon)
		#(1050		'remove inst var...' 							nil 	model 			removeInstVar 									nil 		deleteIcon)
		#(1060		'remove all unreferenced inst var...' 						
											nil 	model 			removeAllUnreferencedInstVar 									nil 		deleteIcon)
		#(1070		'push up inst var...' 							nil 	model 			pushUpInstanceVariable 									nil 		goTopIcon)
		#(1080		'push down inst var...' 							nil 	model 			pushDownInstanceVariable 									nil 		goBottomIcon)
		#(1090 		'-----')
		#(1100		'add inst var...' 							nil 	model 			addInstVar 									nil 		listAddIcon)

		" 'more' SubMenu"
		#(2010		'unsent methods' 							nil 	window 			browseUnusedMethods 									nil 		junkIcon
					'browse all methods defined by this class that have no senders')
		#(2020		'unreferenced inst vars' 							nil 	window 			showUnreferencedInstVars 									nil 		junkIcon
					'show a list of all instance variables that are not referenced in methods')
		#(2030		'unreferenced class vars' 							nil 	window 			showUnreferencedClassVars 									nil 		junkIcon
					'show a list of all class variables that are not referenced in methods')
		#(2040		'subclass template' 							nil 	model 			makeNewSubclass 									nil 		classIcon
					'put a template into the code pane for defining of a subclass of this class')
		#(2050 		'-----')
		#(2060		'sample instance' 							nil 	window 			makeSampleInstance 									nil 		instanceIcon
					'give me a sample instance of this class, if possible')
		#(2070		'inspect instances' 							nil 	window 			inspectInstances 									nil 		inspectIcon
					'open an inspector on all the extant instances of this class')
		#(2080		'inspect subinstances' 							nil 	window 			inspectSubInstances 									nil 		inspectIcon
					'open an inspector on all the extant instances of this class and of all of its subclasses')
		#(2090 		'-----')
		#(2100		'create inst var accessors' 							nil 	model 			createInstVarAccessors 									nil 		sendReceiveIcon
					'compile instance-variable access methods for any instance variables that do not yet have them')
	)! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 5/31/2024 15:59:56' overrides: 50340547!
                     classListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	Each entry is
		#('menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- label is a string or symbol. Symbol means self updating menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Tipically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
		- isEnabledSelector if not nil, it is #aSymbol, and is sent to the receiver (see receierGetter) to ask whether to enable the item.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	^self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Class List' 			false)
				#(10		'definition' 					nil 	model 			editClass 						nil 		editFindReplaceIcon)
				#(20		'comment' 					nil 	model 			editComment 						nil 		editFindReplaceIcon)
				#(30 		'-----')
				#(40		'browse full (b)' 					$b 	window 			browseMethodFull 						nil 		editFindReplaceIcon)
				#(50		'class refs (N)' 					$N 	window 			browseClassRefs 						nil 		classIcon)
				#(60 		'-----')
				#(70		'fileIn' 					nil 	model 			fileInClass 						nil 		updateIcon)
				#(80		'fileOut' 					nil 	model 			fileOutClass 						nil 		fileOutIcon)
				#(90 		'-----')
				#(100		'rename...' 					nil 	model 			renameClass 						nil 		saveAsIcon)
				#(110		'remove' 					nil 	model 			removeClass 						nil 		listRemoveIcon)
				#(120 		'-----')
				#(130		'remove existing' 					nil 	model 			removeClass 						nil 		deleteIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Class List' 			false)
				#(10		'definition' 					nil 	model 			editClass 						nil 		editFindReplaceIcon)
				#(20		'comment' 					nil 	model 			editComment 						nil 		editFindReplaceIcon)
				#(30 		'-----')
				#(80		'fileOut' 					nil 	model 			fileOutClass 						nil 		fileOutIcon)
				#(90 		'-----')
				#(100		'rename...' 					nil 	model 			renameClass 						nil 		saveAsIcon)
				#(110		'remove' 					nil 	model 			removeClass 						nil 		listRemoveIcon)
				#(120 		'-----')
				#(130		'remove existing' 					nil 	model 			removeClass 						nil 		deleteIcon)
			) ].! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 5/31/2024 16:07:19' prior: 50332683!
                           buildMorphicClassList

	^(PluggableListMorph
		withModel: model
		listGetter: #classList
		indexGetter: #classListIndex
		indexSetter: #classListIndex:)
			menuNshortcutsKey: #classListMenuSpec.! !
!BrowserWindow methodsFor: 'keyboard shortcuts' stamp: 'jmv 5/31/2024 16:06:37' prior: 50333389!
                         systemCatListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $r ifTrue: [^ model recent ].
	aChar = $f ifTrue: [ ^ self findClass ].
	aChar = $x ifTrue: [ ^ model removeSystemCategory ].
	aChar = $t ifTrue: [ ^ model runSystemCategoryTests ].
	aChar = $a ifTrue: [ ^ model addSystemCategory ].
	aChar = $A ifTrue: [ ^ model alphabetizeSystemCategories ].
	aChar = $b ifTrue: [ ^ self openSystemCategoryBrowser ].
	aChar = $B ifTrue: [ ^ self browseAllClasses ].
	aChar = $o ifTrue: [ ^ model fileOutSystemCategory ].
	aChar = $u ifTrue: [ ^ model updateSystemCategories ].
	aChar = $R ifTrue: [ ^ model renameSystemCategory ].
! !

RefactoringMenues class removeSelector: #classListMenuOptions!

!methodRemoval: RefactoringMenues class #classListMenuOptions stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^ `{
			{
				#itemGroup 				-> 		5.
				#itemOrder 				-> 		10.
				#label 				-> 		RefactoringMenues refactoringsLabel.
				#selector 				-> 		#yourself.
				#icon 				-> 		#listAddIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		10.
				#itemOrder 				-> 		20.
				#label 				-> 		'insert superclass...'.
				#object 				-> 		#model.
				#selector 				-> 		#insertSuperclass.
				#icon 				-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		10.
				#label 				-> 		'add inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#addInstVar.
				#icon 				-> 		#listAddIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		20.
				#label 				-> 		'rename inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#renameInstVar.
				#icon 				-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		30.
				#label 				-> 		'remove inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#removeInstVar.
				#icon 				-> 		#deleteIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		40.
				#label 				-> 		'remove all unreferenced inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#removeAllUnreferencedInstVar.
				#icon 				-> 		#deleteIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		50.
				#label 				-> 		'push up inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#pushUpInstanceVariable.
				#icon 				-> 		#goTopIcon
			} asDictionary.
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		60.
				#label 				-> 		'push down inst var...'.
				#object 				-> 		#model.
				#selector 				-> 		#pushDownInstanceVariable.
				#icon 				-> 		#goBottomIcon
			} asDictionary.				
			{
				#submenuOf 				-> 		RefactoringMenues refactoringsLabel.
				#itemGroup 				-> 		30.
				#itemOrder 				-> 		10.
				#label 				-> 		'rename global...'.
				#object 				-> 		#model.
				#selector 				-> 		#renameGlobal.
				#icon 				-> 		#saveAsIcon
			} asDictionary.
	}`.!

CodeFileBrowserWindow removeSelector: #classListMenu!

!methodRemoval: CodeFileBrowserWindow #classListMenu stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListMenu

	| aMenu itemColl |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Class List'.
	itemColl := OrderedCollection new.
	itemColl addAll:
		{
			{#label -> 'definition'. #object -> #model. #selector -> #editClass. #icon -> #editFindReplaceIcon} asDictionary. 
			{#label -> 'comment'. #object -> #model. #selector -> #editComment. #icon -> #editFindReplaceIcon} asDictionary. 
			nil
		}.
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
		itemColl addAll:
			{
				{#label -> 'browse full (b)'. #selector -> #browseMethodFull. #icon -> #editFindReplaceIcon} asDictionary. 
				{#label -> 'class refs (N)'. #selector -> #browseClassRefs. #icon -> #classIcon} asDictionary. 
				nil. 
				{#label -> 'fileIn'. #object -> #model. #selector -> #fileInClass. #icon -> #updateIcon} asDictionary
			} ].
	itemColl addAll:
		{
			{#label -> 'fileOut'. #object -> #model. #selector -> #fileOutClass. #icon -> #fileOutIcon} asDictionary. 
			nil. 
			{#label -> 'rename...'. #object -> #model. #selector -> #renameClass. #icon -> #saveAsIcon} asDictionary. 
			{#label -> 'remove'. #object -> #model. #selector -> #removeClass. #icon -> #listRemoveIcon} asDictionary. 
			nil. 
			{#label -> 'remove existing'. #object -> #model. #selector -> #removeUnmodifiedCategories. #icon -> #deleteIcon} asDictionary
		}.
	aMenu addItemsFromDictionaries: itemColl.
	^ aMenu.!

CodeFileBrowserWindow removeSelector: #classListKey:from:!

!methodRemoval: CodeFileBrowserWindow #classListKey:from: stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $b ifTrue: [^ self browseMethodFull].
	aChar = $N ifTrue: [^ self browseClassRefs].
	self codeFileListKey: aChar from: view!

BrowserWindow class removeSelector: #classListMenuOptions!

!methodRemoval: BrowserWindow class #classListMenuOptions stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^ `{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'browse full (b)'.
				#selector 			-> 		#browseMethodFull.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#browseHierarchy.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		30.
				#label 			-> 		'browse protocol (p)'.
				#selector 			-> 		#browseFullProtocol.
				#icon 			-> 		#spreadsheetIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'fileOut'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutClass.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		5.
				#label 			-> 		'show classes hierarchically'.
				#object 			-> 		#model.
				#selector 			-> 		#enableListClassesHierarchically.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		6.
				#label 			-> 		'show classes alphabetically'.
				#object 			-> 		#model.
				#selector 			-> 		#enableListClassesAlphabetically.
				#icon 			-> 		#sendReceiveIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'show definition'.
				#object 			-> 		#model.
				#selector 			-> 		#editClass.
				#icon 			-> 		#findIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		30.
				#label 			-> 		'show comment'.
				#object 			-> 		#model.
				#selector 			-> 		#editComment.
				#icon 			-> 		#findIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'inst var refs...'.
				#selector 			-> 		#browseInstVarRefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'inst var defs...'.
				#selector 			-> 		#browseInstVarDefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'class var refs...'.
				#selector 			-> 		#browseClassVarRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		20.
				#label 			-> 		'class vars'.
				#selector 			-> 		#browseClassVariables.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		30.
				#label 			-> 		'class refs (N)'.
				#selector 			-> 		#browseClassRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		10.
				#label 			-> 		'rename class... (R)'.
				#object 			-> 		#model.
				#selector 			-> 		#renameClass.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		20.
				#label 			-> 		'copy class...'.
				#object 			-> 		#model.
				#selector 			-> 		#copyClass.
				#icon 			-> 		#copyIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		30.
				#label 			-> 		'remove class (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeClass.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			{
				#itemGroup 			-> 		70.
				#itemOrder 			-> 		10.
				#label 			-> 		'run tests (t)'.
				#object 			-> 		#model.
				#selector 			-> 		#runClassTests.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		70.
				#itemOrder 			-> 		20.
				#label 			-> 		BrowserWindow moreMenuLabel.
				#selector 			-> 		#yourself.
				#icon 			-> 		#listAddIcon
			} asDictionary.
		}, BrowserWindow classListMoreMenuOptions`.!

BrowserWindow class removeSelector: #classListMoreMenuOptions!

!methodRemoval: BrowserWindow class #classListMoreMenuOptions stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListMoreMenuOptions

	^ `{			
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		10.
				#itemOrder 				-> 		10.
				#label 				-> 		'unsent methods'.
				#selector 				-> 		#browseUnusedMethods.
				#icon 				-> 		#junkIcon.
				#balloonText 				-> 		'browse all methods defined by this class that have no senders'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		10.
				#itemOrder 				-> 		20.
				#label 				-> 		'unreferenced inst vars'.
				#selector 				-> 		#showUnreferencedInstVars.
				#icon 				-> 		#junkIcon.
				#balloonText 				-> 		'show a list of all instance variables that are not referenced in methods'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		10.
				#itemOrder 				-> 		30.
				#label 				-> 		'unreferenced class vars'.
				#selector 				-> 		#showUnreferencedClassVars.
				#icon 				-> 		#junkIcon.
				#balloonText 				-> 		'show a list of all class variables that are not referenced in methods'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		10.
				#itemOrder 				-> 		40.
				#label 				-> 		'subclass template'.
				#object 				-> 		#model.
				#selector 				-> 		#makeNewSubclass.
				#icon 				-> 		#classIcon.
				#balloonText 				-> 		'put a template into the code pane for defining of a subclass of this class'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		10.
				#label 				-> 		'sample instance'.
				#selector 				-> 		#makeSampleInstance.
				#icon 				-> 		#instanceIcon.
				#balloonText 				-> 		'give me a sample instance of this class, if possible'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		20.
				#label 				-> 		'inspect instances'.
				#selector 				-> 		#inspectInstances.
				#icon 				-> 		#inspectIcon.
				#balloonText 				-> 		'open an inspector on all the extant instances of this class'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		20.
				#itemOrder 				-> 		30.
				#label 				-> 		'inspect subinstances'.
				#selector 				-> 		#inspectSubInstances.
				#icon 				-> 		#inspectIcon.
				#balloonText 				-> 		'open an inspector on all the extant instances of this class and of all of its subclasses'
			} asDictionary.
			{
				#submenuOf 				-> 		BrowserWindow moreMenuLabel.
				#itemGroup 				-> 		30.
				#itemOrder 				-> 		10.
				#label 				-> 		'create inst var accessors'.
				#object 				-> 		#model.
				#selector 				-> 		#createInstVarAccessors.
				#icon 				-> 		#sendReceiveIcon.
				#balloonText 				-> 		'compile instance-variable access methods for any instance variables that do not yet have them'
			} asDictionary.
		}`.
	!

BrowserWindow class removeSelector: #moreMenuLabel!

!methodRemoval: BrowserWindow class #moreMenuLabel stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
moreMenuLabel

	^'more'!

BrowserWindow removeSelector: #classListKey:from:!

!methodRemoval: BrowserWindow #classListKey:from: stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListKey: aChar from: view 
	"Respond to a Command key.  I am a model with a list of classes and a 
	code pane, and I also have a listView that has a list of methods.  The 
	view knows how to get the list and selection."

	self flag: #definesKeyboardShortcuts.
	aChar = $r ifTrue: [^ model recent].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $x ifTrue: [^ model removeClass].
	aChar = $t ifTrue: [^ model runClassTests ].
	
	^ self messageListKey: aChar from: view!

BrowserWindow removeSelector: #classListMenu!

!methodRemoval: BrowserWindow #classListMenu stamp: 'Install-6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st 6/6/2024 11:37:55'!
classListMenu
	"Set up the menu to apply to the receiver's class list, honoring the #shifted boolean"

	^DynamicMenuBuilder buildTitled: 'Class List' targeting: self collectingMenuOptionsWith: #classListMenuOptions.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6426-NewMenuSpec-Browser-ClassList-JuanVuletich-2024May31-15h29m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6426] on 1 June 2024 at 5:42:39 pm'!
!SystemDictionary methodsFor: 'code authors' stamp: 'jmv 6/1/2024 17:42:19' prior: 50331841!
                      knownInitialsAndNames
	"This list could include people who hasn't contributed code to the Cuis image, but to some optional package."
"
| all ok |
all := Smalltalk allContributors asSet.
ok := (Smalltalk knownInitialsAndNames collect: [ :pair | pair first ]) asSet.
(all copyWithoutAll: ok) print

		initials         				name"
^ #(
	#('ab' 						'Alexandre Bergel')
	#('abc' 						'Colin Putney')
	#('acg' 						'Andrew C. Greenberg')
	#('ads' 						'Adam Spitz')
	#('AFi' 						'Alain Fischer')
	#('ajh' 						'Anthony Hannan')
	#('al' 						'Adrian Lienhard')
	#('and' 						'Alan Dao')
	#('aoy' 						'Andres Otaduy')
	#('apb' 						'Andrew P. Black')
	#('ar' 						'Andreas Raab')
	#('asm' 						'Alejandro Magistrello')
	#('avi' 						'Avi Bryant')
	#('AY'						'Angel Yan')
	#('BAP'						'Barry Perryman')
	#('BenComan' 						'Ben Coman')
	#('bf' 						'Bert Freudenberg')
	#('BG' 						'Boris Gaertner')
	#('bgs' 						'Boris G. Shingarov')
	#('BJP' 						'Bijan Parsia')
	#('bkv' 						'Brent Vukmer')
	#('bolot' 						'Bolot Kerimbaev')
	#('bp' 						'Bernhard Pieber')
	#('BP' 						'Brent Pinkney') 
	#('brp' 						'Brent Pinkney')
	#('cbc' 						'Chris Cunningham')
	#('cbr'						'Casey Ransberger')
	#('ccn' 						'Chris Norton')
	#('chaider'						'Christian Haider')
	#('cmm' 						'Chris Muller')
	#('crl' 						'Craig Latta')
	#('cwp' 						'Colin Putney')
	#('das' 						'David A Smith')
	#('db' 						'Douglas Brebner')
	#('dc' 						'Damien Cassou')
	#('dew' 						'Doug Way')
	#('DF'						'David Faitelson')
	#('dgd' 						'Diego Gomez Deck')
	#('dkh'						'Dale Henrichs')
	#('dhn'	 					'Dan Norton')
	#('dhhi' 						'Dan Ingalls')
	#('di' 						'Dan Ingalls')
	#('djp' 						'David J. Pennell')
	#('DKL'						'Daniel K Lyons')
	#('DM' 						'Duncan Mak')
	#('DSM' 						'Duane Maxwell')
	#('DSG'						'David Graham')
	#('dtl' 						'Dave Lewis')
	#('dvf'	 					'Daniel Vainsencher')
	#('eat' 						'Eric Arseneau Tremblay')
	#('EB'						'Eric Brandwein')
	#('eem'						'Eliot Emilio Miranda')
	#('eliot'						'Eliot Emilio Miranda')
	#('efc' 						'Eddie Cottongim')
	#('em' 						'Ernest Micklei?')
	#('emm' 						'Ernest Micklei')
	#('Ez3' 						'Ezequiel Birman')
	#('fbs' 						'Frank Shearar')
	#('FBS' 						'Frank Shearar')
	#('fc' 						'Frank Caggiano')
	#('fcs' 						'Frank Sergeant')
	#('FernandoOlivero' 						'Fernando Olivero')
	#('FernanodOlivero' 						'Fernando Olivero')
	#('FGJ'						'Fernando Gasperi Jabalera')
	#('fgz'						'Felipe Zak')
	#('FJG'				 		'Facundo Javier Gelatti')
	#('GabrielOmarCotelli' 						'Gabriel Omar Cotelli')
	#('GC' 						'Gast√≥n Caruso')
	#('gera' 						'Gerardo Richarte')
	#('gh' 						'Goran Krampe (nee Hultgren)')
	#('gk' 						'Goran Krampe (nee Hultgren)')
	#('gm' 						'German Morales')
	#('go' 						'Georg Gollmann')
	#('gsa' 						'German Arduino')
	#('HAW' 						'Hernan Wilkinson')
	#('HB' 						'Hari Balaraman')
	#('hjh' 						'Hannes Hirzel')
	#('hlsf' 						'Hilaire Fernandes')
	#('hmm' 						'Hans-Martin Mosner')
	#('hsj' 						'Henrik Sperre Johansen')
	#('Igor.Stasenko' 						'Igor Stasenko')
	#('ikp' 						'Ian Piumarta')
	#('jar' 						'Jaromir Matas')
	#('Jb' 						'Jean Baptiste Arnaud')
	#('jcg' 						'Joshua Gargus')
	#('jdr' 						'Javier Diaz-Reinoso')
	#('je' 						'Joern Eyrich')
	#('jf' 						'Julian Fitzell')
	#('JF' 						'Julian Fitzell')
	#('jhm' 						'John Maloney')
	#('jk'						'Jonathan Kelly')
	#('jlb' 						'Jim Benson')
	#('jm' 						'John Maloney')
	#('jmb' 						'Hans Baveco')
	#('JMG'						'Jeff Gonis')
	#('JMM' 						'John McIntosh')
	#('jmv' 						'Juan Vuletich')
	#('JMV' 						'Juan Vuletich')
	#('JO'						'Javier Olaechea')
	#('jp' 						'Joseph Pelrine')
	#('jrm' 						'John-Reed Maffeo')
	#('jrp' 						'John Pierce')
	#('jsp' 						'Jeff Pierce')
	#('KenD' 						'Ken Dickey')
	#('kfr' 						'Karl Ramberg')
	#('KLC'			 			'Ken Causey')
	#('KLG'			 			'Gerald Klix')
	#('kph'						'Keith Hodges')
	#('KTT' 						'Kurt Thams')
	#('laza' 						'Alexander Lazarevic')
	#('LC' 						'Leandro Caniglia')
	#('len' 						'Luciano Esteban Notarfrancesco')
	#('lpc'						'Laura Perez Cerrato')
	#('lr' 						'Lukas Renggli')
	#('Lukas Renggli' 						'Lukas Renggli')
	#('ls' 						'Lex Spoon')
	#('md' 						'Marcus Denker')
	#('MarcusDenker' 						'Marcus Denker')
	#('marcus.denker' 						'Marcus Denker')
	#('mdr' 						'Mike Rutenberg')
	#('MEGL' 						'MarceloLamperti')
	#('mga' 						'Markus Galli')
	#('MGD'						'Mat√≠as Dinota')
	#('MH'						'Mat√≠as Halperin')
	#('mha' 						'Michael Haupt')
	#('mir' 						'Michael Rueger')
	#('mjg' 						'Mark Guzdial')
	#('mk'	 					'Matej Kosik')
	#('MM'	 					'Mariano Montone')
	#('mnqpr'	 					'Szabolcs Komaromi')
	#('MPH'	 					'Michael Hewner')
	#('mpw' 						'Marcel Weiher')
	#('MPW' 						'Marcel Weiher')
	#('mrm' 						'Martin McClure')
	#('mtf' 						'Matthew Fulmer')
	#('mu' 						'Masashi Umezawa')
	#('nb' 						'Naala Brewer')
	#('nice'					 	'Nicolas Cellier')
	#('nk' 						'Ned Konz')
	#('NM' 						'Nicola Mingotti')
	#('NMS'						'Nicol√°s Sarfati')
	#('nop' 						'Jay Carlson')
	#('NS' 						'Nathanael Schaerli')
	#('panda' 						'Michael Rueger')
	#('pau'						'Paula Perez Bianchi')
	#('pb'						'Phil Bellalouna')
	#('PB'						'Paolo Belforte')
	#('pmon'						'Paolo Montrasi')
	#('PHK' 						'Peter Keeler')
	#('PM' 						'Peter Mikkelsen')
	#('Pmm' 						'Philippe Marschall')
	#('pnm' 						'Paul McDonough')
	#('r++' 						'Gerardo Richarte')
	#('raa' 						'Bob Arning')
	#('RAA' 						'Bob Arning')
	#('raok' 						'Richard A. O''Keefe')
	#('rca' 						'Russell Allen')
	#('reThink'				 		'Paul McDonough')
	#('rew' 						'Roger Whitney')
	#('rhi' 						'Robert Hirschfeld')
	#('RJT' 						'Ron Teitelbaum')
	#('RNG' 						'Nahuel Garbezza')
	#('rr' 						'Romain Robbes')
	#('rss' 						'Ron Spengler')
	#('rw' 						'Robert Withers')
	#('rww' 						'Robert Withers')
	#('Sames' 						'Samuel S. Shuster')
	#('sbw' 						'Stephan B. Wessels')
	#('sd' 						'Stephane Ducasse')
	#('SD' 						'Stephane Ducasse')
	#('sge' 						'Steve Elkins')
	#('sjd' 						'Santiago Jose Dandois')
	#('SLD'						'Steve Davies')
	#('sma' 						'Stefan Matthias Aust')
	#('sps' 						'Steven Swerling')
	#('SqR' 						'Andres Valloud')
	#('sqr' 						'Andres Valloud')
	#('Squeak1.0'						'Squeak 1.0, September 20, 1996')
	#('Squeak1.1'						'Squeak 1.1, September 23, 1996')
	#('Squeak1.2'						'Squeak 1.2, June 29, 1997')
	#('Squeak1.3'						'Squeak 1.3, January 16, 1998')
	#('sr' 						'Stephan Rudlof')
	#('ss'						'Sebastian Sujarchuk')
	#('SSC' 						'Santiago Salvador Cubino')
	#('SSS' 						'Samuel S. Shuster')
	#('ST-80'						'Smalltalk-80, version 2, of April 1, 1983')
	#('stephane.ducasse' 						'Stephane Ducasse')
	#('stephaneducasse'	 					'Stephane Ducasse')
	#('stp' 						'Stephen Travis Pope')
	#('sumim' 						'Masato Sumi')
	#('S.V.' 						'Sebasti√°n M. Vinto√±uke')
	#('svc' 						'Sven Van Caekenberghe')
	#('svp' 						'Stephen Vincent Pair')
	#('sw' 						'Scott Wallace')
	#('TAG' 						'Travis Griggs')
	#('tak' 						'Takashi Yamamiya')
	#('tao' 						'Tim Olson')
	#('TBn' 						'Torsten Bergmann')
	#('tfei' 						'The Fourth Estate, Inc.')
	#('tfel' 						'Tim Felgentreff')
	#('th' 						'Torge Husfeldt')
	#('tk' 						'Ted Kaehler')
	#('tlk' 						'Tom Koenig')
	#('tpr' 						'Tim Rowledge')
	#('TPR' 						'Tim Rowledge')
	#('TS' 						'Tom√°s Spognardi')
	#('tsl' 						'Thiago da Silva Lino')
	#('tween' 						'Andy Tween')
	#('ul' 						'Levente Uzonyi')
	#('vb' 						'Vassili Bykov')
	#('ward' 						'Ward Cunningham')
	#('wiz' 						'Jerome Peace')
	#('wod' 						'Bill Dargel')
	#('yo' 						'Yoshiki Ohshima')
	#('zz' 						'Serge Stinckwich'))! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6427-AddEzequielAsKnownAuthor-JuanVuletich-2024Jun01-17h42m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6427] on 3 June 2024 at 11:23:22 am'!
!LayoutMorph methodsFor: 'geometry testing' stamp: 'jmv 6/3/2024 11:22:43' overrides: 16905625!
 clipsSubmorphs
	"LayoutMorphs are usually not drawn (doAdoptWidgetsColor is false, they are transparent) and do not clip submorphs.
	A special case is Transcript. It doesn't include a ScrollPane (that usually does clipping),
	so doAdoptWidgetsColor is set to true, and we also want it to clipSubmorphs.
	There may be other similar cases in the future."
	^doAdoptWidgetsColor! !
!Transcript class methodsFor: 'ui' stamp: 'jmv 6/3/2024 11:22:04' prior: 16988500!
                   open
	"
	Transcript open
	"
	| win m |
	win := TranscriptWindow new.
	win
		setLabel: 'Transcript';
		model: Transcript.
	m := TranscriptMorph new.
	win layoutMorph
		"This is needed so the Layout is actually drawn and it actually correctly clips the TranscriptMorph"
		doAdoptWidgetsColor;
		addMorph: m proportionalHeight: 1.
	win model when: #redrawTranscriptArea send: #invalidateBounds to: win.
	^ win openInWorld! !
!TranscriptMorph methodsFor: 'drawing' stamp: 'jmv 6/3/2024 11:07:50' prior: 16988553 overrides: 16796436!
               drawOn: aCanvas
	aCanvas
		fillRectangle: self morphLocalBounds
		color: color.
	Transcript displayTextOn: aCanvas in: self morphLocalBounds.
	Transcript bounds: (self externalizeBoundsToWorld: self morphLocalBounds)
				encompassingIntegerRectangle.
	self updateWorkspace! !

TranscriptWindow removeSelector: #clipsSubmorphs!

!methodRemoval: TranscriptWindow #clipsSubmorphs stamp: 'Install-6428-Transcript-fixDrawingGlitch-JuanVuletich-2024Jun03-11h20m-jmv.001.cs.st 6/6/2024 11:37:55'!
clipsSubmorphs
	"Our contents are not inside a PluggableScrollPane like in other SystemWindows,
	so we do the clipping ourselves."

	^ true!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6428-Transcript-fixDrawingGlitch-JuanVuletich-2024Jun03-11h20m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6428] on 3 June 2024 at 11:44:42 am'!
!FeatureRequirement methodsFor: 'requires' stamp: 'KenD 6/1/2024 14:10:57' prior: 16860029!
                             requireUnlessIn: toLoad main: mainFeatureOrNil requiringFeature: requiringFeatureOrNil allRequiringFeatures: chainRequiringMe
	"See if all the requirements can be met and answer the load order"

	(chainRequiringMe includes: self) ifTrue: [
		self error: 'Circular dependence detected. Can not load required packages.' ].
	self isAlreadySatisfied ifFalse: [
		(toLoad anySatisfy: [ :featReq | featReq sameNameAs: self]) ifFalse: [
			(self findPackageFileAsReqOf: mainFeatureOrNil)
				ifTrue: [ | otherRequirements |
					otherRequirements := self requirements.
					otherRequirements ifNotNil: [
						otherRequirements do: [ :requires | 
							requires
								requireUnlessIn: toLoad
								main: (mainFeatureOrNil ifNil: [self])
								requiringFeature: self
								allRequiringFeatures: (chainRequiringMe copyWith: self) ]].
					self == mainFeatureOrNil ifFalse: [
						self addToLoad: toLoad withMyRequirements: otherRequirements ].
					]
				ifFalse: [
					| failureMessage |
					failureMessage := name = #'Cuis-Base'
						ifTrue: [
							(SystemVersion current versionRevision first) > self maxVersion
							ifTrue: [
								'Installing [', requiringFeatureOrNil name, '] has maximum version ',  
									self maxVersion asString, 						String newLineString,
									' which is older than the current Cuis-Base version ',
									 (SystemVersion current versionRevision first) asString
								]
							ifFalse: [
							'Installing [', requiringFeatureOrNil name,
								'] requires base system updated to #', self minRevision printString, String newLineString,
							'But this system is updated to #', SystemVersion current versionRevision second printString, String newLineString,
							'Please install Cuis base system updates and retry.' ]						
						]
						ifFalse: [
							requiringFeatureOrNil notNil
								ifTrue: [
									'Could not find code package file for [', name, '].', String newLineString,
									'Installation of [', requiringFeatureOrNil name, '] failed.']
								ifFalse: [
									'Could not find code package file for [', name, '].', String newLineString,
									'Installation failed.']].
					FeatureRequirementUnsatisfied signal: failureMessage.
				]]].

	^ toLoad! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6429-packageInstallFailMessage-Fix-KenDickey-2024Jun03-11h44m-KenD.001.cs.st----!

'From Cuis7.1 [latest update: #6429] on 3 June 2024 at 12:06:31 pm'!
!InnerTextMorph methodsFor: 'accessing' stamp: 'jmv 6/3/2024 12:05:55'!
              keystrokeAction: aBlock
	"Sets the action to perform when user presses any key, after regular processing."

	self setProperty: #keyStroke: toValue: aBlock.! !
!TextModelMorph methodsFor: 'initialization' stamp: 'jmv 6/3/2024 12:06:01'!
                    keystrokeAction: aBlock
	"Sets the action to perform when user presses any key, after regular processing."
	
	scroller keystrokeAction: aBlock! !
!Morph methodsFor: 'events-processing' stamp: 'jmv 6/3/2024 12:02:53' prior: 50335168!
                       processKeystroke: aKeyboardEvent
	"System level event handling."

	self handlesKeyboard ifTrue: [
		aKeyboardEvent wasHandled ifFalse: [
			self keyStroke: aKeyboardEvent.
			aKeyboardEvent wasHandled: true.
			self 
				valueOfProperty: #'keyStroke:'
				ifPresentDo: [ :handler | handler value: aKeyboardEvent ]]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6430-keystrokeAction-addItBack-JuanVuletich-2024Jun03-11h59m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6430] on 4 June 2024 at 6:06:04 am'!
!Morph methodsFor: 'events' stamp: 'jmv 6/4/2024 06:04:58' prior: 50335461!
       keyboardShortcut: aKeyboardEvent
	"Handle a keyboard shortcut.
	See coment at Morph >> #getMenu
	"
	| menuNshortcutsSpecs shortcutCharacter target widgetKey |
	widgetKey := self menuNshortcutsKey ifNil: [ ^false ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^false ].
	menuNshortcutsSpecs valuesDo: [ :itemSpec |
		itemSpec size >= 5 ifTrue: [
			shortcutCharacter := itemSpec third.
			shortcutCharacter = aKeyboardEvent keyCharacter ifTrue: [
				target := itemSpec fourth
					ifNotNil: [ :targetGetter | self perform: targetGetter ]
					ifNil: [ self ].
				itemSpec fifth
					ifNotNil: [ :selector |
						target perform: selector.
						^true ]
					ifNil: [
						^false ]
				]
			]
		].
	^false! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/4/2024 06:05:16' prior: 50340396!
           addItemTo: topMenu fromSpec: itemSpec submenus: submenusDictionary
	"
	See coment at Morph >> #getMenu
	"
	| submenuId menu label target selector iconSymbol helpText menuItem |
	label := itemSpec second.
	label ifNil: [ ^self ]. "Only a keyboard shortcut, not a real menu item."
	submenuId := itemSpec first // 1000.
	menu := submenuId = 0 ifTrue: [ topMenu ] ifFalse: [ submenusDictionary at: submenuId ].
	target := itemSpec fourth
		ifNotNil: [ :targetGetter | self perform: targetGetter ]
		ifNil: [ self ].
	selector := itemSpec fifth.
	iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	menuItem := label isSymbol
		ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
		ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
	selector ifNil: [
		menuItem isEnabled: false ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/4/2024 06:01:56' prior: 50340480!
    getMenu
	"Answer the right-click (contextual) menu."
	"Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number (integer or float). It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"

	| widgetKey menuNshortcutsSpecs itemSpec menu submenus |
	widgetKey := self menuNshortcutsKey ifNil: [ ^nil ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].
	menu := MenuMorph new.
	submenus := nil.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2 ifTrue: [
				self addLineTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [ itemSpec size = 3 ifTrue: [
				self addTitleTo: menu fromSpec: itemSpec ]
			ifFalse: [ itemSpec fifth isNumber ifTrue: [
				submenus ifNil: [submenus := Dictionary new ].
				self addSubmenuTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [
				self addItemTo: menu fromSpec: itemSpec submenus: submenus ]]]].
	^ menu! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/4/2024 06:01:47' prior: 50336141!
                 menuNshortcutsSpec: aWidgetKey for: aWidget
	"menuSpec is the Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number. It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	self withAllOwnersReverseDo: [ :o |
		o ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:02:46' prior: 50340547!
classListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(30		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(40 		'-----')
		#(50		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(60		'run tests (t)' 							$t 	model 			runClassTests 									weatherFewCloudsIcon)
		#(70 		'-----')
		#(80		'rename class... (R)' 							$R 	model 			renameClass 									saveAsIcon)
		#(90		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(100		'copy class...' 							nil 	model 			copyClass 									copyIcon)
		#(110		'remove class (x)' 							$x 	model 			removeClass 									deleteIcon)
		#(120 		'-----')
		#(130		'show classes hierarchically' 							nil 	model 			enableListClassesHierarchically 									goTopIcon)
		#(140		'show classes alphabetically' 							nil 	model 			enableListClassesAlphabetically 									sendReceiveIcon)
		#(150		'show definition' 							nil 	model 			editClass 									editFindReplaceIcon)
		#(160		'show comment' 							nil 	model 			editComment 									editFindReplaceIcon)
		#(170 		'-----')
		#(180		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(190		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(200 		'-----')
		#(210		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(220		'class vars' 							nil 	window 			browseClassVariables 									classIcon)
		#(230		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(240 		'-----')
		#(250		'more' 							nil 	nil 			2000 									listAddIcon)
		#(260		nil 							$r 	model 			recent) "Shortcut only. No menu entry."

		" 'refactorings' SubMenu"
		#(1010		'insert superclass...' 							nil 	model 			insertSuperclass 									saveAsIcon)
		#(1020 		'-----')
		#(1030		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)
		#(1040		'rename inst var...' 							nil 	model 			renameInstVar 									saveAsIcon)
		#(1050		'remove inst var...' 							nil 	model 			removeInstVar 									deleteIcon)
		#(1060		'remove all unreferenced inst var...' 						
											nil 	model 			removeAllUnreferencedInstVar 									deleteIcon)
		#(1070		'push up inst var...' 							nil 	model 			pushUpInstanceVariable 									goTopIcon)
		#(1080		'push down inst var...' 							nil 	model 			pushDownInstanceVariable 									goBottomIcon)
		#(1090 		'-----')
		#(1100		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)

		" 'more' SubMenu"
		#(2010		'unsent methods' 							nil 	window 			browseUnusedMethods 									junkIcon
					'browse all methods defined by this class that have no senders')
		#(2020		'unreferenced inst vars' 							nil 	window 			showUnreferencedInstVars 									junkIcon
					'show a list of all instance variables that are not referenced in methods')
		#(2030		'unreferenced class vars' 							nil 	window 			showUnreferencedClassVars 									junkIcon
					'show a list of all class variables that are not referenced in methods')
		#(2040		'subclass template' 							nil 	model 			makeNewSubclass 									classIcon
					'put a template into the code pane for defining of a subclass of this class')
		#(2050 		'-----')
		#(2060		'sample instance' 							nil 	window 			makeSampleInstance 									instanceIcon
					'give me a sample instance of this class, if possible')
		#(2070		'inspect instances' 							nil 	window 			inspectInstances 									inspectIcon
					'open an inspector on all the extant instances of this class')
		#(2080		'inspect subinstances' 							nil 	window 			inspectSubInstances 									inspectIcon
					'open an inspector on all the extant instances of this class and of all of its subclasses')
		#(2090 		'-----')
		#(2100		'create inst var accessors' 							nil 	model 			createInstVarAccessors 									sendReceiveIcon
					'compile instance-variable access methods for any instance variables that do not yet have them')
	)! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:02:53' prior: 50340721 overrides: 50341888!
         classListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	See coment at Morph >> #getMenu
	"
	^self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Class List' 			false)
				#(10		'definition' 					nil 	model 			editClass 						editFindReplaceIcon)
				#(20		'comment' 					nil 	model 			editComment 						editFindReplaceIcon)
				#(30 		'-----')
				#(40		'browse full (b)' 					$b 	window 			browseMethodFull 						editFindReplaceIcon)
				#(50		'class refs (N)' 					$N 	window 			browseClassRefs 						classIcon)
				#(60 		'-----')
				#(70		'fileIn' 					nil 	model 			fileInClass 						updateIcon)
				#(80		'fileOut' 					nil 	model 			fileOutClass 						fileOutIcon)
				#(90 		'-----')
				#(100		'rename...' 					nil 	model 			renameClass 						saveAsIcon)
				#(110		'remove' 					nil 	model 			removeClass 						listRemoveIcon)
				#(120 		'-----')
				#(130		'remove existing' 					nil 	model 			removeClass 						deleteIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Class List' 			false)
				#(10		'definition' 					nil 	model 			editClass 						editFindReplaceIcon)
				#(20		'comment' 					nil 	model 			editComment 						editFindReplaceIcon)
				#(30 		'-----')
				#(80		'fileOut' 					nil 	model 			fileOutClass 						fileOutIcon)
				#(90 		'-----')
				#(100		'rename...' 					nil 	model 			renameClass 						saveAsIcon)
				#(110		'remove' 					nil 	model 			removeClass 						listRemoveIcon)
				#(120 		'-----')
				#(130		'remove existing' 					nil 	model 			removeClass 						deleteIcon)
			) ].! !
!ChangeListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:02:58' prior: 50336292!
    listMenuSpec
	"Spec for the menu and shortcut keys the changes list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Change List' 									true)
		#(10		'fileIn selections' 									nil 	model 			fileInSelections 										nil
					'import the selected items into the image')
		#(20		'fileOut selections...	' 								nil 	model 			fileOutSelections 										nil
		 			'create a new file containing the selected items')
		#(30		'fileOut current version of selections...' 					nil 					model 			fileOutCurrentVersionsOfSelections 										nil
 					'create a new file containing the current (in-image) counterparts of the selected methods')
		#(40 		'-----')
		#(50		'compare to current' 									nil 	model 			compareToCurrentVersion 										nil
 					'open a separate window which shows the text differences between the on-file version and the in-image version.')
		#(60		'toggle diffing (D)' 									$D 	model 			toggleDiffing 										nil
 					'start or stop showing diffs in the code pane.')
		#(70 		'-----')
		#(80		'select new methods' 									nil 	model 			selectNewMethods 										nil
 					'select methods in the file that do not currently exist in the image')
		#(90		'select changes for absent classes' 									nil 	model 			selectAllForAbsentClasses 										nil
					'select methods in the file for classes that are not defined in the image')
		#(100		'select all changes for this class' 									nil 	model 			selectAllForThisClass 										nil
					'select all methods in the file that belong to the currently-selected class')
		#(110		'select unchanged methods' 									nil 	model 			selectUnchangedMethods 										nil
					'select methods in the file whose in-image versions are the same as their in-file counterparts')
		#(120		'select methods equivalent to current' 									nil 	model 			selectEquivalentMethods 										nil
					'select methods in the file whose in-image versions have the same behavior as their in-file counterparts')
		#(130		'select methods older than current' 									nil 	model 			selectMethodsOlderThanCurrent 										nil
					'select methods in the file that are older than the one currently in the image')
		#(140		'select removals of sent methods' 									nil 	model 			selectRemovalsOfSent 										nil
					'select all method removals of methods that have some sender in the image')
		#(150 		'-----')
		#(160		'select all (a)' 									$a 	model 			selectAll 										nil
					'select all the items in the list')
		#(170		'deselect all (A)' 									$A 	model 			deselectAll 										nil
					'deselect all the items in the list')
		#(180		'invert selections' 									nil 	model 			invertSelections 										nil
					'select every item that is not currently selected, and deselect every item that *is* currently selected')
		#(190 		'-----')
		#(200		'browse class and method' 									nil 	window 			browseMethodFull 										nil
					'open a full browser showing the selected method')
		#(210		'browse all versions of single selection' 									nil 	window 			browseVersions 										nil
					'open a version browser showing the versions of the currently selected method')
		#(220		'browse current versions of selections' 									nil 	window 			browseCurrentVersionsOfSelections 										nil
					'open a message-list browser showing the current (in-image) counterparts of the selected methods')
		#(230		'destroy current methods of selections' 									nil 	model 			destroyCurrentCodeOfSelections 										nil
					'remove (*destroy*) the in-image counterparts of all selected methods')
		#(240 		'-----')
		#(250		'remove doIts' 									nil 	model 			removeDoIts 										nil
					'remove all items that are doIts rather than definitions')
		#(260		'remove older versions' 									nil 	model 			removeOlderMethodVersions 										nil
					'remove all but the most recent versions of methods in the list')
		#(270		'remove up-to-date versions' 									nil 	model 			removeUpToDate 										nil
					'remove all items whose code is the same as the counterpart in-image code')
		#(280		'remove empty class comments' 									nil 	model 			removeEmptyClassComments 										nil
					'remove all empty class comments')
		#(290		'remove selected items' 									nil 	model 			removeSelections 										nil
					'remove the selected items from the change-list')
		#(300		'remove unselected items' 									nil 	model 			removeNonSelections 										nil
					'remove all the items not currently selected from the change-list')
	)! !
!VersionsBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:04' prior: 50336468!
            classCommentVersionsMenuSpec
	"Spec for the menu and shortcut keys for a class comment version in the versions list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Versions' 							true)
		#(10		'compare to current' 							nil 	model 			compareToCurrentVersion 										nil
					'compare selected version to the current version')
		#(20		'revert to selected version' 							nil 	model 			fileInSelections 										nil
					'resubmit the selected version, so that it becomes the current version')
		#(30 		'-----')
		#(40		'toggle diffing (D)' 							$D 	model 			toggleDiffing 										nil
					'toggle whether or not diffs should be shown here')
		#(50		'update list' 							nil 	model 			reformulateList 										nil
					'reformulate the list of versions, in case it somehow got out of synch with reality')
		#(60 		'-----')
		#(70		'help...' 							nil 	model 			offerVersionsHelp 										nil
					'provide an explanation of the use of this tool')
	)! !
!VersionsBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:10' prior: 50336539!
               methodVersionsMenuSpec
	"Spec for the menu and shortcut keys for a method version in the versions list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := #(
				#(0 		'Versions' 									true)
	).
	model listIndex > 0 ifTrue: [
		(model list size > 1 ) ifTrue: [
			answer := answer, #(
				#(10		'compare to current' 									nil 	model 			compareToCurrentVersion 									nil
							'compare selected version to the current version')
				#(20		'compare to version...' 									nil 	model 			compareToOtherVersion 									nil
							'compare selected version to another selected version'))].
		answer := answer, #(
				#(30		'revert to selected version (z)' 									$z 	model 			fileInSelections 									nil
							'resubmit the selected version, so that it becomes the current version'))].
	answer := answer, #(
				#(40		'edit current method (O)' 									$O 	window 			openSingleMessageBrowser 									nil
							'open a single-message browser on the current version of this method')
				#(50 		'-----')
				#(60		'toggle diffing (D)' 									$D 	model 			toggleDiffing 									nil
							'toggle whether or not diffs should be shown here')
				#(70		'update list' 									nil 	model 			reformulateList 									nil
							'reformulate the list of versions, in case it somehow got out of synch with reality')
				#(80 		'-----')
				#(90		'senders (n)' 									$n 	window 			browseSenders 									nil
							'browse all senders of this selector')
				#(100		'implementors (m)' 									$m 	window 			browseImplementors 									nil
							'browse all implementors of this selector')
				#(110 		'-----')
				#(120		'help...' 									nil 	model 			offerVersionsHelp 									nil
							'provide an explanation of the use of this tool')
	).
	^answer! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:16' prior: 50338762!
           changeSetListMenuSpec
	"Spec for the menu and shortcut keys the changesets list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := #(
			#(0 		'Change Set' 						true)
			#(10 		'File out and remove (o)' 							$o 	model 			fileOutAndRemove 								fileOutIcon)
			#(20 		'File out and keep (k)' 							$k 	model 			fileOutAndKeep 								fileOutIcon)
			#(30 		'-----')
			#(40 		'Rename change set (R)' 					 		$R 	model 			rename 								saveAsIcon)
			#(50 		'Destroy change set (x)' 			 				$x 	model 			remove 								warningIcon)
	).
	model currentCanHavePreambleAndPostscript ifTrue: [
		model currentHasPreamble
			ifTrue: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Edit preamble (p)' 						$p 	model 			addPreamble 								textEditorIcon)
				#(80 		'Remove preamble' 						nil 	model 			removePreamble 								listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Add preamble (p)' 						$p 	model 			addPreamble 								listAddIcon) )].
		model currentHasPostscript
			ifTrue: [ answer  := answer, #(
				#(90 		'Edit postscript...' 						nil 	model 			editPostscript 								textEditorIcon)
				#(100 		'Remove postscript' 						nil 	model 			removePostscript 								listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(90 		'Add postscript...' 						nil 	model 			editPostscript 								listAddIcon) )].
	].

	answer  := answer, #(
		#(110 		'-----')
		#(120 		'conflicts with other change sets' 								nil 	window			browseMethodConflicts 								emblemImportantIcon
			'Browse all methods that occur both in this change set and in at least one other change set.')
		#(130 		'-----')
		#(140 		'trim history' 								nil 	model			trimHistory 								clockIcon
			'Drops any methods added and then removed, as well as renaming and reorganization of newly-added classes.
 NOTE: can cause confusion if later filed in over an earlier version of these changes.')
		#(150 		'view affected class categories' 								nil 	model 			viewAffectedClassCategories 								packageIcon
			'Show class categories affected by any contained change')
	).
	model csIsForBase ifFalse: [ "Maybe disable a few: Copy them the same as above, but without selector."
		answer := answer, #(
			#(40 		'Rename change set (R)' 					 		$R 	model 			nil 								saveAsIcon)
			#(50 		'Destroy change set (x)' 			 				$x 	model 			nil 								warningIcon)
			#(140 		'trim history' 							nil 	model			nil 								clockIcon)) ].
	^answer! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:21' prior: 50337200!
  classListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	See coment at Morph >> #getMenu
	"
	^#(
			#(0 		'Class List' 						false)
			#(10 		'delete class from change set (d)' 								$d 	model 			forgetClass 						warningIcon)
			#(20 		'remove class from system (x)' 								$x 	model 			removeClass 						deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 								$b 	window 			browseMethodFull 						editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 								$h 	window 			browseHierarchy 						goTopIcon)
			#(60 		'browse protocol (p)' 								$p 	window 			browseFullProtocol 						spreadsheetIcon)
			#(70 		'-----')		
			#(80 		'inst var refs...' 								nil 	window 			browseInstVarRefs 						instanceIcon)
			#(90 		'inst var defs...' 								nil 	window 			browseInstVarDefs 						instanceIcon)
			#(100 		'class var refs...' 								nil 	window 			browseClassVarRefs 						classIcon)
			#(110 		'class vars' 								nil 	window 			browseClassVariables 						classIcon)
			#(120 		'class refs (N)' 								$N 	window 			browseClassRefs 						classIcon)
	).
! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:26' prior: 50337266!
            messageListMenuSpec
	"Spec for the menu and shortcut keys the message list.
	See coment at Morph >> #getMenu
	"
	^#(
			#(0 		'Message List' 						true)
			#(10 		'delete method from change set (d)' 									$d 	model 			forget 								warningIcon)
			#(20 		'remove method from system (x)' 									$x 	model 			removeMessage 								deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 									$b 	window 			browseMethodFull 								editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 									$h 	window 			browseHierarchy 								goTopIcon)
			#(60 		'browse method (O)' 									$O 	window 			openSingleMessageBrowser 								scriptIcon)
			#(70 		'browse protocol (p)' 									$p 	window 			browseFullProtocol 								spreadsheetIcon)
			#(80 		'-----')		
			#(90 		'fileOut (o)' 									$o 	model 			fileOutMessage 								fileOutIcon)
			#(100 		'-----')		
			#(110 		'senders of... (n)' 									$n 	window 			browseSendersOfMessages 								mailForwardIcon)
			#(120 		'implementors of... (m)' 									$m 	window 			browseMessages 								developmentIcon)
			#(130 		'inheritance (i)' 									$i 	window 			methodInheritance 								goDownIcon)
			#(140 		'versions (v)' 									$v 	window 			browseVersions 								clockIcon)
	).
! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:33' prior: 50339173!
                  contextStackMenuSpec
	"Spec for the menu and shortcut keys for call stack list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(10		'fullStack (f)' 						$f 	window 			fullStack 						nil 	'show the complete call stack')
		#(20		'proceed (p)' 						$p 	window 			proceed 						nil 	'close the debugger and proceed')
		#(30		'restart (r)' 						$r 	window 			restart 						nil 	'reset this context to its start')
		#(40		'step into send (e)' 						$e 	window 			send 						nil 	'step into message sends')
		#(50		'step over send (t)' 						$t 	window 			doStep 						nil 	'step over message sends')
		#(60		'step into block (T)' 						$T 	window 			stepIntoBlock 						nil 	'step into a code block')
		#(70		'run to cursor' 						nil 	window 			runToCursor 						nil 	'run to cursor')
		#(80		'where (w)' 						$w 	window 			where 						nil 	'select current pc range')
		#(90		'peel to first like this' 						nil 	window 			peelToFirst 						nil 	'peel stack back to the second occurance of selected message')
		#(100 		'-----')
		#(110		'return entered value' 						nil 	window 			returnValue 						nil 	'lets you enter an expression and return method answering result')
		#(120		'toggle break on entry' 						nil 	model 			toggleBreakOnEntry 						nil 	'install or uninstall a breakpoint on method entry')
	)! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:39' prior: 50337791!
                               contextVariablesListMenuSpec
	"Spec for the menu and shortcut keys for the list of variables in this context.
	See coment at Morph >> #getMenu
	"
	^#(
		#(10		'inspect (i)' 						$i 	window 			inspectContextSelection 							inspectIcon)
		#(20		'explore (I)' 						$I 	window 			exploreContextSelection 							exploreIcon)
		#(30 		'-----')
		#(40		'browser full (b)' 						$b 	window 			contextClassBrowse 							editFindReplaceIcon)
		#(50		'browser hierarch (h)' 						$h 	window 			contextClassHierarchy 							goTopIcon)
		#(60		'browser protocol (p)' 						$p 	window 			contextClassProtocol 							spreadsheetIcon)
	)! !
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:44' prior: 50337841!
         receiverVariablesListMenuSpec
	"Spec for the menu and shortcut keys for the list of instance variables in the receiver.
	See coment at Morph >> #getMenu
	"
	^#(
		#(10		'inspect (i)' 						$i 	window 			inspectReceiverSelection 							inspectIcon)
		#(20		'explore (I)' 						$I 	window 			exploreReceiverSelection 							exploreIcon)
		#(30 		'-----')
		#(40		'browser full (b)' 						$b 	window 			receiverClassBrowse 							editFindReplaceIcon)
		#(50		'browser hierarch (h)' 						$h 	window 			receiverClassHierarchy 							goTopIcon)
		#(60		'browser protocol (p)' 						$p 	window 			receiverClassProtocol 							spreadsheetIcon)
	)! !
!FileListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:50' prior: 50338869!
                          directoryTreeMenuSpec
	"Spec for the menu and shortcut keys for our tree nodes.
	See coment at Morph >> #getMenu
	"
	| showHiddenTogleAndLabel |
	showHiddenTogleAndLabel := model showHidden asMenuItemTextPrefix, 'show hidden folders and files'.
	^{
		{10. 'delete directory...'. 								nil. 	#model. 			#deleteDirectory. 							#warningIcon.
			'Delete the selected directory'}.
		{20. 	showHiddenTogleAndLabel. 							nil. 	#model. 			#toggleShowHidden. 							nil.
			'show or hide files and directories that begin with a dot'}.
		{30. 	'show Cuis top as tree root'. 							nil. 	#window. 			#useCuisTopAsTreeRoot. 							nil.
			'use the default Cuis top directory'}.
		{40. 'show OS roots as tree root'. 								nil. 	#window. 			#useOSrootsAsTreeRoot. 							nil.
			'use the host OS root directories. Drives on Windows; "/" on Unix'}
	}! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:03:56' prior: 50338158!
             fieldListMenuSpec
	"Spec for the menu and shortcut keys for the list of variables in our object.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := #(
		#(10		'inspect (i)' 						$i 	window 			inspectSelection 							inspectIcon)
		#(20		'explore (I)' 						$I 	window 			exploreSelection 							exploreIcon)
		#(30		'copy to clipboard (c)' 						$c 	window 			copySelectionToClipboard 							copyIcon)
		#(40		'basic inspect' 						nil 	window 			inspectBasic 							inspectIcon)
		#(50		'references finder' 						nil 	window 			openReferencesFinder 							exploreIcon)
		#(60		'weight explorer' 						nil 	window 			openWeightExplorer 							exploreIcon)
	).
	(self model objectSpecificMenuSpecFrom: self) ifNotNil: [ :spec |
		answer := answer, spec ].
	answer := answer, #(
		#(210 		'-----')
		#(220		'browser full (b)' 						$b 	window 			browseMethodFull 							editFindReplaceIcon)
		#(230		'browser hierarch (h)' 						$h 	window 			browseHierarchy 							goTopIcon)
		#(240		'browser protocol (p)' 						$p 	window 			browseFullProtocol 							spreadsheetIcon)
	).
	^answer! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:04:01' prior: 50340341!
                     menuSpecForDictionary
	"Spec for the menu and shortcut keys for the list of variables in our object.
	See coment at Morph >> #getMenu
	"
	^#(
		#(100 		'-----')
		#(110		'inspect key' 					nil 	window 			inspectSelectedKey 							editFindReplaceIcon)
		#(120		'senders of this key' 					nil 	window 			sendersOfSelectedKey 							mailForwardIcon)
		#(130		'add key' 					nil 	window 			addEntry 							listAddIcon)
		#(140		'rename key' 					nil 	window 			renameEntry 							saveAsIcon)
		#(150		'remove' 					nil 	model 			removeSelection 							listRemoveIcon)
	)! !
!InspectorWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:04:06' prior: 50338272!
  menuSpecForSet
	"Spec for the menu and shortcut keys for the list of variables in our object.
	See coment at Morph >> #getMenu
	"
	^#(
		#(100 		'-----')
		#(110		'remove' 			nil 	model 			removeSelection 					listRemoveIcon)
	)! !
!ObjectExplorerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:04:11' prior: 50338526!
               listMenuSpec
	"Spec for the menu and shortcut keys for our tree nodes.
	See coment at Morph >> #getMenu
	"
	| answer |
	model getCurrentSelection
		ifNil: [^#()]
		ifNotNil: [ :currSel |
			answer := #(
				#(10		'inspect (i)' 						$i 	window 			inspectSelection 							inspectIcon)
				#(20		'explore (I)' 						$I 	window 			exploreSelection 							exploreIcon)
				#(30		'copy to clipboard (c)' 						$c 	window 			copySelectionToClipboard 							copyIcon)
				#(40		'basic inspect' 						nil 	window 			inspectBasic 							inspectIcon)
				#(50		'references finder' 						nil 	window 			openReferencesFinder 							exploreIcon)
				#(60		'weight explorer' 						nil 	window 			openWeightExplorer 							exploreIcon)
				#(70 		'-----')
				#(80		'browser full (b)' 						$b 	window 			browseMethodFull 							editFindReplaceIcon)
				#(90		'browser hierarch (h)' 						$h 	window 			browseHierarchy 							goTopIcon)
				#(100		'browser protocol (p)' 						$p 	window 			browseFullProtocol 							spreadsheetIcon)).
			(currSel item is: #Morph) ifTrue: [ answer := answer, #(
				#(110 		'-----')
				#(120		'show morph halo' 						nil 	window 			addHaloToSelection 							editFindReplaceIcon)) ].
			model class == ReferencesExplorer ifTrue: [ answer := answer, #(
				#(210 		'-----')
				#(220		'rescan' 						nil 	window 			rescan 							editFindReplaceIcon)) ].
			answer := answer, #(
				#(310 		'-----')
				#(320		'monitor changes' 						nil 	window 			monitorChanges 							editFindReplaceIcon)).
			model isMonitoring ifTrue: [ answer := answer, #(
				#(410 		'-----')
				#(420		'stop monitoring all' 						nil 	window 			stopMonitoring 							editFindReplaceIcon)) ].
			^answer ].! !
!ProcessBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:04:15' prior: 50339012!
               processListMenuSpec
	"Spec for the menu and shortcut keys for the list of processes.
	See coment at Morph >> #getMenu
	"
	| rules answer |
	answer := #().
	model selectedProcess ifNotNil: [ :selectedProcess |
		rules := model class rulesFor: model selectedProcess.
		answer := answer, #(
				#(10		'inspect (i)' 						$i 	window 			inspectProcess 						inspectIcon)
				#(20		'explore (I)' 						$I 	window 			exploreProcess 						exploreIcon)
				#(30		'references finder (P)' 						$P 	window 			openReferencesFinder 						exploreIcon)).
		rules first ifTrue: [
			answer := answer, 
				#((40		'terminate (t)' 						$t 	model 			terminateProcess 						cancelIcon)).
			selectedProcess isSuspended ifTrue: [ answer := answer,
				#((50		'resume (r)' 						$r 	model 			resumeProcess 						mediaPlaybackStartIcon))]
			ifFalse: [ answer := answer, 
				#((50 		'suspend (s)' 						$s 	model 			suspendProcess 						chatIcon))]].
		rules second ifTrue: [ answer := answer, #(
				#(60 		'change priority (p)' 						$p 	window 			changePriority 						systemMonitorIcon)
				#(70 		'debug (d)' 						$d 	window 			debugProcess 						debugIcon))].
		(selectedProcess suspendingList isKindOf: Semaphore) ifTrue: [ answer := answer,
				#((80 		'signal Semaphore (S)' 						$S 	model 			signalSemaphore 						haloHelpIcon))].
		answer := answer, #(
				#(90		'full stack (k)' 						$k 	model 			moreStack 						systemIcon)
				#(100 		'-----'))].
	answer := answer, #(
				#(110		'find context... (f)' 						$f 	window 			findContext 						findIcon)
				#(120		'find again (g)' 						$g 	model 			nextContext 						systemIcon)
				#(130 		'-----')).
	answer := answer, (isStepping ifTrue: [
				#((140		'turn off auto-update (a)' 						$a 	window 			toggleAutoUpdate 						cancelIcon)) ]
			ifFalse: [
				#((140		'turn on auto-update (a)' 						$a 	window 			toggleAutoUpdate 						updateIcon)) ]).
	answer := answer, #(
				#(150		'update list (u)' 						$u 	model 			updateProcessList 						updateIcon)
				#(160 		'-----')).
	answer := answer, (CPUWatcher isMonitoring ifTrue: [
				#((170		'stop CPUWatcher' 						nil 	model 			stopCPUWatcher 						inspectIcon)) ]
			ifFalse: [
				#((170		'start CPUWatcher' 						nil 	model 			startCPUWatcher 						inspectIcon)) ]).
	answer := answer, (StackSizeWatcher isWatching ifTrue: [
				#((180		'stop StackSizeWatcher' 						nil 	model 			stopStackSizeWatcher 						inspectIcon)) ]
			ifFalse: [
				#((180		'start StackSizeWatcher' 						nil 	model 			startStackSizeWatcher 						inspectIcon)) ]).
	^answer! !
!ProcessBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:04:20' prior: 50339125!
                           stackMenuSpec
	"Spec for the menu and shortcut keys for the list of stack frames.
	See coment at Morph >> #getMenu
	"
	^ #(
		#(10		'inspect context (c)' 					$c 	window 			inspectContext 					inspectIcon)
		#(20		'explore context (C)' 					$C 	window 			exploreContext 					exploreIcon)
		#(30		'inspect receiver (i)' 					$i 	window 			inspectReceiver 					inspectIcon)
		#(40		'explore receiver (I)' 					$I 	window 			exploreReceiver 					exploreIcon)
		#(50		'browse context (b)' 					$b 	window 			browseContext 					editFindReplaceIcon)
	).! !
!TestRunnerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:04:25' prior: 50339481!
                    listMenuSpec
	"Spec for the menu and shortcut keys for the list of test classes.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := #(
		#(0 		'Test Cases Set' 						false)
		#(10		'select all (a)' 					$a 	model 			selectAll 					selectAllIcon)
		#(20		'deselect all (A)' 					$A 	model 			deselectAll 					selectAllIcon)
		#(30		'invert selections' 					nil 	model 			invertSelections 					switchIcon)
		#(40		'filter (f)' 					$f 	model 			setFilter 					findIcon)
		#(50		'refresh (u)' 					$u 	model 			refreshTests 					refreshIcon)
		#(60 		'-----')).
	model isRunning ifTrue: [ answer := answer, #(
		#(70		'stop (l)' 					$l 	model 			interruptRun 					stopIcon))]
	ifFalse: [ answer := answer, #(
		#(70		'run (r)' 					$r 	model 			runTests 					playIcon)
		#(80		'run one (o)' 					$o 	model 			runOneTest 					playIcon)
		#(90		'run profiled (p)' 					$p 	model 			runProfiledTests 					playIcon))].
	model selectedSuite > 0 ifTrue: [ answer := answer, #(
		#(100 		'-----')
		#(110		'browse' 					nil 	window 			browseSelected 					editFindReplaceIcon))].
	answer := answer, #(
		#(100 		'-----')
		#(110		'log to Transcript' 					nil 	model 			showResult 					printerIcon)).
	^answer! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6431-NewMenuAndShortcutSpecs-Enhancements-JuanVuletich-2024Jun04-05h29m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6431] on 4 June 2024 at 6:11:25 am'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:10:30'!
                            systemCatSingletonMenuSpec
	"Spec for the menu and shortcut keys the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class category' 					false)
		#(10		'find class... (f)' 						$f 	window 			findClass 									findIcon)
		#(20 		'-----')
		#(30		'browse all (B)' 						$B 	window 			browseAllClasses 									editFindReplaceIcon)
		#(40		'browse (b)' 						$b 	window 			openSystemCategoryBrowser 									packageIcon)
		#(50 		'-----')
		#(60		'fileOut (o)' 						$o 	model 			fileOutSystemCategory 									fileOutIcon)
		#(70 		'-----')
		#(80		'update (u)' 						$u 	model 			updateSystemCategories 									updateIcon)
		#(90		'rename... (R)' 						$R 	model 			renameSystemCategory 									saveAsIcon)
		#(100		'remove (x)' 						$x 	model 			removeSystemCategory 									deleteIcon)
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:10:23'!
systemCategoriesListMenuSpec
	"Spec for the menu and shortcut keys the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class Categories' 					false)
		#(10		'find class... (f)' 						$f 	window 			findClass 									findIcon)
		#(20		'recent classes... (r)' 						$r 	model 			recent 									clockIcon)
		#(30 		'-----')
		#(40		'browse all (B)' 						$B 	window 			browseAllClasses 									editFindReplaceIcon)
		#(50		'browse (b)' 						$b 	window 			openSystemCategoryBrowser 									packageIcon)
		#(60 		'-----')
		#(70		'fileOut (o)' 						$o 	model 			fileOutSystemCategory 									fileOutIcon)
		#(80 		'-----')
		#(90		'reorganize' 						nil 	model 			editSystemCategories 									sendReceiveIcon)
		#(100		'alphabetize (A)' 						$A 	model 			alphabetizeSystemCategories 									fontXGenericIcon)
		#(110 		'-----')
		#(120		'update (u)' 						$u 	model 			updateSystemCategories 									updateIcon)
		#(130		'add item... (a)' 						$a 	model 			addSystemCategory 									newIcon)
		#(140		'rename... (R)' 						$R 	model 			renameSystemCategory 									saveAsIcon)
		#(150		'move to... (m)' 						$m 	model 			moveAllToOtherSystemCategory 									saveAsIcon)
		#(160		'remove (x)' 						$x 	model 			removeSystemCategory 									deleteIcon)
		#(170 		'-----')
		#(180		'move to top' 						nil 	model 			moveSystemCategoryTop 									goTopIcon)
		#(190		'move up' 						nil 	model 			moveSystemCategoryUp 									goUpIcon)
		#(200		'move down' 						nil 	model 			moveSystemCategoryDown 									goDownIcon)
		#(210		'move to bottom' 						nil 	model 			moveSystemCategoryBottom 									fileOutIcon)
		#(220 		'-----')
		#(230		'run tests (t)' 						$t 	model 			runSystemCategoryTests 									weatherFewCloudsIcon)
	)! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/1/2024 11:20:24' prior: 50332720!
     buildMorphicSystemCategoryList
	^(HierarchicalListMorph
		withModel: model
		listGetter: #systemCategoryRoots
		indexGetter: #selectedSystemCategory
		indexSetter: #setSelectedSystemCategoryTreeItem:)
			menuNshortcutsKey: #systemCategoriesListMenuSpec;
			autoDeselect: true;
			autoExpand: true;
			yourself! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/1/2024 11:19:09' prior: 50332734!
             buildNoSysCatMorphicWindow
	"A Browser without the class categories list"

	| mySingletonList upperPanes messageCatList messageList classColumn classList |
	mySingletonList := (PluggableListMorph
				withModel: model
				listGetter: #systemCategorySingleton
				indexGetter: #indexIsOne
				indexSetter: #indexIsOne:)
					menuNshortcutsKey: #systemCatSingletonMenuSpec.
	mySingletonList hideScrollBarsIndefinitely.

	classList := self buildMorphicClassList.
	classColumn := self buildMorphicClassColumnWith: classList.
	messageCatList := self buildMorphicMessageCatList.
	messageList := self buildMorphicMessageList.
	
	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: classColumn proportionalWidth: 0.3;
		addAdjusterAndMorph: messageCatList proportionalWidth: 0.3;
		addAdjusterAndMorph: messageList proportionalWidth: 0.4.

	messageList allowItemDrag: true.
	messageCatList
		acceptDropsFrom: messageList
		performing: #categorizeUnderCategoryAt:selector:.

	self layoutMorph
		addMorph: mySingletonList fixedHeight: (Preferences at: #standardCodeFont) lineSpacing + 10;
		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.

	model changed: #editSelection! !

HierarchyBrowserWindow removeSelector: #systemCatSingletonKey:from:!

!methodRemoval: HierarchyBrowserWindow #systemCatSingletonKey:from: stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCatSingletonKey: aChar from: aView
	^ self systemCatListKey: aChar from: aView!

BrowserWindow class removeSelector: #systemCategoryMenuOptions!

!methodRemoval: BrowserWindow class #systemCategoryMenuOptions stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCategoryMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'find class... (f)'.
				#selector 			-> 		#findClass.
				#icon 			-> 		#findIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'recent classes... (r)'.
				#object 			-> 		#model.
				#selector 			-> 		#recent.
				#icon 			-> 		#clockIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'browse all (B)'.
				#selector 			-> 		#browseAllClasses.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'browse (b)'.
				#selector 			-> 		#openSystemCategoryBrowser.
				#icon 			-> 		#packageIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'fileOut (o)'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutSystemCategory.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'reorganize'.
				#object 			-> 		#model.
				#selector 			-> 		#editSystemCategories.
				#icon 			-> 		#sendReceiveIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'alphabetize (A)'.
				#object 			-> 		#model.
				#selector 			-> 		#alphabetizeSystemCategories.
				#icon 			-> 		#fontXGenericIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'update (u)'.
				#object 			-> 		#model.
				#selector 			-> 		#updateSystemCategories.
				#icon 			-> 		#updateIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		20.
				#label 			-> 		'add item... (a)'.
				#object 			-> 		#model.
				#selector 			-> 		#addSystemCategory.
				#icon 			-> 		#newIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		30.
				#label 			-> 		'rename... (R)'.
				#object 			-> 		#model.
				#selector 			-> 		#renameSystemCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		35.
				#label 			-> 		'move to... (m)'.
				#object 			-> 		#model.
				#selector 			-> 		#moveAllToOtherSystemCategory.
				#icon 			-> 		#saveAsIcon.
				#balloonText 			-> 		'Move all classes in this category to another category'       
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		40.
				#label 			-> 		'remove (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeSystemCategory.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		10.
				#label 			-> 		'move to top'.
				#object 			-> 		#model.
				#selector 			-> 		#moveSystemCategoryTop.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		20.
				#label 			-> 		'move up'.
				#object 			-> 		#model.
				#selector 			-> 		#moveSystemCategoryUp.
				#icon 			-> 		#goUpIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		30.
				#label 			-> 		'move down'.
				#object 			-> 		#model.
				#selector 			-> 		#moveSystemCategoryDown.
				#icon 			-> 		#goDownIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		40.
				#label 			-> 		'move to bottom'.
				#object 			-> 		#model.
				#selector 			-> 		#moveSystemCategoryBottom.
				#icon 			-> 		#goBottomIcon
			} asDictionary.
			{
				#itemGroup 			-> 		70.
				#itemOrder 			-> 		10.
				#label 			-> 		'run tests (t)'.
				#object 			-> 		#model.
				#selector 			-> 		#runSystemCategoryTests.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
		}`.
	!

BrowserWindow class removeSelector: #systemCatSingletonMenuOptions!

!methodRemoval: BrowserWindow class #systemCatSingletonMenuOptions stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCatSingletonMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'find class... (f)'.
				#selector 			-> 		#findClass.
				#icon 			-> 		#findIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'browse all (B)'.
				#selector 			-> 		#browseAllClasses.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'browse (b)'.
				#selector 			-> 		#openSystemCategoryBrowser.
				#icon 			-> 		#packageIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'fileOut (o)'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutSystemCategory.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'update (u)'.
				#object 			-> 		#model.
				#selector 			-> 		#updateSystemCategories.
				#icon 			-> 		#updateIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'rename... (R)'.
				#object 			-> 		#model.
				#selector 			-> 		#renameSystemCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'remove (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeSystemCategory.
				#icon 			-> 		#deleteIcon
			} asDictionary.
		}`.
	!

BrowserWindow removeSelector: #systemCategoryMenu!

!methodRemoval: BrowserWindow #systemCategoryMenu stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCategoryMenu

	^DynamicMenuBuilder buildTitled: 'Class category' targeting: self collectingMenuOptionsWith: #systemCategoryMenuOptions.!

BrowserWindow removeSelector: #systemCatSingletonKey:from:!

!methodRemoval: BrowserWindow #systemCatSingletonKey:from: stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCatSingletonKey: aChar from: aView
	^ self messageListKey: aChar from: aView!

BrowserWindow removeSelector: #systemCatSingletonMenu!

!methodRemoval: BrowserWindow #systemCatSingletonMenu stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCatSingletonMenu

	^DynamicMenuBuilder buildTitled: 'Class category' targeting: self collectingMenuOptionsWith: #systemCatSingletonMenuOptions.
!

BrowserWindow removeSelector: #systemCatListKey:from:!

!methodRemoval: BrowserWindow #systemCatListKey:from: stamp: 'Install-6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st 6/6/2024 11:37:55'!
systemCatListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $r ifTrue: [^ model recent ].
	aChar = $f ifTrue: [ ^ self findClass ].
	aChar = $x ifTrue: [ ^ model removeSystemCategory ].
	aChar = $t ifTrue: [ ^ model runSystemCategoryTests ].
	aChar = $a ifTrue: [ ^ model addSystemCategory ].
	aChar = $A ifTrue: [ ^ model alphabetizeSystemCategories ].
	aChar = $b ifTrue: [ ^ self openSystemCategoryBrowser ].
	aChar = $B ifTrue: [ ^ self browseAllClasses ].
	aChar = $o ifTrue: [ ^ model fileOutSystemCategory ].
	aChar = $u ifTrue: [ ^ model updateSystemCategories ].
	aChar = $R ifTrue: [ ^ model renameSystemCategory ].
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6432-NewMenuSpecs-Browser-SystemCategoriesList-JuanVuletich-2024Jun04-06h09m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6431] on 4 June 2024 at 6:14:10 am'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:12:56'!
              methodCategoriesListMenuSpec
	"Spec for the menu and shortcut keys the method categories list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message Categories' 					false)
		#(10		'fileOut (o)' 								$o 	model 			fileOutMessageCategories 										fileOutIcon)
		#(20 		'-----')
		#(30		'reorganize (r)' 								$r 	model 			editMessageCategories 										sendReceiveIcon)
		#(40		'alphabetize (a)' 								$a 	model 			alphabetizeMessageCategories 										fontXGenericIcon)
		#(50		'remove empty categories (e)' 								$e 	model 			removeEmptyCategories 										listRemoveIcon)
		#(60		'categorize all uncategorized (c)' 								$c 	model 			categorizeAllUncategorizedMethods 										packageIcon)
		#(70		'new category... (n)' 								$n 	model 			addCategory 										newIcon)
		#(80		'new extension category... (N)' 								$N 	model 			addExtensionCategory 										listAddIcon)
		#(90 		'-----')
		#(100		'rename... (R)' 								$R 	model 			renameCategory 										saveAsIcon)
		#(110		'remove (x)' 								$x 	model 			removeMessageCategory 										deleteIcon)
		#(120 		'-----')
		#(130		'run tests (t)' 								$t 	model 			runMessageCategoryTests 										weatherFewCloudsIcon)
	)! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:13:13' overrides: 50343285!
                   methodCategoriesListMenuSpec
	"Spec for the menu and shortcut keys the method categories list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Message Categories' 			false)
				#(10		'fileIn' 					nil 	model 			fileInMessageCategories 								updateIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Message Categories' 			false)
			)].
	answer := answer, 
			#(
				#(20		'fileOut' 					nil 	model 			fileOutMessageCategories 								fileOutIcon)
				#(30 		'-----')
				#(40		'reorganize' 					nil 	model 			editMessageCategories 								sendReceiveIcon)
				#(50 		'-----')
				#(60		'add item...' 					nil 	model 			addCategory 								newIcon)
				#(70 		'-----')
				#(80		'rename...' 					nil 	model 			renameCategory 								saveAsIcon)
				#(90		'remove' 					nil 	model 			removeMessageCategory 								listRemoveIcon)
			).
	self model caseCodeSource isLiveSmalltalkImage ifFalse: [
		answer := answer, #(
				#(100 		'-----')
				#(100		'remove existing' 					nil 	model 			removeUnmodifiedMethods 								deleteIcon)
		) ].
	^answer! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/2/2024 19:31:10' prior: 50332694!
                               buildMorphicMessageCatList

	^(PluggableListMorph
		withModel: model
		listGetter: #messageCategoryList
		indexGetter: #messageCategoryListIndex
		indexSetter: #messageCategoryListIndex:)
			menuNshortcutsKey: #methodCategoriesListMenuSpec.
! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:13:23' prior: 50342881!
         systemCatSingletonMenuSpec
	"Spec for the menu and shortcut keys the one-item system category list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class category' 					false)
		#(10		'find class... (f)' 						$f 	window 			findClass 									findIcon)
		#(20 		'-----')
		#(30		'browse all (B)' 						$B 	window 			browseAllClasses 									editFindReplaceIcon)
		#(40		'browse (b)' 						$b 	window 			openSystemCategoryBrowser 									packageIcon)
		#(50 		'-----')
		#(60		'fileOut (o)' 						$o 	model 			fileOutSystemCategory 									fileOutIcon)
		#(70 		'-----')
		#(80		'update (u)' 						$u 	model 			updateSystemCategories 									updateIcon)
		#(90		'rename... (R)' 						$R 	model 			renameSystemCategory 									saveAsIcon)
		#(100		'remove (x)' 						$x 	model 			removeSystemCategory 									deleteIcon)
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 06:13:30' prior: 50342909!
                             systemCategoriesListMenuSpec
	"Spec for the menu and shortcut keys the system categories list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class Categories' 					false)
		#(10		'find class... (f)' 						$f 	window 			findClass 									findIcon)
		#(20		'recent classes... (r)' 						$r 	model 			recent 									clockIcon)
		#(30 		'-----')
		#(40		'browse all (B)' 						$B 	window 			browseAllClasses 									editFindReplaceIcon)
		#(50		'browse (b)' 						$b 	window 			openSystemCategoryBrowser 									packageIcon)
		#(60 		'-----')
		#(70		'fileOut (o)' 						$o 	model 			fileOutSystemCategory 									fileOutIcon)
		#(80 		'-----')
		#(90		'reorganize' 						nil 	model 			editSystemCategories 									sendReceiveIcon)
		#(100		'alphabetize (A)' 						$A 	model 			alphabetizeSystemCategories 									fontXGenericIcon)
		#(110 		'-----')
		#(120		'update (u)' 						$u 	model 			updateSystemCategories 									updateIcon)
		#(130		'add item... (a)' 						$a 	model 			addSystemCategory 									newIcon)
		#(140		'rename... (R)' 						$R 	model 			renameSystemCategory 									saveAsIcon)
		#(150		'move to... (m)' 						$m 	model 			moveAllToOtherSystemCategory 									saveAsIcon)
		#(160		'remove (x)' 						$x 	model 			removeSystemCategory 									deleteIcon)
		#(170 		'-----')
		#(180		'move to top' 						nil 	model 			moveSystemCategoryTop 									goTopIcon)
		#(190		'move up' 						nil 	model 			moveSystemCategoryUp 									goUpIcon)
		#(200		'move down' 						nil 	model 			moveSystemCategoryDown 									goDownIcon)
		#(210		'move to bottom' 						nil 	model 			moveSystemCategoryBottom 									fileOutIcon)
		#(220 		'-----')
		#(230		'run tests (t)' 						$t 	model 			runSystemCategoryTests 									weatherFewCloudsIcon)
	)! !
!CodeFileBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/2/2024 19:31:17' prior: 50332779 overrides: 16799397!
                             buildMorphicWindow
	"Create a pluggable version of all the views for a Browser, using Morphic widgets."

	| sysCatList msgCatList upperPanes clsLayout clsList msgList |
	model setSelectedSystemCategory: model systemCategoryList first.
	sysCatList := (PluggableListMorph
			withModel: model 
			listGetter: #systemCategorySingleton
			indexGetter: #indexIsOne 
			indexSetter: #indexIsOne:)
				mainView: self
				menuGetter: #codeFileListMenu
				keystrokeAction: #codeFileListKey:from:.
	sysCatList hideScrollBarsIndefinitely.
	
	msgCatList := (PluggableListMorph
			withModel: model 
			listGetter: #messageCategoryList
			indexGetter: #messageCategoryListIndex 
			indexSetter: #messageCategoryListIndex:)
				menuNshortcutsKey: #methodCategoriesListMenuSpec.

	clsList := self buildMorphicClassList.
	clsLayout := self buildMorphicClassColumnWith: clsList.
	msgList := self buildMorphicMessageList.

	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: clsLayout proportionalWidth: 0.3;
		addAdjusterAndMorph: msgCatList proportionalWidth: 0.3;
		addAdjusterAndMorph: msgList proportionalWidth: 0.4.

	self layoutMorph
		addMorph: sysCatList fixedHeight: (Preferences at: #standardCodeFont) lineSpacing + 10;
		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.
	model changed: #editSelection! !

CodeFileBrowserWindow removeSelector: #messageCategoryMenu!

!methodRemoval: CodeFileBrowserWindow #messageCategoryMenu stamp: 'Install-6433-NewMenuSpecs-Browser-MethodCategoriesList-JuanVuletich-2024Jun04-06h11m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageCategoryMenu
	| aMenu itemColl |
	aMenu := MenuMorph new defaultTarget: model.
	"All the options are for the model."
	aMenu addTitle: 'Message Category'.
	itemColl := OrderedCollection new.
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
		itemColl add:
			{#label -> 'fileIn'. #selector -> #fileInMessageCategories. #icon -> #updateIcon} asDictionary ].
	itemColl addAll:
		{
			{#label -> 'fileOut'. #selector -> #fileOutMessageCategories. #icon -> #fileOutIcon} asDictionary. 
			nil. 
			{#label -> 'reorganize'. #selector -> #editMessageCategories. #icon -> #sendReceiveIcon} asDictionary. 
			nil. 
			{#label -> 'add item...'. #selector -> #addCategory. #icon -> #newIcon} asDictionary. 
			nil. 
			{#label -> 'rename...'. #selector -> #renameCategory. #icon -> #saveAsIcon} asDictionary. 
			{#label -> 'remove'. #selector -> #removeMessageCategory. #icon -> #listRemoveIcon} asDictionary
		}.
	self model caseCodeSource isLiveSmalltalkImage ifFalse: [
		itemColl addAll:
			{
				nil. 
				{#label -> 'remove existing'. #selector -> #removeUnmodifiedMethods. #icon -> #deleteIcon} asDictionary
			} ].
	aMenu addItemsFromDictionaries: itemColl.
	^ aMenu.!

BrowserWindow class removeSelector: #messageCategoryMenuOptions!

!methodRemoval: BrowserWindow class #messageCategoryMenuOptions stamp: 'Install-6433-NewMenuSpecs-Browser-MethodCategoriesList-JuanVuletich-2024Jun04-06h11m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageCategoryMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'fileOut (o)'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutMessageCategories.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'reorganize (r)'.
				#object 			-> 		#model.
				#selector 			-> 		#editMessageCategories.
				#icon 			-> 		#sendReceiveIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'alphabetize (a)'.
				#object 			-> 		#model.
				#selector 			-> 		#alphabetizeMessageCategories.
				#icon 			-> 		#fontXGenericIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'remove empty categories (e)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeEmptyCategories.
				#icon 			-> 		#listRemoveIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		40.
				#label 			-> 		'categorize all uncategorized (c)'.
				#object 			-> 		#model.
				#selector 			-> 		#categorizeAllUncategorizedMethods.
				#icon 			-> 		#packageIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		50.
				#label 			-> 		'new category... (n)'.
				#object 			-> 		#model.
				#selector 			-> 		#addCategory.
				#icon 			-> 		#newIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		60.
				#label 			-> 		'new extension category... (N)'.
				#object 			-> 		#model.
				#selector 			-> 		#addExtensionCategory.
				#icon 			-> 		#listAddIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'rename... (R)'.
				#object 			-> 		#model.
				#selector 			-> 		#renameCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'remove (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeMessageCategory.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'run tests (t)'.
				#object 			-> 		#model.
				#selector 			-> 		#runMessageCategoryTests.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
		}`.
	!

BrowserWindow removeSelector: #messageCategoryMenu!

!methodRemoval: BrowserWindow #messageCategoryMenu stamp: 'Install-6433-NewMenuSpecs-Browser-MethodCategoriesList-JuanVuletich-2024Jun04-06h11m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageCategoryMenu

	^DynamicMenuBuilder buildTitled: 'Message Category' targeting: self collectingMenuOptionsWith: #messageCategoryMenuOptions.
!

BrowserWindow removeSelector: #messageCatListKey:from:!

!methodRemoval: BrowserWindow #messageCatListKey:from: stamp: 'Install-6433-NewMenuSpecs-Browser-MethodCategoriesList-JuanVuletich-2024Jun04-06h11m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageCatListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $o ifTrue: [ ^ model fileOutMessageCategories ].
	aChar = $t ifTrue: [ ^ model runMessageCategoryTests ].
	aChar = $x ifTrue: [ ^ model removeMessageCategory ].
	aChar = $R ifTrue: [ ^ model renameCategory ].
	aChar = $n ifTrue: [ ^ model addCategory ].
	aChar = $N ifTrue: [ ^ model addExtensionCategory ].
	aChar = $e ifTrue: [ ^ model removeEmptyCategories ].
	aChar = $c ifTrue: [ ^ model categorizeAllUncategorizedMethods ].
	aChar = $a ifTrue: [ ^ model alphabetizeMessageCategories ].
	aChar = $r ifTrue: [ ^ model editMessageCategories ]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6433-NewMenuSpecs-Browser-MethodCategoriesList-JuanVuletich-2024Jun04-06h11m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6433] on 4 June 2024 at 8:24:58 am'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 08:20:59'!
      messageListMenuSpec
	"Spec for the menu and shortcut keys the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message List' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(80		'browse method category (c)' 							$c 	window 			browseCategoryOfCurrentMethod 									editFindReplaceIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(150		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(160		'senders of... (n)' 							$n 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(170		'implementors of... (m)' 							$m 	window 			browseMessages 									developmentIcon)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(280		'remove method in hierarchy' 							nil 	model 			removeMessageInHierarchy 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'refactorings' SubMenu"
		#(1010		'rename... (R)' 											$R 	model 			renameSelector 											saveAsIcon)
		#(1020		'change keyword order...' 											nil 	model 			changeKeywordOrder 											sendReceiveIcon)
		#(1030		'add parameter... (A)' 											$A 	model 			addParameter 											listAddIcon)
		#(1040		'remove parameter... (S)' 											$S 	model 			removeParameter 											listRemoveIcon)
		#(1050 		'-----')
		#(1060		'inline method... (F)' 											$F 	model 			inlineMethod 											saveAsIcon)
		#(1070		'move to instance/class method' 											nil 	model 			moveToInstanceOrClassMethod 											changesIcon)
		#(1080		'push up' 											nil 	model 			pushUpSelector 											goTopIcon)
		#(1090		'add in superclass as subclassResponsability' 											nil 	model 			addAsSubclassResponsabilitySelector 											goTopIcon)
		#(1100		'push down to subclasses' 											nil 	model 			pushDownSelectorToSubclasses 											goBottomIcon)
		#(1110		'push down to one subclass' 											nil 	model 			pushDownSelectorToOneSubclass 											goBottomIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2110		'show category (C)' 								$C 	model 			showHomeCategory 									packageIcon)
		#(2120		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2130		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
	)! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 08:12:54' overrides: 50343686!
                     messageListMenuSpec
	"Spec for the menu and shortcut keys the messages list.
	See coment at Morph >> #getMenu
	"
	^ self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Messages' 			false)
				#(10		'fileIn' 						nil 	model 			fileInMessage 							updateIcon)
				#(20		'fileOut' 						nil 	model 			fileOutMessage 							fileOutIcon)
				#(30 		'-----')
				#(40		'senders (n)' 						$n 	window 			browseSenders 							mailForwardIcon)
				#(50		'implementors (m)' 						$m 	window 			browseImplementors 							developmentIcon)
				#(60		'method inheritance (h)' 						$h 	window 			methodInheritance 							goDownIcon)
				#(70		'browse full (b)' 						$b 	window 			browseMethodFull 							editFindReplaceIcon)
				#(80		'versions (v)' 						nil 	window 			browseVersions 							clockIcon)
				#(90 		'-----')
				#(100		'remove method (x)' 						$x 	model 			removeMessage 							deleteIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Messages' 			false)
				#(10		'fileOut' 						nil 	model 			fileOutMessage 							fileOutIcon)
				#(20 		'-----')
				#(30		'remove method (x)' 						$x 	model 			removeMessage 							deleteIcon)
			)].! !
!MethodSetWindow methodsFor: 'menu building' stamp: 'jmv 6/4/2024 08:16:12' overrides: 50340290!
                    messageListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also
	have a listView that has a list of methods.  The view knows how to get
	the list and selection."

	| sel class |
	self flag: #definesKeyboardShortcuts.
	aChar = $D ifTrue: [^ model toggleDiffing].

	sel := model selectedMessageName.
	aChar = $m ifTrue: [  "These next two put up a type in if no message selected"
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllImplementorsOf: to: Smalltalk].
	aChar = $n ifTrue: [
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllCallsOn: to: Smalltalk].

	"The following require a class selection"
	(class := model selectedClassOrMetaClass) ifNil: [^ self ].
	aChar = $b ifTrue: [^ BrowserWindow fullOnClass: class selector: sel].
	aChar = $N ifTrue: [^ self browseClassRefs].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $p ifTrue: [^ self browseFullProtocol].

	sel
		ifNotNil: [
			"The following require a method selection"
			aChar = $i ifTrue: [^ self methodInheritance].
			aChar = $o ifTrue: [^ model fileOutMessage].
			aChar = $c ifTrue: [^ model copySelector].
			aChar = $v ifTrue: [^ self browseVersions].
			aChar = $C ifTrue: [^ model showHomeCategory].
			aChar = $O ifTrue: [^ self openSingleMessageBrowser].
			aChar = $x ifTrue: [^ model removeMessage].
			aChar = $t ifTrue: [^ model runMethodTest].
			aChar = $r ifTrue: [^ model debugMethodTest]]
		ifNil: [
			aChar = $R ifTrue: [^ model renameClass]]! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/4/2024 06:31:57' prior: 50341723!
        addItemTo: topMenu fromSpec: itemSpec submenus: submenusDictionary
	"
	See coment at Morph >> #getMenu
	"
	| submenuId menu label target selector iconSymbol helpText menuItem |
	label := itemSpec second.
	label ifNil: [ ^self ]. "Only a keyboard shortcut, not a real menu item."
	submenuId := itemSpec first // 1000.
	menu := submenuId = 0 ifTrue: [ topMenu ] ifFalse: [ submenusDictionary at: submenuId ].
	target := itemSpec fourth
		ifNotNil: [ :targetGetter | self perform: targetGetter ]
		ifNil: [ self ].
	selector := itemSpec fifth.
	menuItem := label isSymbol
		ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
		ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
	selector ifNil: [
		menuItem isEnabled: false ].
	iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/4/2024 06:32:29' prior: 50340444!
    addSubmenuTo: menu fromSpec: itemSpec submenus: submenusDictionary
	| submenu label submenuId iconSymbol helpText menuItem |
	submenu := MenuMorph new.
	label := itemSpec second.
	submenuId := itemSpec fifth // 1000.
	menuItem := menu add: label subMenu: submenu.
	iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].
	submenusDictionary at: submenuId put: submenu! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/4/2024 08:10:12' prior: 50332706!
                             buildMorphicMessageList
	"Build a morphic message list, with #messageList as its list-getter"

	^(PluggableListMorph
		withModel: model
		listGetter: #messageList
		indexGetter: #messageListIndex
		indexSetter: #messageListIndex:)
			menuNshortcutsKey: #messageListMenuSpec.! !
!MethodSetWindow methodsFor: 'menu building' stamp: 'jmv 6/4/2024 08:09:12' prior: 50334017!
             messageListMenu2
	"Fill aMenu with the items appropriate when the shift key is held down"

	self flag: #assumesKeyboardShortcuts.
	^DynamicMenuBuilder 
		buildTitled: 'Message Set' 
		targeting: self 
		collectingMenuOptionsWith: #messageSetMenu2Options 
		changingThemWith: [ :options |
			self addExtraMenu2ItemsTo: options ].! !

RefactoringMenues class removeSelector: #messageListMenuOptions!

!methodRemoval: RefactoringMenues class #messageListMenuOptions stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^ `{
		{
			#itemGroup 			-> 		5.
			#itemOrder 			-> 		10.
			#label 			-> 		RefactoringMenues refactoringsLabel.
			#selector 			-> 		#yourself.
			#icon 			-> 		#listAddIcon
		} asDictionary.
			{
				#submenuOf 	-> 				RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'rename... (R)'.
				#object 			-> 		#model.
				#selector 			-> 		#renameSelector.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		15.
				#label 			-> 		'change keyword order...'.
				#object 			-> 		#model.
				#selector 			-> 		#changeKeywordOrder.
				#icon 			-> 		#sendReceiveIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'add parameter...(A)'.
				#object 			-> 		#model.
				#selector 			-> 		#addParameter.
				#icon 			-> 		#listAddIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		30.
				#label 			-> 		'remove parameter...(S)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeParameter.
				#icon 			-> 		#listRemoveIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'inline method... (F)'.
				#object 			-> 		#model.
				#selector 			-> 		#inlineMethod.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'move to instance/class method'.
				#object 			-> 		#model.
				#selector 			-> 		#moveToInstanceOrClassMethod.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'push up'.
				#object 			-> 		#model.
				#selector 			-> 		#pushUpSelector.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		40.
				#label 			-> 		'add in superclass as subclassResponsability'.
				#object 			-> 		#model.
				#selector 			-> 		#addAsSubclassResponsabilitySelector.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		50.
				#label 			-> 		'push down to subclasses'.
				#object 			-> 		#model.
				#selector 			-> 		#pushDownSelectorToSubclasses.
				#icon 			-> 		#goBottomIcon
			} asDictionary.
			{
				#submenuOf -> 					RefactoringMenues refactoringsLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		60.
				#label 			-> 		'push down to one subclass'.
				#object 			-> 		#model.
				#selector 			-> 		#pushDownSelectorToOneSubclass.
				#icon 			-> 		#goBottomIcon
			} asDictionary.
			
		}`.
	!

CodeFileBrowserWindow removeSelector: #messageListMenu!

!methodRemoval: CodeFileBrowserWindow #messageListMenu stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListMenu
	| aMenu itemColl |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Message List'.
	itemColl := OrderedCollection new.
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
		itemColl add:
			{#label -> 'fileIn'. #object -> #model. #selector -> #fileInMessage. #icon -> #updateIcon} asDictionary ].
	itemColl addAll:
		{
			{#label -> 'fileOut'. #object -> #model. #selector -> #fileOutMessage. #icon -> #fileOutIcon} asDictionary. 
			nil
		}.
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
		itemColl addAll:
			{
				{#label -> 'senders (n)'. #selector -> #browseSenders. #icon -> #mailForwardIcon} asDictionary. 
				{#label -> 'implementors (m)'. #selector -> #browseImplementors. #icon -> #developmentIcon} asDictionary. 
				{#label -> 'method inheritance (h)'. #selector -> #methodInheritance. #icon -> #goDownIcon} asDictionary. 
				{#label -> 'versions (v)'. #selector -> #browseVersions. #icon -> #clockIcon} asDictionary
			} ].
	itemColl addAll:
		{
			nil. 
			{#label -> 'remove method (x)'. #object -> #model. #selector -> #removeMessage. #icon -> #deleteIcon} asDictionary
		}.
	aMenu addItemsFromDictionaries: itemColl.
	^ aMenu.!

CodeFileBrowserWindow removeSelector: #messageListKey:from:!

!methodRemoval: CodeFileBrowserWindow #messageListKey:from: stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $b ifTrue: [^ self browseMethodFull].
	super messageListKey: aChar from: view!

BrowserWindow class removeSelector: #messageListMenu2Options!

!methodRemoval: BrowserWindow class #messageListMenu2Options stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListMenu2Options
	
	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'toggle diffing (D)'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleDiffing.
				#icon 			-> 		#switchIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'implementors of sent messages'.
				#selector 			-> 		#browseAllMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'local senders of...'.
				#selector 			-> 		#browseLocalSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'local implementors of...'.
				#selector 			-> 		#browseLocalImplementors.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'sample instance'.
				#selector 			-> 		#makeSampleInstance.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'inspect instances'.
				#selector 			-> 		#inspectInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'inspect subinstances'.
				#selector 			-> 		#inspectSubInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		40.
				#label 			-> 		'change category...'.
				#object 			-> 		#model.
				#selector 			-> 		#changeCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		50.
				#label 			-> 		'change sets with this method'.
				#selector 			-> 		#findMethodInChangeSets.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		60.
				#label 			-> 		'revert to previous version'.
				#object 			-> 		#model.
				#selector 			-> 		#revertToPreviousVersion.
				#icon 			-> 		#undoIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'more...'.
				#selector 			-> 		#openMessageListMenu.
				#icon 			-> 		#listAddIcon
			} asDictionary.			
		}`!

BrowserWindow class removeSelector: #messageListMenuOptions!

!methodRemoval: BrowserWindow class #messageListMenuOptions stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'what to show...'.
				#selector 			-> 		#offerWhatToShowMenu.
				#icon 			-> 		#preferencesIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'toggle break on entry'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleBreakOnEntry.
				#icon 			-> 		#debugIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'browse full (b)'.
				#selector 			-> 		#browseMethodFull.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#browseHierarchy.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'browse method (O)'.
				#selector 			-> 		#openSingleMessageBrowser.
				#icon 			-> 		#scriptIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		40.
				#label 			-> 		'browse protocol (p)'.
				#selector 			-> 		#browseFullProtocol.
				#icon 			-> 		#spreadsheetIcon
			} asDictionary.
			{	#itemGroup  			-> 		20.
				#itemOrder  			-> 		50.
				#label            			-> 		'browse method category (c)'.
				#selector       			-> 		#browseCategoryOfCurrentMethod.
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'fileOut'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutMessage.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'inspect CompiledMethod'.
				#object 			-> 		#model.
				#selector 			-> 		#inspectCompiledMethod.
				#icon 			-> 		#exploreIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'senders of... (n)'.
				#selector 			-> 		#browseSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'implementors of... (m)'.
				#selector 			-> 		#browseMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'inheritance (i)'.
				#selector 			-> 		#methodInheritance.
				#icon 			-> 		#goDownIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		40.
				#label 			-> 		'versions (v)'.
				#selector 			-> 		#browseVersions.
				#icon 			-> 		#clockIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'inst var refs...'.
				#selector 			-> 		#browseInstVarRefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		20.
				#label 			-> 		'inst var defs...'.
				#selector 			-> 		#browseInstVarDefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		30.
				#label 			-> 		'class var refs...'.
				#selector 			-> 		#browseClassVarRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		40.
				#label 			-> 		'class variables'.
				#selector 			-> 		#browseClassVariables.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		50.
				#label 			-> 		'class refs (N)'.
				#selector 			-> 		#browseClassRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		10.
				#label 			-> 		'remove method (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeMessage.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		20.
				#label 			-> 		'remove method in hierarchy'.
				#object 			-> 		#model.
				#selector 			-> 		#removeMessageInHierarchy.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		30.
				#label 			-> 		'run test (t)'.
				#object 			-> 		#model.
				#selector 			-> 		#runMethodTest.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		40.
				#label 			-> 		'debug test (r)'.
				#object 			-> 		#model.
				#selector 			-> 		#debugMethodTest.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		70.
				#itemOrder 			-> 		10.
				#label 			-> 		'more...'.
				#selector 			-> 		#openMessageListMenu2.
				#icon 			-> 		#listAddIcon
			} asDictionary.
		}`.
	!

BrowserWindow removeSelector: #openMessageListMenu!

!methodRemoval: BrowserWindow #openMessageListMenu stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
openMessageListMenu
	"Offer the unshifted selector-list menu"

	^ self messageListMenu popUpInWorld!

BrowserWindow removeSelector: #messageListMenu2!

!methodRemoval: BrowserWindow #messageListMenu2 stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListMenu2
	"Fill aMenu with the items appropriate when the shift key is held down"

	self flag: #assumesKeyboardShortcuts.
	^DynamicMenuBuilder 
		buildTitled: 'Message List' 
		targeting: self 
		collectingMenuOptionsWith: #messageListMenu2Options 
		changingThemWith: [ :options |
			self addExtraMenu2ItemsTo: options.
			model canShowMultipleMessageCategories ifTrue: [	
				options add: `{ 
					#itemGroup 			-> 		40.
					#itemOrder 			-> 		45.		
					#label 			-> 		'show category (C)'.
					#object 			-> 		#model.
					#selector 			-> 		#showHomeCategory.
					#icon 			-> 		#packageIcon
				} asDictionary` ]].
!

BrowserWindow removeSelector: #messageListMenu!

!methodRemoval: BrowserWindow #messageListMenu stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListMenu
	"Answer the message-list menu"

	^DynamicMenuBuilder buildTitled: 'Message List' targeting: self collectingMenuOptionsWith: #messageListMenuOptions.
	!

BrowserWindow removeSelector: #messageListKey:from:!

!methodRemoval: BrowserWindow #messageListKey:from: stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also
	have a listView that has a list of methods.  The view knows how to get
	the list and selection."

	| sel |
	self flag: #definesKeyboardShortcuts.
	sel := model selectedMessageName.
	sel
		ifNotNil: [
			"The following require a method selection"
			aChar = $c ifTrue: [ ^ self browseCategoryOfCurrentMethod ].
			aChar = $R ifTrue: [^ model renameSelector].
			aChar = $A ifTrue: [^ model addParameter ].
			aChar = $S ifTrue: [^ model removeParameter ].
			aChar = $F ifTrue: [^ model inlineMethod ]].
	super messageListKey: aChar from: view!

BrowserWindow removeSelector: #addExtraMenu2ItemsTo:!

!methodRemoval: BrowserWindow #addExtraMenu2ItemsTo: stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
addExtraMenu2ItemsTo: optoins
	"The shifted selector-list menu is being built; some menu items are appropriate only for certain kinds of browsers, and this gives a hook for them to be added as approrpiate.  If any is added here, a line should be added first -- browse reimplementors of this message for examples."!

BrowserWindow removeSelector: #openMessageListMenu2!

!methodRemoval: BrowserWindow #openMessageListMenu2 stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
openMessageListMenu2
	"Offer the additional selector-list menu"

	^ self messageListMenu2 popUpInWorld!

CodeWindow removeSelector: #messageListKey:from:!

!methodRemoval: CodeWindow #messageListKey:from: stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
messageListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also
	have a listView that has a list of methods.  The view knows how to get
	the list and selection."

	| sel class |
	self flag: #definesKeyboardShortcuts.
	aChar = $D ifTrue: [^ model toggleDiffing].

	sel := model selectedMessageName.
	aChar = $m ifTrue: [  "These next two put up a type in if no message selected"
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllImplementorsOf: to: Smalltalk].
	aChar = $n ifTrue: [
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllCallsOn: to: Smalltalk].

	"The following require a class selection"
	(class := model selectedClassOrMetaClass) ifNil: [^ self ].
	aChar = $b ifTrue: [^ BrowserWindow fullOnClass: class selector: sel].
	aChar = $N ifTrue: [^ self browseClassRefs].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $p ifTrue: [^ self browseFullProtocol].

	sel
		ifNotNil: [
			"The following require a method selection"
			aChar = $i ifTrue: [^ self methodInheritance].
			aChar = $o ifTrue: [^ model fileOutMessage].
			aChar = $c ifTrue: [^ model copySelector].
			aChar = $v ifTrue: [^ self browseVersions].
			aChar = $C ifTrue: [^ model showHomeCategory].
			aChar = $O ifTrue: [^ self openSingleMessageBrowser].
			aChar = $x ifTrue: [^ model removeMessage].
			aChar = $t ifTrue: [^ model runMethodTest].
			aChar = $r ifTrue: [^ model debugMethodTest]]
		ifNil: [
			aChar = $R ifTrue: [^ model renameClass]]!

Browser removeSelector: #canShowMultipleMessageCategories!

!methodRemoval: Browser #canShowMultipleMessageCategories stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
canShowMultipleMessageCategories
	"Answer whether the receiver is capable of showing multiple message categories"

	^ true!

CodeProvider removeSelector: #canShowMultipleMessageCategories!

!methodRemoval: CodeProvider #canShowMultipleMessageCategories stamp: 'Install-6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st 6/6/2024 11:37:55'!
canShowMultipleMessageCategories
	"Answer whether the receiver is capable of showing multiple message categories"

	^ false!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6434-NewMenuSpecs-Browser-MessageList-JuanVuletich-2024Jun04-06h22m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6433] on 4 June 2024 at 9:51:10 am'!
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:47:19'!
     codeFileListMenuSpec
	"Spec for the menu and shortcut keys for the single entry filename list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := 
			#(
				#(0 		'Code File' 			false)
				#(10		'find class... (f)' 					$f 	window 			findClass)
				#(20 		'-----')
			).
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
			answer := answer, #(
				#(30		'fileIn' 					nil 	model 			fileIn) )].
	answer := answer, 
			#(
				#(40		'fileOut' 					nil 	model 			fileOut) ).
	self model caseCodeSource isLiveSmalltalkImage ifFalse: [
		answer := answer, #(
				#(50		'remove existing' 					nil 	model 			removeUnmodifiedClasses) )].
	^answer! !
!CodeFileBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/4/2024 09:49:27' prior: 50343467 overrides: 16799397!
                        buildMorphicWindow
	"Create a pluggable version of all the views for a Browser, using Morphic widgets."

	| sysCatList msgCatList upperPanes clsLayout clsList msgList |
	model setSelectedSystemCategory: model systemCategoryList first.
	sysCatList := (PluggableListMorph
			withModel: model 
			listGetter: #systemCategorySingleton
			indexGetter: #indexIsOne 
			indexSetter: #indexIsOne:)
				menuNshortcutsKey: #codeFileListMenuSpec.
	sysCatList hideScrollBarsIndefinitely.
	
	msgCatList := (PluggableListMorph
			withModel: model 
			listGetter: #messageCategoryList
			indexGetter: #messageCategoryListIndex 
			indexSetter: #messageCategoryListIndex:)
				menuNshortcutsKey: #methodCategoriesListMenuSpec.

	clsList := self buildMorphicClassList.
	clsLayout := self buildMorphicClassColumnWith: clsList.
	msgList := self buildMorphicMessageList.

	upperPanes := LayoutMorph newRow.
	upperPanes
		addMorph: clsLayout proportionalWidth: 0.3;
		addAdjusterAndMorph: msgCatList proportionalWidth: 0.3;
		addAdjusterAndMorph: msgList proportionalWidth: 0.4.

	self layoutMorph
		addMorph: sysCatList fixedHeight: (Preferences at: #standardCodeFont) lineSpacing + 10;
		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.
	model changed: #editSelection! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:31:49' prior: 50342026 overrides: 50341888!
                 classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Class List' 			false)
				#(10		'definition' 					nil 	model 			editClass 						editFindReplaceIcon)
				#(20		'comment' 					nil 	model 			editComment 						editFindReplaceIcon)
				#(30 		'-----')
				#(40		'browse full (b)' 					$b 	window 			browseMethodFull 						editFindReplaceIcon)
				#(50		'class refs (N)' 					$N 	window 			browseClassRefs 						classIcon)
				#(60 		'-----')
				#(70		'fileIn' 					nil 	model 			fileInClass 						updateIcon)
				#(80		'fileOut' 					nil 	model 			fileOutClass 						fileOutIcon)
				#(90 		'-----')
				#(100		'rename...' 					nil 	model 			renameClass 						saveAsIcon)
				#(110		'remove' 					nil 	model 			removeClass 						listRemoveIcon)
				#(120 		'-----')
				#(130		'remove existing' 					nil 	model 			removeClass 						deleteIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Class List' 			false)
				#(10		'definition' 					nil 	model 			editClass 						editFindReplaceIcon)
				#(20		'comment' 					nil 	model 			editComment 						editFindReplaceIcon)
				#(30 		'-----')
				#(80		'fileOut' 					nil 	model 			fileOutClass 						fileOutIcon)
				#(90 		'-----')
				#(100		'rename...' 					nil 	model 			renameClass 						saveAsIcon)
				#(110		'remove' 					nil 	model 			removeClass 						listRemoveIcon)
				#(120 		'-----')
				#(130		'remove existing' 					nil 	model 			removeClass 						deleteIcon)
			) ].! !

CodeFileBrowserWindow removeSelector: #codeFileListMenu!

!methodRemoval: CodeFileBrowserWindow #codeFileListMenu stamp: 'Install-6435-NewMenuSpecs-CodeFileBrowser-codeFileList-JuanVuletich-2024Jun04-08h24m-jmv.001.cs.st 6/6/2024 11:37:56'!
codeFileListMenu
	| aMenu itemColl |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Code File'.
	itemColl := OrderedCollection new.
	itemColl addAll:
		{
			{#label -> 'find class... (f)'. #selector -> #findClass} asDictionary. 
			nil
		}.
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
		itemColl add:
			{#label -> 'fileIn'. #object -> #model. #selector -> #fileIn} asDictionary ].
	itemColl add:
		{#label -> 'fileOut'. #object -> #model. #selector -> #fileOut} asDictionary.
	self model caseCodeSource isLiveSmalltalkImage ifFalse: [
		itemColl add:
			{#label -> 'remove existing'. #object -> #model. #selector -> #removeUnmodifiedClasses} asDictionary ].
	aMenu addItemsFromDictionaries: itemColl.
	^ aMenu.!

CodeFileBrowserWindow removeSelector: #codeFileListKey:from:!

!methodRemoval: CodeFileBrowserWindow #codeFileListKey:from: stamp: 'Install-6435-NewMenuSpecs-CodeFileBrowser-codeFileList-JuanVuletich-2024Jun04-08h24m-jmv.001.cs.st 6/6/2024 11:37:56'!
codeFileListKey: aChar from: view

	self flag: #definesKeyboardShortcuts.
	aChar = $f ifTrue: [^ self findClass]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6435-NewMenuSpecs-CodeFileBrowser-codeFileList-JuanVuletich-2024Jun04-08h24m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6433] on 4 June 2024 at 9:52:55 am'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:51:30' prior: 50341888!
                        classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(30		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(40 		'-----')
		#(50		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(60		'run tests (t)' 							$t 	model 			runClassTests 									weatherFewCloudsIcon)
		#(70 		'-----')
		#(80		'rename class... (R)' 							$R 	model 			renameClass 									saveAsIcon)
		#(90		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(100		'copy class...' 							nil 	model 			copyClass 									copyIcon)
		#(110		'remove class (x)' 							$x 	model 			removeClass 									deleteIcon)
		#(120 		'-----')
		#(130		'show classes hierarchically' 							nil 	model 			enableListClassesHierarchically 									goTopIcon)
		#(140		'show classes alphabetically' 							nil 	model 			enableListClassesAlphabetically 									sendReceiveIcon)
		#(150		'show definition' 							nil 	model 			editClass 									editFindReplaceIcon)
		#(160		'show comment' 							nil 	model 			editComment 									editFindReplaceIcon)
		#(170 		'-----')
		#(180		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(190		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(200 		'-----')
		#(210		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(220		'class vars' 							nil 	window 			browseClassVariables 									classIcon)
		#(230		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(240 		'-----')
		#(250		'more' 							nil 	nil 			2000 									listAddIcon)
		#(260		nil 							$r 	model 			recent) "Shortcut only. No menu entry."

		" 'refactorings' SubMenu"
		#(1010		'insert superclass...' 							nil 	model 			insertSuperclass 									saveAsIcon)
		#(1020 		'-----')
		#(1030		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)
		#(1040		'rename inst var...' 							nil 	model 			renameInstVar 									saveAsIcon)
		#(1050		'remove inst var...' 							nil 	model 			removeInstVar 									deleteIcon)
		#(1060		'remove all unreferenced inst var...' 						
											nil 	model 			removeAllUnreferencedInstVar 									deleteIcon)
		#(1070		'push up inst var...' 							nil 	model 			pushUpInstanceVariable 									goTopIcon)
		#(1080		'push down inst var...' 							nil 	model 			pushDownInstanceVariable 									goBottomIcon)
		#(1090 		'-----')
		#(1100		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)

		" 'more' SubMenu"
		#(2010		'unsent methods' 							nil 	window 			browseUnusedMethods 									junkIcon
					'browse all methods defined by this class that have no senders')
		#(2020		'unreferenced inst vars' 							nil 	window 			showUnreferencedInstVars 									junkIcon
					'show a list of all instance variables that are not referenced in methods')
		#(2030		'unreferenced class vars' 							nil 	window 			showUnreferencedClassVars 									junkIcon
					'show a list of all class variables that are not referenced in methods')
		#(2040		'subclass template' 							nil 	model 			makeNewSubclass 									classIcon
					'put a template into the code pane for defining of a subclass of this class')
		#(2050 		'-----')
		#(2060		'sample instance' 							nil 	window 			makeSampleInstance 									instanceIcon
					'give me a sample instance of this class, if possible')
		#(2070		'inspect instances' 							nil 	window 			inspectInstances 									inspectIcon
					'open an inspector on all the extant instances of this class')
		#(2080		'inspect subinstances' 							nil 	window 			inspectSubInstances 									inspectIcon
					'open an inspector on all the extant instances of this class and of all of its subclasses')
		#(2090 		'-----')
		#(2100		'create inst var accessors' 							nil 	model 			createInstVarAccessors 									sendReceiveIcon
					'compile instance-variable access methods for any instance variables that do not yet have them')
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:51:38' prior: 50343686!
 messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message List' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(80		'browse method category (c)' 							$c 	window 			browseCategoryOfCurrentMethod 									editFindReplaceIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(150		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(160		'senders of... (n)' 							$n 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(170		'implementors of... (m)' 							$m 	window 			browseMessages 									developmentIcon)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(280		'remove method in hierarchy' 							nil 	model 			removeMessageInHierarchy 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'refactorings' SubMenu"
		#(1010		'rename... (R)' 											$R 	model 			renameSelector 											saveAsIcon)
		#(1020		'change keyword order...' 											nil 	model 			changeKeywordOrder 											sendReceiveIcon)
		#(1030		'add parameter... (A)' 											$A 	model 			addParameter 											listAddIcon)
		#(1040		'remove parameter... (S)' 											$S 	model 			removeParameter 											listRemoveIcon)
		#(1050 		'-----')
		#(1060		'inline method... (F)' 											$F 	model 			inlineMethod 											saveAsIcon)
		#(1070		'move to instance/class method' 											nil 	model 			moveToInstanceOrClassMethod 											changesIcon)
		#(1080		'push up' 											nil 	model 			pushUpSelector 											goTopIcon)
		#(1090		'add in superclass as subclassResponsability' 											nil 	model 			addAsSubclassResponsabilitySelector 											goTopIcon)
		#(1100		'push down to subclasses' 											nil 	model 			pushDownSelectorToSubclasses 											goBottomIcon)
		#(1110		'push down to one subclass' 											nil 	model 			pushDownSelectorToOneSubclass 											goBottomIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2110		'show category (C)' 								$C 	model 			showHomeCategory 									packageIcon)
		#(2120		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2130		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:51:42' prior: 50343285!
                             methodCategoriesListMenuSpec
	"Spec for the menu and shortcut keys for the method categories list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message Categories' 					false)
		#(10		'fileOut (o)' 								$o 	model 			fileOutMessageCategories 										fileOutIcon)
		#(20 		'-----')
		#(30		'reorganize (r)' 								$r 	model 			editMessageCategories 										sendReceiveIcon)
		#(40		'alphabetize (a)' 								$a 	model 			alphabetizeMessageCategories 										fontXGenericIcon)
		#(50		'remove empty categories (e)' 								$e 	model 			removeEmptyCategories 										listRemoveIcon)
		#(60		'categorize all uncategorized (c)' 								$c 	model 			categorizeAllUncategorizedMethods 										packageIcon)
		#(70		'new category... (n)' 								$n 	model 			addCategory 										newIcon)
		#(80		'new extension category... (N)' 								$N 	model 			addExtensionCategory 										listAddIcon)
		#(90 		'-----')
		#(100		'rename... (R)' 								$R 	model 			renameCategory 										saveAsIcon)
		#(110		'remove (x)' 								$x 	model 			removeMessageCategory 										deleteIcon)
		#(120 		'-----')
		#(130		'run tests (t)' 								$t 	model 			runMessageCategoryTests 										weatherFewCloudsIcon)
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:51:47' prior: 50343377!
                           systemCatSingletonMenuSpec
	"Spec for the menu and shortcut keys for the one-item system category list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class category' 					false)
		#(10		'find class... (f)' 						$f 	window 			findClass 									findIcon)
		#(20 		'-----')
		#(30		'browse all (B)' 						$B 	window 			browseAllClasses 									editFindReplaceIcon)
		#(40		'browse (b)' 						$b 	window 			openSystemCategoryBrowser 									packageIcon)
		#(50 		'-----')
		#(60		'fileOut (o)' 						$o 	model 			fileOutSystemCategory 									fileOutIcon)
		#(70 		'-----')
		#(80		'update (u)' 						$u 	model 			updateSystemCategories 									updateIcon)
		#(90		'rename... (R)' 						$R 	model 			renameSystemCategory 									saveAsIcon)
		#(100		'remove (x)' 						$x 	model 			removeSystemCategory 									deleteIcon)
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:51:56' prior: 50343407!
                         systemCategoriesListMenuSpec
	"Spec for the menu and shortcut keys for the system categories list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class Categories' 					false)
		#(10		'find class... (f)' 						$f 	window 			findClass 									findIcon)
		#(20		'recent classes... (r)' 						$r 	model 			recent 									clockIcon)
		#(30 		'-----')
		#(40		'browse all (B)' 						$B 	window 			browseAllClasses 									editFindReplaceIcon)
		#(50		'browse (b)' 						$b 	window 			openSystemCategoryBrowser 									packageIcon)
		#(60 		'-----')
		#(70		'fileOut (o)' 						$o 	model 			fileOutSystemCategory 									fileOutIcon)
		#(80 		'-----')
		#(90		'reorganize' 						nil 	model 			editSystemCategories 									sendReceiveIcon)
		#(100		'alphabetize (A)' 						$A 	model 			alphabetizeSystemCategories 									fontXGenericIcon)
		#(110 		'-----')
		#(120		'update (u)' 						$u 	model 			updateSystemCategories 									updateIcon)
		#(130		'add item... (a)' 						$a 	model 			addSystemCategory 									newIcon)
		#(140		'rename... (R)' 						$R 	model 			renameSystemCategory 									saveAsIcon)
		#(150		'move to... (m)' 						$m 	model 			moveAllToOtherSystemCategory 									saveAsIcon)
		#(160		'remove (x)' 						$x 	model 			removeSystemCategory 									deleteIcon)
		#(170 		'-----')
		#(180		'move to top' 						nil 	model 			moveSystemCategoryTop 									goTopIcon)
		#(190		'move up' 						nil 	model 			moveSystemCategoryUp 									goUpIcon)
		#(200		'move down' 						nil 	model 			moveSystemCategoryDown 									goDownIcon)
		#(210		'move to bottom' 						nil 	model 			moveSystemCategoryBottom 									fileOutIcon)
		#(220 		'-----')
		#(230		'run tests (t)' 						$t 	model 			runSystemCategoryTests 									weatherFewCloudsIcon)
	)! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:10' prior: 50344594!
     codeFileListMenuSpec
	"Spec for the menu and shortcut keys for the single entry filename list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := 
			#(
				#(0 		'Code File' 			false)
				#(10		'find class... (f)' 					$f 	window 			findClass)
				#(20 		'-----') ).
	self model baseCodeSource isLiveSmalltalkImage ifTrue: [
			answer := answer, #(
				#(30		'fileIn' 					nil 	model 			fileIn) )].
	answer := answer, 
			#(
				#(40		'fileOut' 					nil 	model 			fileOut) ).
	self model caseCodeSource isLiveSmalltalkImage ifFalse: [
		answer := answer, #(
				#(50		'remove existing' 					nil 	model 			removeUnmodifiedClasses) )].
	^answer! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:15' prior: 50343836 overrides: 50344906!
                   messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^ self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Messages' 			false)
				#(10		'fileIn' 						nil 	model 			fileInMessage 							updateIcon)
				#(20		'fileOut' 						nil 	model 			fileOutMessage 							fileOutIcon)
				#(30 		'-----')
				#(40		'senders (n)' 						$n 	window 			browseSenders 							mailForwardIcon)
				#(50		'implementors (m)' 						$m 	window 			browseImplementors 							developmentIcon)
				#(60		'method inheritance (h)' 						$h 	window 			methodInheritance 							goDownIcon)
				#(70		'browse full (b)' 						$b 	window 			browseMethodFull 							editFindReplaceIcon)
				#(80		'versions (v)' 						nil 	window 			browseVersions 							clockIcon)
				#(90 		'-----')
				#(100		'remove method (x)' 						$x 	model 			removeMessage 							deleteIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Messages' 			false)
				#(10		'fileOut' 						nil 	model 			fileOutMessage 							fileOutIcon)
				#(20 		'-----')
				#(30		'remove method (x)' 						$x 	model 			removeMessage 							deleteIcon)
			)].! !
!CodeFileBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:18' prior: 50343327 overrides: 50345056!
                   methodCategoriesListMenuSpec
	"Spec for the menu and shortcut keys for the method categories list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := self model baseCodeSource isLiveSmalltalkImage
		ifTrue: [
			#(
				#(0 		'Message Categories' 			false)
				#(10		'fileIn' 					nil 	model 			fileInMessageCategories 								updateIcon)
			)]
		ifFalse: [
			#(
				#(0 		'Message Categories' 			false)
			)].
	answer := answer, 
			#(
				#(20		'fileOut' 					nil 	model 			fileOutMessageCategories 								fileOutIcon)
				#(30 		'-----')
				#(40		'reorganize' 					nil 	model 			editMessageCategories 								sendReceiveIcon)
				#(50 		'-----')
				#(60		'add item...' 					nil 	model 			addCategory 								newIcon)
				#(70 		'-----')
				#(80		'rename...' 					nil 	model 			renameCategory 								saveAsIcon)
				#(90		'remove' 					nil 	model 			removeMessageCategory 								listRemoveIcon)
			).
	self model caseCodeSource isLiveSmalltalkImage ifFalse: [
		answer := answer, #(
				#(100 		'-----')
				#(100		'remove existing' 					nil 	model 			removeUnmodifiedMethods 								deleteIcon)
		) ].
	^answer! !
!ChangeListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:23' prior: 50342078!
                listMenuSpec
	"Spec for the menu and shortcut keys for the changes list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Change List' 									true)
		#(10		'fileIn selections' 									nil 	model 			fileInSelections 										nil
					'import the selected items into the image')
		#(20		'fileOut selections...	' 								nil 	model 			fileOutSelections 										nil
		 			'create a new file containing the selected items')
		#(30		'fileOut current version of selections...' 					nil 					model 			fileOutCurrentVersionsOfSelections 										nil
 					'create a new file containing the current (in-image) counterparts of the selected methods')
		#(40 		'-----')
		#(50		'compare to current' 									nil 	model 			compareToCurrentVersion 										nil
 					'open a separate window which shows the text differences between the on-file version and the in-image version.')
		#(60		'toggle diffing (D)' 									$D 	model 			toggleDiffing 										nil
 					'start or stop showing diffs in the code pane.')
		#(70 		'-----')
		#(80		'select new methods' 									nil 	model 			selectNewMethods 										nil
 					'select methods in the file that do not currently exist in the image')
		#(90		'select changes for absent classes' 									nil 	model 			selectAllForAbsentClasses 										nil
					'select methods in the file for classes that are not defined in the image')
		#(100		'select all changes for this class' 									nil 	model 			selectAllForThisClass 										nil
					'select all methods in the file that belong to the currently-selected class')
		#(110		'select unchanged methods' 									nil 	model 			selectUnchangedMethods 										nil
					'select methods in the file whose in-image versions are the same as their in-file counterparts')
		#(120		'select methods equivalent to current' 									nil 	model 			selectEquivalentMethods 										nil
					'select methods in the file whose in-image versions have the same behavior as their in-file counterparts')
		#(130		'select methods older than current' 									nil 	model 			selectMethodsOlderThanCurrent 										nil
					'select methods in the file that are older than the one currently in the image')
		#(140		'select removals of sent methods' 									nil 	model 			selectRemovalsOfSent 										nil
					'select all method removals of methods that have some sender in the image')
		#(150 		'-----')
		#(160		'select all (a)' 									$a 	model 			selectAll 										nil
					'select all the items in the list')
		#(170		'deselect all (A)' 									$A 	model 			deselectAll 										nil
					'deselect all the items in the list')
		#(180		'invert selections' 									nil 	model 			invertSelections 										nil
					'select every item that is not currently selected, and deselect every item that *is* currently selected')
		#(190 		'-----')
		#(200		'browse class and method' 									nil 	window 			browseMethodFull 										nil
					'open a full browser showing the selected method')
		#(210		'browse all versions of single selection' 									nil 	window 			browseVersions 										nil
					'open a version browser showing the versions of the currently selected method')
		#(220		'browse current versions of selections' 									nil 	window 			browseCurrentVersionsOfSelections 										nil
					'open a message-list browser showing the current (in-image) counterparts of the selected methods')
		#(230		'destroy current methods of selections' 									nil 	model 			destroyCurrentCodeOfSelections 										nil
					'remove (*destroy*) the in-image counterparts of all selected methods')
		#(240 		'-----')
		#(250		'remove doIts' 									nil 	model 			removeDoIts 										nil
					'remove all items that are doIts rather than definitions')
		#(260		'remove older versions' 									nil 	model 			removeOlderMethodVersions 										nil
					'remove all but the most recent versions of methods in the list')
		#(270		'remove up-to-date versions' 									nil 	model 			removeUpToDate 										nil
					'remove all items whose code is the same as the counterpart in-image code')
		#(280		'remove empty class comments' 									nil 	model 			removeEmptyClassComments 										nil
					'remove all empty class comments')
		#(290		'remove selected items' 									nil 	model 			removeSelections 										nil
					'remove the selected items from the change-list')
		#(300		'remove unselected items' 									nil 	model 			removeNonSelections 										nil
					'remove all the items not currently selected from the change-list')
	)! !
!VersionsBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:26' prior: 50336530 overrides: 50345292!
                    listMenuSpec
	"Spec for the menu and shortcut keys for the versions list."
	^model classCommentIndicated
		ifTrue: [ self classCommentVersionsMenuSpec ]
		ifFalse: [ self methodVersionsMenuSpec ]! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:29' prior: 50342316!
                  changeSetListMenuSpec
	"Spec for the menu and shortcut keys for the changesets list.
	See coment at Morph >> #getMenu
	"
	| answer |
	answer := #(
			#(0 		'Change Set' 						true)
			#(10 		'File out and remove (o)' 							$o 	model 			fileOutAndRemove 								fileOutIcon)
			#(20 		'File out and keep (k)' 							$k 	model 			fileOutAndKeep 								fileOutIcon)
			#(30 		'-----')
			#(40 		'Rename change set (R)' 					 		$R 	model 			rename 								saveAsIcon)
			#(50 		'Destroy change set (x)' 			 				$x 	model 			remove 								warningIcon)
	).
	model currentCanHavePreambleAndPostscript ifTrue: [
		model currentHasPreamble
			ifTrue: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Edit preamble (p)' 						$p 	model 			addPreamble 								textEditorIcon)
				#(80 		'Remove preamble' 						nil 	model 			removePreamble 								listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(60 		'-----')
				#(70 		'Add preamble (p)' 						$p 	model 			addPreamble 								listAddIcon) )].
		model currentHasPostscript
			ifTrue: [ answer  := answer, #(
				#(90 		'Edit postscript...' 						nil 	model 			editPostscript 								textEditorIcon)
				#(100 		'Remove postscript' 						nil 	model 			removePostscript 								listRemoveIcon)) ]
			ifFalse: [ answer  := answer, #(
				#(90 		'Add postscript...' 						nil 	model 			editPostscript 								listAddIcon) )].
	].

	answer  := answer, #(
		#(110 		'-----')
		#(120 		'conflicts with other change sets' 								nil 	window			browseMethodConflicts 								emblemImportantIcon
			'Browse all methods that occur both in this change set and in at least one other change set.')
		#(130 		'-----')
		#(140 		'trim history' 								nil 	model			trimHistory 								clockIcon
			'Drops any methods added and then removed, as well as renaming and reorganization of newly-added classes.
 NOTE: can cause confusion if later filed in over an earlier version of these changes.')
		#(150 		'view affected class categories' 								nil 	model 			viewAffectedClassCategories 								packageIcon
			'Show class categories affected by any contained change')
	).
	model csIsForBase ifFalse: [ "Maybe disable a few: Copy them the same as above, but without selector."
		answer := answer, #(
			#(40 		'Rename change set (R)' 					 		$R 	model 			nil 								saveAsIcon)
			#(50 		'Destroy change set (x)' 			 				$x 	model 			nil 								warningIcon)
			#(140 		'trim history' 							nil 	model			nil 								clockIcon)) ].
	^answer! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:36' prior: 50342397!
                              classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^#(
			#(0 		'Class List' 						false)
			#(10 		'delete class from change set (d)' 								$d 	model 			forgetClass 						warningIcon)
			#(20 		'remove class from system (x)' 								$x 	model 			removeClass 						deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 								$b 	window 			browseMethodFull 						editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 								$h 	window 			browseHierarchy 						goTopIcon)
			#(60 		'browse protocol (p)' 								$p 	window 			browseFullProtocol 						spreadsheetIcon)
			#(70 		'-----')		
			#(80 		'inst var refs...' 								nil 	window 			browseInstVarRefs 						instanceIcon)
			#(90 		'inst var defs...' 								nil 	window 			browseInstVarDefs 						instanceIcon)
			#(100 		'class var refs...' 								nil 	window 			browseClassVarRefs 						classIcon)
			#(110 		'class vars' 								nil 	window 			browseClassVariables 						classIcon)
			#(120 		'class refs (N)' 								$N 	window 			browseClassRefs 						classIcon)
	).
! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 09:52:39' prior: 50342435!
        messageListMenuSpec
	"Spec for the menu and shortcut keys for the message list.
	See coment at Morph >> #getMenu
	"
	^#(
			#(0 		'Message List' 						true)
			#(10 		'delete method from change set (d)' 									$d 	model 			forget 								warningIcon)
			#(20 		'remove method from system (x)' 									$x 	model 			removeMessage 								deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 									$b 	window 			browseMethodFull 								editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 									$h 	window 			browseHierarchy 								goTopIcon)
			#(60 		'browse method (O)' 									$O 	window 			openSingleMessageBrowser 								scriptIcon)
			#(70 		'browse protocol (p)' 									$p 	window 			browseFullProtocol 								spreadsheetIcon)
			#(80 		'-----')		
			#(90 		'fileOut (o)' 									$o 	model 			fileOutMessage 								fileOutIcon)
			#(100 		'-----')		
			#(110 		'senders of... (n)' 									$n 	window 			browseSendersOfMessages 								mailForwardIcon)
			#(120 		'implementors of... (m)' 									$m 	window 			browseMessages 								developmentIcon)
			#(130 		'inheritance (i)' 									$i 	window 			methodInheritance 								goDownIcon)
			#(140 		'versions (v)' 									$v 	window 			browseVersions 								clockIcon)
	).
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6436-Tweaks-JuanVuletich-2024Jun04-09h51m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6436] on 4 June 2024 at 11:12:16 am'!
!MethodSetWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:03:47'!
  messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message Set' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutMessage 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(161		nil 							$n 	window 			browseSenders 									mailForwardIcon)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(171		nil 							$m 	window 			browseImplementors 									developmentIcon)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100 		'remove from this browser' 								nil 	model 			removeMessageFromBrowser 									listRemoveIcon)
		#(2110 		'filter message list...' 								nil 	window 			filterMessageList 									findIcon)
		#(2120		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2130		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2140		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
		#(2150 		'-----')
		#(2160 		'sort by class hierarchy' 								nil 	model 			sortByClassHierarchy 									classIcon)
		#(2170 		'sort by class name' 								nil 	model 			sortByClassName 									classIcon)
		#(2180 		'sort by selector' 								nil 	model 			sortBySelector 									scriptIcon)
		#(2190 		'sort by date' 								nil 	model 			sortByDate 									dateIcon)
		#(2200 		'reverse sort' 								nil 	model 			sortReverse 									redoIcon)
	).
! !
!ProtocolBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 10:43:36' overrides: 50345617!
                 messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^ super messageListMenuSpec, #(
		#(80		'browse method category (c)' 							$c 	window 			browseCategoryOfCurrentMethod 									editFindReplaceIcon)
		#(2100 		'XXremove from this browser')
		#(2110 		'XXfilter message list...'))! !
!MethodSetWindow methodsFor: 'GUI building' stamp: 'jmv 6/4/2024 10:35:53' prior: 50333039!
    buildMorphicMessageList
	"Build a morphic message list, with #messageList as its list-getter"

	^(PluggableListMorph
		withModel: model
		listGetter: #messageList
		indexGetter: #messageListIndex
		indexSetter: #messageListIndex:)
			menuNshortcutsKey: #messageListMenuSpec.! !

MethodSetWindow class removeSelector: #messageSetMenuOptions!

!methodRemoval: MethodSetWindow class #messageSetMenuOptions stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
messageSetMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'what to show...'.
				#selector 			-> 		#offerWhatToShowMenu.
				#icon 			-> 		#preferencesIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'toggle break on entry'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleBreakOnEntry.
				#icon 			-> 		#debugIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'browse full (b)'.
				#selector 			-> 		#browseMethodFull.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#browseHierarchy.
				#icon 			-> 		#goTopIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'browse method (O)'.
				#selector 			-> 		#openSingleMessageBrowser.
				#icon 			-> 		#scriptIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		40.
				#label 			-> 		'browse protocol (p)'.
				#selector 			-> 		#browseFullProtocol.
				#icon 			-> 		#spreadsheetIcon
			} asDictionary.
			{	#itemGroup  			-> 		20.
				#itemOrder  			-> 		50.
				#label            			-> 		'browse method category (c)'.
				#selector       			-> 			#browseCategoryOfCurrentMethod.
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'fileOut'.
				#object 			-> 		#model.
				#selector 			-> 		#fileOutMessage.
				#icon 			-> 		#fileOutIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'inspect CompiledMethod'.
				#object 			-> 		#model.
				#selector 			-> 		#inspectCompiledMethod.
				#icon 			-> 		#exploreIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'senders of... (n)'.
				#selector 			-> 		#browseSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'implementors of... (m)'.
				#selector 			-> 		#browseMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'inheritance (i)'.
				#selector 			-> 		#methodInheritance.
				#icon 			-> 		#goDownIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		40.
				#label 			-> 		'versions (v)'.
				#selector 			-> 		#browseVersions.
				#icon 			-> 		#clockIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'inst var refs...'.
				#selector 			-> 		#browseInstVarRefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		20.
				#label 			-> 		'inst var defs...'.
				#selector 			-> 		#browseInstVarDefs.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		30.
				#label 			-> 		'class var refs...'.
				#selector 			-> 		#browseClassVarRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		40.
				#label 			-> 		'class variables'.
				#selector 			-> 		#browseClassVariables.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		50.
				#label 			-> 		'class refs (N)'.
				#selector 			-> 		#browseClassRefs.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		10.
				#label 			-> 		'remove method (x)'.
				#object 			-> 		#model.
				#selector 			-> 		#removeMessage.
				#icon 			-> 		#deleteIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		20.
				#label 			-> 		'run test (t)'.
				#object 			-> 		#model.
				#selector 			-> 		#runMethodTest.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		60.
				#itemOrder 			-> 		30.
				#label 			-> 		'debug test (r)'.
				#object 			-> 		#model.
				#selector 			-> 		#debugMethodTest.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		70.
				#itemOrder 			-> 		10.
				#label 			-> 		'more...'.
				#selector 			-> 		#openMessageListMenu2.
				#icon 			-> 		#listAddIcon
			} asDictionary.
		}`.
	!

MethodSetWindow class removeSelector: #messageSetMenu2Options!

!methodRemoval: MethodSetWindow class #messageSetMenu2Options stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
messageSetMenu2Options
	
	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'toggle diffing (D)'.
				#object 			-> 		#model.
				#selector 			-> 		#toggleDiffing.
				#icon 			-> 		#switchIcon
			} asDictionary.
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'implementors of sent messages'.
				#selector 			-> 		#browseAllMessages.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'local senders of...'.
				#selector 			-> 		#browseLocalSendersOfMessages.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'local implementors of...'.
				#selector 			-> 		#browseLocalImplementors.
				#icon 			-> 		#classIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'sample instance'.
				#selector 			-> 		#makeSampleInstance.
				#icon 			-> 		#instanceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'inspect instances'.
				#selector 			-> 		#inspectInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'inspect subinstances'.
				#selector 			-> 		#inspectSubInstances.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		40.
				#label 			-> 		'change category...'.
				#object 			-> 		#model.
				#selector 			-> 		#changeCategory.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		50.
				#label 			-> 		'change sets with this method'.
				#selector 			-> 		#findMethodInChangeSets.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		60.
				#label 			-> 		'revert to previous version'.
				#object 			-> 		#model.
				#selector 			-> 		#revertToPreviousVersion.
				#icon 			-> 		#undoIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'more...'.
				#selector 			-> 		#openMessageListMenu.
				#icon 			-> 		#listAddIcon
			} asDictionary.			
		}`!

MethodSetWindow removeSelector: #openMessageListMenu!

!methodRemoval: MethodSetWindow #openMessageListMenu stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
openMessageListMenu
	"Offer the unshifted selector-list menu"

	^ self messageListMenu popUpInWorld!

MethodSetWindow removeSelector: #browseCategoryOfCurrentMethod!

!methodRemoval: MethodSetWindow #browseCategoryOfCurrentMethod stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
browseCategoryOfCurrentMethod

	model categoryOfCurrentMethod ifNotNil: [:category| |catIndex selectedMessage|
		selectedMessage := model selectedMessageName.
		catIndex := model classOrMetaClassOrganizer categories indexOf: category.
		model messageCategoryListIndex: catIndex + 1.
		model selectedMessageName: selectedMessage]!

MethodSetWindow removeSelector: #messageListMenu2!

!methodRemoval: MethodSetWindow #messageListMenu2 stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
messageListMenu2
	"Fill aMenu with the items appropriate when the shift key is held down"

	self flag: #assumesKeyboardShortcuts.
	^DynamicMenuBuilder 
		buildTitled: 'Message Set' 
		targeting: self 
		collectingMenuOptionsWith: #messageSetMenu2Options 
		changingThemWith: [ :options |
			self addExtraMenu2ItemsTo: options ].!

MethodSetWindow removeSelector: #messageListKey:from:!

!methodRemoval: MethodSetWindow #messageListKey:from: stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
messageListKey: aChar from: view
	"Respond to a Command key.  I am a model with a code pane, and I also
	have a listView that has a list of methods.  The view knows how to get
	the list and selection."

	| sel class |
	self flag: #definesKeyboardShortcuts.
	aChar = $D ifTrue: [^ model toggleDiffing].

	sel := model selectedMessageName.
	aChar = $m ifTrue: [  "These next two put up a type in if no message selected"
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllImplementorsOf: to: Smalltalk].
	aChar = $n ifTrue: [
		^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllCallsOn: to: Smalltalk].

	"The following require a class selection"
	(class := model selectedClassOrMetaClass) ifNil: [^ self ].
	aChar = $b ifTrue: [^ BrowserWindow fullOnClass: class selector: sel].
	aChar = $N ifTrue: [^ self browseClassRefs].
	aChar = $h ifTrue: [^ self browseHierarchy].
	aChar = $p ifTrue: [^ self browseFullProtocol].

	sel
		ifNotNil: [
			"The following require a method selection"
			aChar = $i ifTrue: [^ self methodInheritance].
			aChar = $o ifTrue: [^ model fileOutMessage].
			aChar = $c ifTrue: [^ model copySelector].
			aChar = $v ifTrue: [^ self browseVersions].
			aChar = $C ifTrue: [^ model showHomeCategory].
			aChar = $O ifTrue: [^ self openSingleMessageBrowser].
			aChar = $x ifTrue: [^ model removeMessage].
			aChar = $t ifTrue: [^ model runMethodTest].
			aChar = $r ifTrue: [^ model debugMethodTest]]
		ifNil: [
			aChar = $R ifTrue: [^ model renameClass]]!

MethodSetWindow removeSelector: #messageListMenu!

!methodRemoval: MethodSetWindow #messageListMenu stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
messageListMenu
	"Answer the message-list menu"

	^DynamicMenuBuilder buildTitled: 'Message Set' targeting: self collectingMenuOptionsWith: #messageSetMenuOptions.
	!

MethodSetWindow removeSelector: #addExtraMenu2ItemsTo:!

!methodRemoval: MethodSetWindow #addExtraMenu2ItemsTo: stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
addExtraMenu2ItemsTo: options
	"The shifted selector-list menu is being built.  Add items specific to MessageSet"

	model growable ifTrue: [
		options add: `{
			#itemGroup 			-> 		40.
			#itemOrder 			-> 		31.		
			#label 			-> 		'remove from this browser'.
			#object 			-> 		#model.
			#selector 			-> 		#removeMessageFromBrowser.
			#icon 			-> 		#listRemoveIcon 
		} asDictionary`.
		options add:`{
			#itemGroup 			-> 		40.
			#itemOrder 			-> 		32.		
			#label 			-> 		'filter message list...'.
			#selector 			-> 		#filterMessageList.
			#icon 			-> 		#findIcon
		} asDictionary`	].

	options add: `{
			#itemGroup 			-> 		41.
			#itemOrder 			-> 		33.		
			#label 			-> 		'sort by class hierarchy'.
			#object 			-> 		#model.	
			#selector 			-> 		#sortByClassHierarchy.
			#icon 			-> 		#classIcon
		} asDictionary`.
	options add: `{
			#itemGroup 			-> 		41.
			#itemOrder 			-> 		34.		
			#label 			-> 		'sort by class name'.
			#object 			-> 		#model.	
			#selector 			-> 		#sortByClassName.
			#icon 			-> 		#classIcon
		} asDictionary`.
	options add: `{
			#itemGroup 			-> 		41.
			#itemOrder 			-> 		35.		
			#label 			-> 		'sort by selector'.
			#object 			-> 		#model.	
			#selector 			-> 		#sortBySelector.
			#icon 			-> 		#scriptIcon
		} asDictionary`.
	options add: `{
			#itemGroup 			-> 		41.
			#itemOrder 			-> 		36.		
			#label 			-> 		'sort by date'.
			#object 			-> 		#model.	
			#selector 			-> 		#sortByDate.
			#icon 			-> 		#dateIcon
		} asDictionary`.
	options add: `{
			#itemGroup 			-> 		41.
			#itemOrder 			-> 		37.		
			#label 			-> 		'reverse sort'.
			#object 			-> 		#model.	
			#selector 			-> 		#sortReverse.
			#icon 			-> 		#redoIcon
		} asDictionary`.

!

MethodSetWindow removeSelector: #openMessageListMenu2!

!methodRemoval: MethodSetWindow #openMessageListMenu2 stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
openMessageListMenu2
	"Offer the additional selector-list menu"

	^ self messageListMenu2 popUpInWorld!

ProtocolBrowser removeSelector: #growable!

!methodRemoval: ProtocolBrowser #growable stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
growable
	"Answer whether the receiver is subject to manual additions and deletions"

	^ false!

MethodSet removeSelector: #growable!

!methodRemoval: MethodSet #growable stamp: 'Install-6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st 6/6/2024 11:37:56'!
growable
	"Answer whether the receiver is capable of growing/shrinking dynamically"

	^ true!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6437-NewMenuSpecs-MethodSet-MessageList-JuanVuletich-2024Jun04-10h56m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6436] on 4 June 2024 at 11:20:35 am'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:16:12' prior: 50344906!
                    messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message List' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(80		'browse method category (c)' 							$c 	window 			browseCategoryOfCurrentMethod 									editFindReplaceIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(150		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(161		nil 							$n 	window 			browseSenders)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(171		nil 							$m 	window 			browseImplementors)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(280		'remove method in hierarchy' 							nil 	model 			removeMessageInHierarchy 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'refactorings' SubMenu"
		#(1010		'rename... (R)' 											$R 	model 			renameSelector 											saveAsIcon)
		#(1020		'change keyword order...' 											nil 	model 			changeKeywordOrder 											sendReceiveIcon)
		#(1030		'add parameter... (A)' 											$A 	model 			addParameter 											listAddIcon)
		#(1040		'remove parameter... (S)' 											$S 	model 			removeParameter 											listRemoveIcon)
		#(1050 		'-----')
		#(1060		'inline method... (F)' 											$F 	model 			inlineMethod 											saveAsIcon)
		#(1070		'move to instance/class method' 											nil 	model 			moveToInstanceOrClassMethod 											changesIcon)
		#(1080		'push up' 											nil 	model 			pushUpSelector 											goTopIcon)
		#(1090		'add in superclass as subclassResponsability' 											nil 	model 			addAsSubclassResponsabilitySelector 											goTopIcon)
		#(1100		'push down to subclasses' 											nil 	model 			pushDownSelectorToSubclasses 											goBottomIcon)
		#(1110		'push down to one subclass' 											nil 	model 			pushDownSelectorToOneSubclass 											goBottomIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2110		'show category (C)' 								$C 	model 			showHomeCategory 									packageIcon)
		#(2120		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2130		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
	)! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:19:02' prior: 50345568!
               messageListMenuSpec
	"Spec for the menu and shortcut keys for the message list.
	See coment at Morph >> #getMenu
	"
	^#(
			#(0 		'Message List' 						true)
			#(10 		'delete method from change set (d)' 									$d 	model 			forget 								warningIcon)
			#(20 		'remove method from system (x)' 									$x 	model 			removeMessage 								deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 									$b 	window 			browseMethodFull 								editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 									$h 	window 			browseHierarchy 								goTopIcon)
			#(60 		'browse method (O)' 									$O 	window 			openSingleMessageBrowser 								scriptIcon)
			#(70 		'browse protocol (p)' 									$p 	window 			browseFullProtocol 								spreadsheetIcon)
			#(80 		'-----')		
			#(90 		'fileOut (o)' 									$o 	model 			fileOutMessage 								fileOutIcon)
			#(100 		'-----')		
			#(110		'senders of... (n)' 									nil 	window 			browseSendersOfMessages 								mailForwardIcon)
			#(111		nil 									$n 	window 			browseSenders)
			#(120		'implementors of... (m)' 									nil 	window 			browseMessages 								developmentIcon)
			#(121		nil 									$m 	window 			browseImplementors)		
			#(130 		'inheritance (i)' 									$i 	window 			methodInheritance 								goDownIcon)
			#(140 		'versions (v)' 									$v 	window 			browseVersions 								clockIcon)
	).
! !
!MethodSetWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:15:51' prior: 50345617!
                              messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message Set' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutMessage 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(161		nil 							$n 	window 			browseSenders)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(171		nil 							$m 	window 			browseImplementors)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100 		'remove from this browser' 								nil 	model 			removeMessageFromBrowser 									listRemoveIcon)
		#(2110 		'filter message list...' 								nil 	window 			filterMessageList 									findIcon)
		#(2120		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2130		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2140		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
		#(2150 		'-----')
		#(2160 		'sort by class hierarchy' 								nil 	model 			sortByClassHierarchy 									classIcon)
		#(2170 		'sort by class name' 								nil 	model 			sortByClassName 									classIcon)
		#(2180 		'sort by selector' 								nil 	model 			sortBySelector 									scriptIcon)
		#(2190 		'sort by date' 								nil 	model 			sortByDate 									dateIcon)
		#(2200 		'reverse sort' 								nil 	model 			sortReverse 									redoIcon)
	).
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6438-sendersNimplementors-shortcutNotSameAsMenu-JuanVuletich-2024Jun04-11h12m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6436] on 4 June 2024 at 11:47:16 am'!
!ProtocolBrowser methodsFor: 'message category functions' stamp: 'jmv 6/4/2024 11:30:06'!
                        showHomeCategory
	"Show the home category of the selected method."

	self categoryOfCurrentMethod ifNotNil: [ :category | | catIndex selector |
		selector := self selectedMessageName.
		catIndex := self categoriesList indexOf: category.
		self categoriesListIndex: catIndex.
		self selectedMessageName: selector ].
! !
!Browser methodsFor: 'message category functions' stamp: 'jmv 6/1/2011 15:06' prior: 16798177!
  showHomeCategory
	"Show the home category of the selected method.  This is only really useful if one is in a tool that supports the showing of categories.  Thus, it's good in browsers and hierarchy browsers but not in message-list browsers"

	| aSelector |
	(aSelector := self selectedMessageName) ifNotNil: [
		self selectOriginalCategoryForCurrentMethod.
		self selectedMessageName: aSelector]! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:42:37' prior: 50346209!
               messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message List' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(150		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(161		nil 							$n 	window 			browseSenders)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(171		nil 							$m 	window 			browseImplementors)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(280		'remove method in hierarchy' 							nil 	model 			removeMessageInHierarchy 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'refactorings' SubMenu"
		#(1010		'rename... (R)' 											$R 	model 			renameSelector 											saveAsIcon)
		#(1020		'change keyword order...' 											nil 	model 			changeKeywordOrder 											sendReceiveIcon)
		#(1030		'add parameter... (A)' 											$A 	model 			addParameter 											listAddIcon)
		#(1040		'remove parameter... (S)' 											$S 	model 			removeParameter 											listRemoveIcon)
		#(1050 		'-----')
		#(1060		'inline method... (F)' 											$F 	model 			inlineMethod 											saveAsIcon)
		#(1070		'move to instance/class method' 											nil 	model 			moveToInstanceOrClassMethod 											changesIcon)
		#(1080		'push up' 											nil 	model 			pushUpSelector 											goTopIcon)
		#(1090		'add in superclass as subclassResponsability' 											nil 	model 			addAsSubclassResponsabilitySelector 											goTopIcon)
		#(1100		'push down to subclasses' 											nil 	model 			pushDownSelectorToSubclasses 											goBottomIcon)
		#(1110		'push down to one subclass' 											nil 	model 			pushDownSelectorToOneSubclass 											goBottomIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2110		'select method category (C)' 								$C 	model 			showHomeCategory 									editFindReplaceIcon)
		#(2111		nil 								$c 	model 			copySelector)
		#(2120		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2130		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
	)! !
!MethodSetWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:45:43' prior: 50346409!
      messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message Set' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(80		nil 							$c 	model 			copySelector)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutMessage 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(161		nil 							$n 	window 			browseSenders)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(171		nil 							$m 	window 			browseImplementors)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100 		'remove from this browser' 								nil 	model 			removeMessageFromBrowser 									listRemoveIcon)
		#(2110 		'filter message list...' 								nil 	window 			filterMessageList 									findIcon)
		#(2120		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2130		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2140		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
		#(2150 		'-----')
		#(2160 		'sort by class hierarchy' 								nil 	model 			sortByClassHierarchy 									classIcon)
		#(2170 		'sort by class name' 								nil 	model 			sortByClassName 									classIcon)
		#(2180 		'sort by selector' 								nil 	model 			sortBySelector 									scriptIcon)
		#(2190 		'sort by date' 								nil 	model 			sortByDate 									dateIcon)
		#(2200 		'reverse sort' 								nil 	model 			sortReverse 									redoIcon)
	).
! !
!ProtocolBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 11:45:45' prior: 50345746 overrides: 50346724!
     messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^ super messageListMenuSpec, #(
		#(81		'select method category (C)' 							$C 	model 			showHomeCategory 						editFindReplaceIcon)
		#(2100 		'XXremove from this browser')
		#(2110 		'XXfilter message list...'))! !

ProtocolBrowserWindow removeSelector: #browseCategoryOfCurrentMethod!

!methodRemoval: ProtocolBrowserWindow #browseCategoryOfCurrentMethod stamp: 'Install-6439-Cleanup-JuanVuletich-2024Jun04-11h20m-jmv.001.cs.st 6/6/2024 11:37:56'!
browseCategoryOfCurrentMethod

	model categoryOfCurrentMethod ifNotNil: [:category| |catIndex selectedMessage|
		selectedMessage := model selectedMessageName.
		catIndex := model categoriesList indexOf: category.
		model categoriesListIndex: catIndex.
		model selectedMessageName: selectedMessage]!

BrowserWindow removeSelector: #browseCategoryOfCurrentMethod!

!methodRemoval: BrowserWindow #browseCategoryOfCurrentMethod stamp: 'Install-6439-Cleanup-JuanVuletich-2024Jun04-11h20m-jmv.001.cs.st 6/6/2024 11:37:56'!
browseCategoryOfCurrentMethod

	model categoryOfCurrentMethod ifNotNil: [:category| |catIndex selectedMessage|
		selectedMessage := model selectedMessageName.
		catIndex := model classOrMetaClassOrganizer categories indexOf: category.
		model messageCategoryListIndex: catIndex + 1.
		model selectedMessageName: selectedMessage]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6439-Cleanup-JuanVuletich-2024Jun04-11h20m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6436] on 4 June 2024 at 12:14:23 pm'!
!ProtocolBrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 12:11:33'!
  classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 						$b 	window 			browseMethodFull 						editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 						$h 	window 			browseHierarchy 						goTopIcon)
	)! !
!ProtocolBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/4/2024 12:12:47' prior: 50333119!
                    buildSelectiveClassList
	"Define the class hierarchy list pane"

	^(PluggableListMorph
		withModel: model
		listGetter: #selectiveClassList
		indexGetter: #selectiveClassListIndex
		indexSetter: #selectiveClassListIndex:)
			menuNshortcutsKey: #classListMenuSpec.
! !

ProtocolBrowserWindow removeSelector: #protocolClassListKey:from:!

!methodRemoval: ProtocolBrowserWindow #protocolClassListKey:from: stamp: 'Install-6440-NewMenuSpecs-ProtocolBrowser-ClassList-JuanVuletich-2024Jun04-11h47m-jmv.001.cs.st 6/6/2024 11:37:56'!
protocolClassListKey: aChar from: view 
	"Respond to a Command key.  I am a model with a list of 
	classes and a list of methods.  The 
	view knows how to get the list and selection."

	self flag: #definesKeyboardShortcuts.
	aChar = $b ifTrue: [^ self browseMethodFull ].
	aChar = $h ifTrue: [^ self browseHierarchy].
	
	^ nil!

ProtocolBrowserWindow removeSelector: #protocolClassListMenu!

!methodRemoval: ProtocolBrowserWindow #protocolClassListMenu stamp: 'Install-6440-NewMenuSpecs-ProtocolBrowser-ClassList-JuanVuletich-2024Jun04-11h47m-jmv.001.cs.st 6/6/2024 11:37:56'!
protocolClassListMenu
	"Fill aMenu with items appropriate for the class list"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	aMenu addTitle: 'Class List'.
	aMenu 
		addItemsFromDictionaries: `{
			{
				#label 			-> 		'browse full (b)'.
				#selector 			-> 		#browseMethodFull.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#label 			-> 		'browse hierarchy (h)'.
				#selector 			-> 		#browseHierarchy.
				#icon 			-> 		#goTopIcon
			} asDictionary.

		}`.
	^ aMenu!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6440-NewMenuSpecs-ProtocolBrowser-ClassList-JuanVuletich-2024Jun04-11h47m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6436] on 4 June 2024 at 12:27:06 pm'!
!MessageNamesWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 12:22:14'!
   selectorListMenuSpec
	"Spec for the menu and shortcut keys for the selectors list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Selectors' 					false)
		#(10		'senders (n)' 						$n 	window 			browseSenders 						mailForwardIcon)
		#(20		'implementors of... (m)' 						$m 	window 			browseImplementors 						developmentIcon)
	).
! !
!MessageNamesWindow methodsFor: 'GUI building' stamp: 'jmv 6/4/2024 12:25:59' prior: 50333053 overrides: 16902025!
                           buildMorphicWindow
	"Answer a morphic window with the given initial search string, nil if none"
	"MessageNames open"
	| selectorListView firstRow searchButton secondRow |
	textMorph := (TextModelMorph
		textProvider: model
		textGetter: #searchString
		textSetter: #searchString:
		selectionGetter: #contentsSelection)
		setBalloonText: 'See MessageNames class comment for search string options';
		emptyTextDisplayMessage: 'Type here, then hit Search'.
	textMorph askBeforeDiscardingEdits: false.
	textMorph acceptOnCR: true.
	textMorph hideScrollBarsIndefinitely.
	searchButton := PluggableButtonMorph new
		model: textMorph innerTextMorph;
		label: 'Search';
		action: #acceptContents.
	searchButton setBalloonText: 'Type some letters into the pane at right, and then press this Search button (or hit RETURN) and all method selectors that match what you typed will appear in the list pane below.  Click on any one of them, and all the implementors of that selector will be shown in the right-hand pane, and you can view and edit their code without leaving this tool.'.
	firstRow := LayoutMorph newRow.
	firstRow color: self windowColor.
	firstRow
		doAdoptWidgetsColor;
		
			addMorph: searchButton
			proportionalWidth: 0.25;
		
			addMorph: textMorph
			proportionalWidth: 0.75.
	selectorListView := (PluggableListMorph
		withModel: model
		listGetter: #selectorList
		indexGetter: #selectorListIndex
		indexSetter: #selectorListIndex:)
			menuNshortcutsKey: #selectorListMenuSpec.
	secondRow := LayoutMorph newRow.
	secondRow
		
			addMorph: selectorListView
			proportionalWidth: 0.5;
		
			addAdjusterAndMorph: self buildMorphicMessageList
			proportionalWidth: 0.5.
	self layoutMorph
		
			addMorph: firstRow
			fixedHeight: self defaultButtonPaneHeight + 4;
		
			addAdjusterAndMorph: secondRow
			proportionalHeight: 0.5;
		
			addAdjusterAndMorph: self buildLowerPanes
			proportionalHeight: 0.5.
	model changed: #editSelection! !

MessageNamesWindow removeSelector: #selectorListMenu!

!methodRemoval: MessageNamesWindow #selectorListMenu stamp: 'Install-6441-NewMenuSpecs-MessageNames-SelectorList-JuanVuletich-2024Jun04-12h14m-jmv.001.cs.st 6/6/2024 11:37:56'!
selectorListMenu
	"Answer the menu associated with the selectorList"

	| aMenu |
	self flag: #assumesKeyboardShortcuts.
	aMenu := MenuMorph new defaultTarget: self.
	(aMenu add: 'senders (n)' action: #browseSenders icon: #mailForwardIcon)
		setBalloonText: 'browse senders of the chosen selector'.
	^ aMenu!

MessageNamesWindow removeSelector: #selectorListKey:from:!

!methodRemoval: MessageNamesWindow #selectorListKey:from: stamp: 'Install-6441-NewMenuSpecs-MessageNames-SelectorList-JuanVuletich-2024Jun04-12h14m-jmv.001.cs.st 6/6/2024 11:37:56'!
selectorListKey: aChar from: view
	"Respond to a Command key in the message-list pane."

	self flag: #definesKeyboardShortcuts.
	aChar = $n ifTrue: [ ^ self browseSenders ].
	aChar = $b ifTrue: [ ^ self browseMethodFull ].
	aChar = $m ifTrue: [ ^ self browseImplementors ].!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6441-NewMenuSpecs-MessageNames-SelectorList-JuanVuletich-2024Jun04-12h14m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6441] on 4 June 2024 at 2:40:29 pm'!
!Morph methodsFor: 'events' stamp: 'jmv 6/4/2024 13:20:13' prior: 50341696!
keyboardShortcut: aKeyboardEvent
	"Handle a keyboard shortcut.
	See coment at Morph >> #getMenu
	"
	| menuNshortcutsSpecs shortcutCharacter target widgetKey |
	widgetKey := self menuNshortcutsKey ifNil: [ ^false ].
	menuNshortcutsSpecs := self menuNshortcutsSpec: widgetKey for: self.
	menuNshortcutsSpecs ifEmpty: [ ^false ].
	menuNshortcutsSpecs valuesDo: [ :itemSpec |
		itemSpec size >= 5 ifTrue: [
			shortcutCharacter := itemSpec third.
			shortcutCharacter = aKeyboardEvent keyCharacter ifTrue: [
				target := itemSpec fourth
					ifNotNil: [ :targetOrGetter |
						targetOrGetter isSymbol
							ifTrue: [ 	self perform: targetOrGetter ]
							ifFalse: [ targetOrGetter ]]
					ifNil: [ self ].
				itemSpec fifth
					ifNotNil: [ :selector |
						target perform: selector.
						^true ]
					ifNil: [
						^false ]
				]
			]
		].
	^false! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/4/2024 13:20:06' prior: 50343926!
                   addItemTo: topMenu fromSpec: itemSpec submenus: submenusDictionary
	"
	See coment at Morph >> #getMenu
	"
	| submenuId menu label target selector iconSymbol helpText menuItem |
	label := itemSpec second.
	label ifNil: [ ^self ]. "Only a keyboard shortcut, not a real menu item."
	submenuId := itemSpec first // 1000.
	menu := submenuId = 0 ifTrue: [ topMenu ] ifFalse: [ submenusDictionary at: submenuId ].
	target := itemSpec fourth
		ifNotNil: [ :targetOrGetter |
			targetOrGetter isSymbol
				ifTrue: [ 	self perform: targetOrGetter ]
				ifFalse: [ targetOrGetter ]]
		ifNil: [ self ].
	selector := itemSpec fifth.
	menuItem := label isSymbol
		ifTrue: [ menu addUpdating: label target: target action: selector argumentList: #() ]
		ifFalse: [ menu add: label target: target action: selector argumentList: #() ].
	selector ifNil: [
		menuItem isEnabled: false ].
	iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6442-AllowArbitraryTargetsInMenuSpecs-JuanVuletich-2024Jun04-14h40m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6441] on 4 June 2024 at 2:41:29 pm'!

ActiveModel subclass: #SimpleServiceEntry
	instanceVariableNames: 'provider label selector useLineAfter stateSelector description argumentGetter buttonLabel argumentProvider triggerFileListChanged sortOrder icon keyboardShortcutCharacter '
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-FileList'!

!classDefinition: #SimpleServiceEntry category: #'Tools-FileList' stamp: 'Install-6443-keyboardShortcut-SimpleServiceEntry-JuanVuletich-2024Jun04-14h40m-jmv.001.cs.st 6/6/2024 11:37:56'!
ActiveModel subclass: #SimpleServiceEntry
	instanceVariableNames: 'provider label selector useLineAfter stateSelector description argumentGetter buttonLabel argumentProvider triggerFileListChanged sortOrder icon keyboardShortcutCharacter'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-FileList'!
!SimpleServiceEntry methodsFor: 'accessing' stamp: 'jmv 6/4/2024 12:45:39'!
                        keyboardShortcutCharacter
	^keyboardShortcutCharacter! !
!SimpleServiceEntry methodsFor: 'accessing' stamp: 'jmv 6/4/2024 12:36:33'!
                           keyboardShortcutCharacter: aCharacter
	keyboardShortcutCharacter := aCharacter! !

ActiveModel subclass: #SimpleServiceEntry
	instanceVariableNames: 'provider label selector useLineAfter stateSelector description argumentGetter buttonLabel argumentProvider triggerFileListChanged sortOrder icon keyboardShortcutCharacter'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-FileList'!

!classDefinition: #SimpleServiceEntry category: #'Tools-FileList' stamp: 'Install-6443-keyboardShortcut-SimpleServiceEntry-JuanVuletich-2024Jun04-14h40m-jmv.001.cs.st 6/6/2024 11:37:56'!
ActiveModel subclass: #SimpleServiceEntry
	instanceVariableNames: 'provider label selector useLineAfter stateSelector description argumentGetter buttonLabel argumentProvider triggerFileListChanged sortOrder icon keyboardShortcutCharacter'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-FileList'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6443-keyboardShortcut-SimpleServiceEntry-JuanVuletich-2024Jun04-14h40m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6441] on 4 June 2024 at 2:43:46 pm'!
!FileListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 12:48:38'!
                   fileListMenuSpec
	"Spec for the menu and shortcut keys for our tree nodes.
	See coment at Morph >> #getMenu
	"
	^model fileName
		ifNil: [ self noFileSelectedMenuSpec ]
		ifNotNil: [ self fileSelectedMenuSpec ]! !
!FileListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 13:27:25'!
                       fileSelectedMenuSpec
	| itemsPart1 itemsPart2 itemsPart3 itemsPart4 services |
	itemsPart1 := model itemsForAnyFile1.
	itemsPart2 := model itemsForFileEntry: model selectedFileEntry.
	itemsPart3 := model itemsForAnyFile2.
	itemsPart4 := model itemsForNoFile.
	itemsPart1 notEmpty ifTrue: [ itemsPart1 last useLineAfter: true ].
	itemsPart2 notEmpty ifTrue: [ itemsPart2 last useLineAfter: true ].
	itemsPart3 notEmpty ifTrue: [ itemsPart3 last useLineAfter: true ].
	services := itemsPart1, itemsPart2, itemsPart3, itemsPart4.
	services do: [ :svc |
		svc argumentProvider: model.
		svc when: #fileListChanged send: #updateFileList to: model ].
	^Array streamContents: [ :strm | | itemId |
		itemId :=0.
		services do: [ :service |
			itemId := itemId + 10.
			"strm nextPut: {itemId. service label. service keyboardShortcutCharacter . #model. service selector. service iconSpec}."
			strm nextPut: {itemId. service label. service keyboardShortcutCharacter . service. #performService. service iconSpec}.
			service useLineAfter ifTrue: [
				itemId := itemId + 10.
				strm nextPut: {itemId. '-----'} ]]].! !
!FileListWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 12:52:40'!
                        noFileSelectedMenuSpec
	^Array streamContents: [ :strm | | itemId |
		itemId :=0.
		model itemsForNoFile do: [ :service |
			itemId := itemId + 10.
			strm nextPut: {itemId. service label. service keyboardShortcutCharacter . #model. service selector. service iconSpec}.
			service useLineAfter ifTrue: [
				itemId := itemId + 10.
				strm nextPut: {itemId. '-----'} ]]].! !
!FileList methodsFor: 'own services' stamp: 'jmv 6/4/2024 12:38:21' prior: 16861968!
                    serviceAddNewDirectory
	"Answer a service entry characterizing the 'add new directory' command"

	^ (SimpleServiceEntry
		provider: self
		label: 'add new directory (N)'
		selector: #addNewDirectory
		description: 'adds a new, empty directory (folder)'
		icon: #listAddIcon)
			keyboardShortcutCharacter: $N! !
!FileList methodsFor: 'own services' stamp: 'jmv 6/4/2024 12:38:15' prior: 16861981!
                    serviceAddNewFile
	"Answer a service entry characterizing the 'add new file' command"

	^ (SimpleServiceEntry 
		provider: self 
		label: 'add new file (n)' 
		selector: #addNewFile 
		description: 'create a new,. empty file, and add it to the current directory.'
		icon: #newIcon)
			keyboardShortcutCharacter: $n! !
!FileList methodsFor: 'own services' stamp: 'jmv 6/4/2024 12:38:12' prior: 16862002!
             serviceDeleteFile

	^ (SimpleServiceEntry
		provider: self
		label: 'delete (x)'
		selector: #deleteFile
		description: 'delete the seleted item'
		icon: #deleteIcon)
			keyboardShortcutCharacter: $x! !
!FileList methodsFor: 'own services' stamp: 'jmv 6/4/2024 12:38:07' prior: 16862031!
serviceRenameFile

	^ (SimpleServiceEntry
		provider: self
		label: 'rename (R)'
		selector: #renameFile
		description: 'rename file'
		icon: #saveAsIcon)
			keyboardShortcutCharacter: $R! !
!FileListWindow methodsFor: 'GUI building' stamp: 'jmv 6/4/2024 13:33:43' prior: 50333166!
      morphicFileListPane

	^(PluggableListMorph
		withModel: model 
		listGetter: #fileList 
		indexGetter: #fileListIndex
		indexSetter: #fileListIndex: )
			menuNshortcutsKey: #fileListMenuSpec.! !

FileListWindow removeSelector: #fileListKey:from:!

!methodRemoval: FileListWindow #fileListKey:from: stamp: 'Install-6444-NewMenuSpecs-FileList-JuanVuletich-2024Jun04-14h41m-jmv.001.cs.st 6/6/2024 11:37:56'!
fileListKey: aChar from: aView

	self flag: #definesKeyboardShortcuts.
	aChar = $x ifTrue: [ ^ aView model deleteFile ].
	aChar = $R ifTrue: [ ^ aView model renameFile ].
	aChar = $n ifTrue: [ ^ aView model addNewFile ].
	aChar = $N ifTrue: [ ^ aView model addNewDirectory ].!

FileListWindow removeSelector: #noFileSelectedMenu!

!methodRemoval: FileListWindow #noFileSelectedMenu stamp: 'Install-6444-NewMenuSpecs-FileList-JuanVuletich-2024Jun04-14h41m-jmv.001.cs.st 6/6/2024 11:37:56'!
noFileSelectedMenu

	| aMenu |
	aMenu := MenuMorph new defaultTarget: model.
	^ aMenu
		addServices: model itemsForNoFile 
		for: model
		extraLines: #()!

FileListWindow removeSelector: #fileListMenu!

!methodRemoval: FileListWindow #fileListMenu stamp: 'Install-6444-NewMenuSpecs-FileList-JuanVuletich-2024Jun04-14h41m-jmv.001.cs.st 6/6/2024 11:37:56'!
fileListMenu
	^model fileName
		ifNil: [ self noFileSelectedMenu ]
		ifNotNil: [ self fileSelectedMenu ]!

FileListWindow removeSelector: #fileSelectedMenu!

!methodRemoval: FileListWindow #fileSelectedMenu stamp: 'Install-6444-NewMenuSpecs-FileList-JuanVuletich-2024Jun04-14h41m-jmv.001.cs.st 6/6/2024 11:37:56'!
fileSelectedMenu

	| itemsPart1 itemsPart2 itemsPart3 itemsPart4 n1 n2 n3 services aMenu |
	aMenu := MenuMorph new defaultTarget: model.
	itemsPart1 := model itemsForAnyFile1.
	itemsPart2 := model itemsForFileEntry: model selectedFileEntry.
	itemsPart3 := model itemsForAnyFile2.
	itemsPart4 := model itemsForNoFile.
	n1 := itemsPart1 size.
	n2 := n1 + itemsPart2 size.
	n3 := n2 + itemsPart3 size.
	services := itemsPart1, itemsPart2, itemsPart3, itemsPart4.
	services do: [ :svc | svc when: #fileListChanged send: #updateFileList to: model ].
	^ aMenu 
		addServices: services 
		for: model
		extraLines:{ n1 . n2 . n3 }
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6444-NewMenuSpecs-FileList-JuanVuletich-2024Jun04-14h41m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6441] on 4 June 2024 at 2:44:49 pm'!

MenuMorph removeSelector: #addServices:for:extraLines:!

!methodRemoval: MenuMorph #addServices:for:extraLines: stamp: 'Install-6445-Cleanup-JuanVuletich-2024Jun04-14h43m-jmv.001.cs.st 6/6/2024 11:37:56'!
addServices: services for: served extraLines: linesArray

	services withIndexDo: [:service :i |
		service addServiceFor: served toMenu: self.
		submorphs last setBalloonText: service description.
		(linesArray includes: i) | service useLineAfter 
			ifTrue: [self addLine]].
!

SimpleServiceEntry removeSelector: #addServiceFor:toMenu:!

!methodRemoval: SimpleServiceEntry #addServiceFor:toMenu: stamp: 'Install-6445-Cleanup-JuanVuletich-2024Jun04-14h43m-jmv.001.cs.st 6/6/2024 11:37:56'!
addServiceFor: served toMenu: aMenu
	argumentProvider := served.
	aMenu 
		add: self label 
		target: self 
		action: #performService
		icon: icon.
	self useLineAfter ifTrue: [ aMenu addLine ].!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6445-Cleanup-JuanVuletich-2024Jun04-14h43m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6445] on 4 June 2024 at 5:50:19 pm'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/4/2024 17:49:57' prior: 50346573!
                    messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message List' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutMessage 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(150		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(161		nil 							$n 	window 			browseSenders)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(171		nil 							$m 	window 			browseImplementors)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(280		'remove method in hierarchy' 							nil 	model 			removeMessageInHierarchy 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		" 'refactorings' SubMenu"
		#(1010		'rename... (R)' 											$R 	model 			renameSelector 											saveAsIcon)
		#(1020		'change keyword order...' 											nil 	model 			changeKeywordOrder 											sendReceiveIcon)
		#(1030		'add parameter... (A)' 											$A 	model 			addParameter 											listAddIcon)
		#(1040		'remove parameter... (S)' 											$S 	model 			removeParameter 											listRemoveIcon)
		#(1050 		'-----')
		#(1060		'inline method... (F)' 											$F 	model 			inlineMethod 											saveAsIcon)
		#(1070		'move to instance/class method' 											nil 	model 			moveToInstanceOrClassMethod 											changesIcon)
		#(1080		'push up' 											nil 	model 			pushUpSelector 											goTopIcon)
		#(1090		'add in superclass as subclassResponsability' 											nil 	model 			addAsSubclassResponsabilitySelector 											goTopIcon)
		#(1100		'push down to subclasses' 											nil 	model 			pushDownSelectorToSubclasses 											goBottomIcon)
		#(1110		'push down to one subclass' 											nil 	model 			pushDownSelectorToOneSubclass 											goBottomIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2110		'select method category (C)' 								$C 	model 			showHomeCategory 									editFindReplaceIcon)
		#(2111		nil 								$c 	model 			copySelector)
		#(2120		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2130		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
	)! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6446-Bugfix-JuanVuletich-2024Jun04-17h49m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6426] on 4 June 2024 at 4:26:27 pm'!
!CodeProvider methodsFor: 'message list' stamp: 'eem 5/31/2024 17:20:01'!
    messageList
	"Answer the list of messages being displayed by the receiver, if any.
	 By default answer nil. Subclasses that present a list of messages override."

	^nil! !
!CodeProvider methodsFor: 'message list menu' stamp: 'eem 5/31/2024 17:23:31' prior: 16826427!
                     fileOutMessage
	"Put a description of the selected message on a file"

	self selectedMessageName ifNotNil:
		[^self selectedClassOrMetaClass fileOutMethod: self selectedMessageName].
	self messageList ifNotNil:
		[:theMethods|
		self request: 'Enter file name'
			initialAnswer: 'methods.st'
			do: [ :filename |
				DirectoryEntry fileOutsDirectory // filename writeStreamDo:
					[ :stream |
					stream timeStamp.
					theMethods do:
						[ :methodRef |
						methodRef actualClass
							printMethodChunk: methodRef methodSymbol
							withPreamble: true
							on: stream
							moveSource: false
							toFile: 0 ]]]]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6447-FileOutAll-ifNoneSelected-EliotEmilioMiranda-2024May31-19h05m-eem.002.cs.st----!

'From Cuis7.1 [latest update: #6426] on 4 June 2024 at 4:26:27 pm'!
!SHParserST80 methodsFor: 'parse' stamp: 'eem 6/2/2024 17:21:15' prior: 16942474!
       parsePrimitive
	self scanNext.
	currentTokenFirst isDigit 
		ifTrue: [self scanPast: #integer]
		ifFalse: [
			self failUnless: ('''#' includes: currentTokenFirst).
			self parseStringOrSymbol.
			currentToken = 'module:' ifTrue: [
				self scanPast: #module.
				self failUnless: ('''#' includes: currentTokenFirst).
				self parseStringOrSymbol]].
	currentToken = 'error:' ifTrue: [
		self scanPast: #primitive. "there's no rangeType for error"
		self isName
			ifTrue: [ self scanPast: #patternTempVar ]
			ifFalse: [ self parseStringOrSymbol ] ].
	self failUnless: currentToken = '>'.
	self scanPast: #primitiveOrExternalCallEnd! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6448-AllowSymbolsInNamedPrimitiveCalls-EliotEmilioMiranda-2024May31-19h05m-eem.002.cs.st----!

'From Cuis7.1 [latest update: #6448] on 5 June 2024 at 10:02:45 am'!
!ByteArray methodsFor: 'access - Numeric Types' stamp: 'jmv 6/5/2024 10:00:06'!
                        int8At: index bigEndian: dummyArgument
	"Return a 8-bit signed integer quantity from the given byte index.
	Endiannes is irrelevant for 8 bit quantities. dummyArgument is included for consistency,
	and because #int8At: is implemented in FFI package."

	| result |
	result := self at: index.
	result < 16r80 ifTrue: [ ^result ].
	^result - 16r100! !
!ByteArray methodsFor: 'access - Numeric Types' stamp: 'jmv 6/5/2024 10:00:50'!
                   int8At: index put: value bigEndian: dummyArgument
	"Store a 8-bit signed integer quantity at the given byte index
	Endiannes is irrelevant for 8 bit quantities. dummyArgument is included for consistency,
	and because #int8At: is implemented in FFI package."

	| unsignedValue |
	(unsignedValue := value) < 0 ifTrue: [
		unsignedValue := unsignedValue + 16r100 ].
	self at: index put: unsignedValue.
	^value! !
!ByteArray methodsFor: 'access - Numeric Types' stamp: 'jmv 6/5/2024 10:00:58'!
                      uint8At: index bigEndian: dummyArgument
	"Return a 8-bit unsigned integer quantity from the given byte index.
	Endiannes is irrelevant for 8 bit quantities. dummyArgument is included for consistency,
	and because #int8At: is implemented in FFI package."

	^self at: index! !
!ByteArray methodsFor: 'access - Numeric Types' stamp: 'jmv 6/5/2024 10:01:02'!
                             uint8At: index put: value bigEndian: dummyArgument
	"Store a 8-bit unsigned integer quantity at the given byte index.
	Endiannes is irrelevant for 8 bit quantities. dummyArgument is included for consistency,
	and because #int8At: is implemented in FFI package."

	^self at: index put: value! !

ByteArray removeSelector: #uint8At:!

!methodRemoval: ByteArray #uint8At: stamp: 'Install-6449-ByteArray-int8At-protocol-addEndianessDummyArgument-JuanVuletich-2024Jun05-10h00m-jmv.001.cs.st 6/6/2024 11:37:56'!
uint8At: index
	"Return a 8-bit unsigned integer quantity from the given byte index.
	Endiannes is irrelevant for 8 bit quantities"

	^self at: index!

ByteArray removeSelector: #int8At:!

!methodRemoval: ByteArray #int8At: stamp: 'Install-6449-ByteArray-int8At-protocol-addEndianessDummyArgument-JuanVuletich-2024Jun05-10h00m-jmv.001.cs.st 6/6/2024 11:37:56'!
int8At: index
	"Return a 8-bit signed integer quantity from the given byte index.
	Endiannes is irrelevant for 8 bit quantities"

	| result |
	result := self at: index.
	result < 16r80 ifTrue: [ ^result ].
	^result - 16r100!

ByteArray removeSelector: #uint8At:put:!

!methodRemoval: ByteArray #uint8At:put: stamp: 'Install-6449-ByteArray-int8At-protocol-addEndianessDummyArgument-JuanVuletich-2024Jun05-10h00m-jmv.001.cs.st 6/6/2024 11:37:56'!
uint8At: index put: value
	"Store a 8-bit unsigned integer quantity at the given byte index.
	Endiannes is irrelevant for 8 bit quantities"

	^self at: index put: value!

ByteArray removeSelector: #int8At:put:!

!methodRemoval: ByteArray #int8At:put: stamp: 'Install-6449-ByteArray-int8At-protocol-addEndianessDummyArgument-JuanVuletich-2024Jun05-10h00m-jmv.001.cs.st 6/6/2024 11:37:56'!
int8At: index put: value
	"Store a 8-bit signed integer quantity at the given byte index
	Endiannes is irrelevant for 8 bit quantities"

	| unsignedValue |
	(unsignedValue := value) < 0 ifTrue: [
		unsignedValue := unsignedValue + 16r100 ].
	self at: index put: unsignedValue.
	^value!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6449-ByteArray-int8At-protocol-addEndianessDummyArgument-JuanVuletich-2024Jun05-10h00m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6449] on 5 June 2024 at 10:48:12 am'!
!SystemDictionary methodsFor: 'retrieving' stamp: 'eem 6/5/2024 10:37:47'!
           allSelect: aUnaryBlock localTo: aClass
	"Answer a SortedCollection of each method in the hierarchy of aClass
	 for which aUnaryBlock answers true when evaluated with the method."
	| aCollection |
	aCollection := SortedCollection new.
	aClass allSuperclasses, aClass withAllSubclasses do:
		[:class |
		class selectorsAndMethodsDo:
			[:sel :meth|
			(aUnaryBlock value: meth) ifTrue:
				[aCollection add: (MethodReference class: class selector: sel)]]].
	^aCollection! !
!SystemDictionary methodsFor: 'browsing' stamp: 'eem 6/5/2024 10:42:36'!
                               browseAllSelect: aUnaryBlock localTo: aClass
	"Create and schedule a message browser on each method in the hierarchy of aClass
	 for which aUnaryBlock answers true when evaluated with the method.
	For example, Smalltalk browseAllSelect: [:m| m sendsSelector: #size] localTo: Collection."
	self browseMessageList: (self allSelect: aUnaryBlock localTo: aClass) name: 'selected messages in', aClass name! !
!SystemDictionary methodsFor: 'retrieving' stamp: 'eem 6/5/2024 10:37:34' prior: 16965064!
                 allSelect: aUnaryBlock
	"Answer a SortedCollection of each method in the system
	 for which aUnaryBlock answers true when evaluated with the method."
	| aCollection |
	aCollection := SortedCollection new.
	self allBehaviorsDo: [ :class |
		class selectorsAndMethodsDo: [ :sel :meth |
			(aUnaryBlock value: meth) ifTrue: [
				aCollection add: (MethodReference class: class selector: sel)
			]]].
	^ aCollection! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6450-allSelectLocalTo-EliotEmilioMiranda-2024Jun05-10h34m-eem.001.cs.st----!

'From Cuis7.1 [latest update: #6449] on 5 June 2024 at 10:56:36 am'!
!CompiledMethod methodsFor: 'printing' stamp: 'eem 6/5/2024 10:55:56' prior: 16833593!
                               printPrimitiveOn: aStream
	"Print the primitive on aStream"
	| primIndex primDecl |
	(primIndex := self primitive) = 0 ifTrue:
		[^self].
	primIndex = 120 ifTrue: "External call spec"
		[^aStream print: (self literalAt: 1); newLine].
	aStream nextPutAll: '<primitive: '.
	primIndex = 117
		ifTrue:
			[primDecl := self literalAt: 1.
			(primDecl at: 2) printOn: aStream.
			(primDecl at: 1) ifNotNil: [ :moduleName |
				aStream nextPutAll:' module: '.
				moduleName printOn: aStream]]
		ifFalse:
			[aStream print: primIndex].
	self primitiveErrorVariableName ifNotNil: [ :primitiveErrorVariableName |
		aStream nextPutAll: ' error: '; nextPutAll: primitiveErrorVariableName].
	aStream nextPut: $>; newLine! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6451-CompiledMethod-printPrimitiveOn-EliotEmilioMiranda-2024Jun05-10h34m-eem.001.cs.st----!

'From Cuis7.1 [latest update: #6451] on 5 June 2024 at 5:21:51 pm'!
!String class methodsFor: 'instance creation' stamp: 'jmv 6/5/2024 17:20:27' prior: 16960241!
 percentEscapingNonAsciiAndThoseIn: aCharacterMapByteArray bytes: aByteArray
	"Percent encode any byte not in the ASCII range.
	Also encode any in aCharacterMap.
	Replace them with %XX where XX are the hexadecimal digits.
	See https://en.wikipedia.org/wiki/URL_encoding
	
	String percentEscapingNonAscii: '‚äô' bytes
	"

	^String streamContents: [ :strm |
		aByteArray do: [ :byte | 
			(byte > 127 or: [
						aCharacterMapByteArray isNil or: [
							(aCharacterMapByteArray at: byte+1) = 1 ]])
				ifTrue: [
					strm nextPut: $%.
					strm nextPut: (byte // 16) asHexDigit.
					strm nextPut: (byte \\ 16) asHexDigit ]
				ifFalse: [ strm nextPut: (Character codePoint: byte) ]]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6452-String-PercentEscapingFix-JuanVuletich-2024Jun05-17h16m-jmv.001.cs.st----!

		Preferences at: #saveReleaseOptionsInWorldMenu put: true!

----QUIT----(6 June 2024 11:40:36) Cuis7.1-6452.image priorSource: 138!

----STARTUP---- (8 July 2024 11:53:03) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6452.image!


'From Cuis7.1 [latest update: #6452] on 6 June 2024 at 5:23:08 pm'!
!Character methodsFor: 'testing' stamp: 'jmv 6/6/2024 16:04:41' prior: 16810759!
          isSeparator
	"Answer whether the receiver is one of the separator characters"
	"Also see #separators"

	^ #(32 "space"
		9 "tab"
		10 "line feed"
		13 "cr"
		12 "form feed"
		160 "non-breaking space"
		8203 "Character zeroWidthSpace")
			statePointsTo: self codePoint! !
!Character class methodsFor: 'instance creation' stamp: 'jmv 6/6/2024 17:22:40' prior: 16811330!
                separators
	"Answer the separator characters"
	"Also see #isSeparator"

	^ #(32 "space"
		9 "tab"
		10 "line feed"
		13 "cr"
		12 "form feed"
		160 "non-breaking space"
		8203 "Character zeroWidthSpace")
			collect: [ :v | Character codePoint: v ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6453-Non-breaking-space-isSeparator-JuanVuletich-2024Jun06-17h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6452] on 6 June 2024 at 5:26:22 pm'!
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 6/6/2024 14:32:09'!
                    backQuote
	"Not specifically untypeable, but cumbersome to use in source code."

	^ `Character codePoint: 96`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 6/6/2024 14:31:09'!
                doubleQuote
	"Not specifically untypeable, but cumbersome to use in source code."

	^ `Character codePoint: 34`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 6/6/2024 17:26:00'!
              noBreakSpace

	^ `Character codePoint: 16rA0`! !
!Character class methodsFor: 'accessing untypeable characters' stamp: 'jmv 6/6/2024 14:31:33'!
                singleQuote
	"Not specifically untypeable, but cumbersome to use in source code."

	^ `Character codePoint: 39`! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6454-Character-tweaks-JuanVuletich-2024Jun06-17h23m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6452] on 6 June 2024 at 5:42:56 pm'!
!CharacterSequence methodsFor: 'converting' stamp: 'jmv 6/6/2024 17:27:30'!
                             withDoubleColonsDoubled
	"Return a copy of the receiver with any double colons duplicated.
	Useful for turning text into Smalltalk comments."

	^self species streamContents: [ :stream |
		self do: [ :c |
			stream nextPut: c.
			c = $"
				ifTrue: [ stream nextPut: c ]]].! !
!CharacterSequence methodsFor: 'converting' stamp: 'jmv 6/6/2024 17:36:44'!
withDoubleColonsUndoubled
	"Do the inverse of #withDoubleColonsDoubled"

	| lastWasDoubleColon |
	^self species streamContents: [ :stream |
		lastWasDoubleColon := false.
		self do: [ :c |
			c = $"
				ifTrue: [
					lastWasDoubleColon
						ifFalse: [
							stream nextPut: c.
							lastWasDoubleColon := true ]
						ifTrue: [
							lastWasDoubleColon := false]]
				ifFalse: [
					stream nextPut: c.
					lastWasDoubleColon := false ]]].! !
!SmalltalkEditor methodsFor: 'editing keys' stamp: 'jmv 6/6/2024 17:41:52' overrides: 16980546!
                               enclose: aKeyboardEvent
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	| startIndex stopIndex oldSelection new enlargedBy |
	"This implementation is only for commenting and uncommenting code.
	Other cases are handled by the super implementation.
	This implementation only handles String and discards Text attributes."
	aKeyboardEvent keyCharacter = $" ifFalse: [
		^super enclose: aKeyboardEvent ].

	startIndex := self startIndex.
	stopIndex := self stopIndex.
	oldSelection := self selection string.
	((startIndex > 1 and: [stopIndex <= model textSize])
			and: [ (model actualContents at: startIndex-1) = $"
				and: [(model actualContents at: stopIndex) = $"]])
		ifTrue: [
			"already enclosed in double colons; make selection no longer a comment"
			self selectFrom: startIndex-1 to: stopIndex.
			self replaceSelectionWith: oldSelection withDoubleColonsUndoubled ]
		ifFalse: [
			"not enclosed in double colons; make selection a comment"
			new := oldSelection withDoubleColonsDoubled.
			enlargedBy := new size - oldSelection size.
			self replaceSelectionWith: $" asString, new, $" asString.
			self selectFrom: startIndex+1 to: stopIndex + enlargedBy ].
	^ true.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6455-Comment-Uncomment-code-JuanVuletich-2024Jun06-17h26m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6455] on 6 June 2024 at 6:56:22 pm'!
!MenuMorph methodsFor: 'control' stamp: 'jmv 6/6/2024 18:53:31' prior: 16894007!
      deleteIfPopUp: evt
	"Remove this menu from the screen if stayUp is not true. If it is a submenu, also remove its owning menu."

	| h |
	stayUp ifFalse: [ 
		h := evt ifNotNil: [ evt hand ].
		h ifNil: [
			self world ifNotNil: [ :w | h := h activeHand ]].
		h ifNil: [ h := self activeHand ].
		self delete.
		h ifNotNil: [
			h newKeyboardFocus: prevKbdFocus.
			"h newMouseFocus: prevMouseFocus."
			h newMouseFocus: nil.
			].
		popUpOwner ifNotNil: [
			popUpOwner isSelected: false.
			popUpOwner deleteIfPopUp: evt ]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6456-MenuMorph-fix-JuanVuletich-2024Jun06-18h51m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6456] on 10 June 2024 at 9:19:02 am'!

Smalltalk renameClassNamed: #DraggeableButtonMorph as: #DraggableButtonMorph!

!classRenamed: #DraggeableButtonMorph as: #DraggableButtonMorph stamp: 'Install-6457-Correct-DraggableButtonMorph-name-JuanVuletich-2024Jun10-09h18m-jmv.001.cs.st 7/8/2024 11:53:08'!
Smalltalk renameClassNamed: #DraggeableButtonMorph as: #DraggableButtonMorph!
!ScrollBar methodsFor: 'initialization' stamp: 'jmv 6/10/2024 09:18:25' prior: 16945645!
initializeSlider
	"initialize the receiver's slider"

	sliderShadow := BoxedMorph new noBorder.
	self addMorph: sliderShadow.
	sliderShadow hide.
		
	slider := DraggableButtonMorph new.
	slider model: self.
	slider grabSelector: #sliderGrabbedAt:.
	slider dragSelector: #scrollTo:.
	slider action: #sliderReleased.
	self addMorph: slider.

	self computeSlider! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6457-Correct-DraggableButtonMorph-name-JuanVuletich-2024Jun10-09h18m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6457] on 10 June 2024 at 9:35:11 am'!
!SystemWindow methodsFor: 'submorphs-menus' stamp: 'jmv 6/7/2024 15:39:22' prior: 50335565 overrides: 50335545!
               ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs."

	(self perform: aWidgetKey) do: aBlock.

	(self class registeredMenuAndShortcutsSpecProviders: aWidgetKey) ifNotNil: [ :providers |
		providers do: [ :eachMessageSend |
			(eachMessageSend valueWithPossibleArgument: aWidget) do: aBlock ]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6458-Tweak-JuanVuletich-2024Jun10-09h34m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6458] on 10 June 2024 at 10:02:29 am'!
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/10/2024 09:57:05'!
 allMenuNshortcutsSpecs
	"menuSpec is the Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number. It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	self menuNshortcutsSpecsDo: [ :menuItemSpec |
		menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ].
	self allOwnersDo: [ :o |
		o menuNshortcutsSpecsFor: self do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/10/2024 09:47:37'!
                              menuNshortcutsSpecsDo: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for themselves.
	See implementors."! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/10/2024 09:51:23'!
                            menuNshortcutsSpecsFor: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs.
	See implementors."! !
!SystemWindow methodsFor: 'submorphs-menus' stamp: 'jmv 6/10/2024 09:51:01' overrides: 50348237!
               menuNshortcutsSpecsFor: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs."

	aWidget menuNshortcutsKey ifNotNil: [ :widgetKey |
		(self perform: widgetKey) do: aBlock.
		(self class registeredMenuAndShortcutsSpecProviders: widgetKey) ifNotNil: [ :providers |
			providers do: [ :eachMessageSend |
				(eachMessageSend valueWithPossibleArgument: aWidget) do: aBlock ]]].! !
!Morph methodsFor: 'events' stamp: 'jmv 6/10/2024 09:57:18' prior: 50347102!
               keyboardShortcut: aKeyboardEvent
	"Handle a keyboard shortcut.
	See coment at Morph >> #getMenu
	"
	| menuNshortcutsSpecs shortcutCharacter target |
	menuNshortcutsSpecs := self allMenuNshortcutsSpecs.
	menuNshortcutsSpecs ifEmpty: [ ^false ].
	menuNshortcutsSpecs valuesDo: [ :itemSpec |
		itemSpec size >= 5 ifTrue: [
			shortcutCharacter := itemSpec third.
			shortcutCharacter = aKeyboardEvent keyCharacter ifTrue: [
				target := itemSpec fourth
					ifNotNil: [ :targetOrGetter |
						targetOrGetter isSymbol
							ifTrue: [ 	self perform: targetOrGetter ]
							ifFalse: [ targetOrGetter ]]
					ifNil: [ self ].
				itemSpec fifth
					ifNotNil: [ :selector |
						target perform: selector.
						^true ]
					ifNil: [
						^false ]
				]
			]
		].
	^false! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/10/2024 09:57:14' prior: 50341758!
     getMenu
	"Answer the right-click (contextual) menu."
	"Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number (integer or float). It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"

	| menuNshortcutsSpecs itemSpec menu submenus |
	menuNshortcutsSpecs := self allMenuNshortcutsSpecs.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].
	menu := MenuMorph new.
	submenus := nil.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2 ifTrue: [
				self addLineTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [ itemSpec size = 3 ifTrue: [
				self addTitleTo: menu fromSpec: itemSpec ]
			ifFalse: [ itemSpec fifth isNumber ifTrue: [
				submenus ifNil: [submenus := Dictionary new ].
				self addSubmenuTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [
				self addItemTo: menu fromSpec: itemSpec submenus: submenus ]]]].
	^ menu! !

SystemWindow removeSelector: #ownMenuNshortcutsSpecs:for:do:!

!methodRemoval: SystemWindow #ownMenuNshortcutsSpecs:for:do: stamp: 'Install-6459-MenuNShortcutSpecs-tweaks-JuanVuletich-2024Jun10-09h59m-jmv.001.cs.st 7/8/2024 11:53:08'!
ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs."

	(self perform: aWidgetKey) do: aBlock.

	(self class registeredMenuAndShortcutsSpecProviders: aWidgetKey) ifNotNil: [ :providers |
		providers do: [ :eachMessageSend |
			(eachMessageSend valueWithPossibleArgument: aWidget) do: aBlock ]].!

Morph removeSelector: #ownMenuNshortcutsSpecs:for:do:!

!methodRemoval: Morph #ownMenuNshortcutsSpecs:for:do: stamp: 'Install-6459-MenuNShortcutSpecs-tweaks-JuanVuletich-2024Jun10-09h59m-jmv.001.cs.st 7/8/2024 11:53:08'!
ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for their submorphs.
	See, for instance, SystemWindow."!

Morph removeSelector: #menuNshortcutsSpec:for:!

!methodRemoval: Morph #menuNshortcutsSpec:for: stamp: 'Install-6459-MenuNShortcutSpecs-tweaks-JuanVuletich-2024Jun10-09h59m-jmv.001.cs.st 7/8/2024 11:53:08'!
menuNshortcutsSpec: aWidgetKey for: aWidget
	"menuSpec is the Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number. It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	self withAllOwnersReverseDo: [ :o |
		o ownMenuNshortcutsSpecs: aWidgetKey for: aWidget do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6459-MenuNShortcutSpecs-tweaks-JuanVuletich-2024Jun10-09h59m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6459] on 10 June 2024 at 3:03:53 pm'!
!TextEditor methodsFor: 'new selection' stamp: 'jmv 6/10/2024 11:44:27' prior: 16981096!
                 selectWordOrDelimitedTextAt: localEventPosition
	"Select delimited text or word--the result of double-clicking."

	| hitCharacterBlock range p |
	p := localEventPosition x - 1 @ localEventPosition y.
	hitCharacterBlock := textComposition characterBlockIncludingPoint: p.
	range := self
		delimitedRangeAt: hitCharacterBlock stringIndex
		hitOnRightHalf: p x  > hitCharacterBlock center x
		leftDelimiters: '([{<'
		rightDelimiters: ')]}>'
		simpleDelimiters: '|''"`'.
	self selectFrom: range first to: range last.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6460-DelimitedTextSelection-tweak-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6461] on 11 June 2024 at 10:21:19 am'!
!ChangeList methodsFor: 'menu actions' stamp: 'jmv 6/11/2024 10:06:58' prior: 16804662!
                 selectRemovalsOfSent
	"Selects all method removal for sent methods"

	1 to: changeList size do: [ :i | | change isRemovalOfSent |
		change := changeList at: i.
		isRemovalOfSent := change isMethodDeletion and: [
			Smalltalk isThereAReferenceTo: change methodSelector ].
		isRemovalOfSent := isRemovalOfSent or:
			(change isDoIt and: [
				change string includesSubString: 'removeSelector: #' ] and: [
					Smalltalk isThereAReferenceTo: (change string copyAfterLast: $#) asSymbol ]).
		listSelections at: i put: isRemovalOfSent ].
	self changed: #allSelections.
	self changed: #annotation! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6461-SelectRemovalsOfSent-fix-JuanVuletich-2024Jun11-10h20m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6460] on 11 June 2024 at 4:01:10 pm'!
!TextEditor methodsFor: 'attributes' stamp: 'jmv 6/11/2024 15:59:49' prior: 16980353!
           offerColorMenu
	"Present a menu of available colors, and if one is chosen, apply it to the current selection."
	"This is a user command, and generates undo"

	| attribute colors index thisSel |
	thisSel := self selection.
	colors := #(#black #magenta #red #yellow #green #blue #cyan #white ).
	index := (PopUpMenu
		labelArray: colors ", #('choose color...' )
		lines: (Array with: colors size)") startUpMenu.
	index = 0 ifTrue: [ ^ true ].
	index <= colors size
		ifTrue: [ attribute := TextColor color: (Color perform: (colors at: index)) ]
		ifFalse: [
			index := index - colors size - 1.
			"Re-number!!!!!!"
			index = 0 ifTrue: [ attribute := self chooseColor ].
			thisSel ifNil: [ ^ true ]].
	attribute ifNotNil: [ self applyAttribute: attribute ].
	morph updateFromTextComposition.
	^ true.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6462-ColorMenuFix-JuanVuletich-2024Jun11-15h59m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6462] on 11 June 2024 at 5:05:49 pm'!
!TheWorldMenu class methodsFor: 'menu building' stamp: 'jmv 6/11/2024 17:01:18' prior: 16984359!
                          helpMenuOptions

	^ `{
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'About this System...'.
				#object 			-> 		Smalltalk.
				#selector 			-> 		#aboutThisSystem.
				#icon 			-> 		#helpIcon.
				#balloonText 			-> 		'current version information.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'Terse Guide to Cuis'.
				#selector 			-> 		#openTerseGuide.
				#icon 			-> 		#helpIcon.
				#balloonText 			-> 		'explore Cuis Smalltalk'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		30.
				#label 			-> 		'Class Comment Browser'.
				#selector 			-> 		#openCommentGuide.
				#icon 			-> 		#helpIcon.
				#balloonText 			-> 		'Search & explore Cuis Class Comments. Requires cloning "Cuis-Smalltalk-Tools" git repo.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		40.
				#label 			-> 		'Code management in Cuis'.
				#object 			-> 		Utilities.
				#selector 			-> 		#openCodeManagementInCuis.
				#icon 			-> 		#helpIcon.
				#balloonText 			-> 		'Features are kept in Packages.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		50.
				#label 			-> 		'Using GitHub to host Cuis packages'.
				#object 			-> 		Utilities.
				#selector 			-> 		#openCuisAndGitHub.
				#icon 			-> 		#helpIcon.
				#balloonText 			-> 		'GitHub usage pattern.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'Editor keyboard shortcuts'.
				#object 			-> 		SmalltalkEditor.
				#selector 			-> 		#openHelp.
				#icon 			-> 		#keyboardShortcutsIcon.
				#balloonText 			-> 		'summary of keyboard shortcuts in editors for Smalltalk code.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'Useful Expressions'.
				#object 			-> 		Utilities.
				#selector 			-> 		#openUsefulExpressions.
				#icon 			-> 		#chatIcon.
				#balloonText 			-> 		'a window full of useful expressions.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'VM Statistics'.
				#selector 			-> 		#vmStatistics.
				#icon 			-> 		#systemMonitorIcon.
				#balloonText 			-> 		'obtain some intriguing data about the vm.'
			} asDictionary.
			{
				#submenuOf 			-> 		TheWorldMenu helpLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'Space Left'.
				#selector 			-> 		#garbageCollect.
				#icon 			-> 		#removableMediaIcon.
				#balloonText 			-> 		'perform a full garbage-collection and report how many bytes of space remain in the image.'
			} asDictionary.
		}`! !
!TheWorldMenu class methodsFor: 'menu building' stamp: 'jmv 6/11/2024 17:01:37' prior: 16984957!
       worldMenuOptions
	| options |
	options := `
		TheWorldMenu worldMainMenuOptions,
		"TheWorldMenu additionalMenuOptions,"
		TheWorldMenu preferencesMenuOptions,
		TheWorldMenu windowsMenuOptions,
		TheWorldMenu helpMenuOptions,
		TheWorldMenu changesMenuOptions,
		TheWorldMenu debugMenuOptions`.
		(Preferences at: #saveReleaseOptionsInWorldMenu) ifTrue: [
			options := options, TheWorldMenu worldSaveReleaseImagesMenuOptions ].
	^options! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6463-ClassCommentBrowser-helpBalloon-contents-JuanVuletich-2024Jun11-17h01m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6463] on 11 June 2024 at 6:08:49 pm'!
!InnerTextMorph methodsFor: 'private' stamp: 'jmv 6/11/2024 18:07:08' prior: 16881440!
                 installEditorAndTextComposition
	"Install an editor for my textComposition. Install also the textComposition."
	| e tc |
	
	"Editor and TextComposition are assigned here atomically."
	e := model editorClass new morph: self.
	e model: model.
	tc := TextComposition new.
	"Keep critical section short"
	self mutex critical: [
		editor := e.
		textComposition := tc.
		tc
			setModel: model;
			extentForComposing: self extentForComposing.
		e textComposition: tc.
		tc editor: e ].
	e setEmphasisHereFromText.
	tc composeAll.
	e resetState.
	self fit.
	self selectionChanged.
	self possiblyChanged.

	"Add extras. Text Styler and Autocompleter"
	self stylerClass:
		((Preferences at: #syntaxHighlightingAsYouType) ifTrue: [
			model textStylerClass ]).
	self autoCompleterClass:
		model autoCompleterClass! !
!InnerTextMorph methodsFor: 'private' stamp: 'jmv 6/11/2024 18:07:12' prior: 16881478!
  releaseEditorAndTextComposition
	"Editor and TextComposition instantiation is lazy -- they will be created only when needed"

	editor := nil.
	textComposition := nil.
	self possiblyChanged.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6464-FixArtifactsWithEmbeddedMorphsInText-JuanVuletich-2024Jun11-18h07m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6464] on 12 June 2024 at 9:40:54 am'!
!ClassBuilder methodsFor: 'class mutation' stamp: 'jmv 6/12/2024 09:40:21' prior: 16817185!
          update: oldClass to: newClass
	"Convert oldClass, all its instances and possibly its meta class into newClass,
	 instances of newClass and possibly its meta class. The process is surprisingly
	 simple in its implementation and surprisingly complex in its nuances and potentially
	 bad side effects.
	 We can rely on two assumptions (which are critical):
		#1: The method #updateInstancesFrom: will not create any lasting pointers to
			 'old' instances ('old' is quote on quote since #updateInstancesFrom: will do
			 a become of the old vs. the new instances and therefore it will not create
			 pointers to *new* instances before the #become: which are *old* afterwards)
		#2: The non-preemptive execution of the critical piece of code guarantees that
			 nobody can get a hold by 'other means' (such as process interruption and
			 reflection) on the old instances.
	 Given the above two, we know that after #updateInstancesFrom: there are no pointers
	 to any old instances. After the forwarding become there will be no pointers to the old
	 class or meta class either.
	 Andreas Raab, 2/27/2003 23:42"
	| meta allInstances |
	meta := oldClass isMeta.
	"Note: Everything from here on will run without the ability to get interrupted
	to prevent any other process to create new instances of the old class."
	["Note: The following removal may look somewhat obscure and needs an explanation.
	  When we mutate the class hierarchy we create new classes for any existing subclass.
	  So it may look as if we don't have to remove the old class from its superclass. However,
	  at the top of the hierarchy (the first class we reshape) that superclass itself is not newly
	  created so therefore it will hold both the oldClass and newClass in its (obsolete or not)
	  subclasses. Since the #become: below will transparently replace the pointers to oldClass
	  with newClass the superclass would have newClass in its subclasses TWICE. With rather
	  unclear effects if we consider that we may convert the meta-class hierarchy itself (which
	  is derived from the non-meta class hierarchy).
	  Due to this problem ALL classes are removed from their superclass just prior to converting
	  them. Here, breaking the superclass/subclass invariant really doesn't matter since we will
	  effectively remove the oldClass (becomeForward:) just a few lines below."

		"Convert the instances of oldClass into instances of newClass.
		Note: #canUpdateFrom: has already been called. Instance mutation is safe wrt methods currently in execution."
		allInstances := oldClass allInstances.
		allInstances notEmpty ifTrue: [
			newClass updateInstances: allInstances asArray from: oldClass isMeta: meta ].

		oldClass superclass ifNotNil: [ :oldSuperclass |
			oldSuperclass removeSubclass: oldClass.
			oldSuperclass removeObsoleteSubclass: oldClass ].

		"make sure that the VM cache is clean"
		oldClass methodDict do: [:cm | cm flushCache].

		meta
			ifTrue: [
				oldClass becomeForward: newClass.
				oldClass updateMethodBindingsTo: oldClass binding]
			ifFalse: [
				{oldClass. oldClass class} elementsForwardIdentityTo: {newClass. newClass class}.
				oldClass updateMethodBindingsTo: oldClass binding.
				oldClass class updateMethodBindingsTo: oldClass class binding].

		"eem 5/31/2014 07:22 At this point there used to be a garbage collect whose purpose was
		 to ensure no old instances existed after the becomeForward:.  Without the GC it was possible
		 to resurrect old instances using e.g. allInstancesDo:.  This was because the becomeForward:
		 updated references from the old objects to new objects but didn't destroy the old objects.
		 But as of late 2013/early 2014 becomeForward: has been modified to free all the old objects."
	] valueUnpreemptively! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6465-DontFailWhenRedefiningSubclassesOfNil-JuanVuletich-2024Jun12-09h34m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6465] on 12 June 2024 at 11:15:13 am'!
!PluggableButtonMorph methodsFor: 'accessing' stamp: 'jmv 6/12/2024 11:14:45' prior: 16922588!
                        icon: aForm
	icon := aForm.
	magnifiedIcon := nil.
	self redrawNeeded.! !
!PluggableButtonMorph methodsFor: 'accessing' stamp: 'jmv 6/12/2024 11:14:32' prior: 16922623!
                       label: aStringOrNil font: aFontOrNil
	"Label this button with the given string."
	label := aStringOrNil.
	font := aFontOrNil.
	(self fontToUse notNil and: [ label notNil ])
		ifTrue: [ "Add a bit of padding"
			extent := (self fontToUse widthOfString: label) + 10 @ (self fontToUse lineSpacing + 10) ].
	self redrawNeeded.! !
!PluggableButtonMorph methodsFor: 'accessing' stamp: 'jmv 6/12/2024 11:14:41' prior: 16922635!
                           magnifiedIcon: aForm
	"Meaning: Don't magnify aForm to adapt it to our extent."

	icon := nil.
	magnifiedIcon := aForm.
	self redrawNeeded.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6466-RedrawButtonsWhenLabelFontOrIconChanges-JuanVuletich-2024Jun12-11h13m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6466] on 13 June 2024 at 12:00:21 pm'!
!Class methodsFor: 'accessing class hierarchy' stamp: 'jmv 6/13/2024 11:57:18' overrides: 16787874!
                superclass: aClass 
	"Change the receiver's superclass to be aClass.
	Keep the subclass / superclass invariant.
	Not to be used lightly!!
	Usually used only to create subclasses of nil."

	| oldSuperclass |
	oldSuperclass := superclass.
	super superclass: aClass.
	(oldSuperclass notNil and: [ oldSuperclass ~~ superclass ]) ifTrue: [
		oldSuperclass removeSubclass: self ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6467-superclass-setter-keepSubclassSuperclassInvariant-JuanVuletich-2024Jun13-11h46m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6467] on 13 June 2024 at 2:19:38 pm'!
!Debugger methodsFor: 'context stack menu' stamp: 'jmv 6/13/2024 14:18:45' prior: 16843650!
    doStep
	"Send the selected message in the accessed method, and regain control 
	after the invoked method returns."
	
	| currentContext newContext |

	interruptedProcess isTerminated ifTrue: [^self inform: 'Debugging terminated'].

	currentContext := self selectedContext.
	newContext := self handleLabelUpdatesIn: [interruptedProcess completeStep: currentContext]
						whenExecuting: currentContext.
	newContext == currentContext ifTrue:
		[newContext := interruptedProcess stepToSendOrReturn].
	self contextStackIndex > 1
		ifTrue: [self resetContext: newContext]
		ifFalse:
			[newContext == currentContext
				ifTrue: [self changed: #contentsSelection.
						self updateInspectors]
				ifFalse: [self resetContext: newContext]].
! !
!Debugger methodsFor: 'context stack menu' stamp: 'jmv 6/13/2024 14:18:48' prior: 16843789!
   send
	"Send the selected message in the accessed method, and take control in 
	the method invoked to allow further step or send."

	interruptedProcess isTerminated ifTrue: [^self inform: 'Debugging terminated'].

	self checkContextSelection.
	interruptedProcess step: self selectedContext.
	self resetContext: interruptedProcess stepToSendOrReturn.
! !
!Debugger methodsFor: 'context stack menu' stamp: 'jmv 6/13/2024 14:18:52' prior: 16843800!
   stepIntoBlock
	"Send messages until you return to the present method context.
	 Used to step into a block in the method."

	interruptedProcess isTerminated ifTrue: [^self inform: 'Debugging terminated'].

	self 
		handleLabelUpdatesIn: [interruptedProcess stepToHome: self selectedContext]
		whenExecuting: self selectedContext.
	self resetContext: interruptedProcess stepToSendOrReturn! !
!Debugger class methodsFor: 'instance creation' stamp: 'jmv 6/13/2024 13:41:12' prior: 16844371!
                         newDebugging: aBlock
	"Create a new process to debug aBlock"

	| processToDebug debugger |
	debugger := self new.
	processToDebug := aBlock newProcessForDebugging name: 'debugIt'.
	debugger process: processToDebug context: processToDebug suspendedContext.
		
	^ debugger! !
!BlockClosure methodsFor: 'scheduling' stamp: 'jmv 6/13/2024 13:56:47'!
      newProcessForDebugging
	"Answer a Process running the code in the receiver. The process is not 
	scheduled."
	<primitive: 19> "Simulation guard"
	^Process
		forContext: self asContext
		priority: Processor activePriority! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6468-DebugIt-dontStepWhenDone-JuanVuletich-2024Jun13-14h16m-jmv.002.cs.st----!

'From Cuis7.1 [latest update: #6468] on 13 June 2024 at 3:24:49 pm'!
!BlockClosure methodsFor: 'scheduling' stamp: 'jmv 6/13/2024 15:22:33' prior: 16793518!
                           newProcess
	"Answer a Process running the code in the receiver. The process is not 
	scheduled."
	<primitive: 19> "Simulation guard"
	| p |
	p := Process
		forContext: [
			self value.
			p suspend] asContext
		priority: Processor activePriority.
	^p! !
!BlockClosure methodsFor: 'scheduling' stamp: 'jmv 6/13/2024 15:16:39' prior: 50348977!
          newProcessForDebugging
	"Answer a Process running the code in the receiver. The process is not 
	scheduled."
	<primitive: 19> "Simulation guard"
	| p |
	p := Process
		forContext: [
			self value.
			p terminate] asContext
		priority: Processor activePriority.
	^p! !
!BlockClosure methodsFor: 'scheduling' stamp: 'jmv 6/13/2024 15:23:32' prior: 16793529!
                            newProcessWith: anArray 
	"Answer a Process running the code in the receiver. The receiver's block 
	arguments are bound to the contents of the argument, anArray. The 
	process is not scheduled."
	<primitive: 19> "Simulation guard"
	| p |
	p := Process
		forContext: [
			self valueWithArguments: anArray.
			p suspend] asContext
		priority: Processor activePriority.
	^p! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6469-newProcess-moreRobust-JuanVuletich-2024Jun13-15h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6469] on 16 June 2024 at 4:44:22 pm'!
!SystemDictionary methodsFor: 'code authors' stamp: 'jmv 6/16/2024 16:44:00' prior: 50341266!
 knownInitialsAndNames
	"This list could include people who hasn't contributed code to the Cuis image, but to some optional package."
"
| all ok |
all := Smalltalk allContributors asSet.
ok := (Smalltalk knownInitialsAndNames collect: [ :pair | pair first ]) asSet.
(all copyWithoutAll: ok) print

		initials         				name"
^ #(
	#('ab' 						'Alexandre Bergel')
	#('abc' 						'Colin Putney')
	#('acg' 						'Andrew C. Greenberg')
	#('ads' 						'Adam Spitz')
	#('AFi' 						'Alain Fischer')
	#('ajh' 						'Anthony Hannan')
	#('al' 						'Adrian Lienhard')
	#('and' 						'Alan Dao')
	#('aoy' 						'Andres Otaduy')
	#('apb' 						'Andrew P. Black')
	#('ar' 						'Andreas Raab')
	#('asm' 						'Alejandro Magistrello')
	#('avi' 						'Avi Bryant')
	#('AY'						'Angel Yan')
	#('BAP'						'Barry Perryman')
	#('BenComan' 						'Ben Coman')
	#('bf' 						'Bert Freudenberg')
	#('BG' 						'Boris Gaertner')
	#('bgs' 						'Boris G. Shingarov')
	#('BJP' 						'Bijan Parsia')
	#('bkv' 						'Brent Vukmer')
	#('bolot' 						'Bolot Kerimbaev')
	#('bp' 						'Bernhard Pieber')
	#('BP' 						'Brent Pinkney') 
	#('brp' 						'Brent Pinkney')
	#('cbc' 						'Chris Cunningham')
	#('cbr'						'Casey Ransberger')
	#('ccn' 						'Chris Norton')
	#('chaider'						'Christian Haider')
	#('cmm' 						'Chris Muller')
	#('crl' 						'Craig Latta')
	#('cwp' 						'Colin Putney')
	#('das' 						'David A Smith')
	#('db' 						'Douglas Brebner')
	#('dc' 						'Damien Cassou')
	#('dew' 						'Doug Way')
	#('DF'						'David Faitelson')
	#('dgd' 						'Diego Gomez Deck')
	#('dkh'						'Dale Henrichs')
	#('dhn'	 					'Dan Norton')
	#('dhhi' 						'Dan Ingalls')
	#('di' 						'Dan Ingalls')
	#('djp' 						'David J. Pennell')
	#('DKL'						'Daniel K Lyons')
	#('DM' 						'Duncan Mak')
	#('DSM' 						'Duane Maxwell')
	#('DSG'						'David Graham')
	#('dtl' 						'Dave Lewis')
	#('dvf'	 					'Daniel Vainsencher')
	#('eat' 						'Eric Arseneau Tremblay')
	#('EB'						'Eric Brandwein')
	#('eem'						'Eliot Emilio Miranda')
	#('eliot'						'Eliot Emilio Miranda')
	#('efc' 						'Eddie Cottongim')
	#('em' 						'Ernest Micklei?')
	#('emm' 						'Ernest Micklei')
	#('Ez3' 						'Ezequiel Birman')
	#('fbs' 						'Frank Shearar')
	#('FBS' 						'Frank Shearar')
	#('fc' 						'Frank Caggiano')
	#('fcs' 						'Frank Sergeant')
	#('FernandoOlivero' 						'Fernando Olivero')
	#('FernanodOlivero' 						'Fernando Olivero')
	#('FGJ'						'Fernando Gasperi Jabalera')
	#('fgz'						'Felipe Zak')
	#('FJG'				 		'Facundo Javier Gelatti')
	#('GabrielOmarCotelli' 						'Gabriel Omar Cotelli')
	#('GC' 						'Gast√≥n Caruso')
	#('gera' 						'Gerardo Richarte')
	#('gh' 						'Goran Krampe (nee Hultgren)')
	#('gk' 						'Goran Krampe (nee Hultgren)')
	#('gm' 						'German Morales')
	#('go' 						'Georg Gollmann')
	#('gsa' 						'German Arduino')
	#('HAW' 						'Hernan Wilkinson')
	#('HB' 						'Hari Balaraman')
	#('hjh' 						'Hannes Hirzel')
	#('hlsf' 						'Hilaire Fernandes')
	#('hmm' 						'Hans-Martin Mosner')
	#('hsj' 						'Henrik Sperre Johansen')
	#('Igor.Stasenko' 						'Igor Stasenko')
	#('ikp' 						'Ian Piumarta')
	#('jar' 						'Jaromir Matas')
	#('Jb' 						'Jean Baptiste Arnaud')
	#('jcg' 						'Joshua Gargus')
	#('jdr' 						'Javier Diaz-Reinoso')
	#('je' 						'Joern Eyrich')
	#('jf' 						'Julian Fitzell')
	#('JF' 						'Julian Fitzell')
	#('jhm' 						'John Maloney')
	#('jk'						'Jonathan Kelly')
	#('jlb' 						'Jim Benson')
	#('jm' 						'John Maloney')
	#('jmb' 						'Hans Baveco')
	#('JMG'						'Jeff Gonis')
	#('JMM' 						'John McIntosh')
	#('jmv' 						'Juan Vuletich')
	#('JMV' 						'Juan Vuletich')
	#('JO'						'Javier Olaechea')
	#('jp' 						'Joseph Pelrine')
	#('jrm' 						'John-Reed Maffeo')
	#('jrp' 						'John Pierce')
	#('jsp' 						'Jeff Pierce')
	#('kdpm' 						'Kevin P√©rez Machado')
	#('KenD' 						'Ken Dickey')
	#('kfr' 						'Karl Ramberg')
	#('KLC'			 			'Ken Causey')
	#('KLG'			 			'Gerald Klix')
	#('kph'						'Keith Hodges')
	#('KTT' 						'Kurt Thams')
	#('laza' 						'Alexander Lazarevic')
	#('LC' 						'Leandro Caniglia')
	#('len' 						'Luciano Esteban Notarfrancesco')
	#('lpc'						'Laura Perez Cerrato')
	#('lr' 						'Lukas Renggli')
	#('Lukas Renggli' 						'Lukas Renggli')
	#('ls' 						'Lex Spoon')
	#('md' 						'Marcus Denker')
	#('MarcusDenker' 						'Marcus Denker')
	#('marcus.denker' 						'Marcus Denker')
	#('mdr' 						'Mike Rutenberg')
	#('MEGL' 						'MarceloLamperti')
	#('mga' 						'Markus Galli')
	#('MGD'						'Mat√≠as Dinota')
	#('MH'						'Mat√≠as Halperin')
	#('mha' 						'Michael Haupt')
	#('mir' 						'Michael Rueger')
	#('mjg' 						'Mark Guzdial')
	#('mk'	 					'Matej Kosik')
	#('MM'	 					'Mariano Montone')
	#('mnqpr'	 					'Szabolcs Komaromi')
	#('MPH'	 					'Michael Hewner')
	#('mpw' 						'Marcel Weiher')
	#('MPW' 						'Marcel Weiher')
	#('mrm' 						'Martin McClure')
	#('mtf' 						'Matthew Fulmer')
	#('mu' 						'Masashi Umezawa')
	#('nb' 						'Naala Brewer')
	#('nice'					 	'Nicolas Cellier')
	#('nk' 						'Ned Konz')
	#('NM' 						'Nicola Mingotti')
	#('NMS'						'Nicol√°s Sarfati')
	#('nop' 						'Jay Carlson')
	#('NS' 						'Nathanael Schaerli')
	#('panda' 						'Michael Rueger')
	#('pau'						'Paula Perez Bianchi')
	#('pb'						'Phil Bellalouna')
	#('PB'						'Paolo Belforte')
	#('pmon'						'Paolo Montrasi')
	#('PHK' 						'Peter Keeler')
	#('PM' 						'Peter Mikkelsen')
	#('Pmm' 						'Philippe Marschall')
	#('pnm' 						'Paul McDonough')
	#('r++' 						'Gerardo Richarte')
	#('raa' 						'Bob Arning')
	#('RAA' 						'Bob Arning')
	#('raok' 						'Richard A. O''Keefe')
	#('rca' 						'Russell Allen')
	#('reThink'				 		'Paul McDonough')
	#('rew' 						'Roger Whitney')
	#('rhi' 						'Robert Hirschfeld')
	#('RJT' 						'Ron Teitelbaum')
	#('RNG' 						'Nahuel Garbezza')
	#('rr' 						'Romain Robbes')
	#('rss' 						'Ron Spengler')
	#('rw' 						'Robert Withers')
	#('rww' 						'Robert Withers')
	#('Sames' 						'Samuel S. Shuster')
	#('sbw' 						'Stephan B. Wessels')
	#('sd' 						'Stephane Ducasse')
	#('SD' 						'Stephane Ducasse')
	#('sge' 						'Steve Elkins')
	#('sjd' 						'Santiago Jose Dandois')
	#('SLD'						'Steve Davies')
	#('sma' 						'Stefan Matthias Aust')
	#('sps' 						'Steven Swerling')
	#('SqR' 						'Andres Valloud')
	#('sqr' 						'Andres Valloud')
	#('Squeak1.0'						'Squeak 1.0, September 20, 1996')
	#('Squeak1.1'						'Squeak 1.1, September 23, 1996')
	#('Squeak1.2'						'Squeak 1.2, June 29, 1997')
	#('Squeak1.3'						'Squeak 1.3, January 16, 1998')
	#('sr' 						'Stephan Rudlof')
	#('ss'						'Sebastian Sujarchuk')
	#('SSC' 						'Santiago Salvador Cubino')
	#('SSS' 						'Samuel S. Shuster')
	#('ST-80'						'Smalltalk-80, version 2, of April 1, 1983')
	#('stephane.ducasse' 						'Stephane Ducasse')
	#('stephaneducasse'	 					'Stephane Ducasse')
	#('stp' 						'Stephen Travis Pope')
	#('sumim' 						'Masato Sumi')
	#('S.V.' 						'Sebasti√°n M. Vinto√±uke')
	#('svc' 						'Sven Van Caekenberghe')
	#('svp' 						'Stephen Vincent Pair')
	#('sw' 						'Scott Wallace')
	#('TAG' 						'Travis Griggs')
	#('tak' 						'Takashi Yamamiya')
	#('tao' 						'Tim Olson')
	#('TBn' 						'Torsten Bergmann')
	#('tfei' 						'The Fourth Estate, Inc.')
	#('tfel' 						'Tim Felgentreff')
	#('th' 						'Torge Husfeldt')
	#('tk' 						'Ted Kaehler')
	#('tlk' 						'Tom Koenig')
	#('tpr' 						'Tim Rowledge')
	#('TPR' 						'Tim Rowledge')
	#('TS' 						'Tom√°s Spognardi')
	#('tsl' 						'Thiago da Silva Lino')
	#('tween' 						'Andy Tween')
	#('ul' 						'Levente Uzonyi')
	#('vb' 						'Vassili Bykov')
	#('ward' 						'Ward Cunningham')
	#('wiz' 						'Jerome Peace')
	#('wod' 						'Bill Dargel')
	#('yo' 						'Yoshiki Ohshima')
	#('zz' 						'Serge Stinckwich'))! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6470-AddKevinAsKnownAuthor-JuanVuletich-2024Jun16-16h44m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6470] on 16 June 2024 at 5:11:48 pm'!
!HierarchicalListMorph methodsFor: 'events' stamp: 'jmv 6/16/2024 17:10:59' prior: 16874173 overrides: 16904138!
           doubleClick: aMouseButtonEvent localPosition: localEventPosition
	doubleClickSelector ifNotNil: [
		^ (self window ifNil: [self model]) perform: doubleClickSelector].
	selectedMorph ifNotNil: [
		self toggleExpandedState: selectedMorph.
		self scrollSelectionIntoView ]! !
!HierarchicalListMorph methodsFor: 'initialization' stamp: 'jmv 6/14/2024 15:32:22' prior: 16874353!
          doubleClickSelector: aSymbol
	doubleClickSelector := aSymbol.
	self autoDeselect: false. ! !
!PluggableListMorph methodsFor: 'events' stamp: 'jmv 6/16/2024 17:11:21' prior: 16923362 overrides: 16904138!
                     doubleClick: aMouseButtonEvent localPosition: localEventPosition
	| index |
	doubleClickSelector ifNil: [
		^super doubleClick: aMouseButtonEvent localPosition: localEventPosition ].
	index := self rowAtLocation: localEventPosition.
	index = 0 ifTrue: [
		^super doubleClick: aMouseButtonEvent localPosition: localEventPosition ].
	index == self visualSelectionIndex
		ifFalse: [ self setSelectionIndex: index ].
	^ (self window ifNil: [self model]) perform: doubleClickSelector! !
!PluggableListMorph methodsFor: 'initialization' stamp: 'jmv 6/14/2024 15:32:25' prior: 16923605!
                            doubleClickSelector: aSymbol
	doubleClickSelector := aSymbol.
	self autoDeselect: false. ! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6471-doubleClickSelector-sentToWindowNotModel-JuanVuletich-2024Jun16-17h06m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6471] on 16 June 2024 at 5:20:03 pm'!
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/14/2024 15:17:41' prior: 50340803!
           buildMorphicClassList

	^(PluggableListMorph
		withModel: model
		listGetter: #classList
		indexGetter: #classListIndex
		indexSetter: #classListIndex:)
			menuNshortcutsKey: #classListMenuSpec;
			doubleClickSelector: #browseMethodFull.! !
!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 6/14/2024 15:17:47' prior: 50343982!
                    buildMorphicMessageList
	"Build a morphic message list, with #messageList as its list-getter"

	^(PluggableListMorph
		withModel: model
		listGetter: #messageList
		indexGetter: #messageListIndex
		indexSetter: #messageListIndex:)
			menuNshortcutsKey: #messageListMenuSpec;
			doubleClickSelector: #browseMethodFull.! !
!MethodSetWindow methodsFor: 'GUI building' stamp: 'jmv 6/14/2024 15:17:50' prior: 50345760!
  buildMorphicMessageList
	"Build a morphic message list, with #messageList as its list-getter"

	^(PluggableListMorph
		withModel: model
		listGetter: #messageList
		indexGetter: #messageListIndex
		indexSetter: #messageListIndex:)
			menuNshortcutsKey: #messageListMenuSpec;
			doubleClickSelector: #browseMethodFull.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6472-DoubleClickOnMethodOrClassOpensNewBrowser-JuanVuletich-2024Jun16-17h15m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6472] on 17 June 2024 at 12:05:26 pm'!
!Behavior methodsFor: 'accessing class hierarchy' stamp: 'eem 6/17/2024 12:03:48' prior: 16787773!
                             allSubclassesWithLevelDo: classAndLevelBlock startingLevel: level sortByCategory: sortByCategoryBoolean
	"Walk the tree of subclasses, giving the class and its level.
	 Sort nicely: major order is alphabetical by category name, and within a category alphabetical by class name.
	 Earlier versions used the order of the category within the system organization, but that gives different orders
	 when programmers reorder the system categories to suit their wishes. Since this order decides the order of
	 package file-outs, ignoring the speicifc system category order and using its alphabetical order is important
	 for stable package file-out. eem; '24/6/17"

	classAndLevelBlock value: self value: level.
	self == Class ifTrue:  [^ self].  "Don't visit all the metaclasses"
	"Visit subclasses in alphabetical order, either by category and name, or just by name"
	self subclasses
		sort: [ :a :b |
			sortByCategoryBoolean
				ifTrue: [ (a category ifNil: ['']) < (b category ifNil: ['']) or: [ a category = b category and: [ a name <= b name ]]]
				ifFalse: [ a name <= b name ]
			];
		do: [ :subclass |
			subclass
				allSubclassesWithLevelDo: classAndLevelBlock
				startingLevel: level + 1
				sortByCategory: sortByCategoryBoolean ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6473-SortBySystemCategoryNameNotSystemCategoryIndex-EliotEmilioMiranda-2024June17-12h05m-eem.001.cs.st----!

'From Cuis7.1 [latest update: #6472] on 17 June 2024 at 10:09:53 pm'!

TestCase removeSelector: #assert:isNotCloseTo:withPrecision:!

!methodRemoval: TestCase #assert:isNotCloseTo:withPrecision: stamp: 'Install-6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
assert: aFloatNumber isNotCloseTo: anotherFloatNumber withPrecision: aPrecision 

	self deny: (self is: aFloatNumber closeTo: anotherFloatNumber withPrecision: aPrecision)
!

TestCase removeSelector: #is:closeTo:withPrecision:!

!methodRemoval: TestCase #is:closeTo:withPrecision: stamp: 'Install-6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
is: aNumber closeTo: anotherNumber withPrecision: aPrecision
	"This way of comparing numbers could be useful for many tests, but there is no single correct way to do it for numerical algorithms. That's why this method is here and not at Float."

	aNumber = 0 ifTrue: [ ^ anotherNumber abs < aPrecision ].
	
	^ (aNumber - anotherNumber) abs < (aPrecision * (aNumber abs max: anotherNumber abs))!

TestCase removeSelector: #assert:isNotCloseTo:!

!methodRemoval: TestCase #assert:isNotCloseTo: stamp: 'Install-6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
assert: aNumber isNotCloseTo: anotherNumber
 
	self assert: aNumber isNotCloseTo: anotherNumber withPrecision: self defaultPrecision !

TestCase removeSelector: #assert:isCloseTo:!

!methodRemoval: TestCase #assert:isCloseTo: stamp: 'Install-6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
assert: aNumber isCloseTo: anotherNumber 

	self assert: aNumber isCloseTo: anotherNumber withPrecision: self defaultPrecision !

TestCase removeSelector: #defaultPrecision!

!methodRemoval: TestCase #defaultPrecision stamp: 'Install-6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
defaultPrecision

	^ 0.0001
	!

TestCase removeSelector: #assert:isCloseTo:withPrecision:!

!methodRemoval: TestCase #assert:isCloseTo:withPrecision: stamp: 'Install-6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
assert: aNumber isCloseTo: anotherNumber withPrecision: aPrecision 

	self assert: (self is: aNumber closeTo: anotherNumber withPrecision: aPrecision)!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6474-Cleanup-JuanVuletich-2024Jun17-22h04m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6472] on 17 June 2024 at 7:50:56 pm'!
!Object methodsFor: 'as yet unclassified' stamp: 'jmv 6/17/2024 19:42:51'!
                         run: aSelector with: arguments in: aReceiver

	self halt: 'This object can not behave like a CompiledMethod!!'.
! !
!Behavior methodsFor: 'testing method dictionary' stamp: 'jmv 6/17/2024 19:50:23' prior: 16788759!
         thoroughWhichSelectorsReferTo: literal special: specialFlag byte: specialByte
	"Answer a set of selectors whose methods access the argument as a 
	literal. Dives into the compact literal notation, making it slow but 
	thorough "

	| who |
	who := Set new.
	self selectorsAndMethodsDo: [ :sel :method |
		(method is: #CompiledMethod) ifTrue: [
			((method hasLiteralThorough: literal) or: [specialFlag and: [method scanFor: specialByte]])
				ifTrue: [
					((literal isVariableBinding) not
						or: [method sendsToSuper not
						"N.B. (method indexOfLiteral: literal) < method numLiterals copes with looking for
						Float bindingOf: #NaN, since (Float bindingOf: #NaN) ~= (Float bindingOf: #NaN)."
						or: [(method indexOfLiteral: literal) ~= 0]])
							ifTrue: [who add: sel]]]].
	^ who.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6475-ObjectsAsMethods-dontCrash-JuanVuletich-2024Jun17-19h45m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6480] on 18 June 2024 at 10:11:06 am'!
!Browser methodsFor: 'class list' stamp: 'jmv 6/18/2024 10:08:47' prior: 16797748!
                             createHierarchyTreeOf: classes
	"Create a tree from a collection of classes. Keep ordering while doing it.
	The Each node in the tree is an Association with a class as key and a collection
	of child nodes as value."

	| classesWithSubclassIndexes |

	"For each class, collect the indexes of its included subclasses."
	classesWithSubclassIndexes := classes collect: [ :eachClass | 
		| subclasses subclassIndexes |
		subclasses := classes select: [ :class | class superclass = eachClass ].
		subclassIndexes := subclasses collect: [ :child | classes indexOf: child ].
		Association key: eachClass value: subclassIndexes ].

	"Now replace the indexes by the actual Associations, forming a tree.
	Remove them from the root collection."
	classesWithSubclassIndexes copy do: [ :classAndSubclassIndexes |
		classAndSubclassIndexes value: (classAndSubclassIndexes value collect: [ :idx | 
			| subclassAssociation |
			subclassAssociation := classesWithSubclassIndexes at: idx.
			classesWithSubclassIndexes at: idx put: nil.
			subclassAssociation ])].

	^ classesWithSubclassIndexes select: [ :ea | ea notNil ].
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6476-ClearerCode-JuanVuletich-2024Jun18-10h08m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6476] on 18 June 2024 at 11:04:19 am'!

HierarchyBrowser removeSelector: #selectClass:!

!methodRemoval: HierarchyBrowser #selectClass: stamp: 'Install-6477-cleanup-JuanVuletich-2024Jun18-11h04m-jmv.001.cs.st 7/8/2024 11:53:09'!
selectClass: classNotMeta
	
	self classListIndex: (self classListIndexOf: classNotMeta name)!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6477-cleanup-JuanVuletich-2024Jun18-11h04m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6477] on 18 June 2024 at 2:09:31 pm'!
!CharacterSequence methodsFor: 'converting' stamp: 'jmv 6/18/2024 12:50:58'!
   withoutPossibleSuffix: aString
	"
	'Elvis' withoutPossibleSuffix: 'vis'
	'Elvis' withoutPossibleSuffix: 'Paul'
	"
	^(self endsWith: aString)
		ifTrue: [ self copyFrom: 1 to: self size - aString size ]
		ifFalse: [self]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6478-withoutPossibleSuffix-JuanVuletich-2024Jun18-14h09m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6477] on 18 June 2024 at 2:10:44 pm'!
!Browser methodsFor: 'class list' stamp: 'jmv 6/18/2024 12:48:37' prior: 16797736!
     classListIndexOf: classNameToFind

	"Answer the index of the aClassName selection."

	classNameToFind ifNil: [ ^0 ].
	^self classList findFirst: [ :displayed | | start |
		"Works regardless of currently showing hierarchically or alphabetically."
		start := displayed firstNonSeparator.
		start-1 + classNameToFind size		 = 		displayed size and: [
			displayed is: classNameToFind substringAt: start ]]! !

CharacterSequence removeSelector: #afterBlanksEndsWith:!

!methodRemoval: CharacterSequence #afterBlanksEndsWith: stamp: 'Install-6479-Cleanup-JuanVuletich-2024Jun18-14h09m-jmv.001.cs.st 7/8/2024 11:53:09'!
afterBlanksEndsWith: aTail

	^(self endsWith: aTail) and: [ self firstNonSeparator = (self size - aTail size + 1) ]
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6479-Cleanup-JuanVuletich-2024Jun18-14h09m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6479] on 18 June 2024 at 2:27:00 pm'!
!Browser methodsFor: 'self-updating' stamp: 'jmv 6/18/2024 14:14:18'!
   classRenamed: aClass from: oldClassName to: newClassName inCategory: aCategoryName

	| currentSelectedClass |
	
	selectedSystemCategory = aCategoryName ifTrue: [
		currentSelectedClass := self selectedClass.
		currentSelectedClass ifNil: [ 
			selectedClassName = oldClassName ifTrue: [ 
				currentSelectedClass := aClass ]].
	 	self changed: #classList.
		self selectClass: currentSelectedClass ].! !
!BrowserWindow methodsFor: 'updating' stamp: 'jmv 6/18/2024 14:13:16' prior: 16799678 overrides: 16826898!
  classRenamed: aClass from: oldClassName to: newClassName inCategory: aCategoryName

	self canDiscardEdits ifTrue: [
		self model classRenamed: aClass from: oldClassName to: newClassName inCategory: aCategoryName ].! !

Browser removeSelector: #originalSelectedClassName!

!methodRemoval: Browser #originalSelectedClassName stamp: 'Install-6480-Cleanup-JuanVuletich-2024Jun18-14h25m-jmv.001.cs.st 7/8/2024 11:53:09'!
originalSelectedClassName
	"Returns the selectedClassName no matter if it exits or not.
	It is used for refreshing the browser when renaming a class - Hernan"

	^selectedClassName!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6480-Cleanup-JuanVuletich-2024Jun18-14h25m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6479] on 18 June 2024 at 2:29:30 pm'!
!Browser methodsFor: 'class list' stamp: 'jmv 6/18/2024 11:10:08' prior: 16797873 overrides: 16826513!
        selectedClass
	"Answer the class that is currently selected. Answer nil if no selection 
	exists."

	^selectedClassName ifNotNil: [
		Smalltalk at: selectedClassName ifAbsent: nil ]! !
!Browser methodsFor: 'running tests' stamp: 'jmv 6/18/2024 11:11:52' prior: 16799068!
                 runClassTests

	self selectedClass ifNotNil: [ :selectedClass |
		(ProgressiveTestRunner for: (TestSuite forClass: selectedClass)) value ].
! !
!CodeFileBrowser methodsFor: 'class list' stamp: 'jmv 6/18/2024 14:19:47' prior: 16822750 overrides: 50349714!
 selectedClass
	"Answer the class that is currently selected. Answer nil if no selection 
	exists."

	^selectedClassName ifNotNil: [
		caseCodeSource classNamed: selectedClassName ]! !

HierarchyBrowser removeSelector: #selectedClassName!

!methodRemoval: HierarchyBrowser #selectedClassName stamp: 'Install-6481-Cleanup-JuanVuletich-2024Jun18-14h27m-jmv.001.cs.st 7/8/2024 11:53:09'!
selectedClassName
	"Answer the name of the class currently selected.   di
	  bug fix for the case where name cannot be found -- return nil rather than halt"

	| aName |
	
	aName := super selectedClassName.
	^ aName ifNotNil: [aName withoutLeadingBlanks asSymbol]!

Browser removeSelector: #selectedClassName!

!methodRemoval: Browser #selectedClassName stamp: 'Install-6481-Cleanup-JuanVuletich-2024Jun18-14h27m-jmv.001.cs.st 7/8/2024 11:53:09'!
selectedClassName
	"Answer the name of the current class. Answer nil if no selection exists."

	^selectedClassName ifNotNil: [ 
		"I send #defaultClassList and no #classList because when showing classes hierarchically we should remove spaces to see
		if class name is in the list and that consumes more time - Hernan"
		(self defaultClassList includes: selectedClassName) ifTrue: [ selectedClassName ]]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6481-Cleanup-JuanVuletich-2024Jun18-14h27m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6487] on 18 June 2024 at 2:35:25 pm'!
!Browser methodsFor: 'class list' stamp: 'jmv 6/18/2024 11:13:51'!
               basicClassList
	"Answer an array of the class names of the selected category. Answer an 
	empty array if no selection exists."
	selectedSystemCategory ifNil: [^ #()].
	^ systemOrganizer fullListAtCategoryNamed: selectedSystemCategory! !
!SinglePackageBrowser methodsFor: 'lists' stamp: 'jmv 6/18/2024 11:13:49' overrides: 50349779!
                    basicClassList
	"Answer an array of the class names of the selected category. Answer an 
	empty array if no selection exists."
	| answer |
	answer := selectedSystemCategory
		ifNil: [#()]
		ifNotNil: [
			(package includesSystemCategory: selectedSystemCategory)
				ifTrue: [ systemOrganizer listAtCategoryNamed: selectedSystemCategory ]
				ifFalse: [ 
					package extensionClassNamesIn: (selectedSystemCategory copyFrom: 2 to: selectedSystemCategory size) ]].
	selectedClassName ifNil: [
		answer isEmpty ifFalse: [
			selectedClassName := answer first.
			self setClassOrganizer.
			self editSelection: #editClass ]].
	^answer! !
!Browser methodsFor: 'class list' stamp: 'jmv 6/18/2024 11:14:06' prior: 16797671!
                   classList

	^ listClassesHierarchically
		ifTrue: [self hierarchicalClassList]
		ifFalse: [self basicClassList].! !
!Browser methodsFor: 'class list' stamp: 'jmv 6/18/2024 11:14:45' prior: 16797813!
                         hierarchicalClassList
	"classNames are an arbitrary collection of classNames of the system.
	Reorder those class names so that they are sorted and indended by inheritance"

	| classes |
	classes := self basicClassList collect: [:sym | Smalltalk classNamed: sym].
	^ self
		flattenHierarchyTree: (self createHierarchyTreeOf: classes)
		on: OrderedCollection new
		indent: ''.
! !

SinglePackageBrowser removeSelector: #defaultClassList!

!methodRemoval: SinglePackageBrowser #defaultClassList stamp: 'Install-6482-Cleanup-JuanVuletich-2024Jun18-14h33m-jmv.001.cs.st 7/8/2024 11:53:09'!
defaultClassList
	"Answer an array of the class names of the selected category. Answer an 
	empty array if no selection exists."
	| answer |
	answer := selectedSystemCategory
		ifNil: [#()]
		ifNotNil: [
			(package includesSystemCategory: selectedSystemCategory)
				ifTrue: [ systemOrganizer listAtCategoryNamed: selectedSystemCategory ]
				ifFalse: [ 
					package extensionClassNamesIn: (selectedSystemCategory copyFrom: 2 to: selectedSystemCategory size) ]].
	selectedClassName ifNil: [
		answer isEmpty ifFalse: [
			selectedClassName := answer first.
			self setClassOrganizer.
			self editSelection: #editClass ]].
	^answer!

Browser removeSelector: #defaultClassList!

!methodRemoval: Browser #defaultClassList stamp: 'Install-6482-Cleanup-JuanVuletich-2024Jun18-14h33m-jmv.001.cs.st 7/8/2024 11:53:09'!
defaultClassList
	"Answer an array of the class names of the selected category. Answer an 
	empty array if no selection exists."
	selectedSystemCategory ifNil: [^ #()].
	^ systemOrganizer fullListAtCategoryNamed: selectedSystemCategory!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6482-Cleanup-JuanVuletich-2024Jun18-14h33m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6482] on 18 June 2024 at 4:50:37 pm'!
!SystemDictionary methodsFor: 'retrieving' stamp: 'jmv 6/18/2024 16:39:40'!
                    numberOfDirectSendersOf: aSymbol
	"Answer the count of all the methods that call on aLiteral.
	[ (Smalltalk numberOfSendersOf: #open:label:) ] timeToRun
	[ (Smalltalk numberOfDirectSendersOf: #open:label:) ] timeToRun
	[ (Smalltalk numberOfSendersOf: #==) ] timeToRun
	[ (Smalltalk numberOfDirectSendersOf: #==) ] timeToRun
	"
	| count specialFlag specialByte |
	count := 0.
	specialFlag := self hasSpecialSelector: aSymbol ifTrueSetByte: [ :b | specialByte := b ].
	self allBehaviorsDo: [ :class |
		class selectorsAndMethodsDo: [ :sel :method |
			((method hasLiteral: aSymbol) or: [specialFlag and: [(method scanFor: specialByte)]])
				ifTrue: [ count := count + 1 ]]].
	^ count! !
!SystemDictionary methodsFor: 'retrieving' stamp: 'jmv 6/18/2024 16:42:29' prior: 50340264!
                      numberOfSendersOf: aSymbol
	"Answer the count of all the methods that call on aLiteral.
	[ (Smalltalk numberOfSendersOf: #open:label:) ] timeToRun
	[ (Smalltalk numberOfSendersOf: #==) ] timeToRun
	
	See #numberOfDirectSendersOf:
	"
	| count specialFlag specialByte |
	count := 0.
	specialFlag := self hasSpecialSelector: aSymbol ifTrueSetByte: [ :b | specialByte := b ].
	self allBehaviorsDo: [ :class |
		count := count + (class whichSelectorsReferTo: aSymbol special: specialFlag byte: specialByte) size ].
	^ count! !
!CodeProvider methodsFor: 'annotation' stamp: 'jmv 6/18/2024 16:40:20' prior: 16825387!
                              annotationForSelector: aSelector ofClass: aClass
	"Provide a line of content for an annotation pane, representing  
	information about the given selector and class"

	| method |
	aSelector == #Comment
		ifTrue: [^ self annotationForClassCommentFor: aClass].
	aSelector == #Definition
		ifTrue: [^ self annotationForClassDefinitionFor: aClass].

	method := aClass compiledMethodAt: aSelector ifAbsent: nil.
	^ String streamContents: [ :strm |
		(Preferences at: #methodAnnotations)
			do: [ :each |
				each caseOf: {
					[#firstComment] -> [
						strm nextPutAll: (aClass firstCommentAt: aSelector) ].
					[#masterComment] -> [
						strm nextPutAll: ((aClass supermostPrecodeCommentFor: aSelector) ifNil: ['']) ].
					[#documentation] -> [
						strm nextPutAll: ((aClass precodeCommentOrInheritedCommentFor: aSelector) ifNil: ['']) ].
					[#timeStamp] -> [ | stamp |
						stamp := self timeStamp.
						strm nextPutAll: (stamp size > 0 ifTrue: [stamp] ifFalse: ['no timestamp'])].
					[#linesOfCode] -> [
						method notNil ifTrue: [
							strm
								print: method linesOfCode;
								nextPutAll: ' lines of code' ]].
					[#messageSendsCount] -> [
						method notNil ifTrue: [
							strm
								print: method messageSendsCount;
								nextPutAll: ' message sends' ]].
					[#messageCategory] -> [
						strm nextPutAll: (( aClass organization categoryOfElement: aSelector) ifNil: ['']) ].
					[#sendersCount] -> [ | sendersCount |
						sendersCount := Smalltalk numberOfDirectSendersOf: aSelector.
						sendersCount := sendersCount = 1
								ifTrue: ['1 direct sender']
								ifFalse: [sendersCount printString , ' direct senders'].
						strm nextPutAll: sendersCount ].
					[#implementorsCount] -> [ | implementorsCount |
						implementorsCount := Smalltalk numberOfImplementorsOf: aSelector.
						implementorsCount := implementorsCount = 1
								ifTrue: ['1 implementor']
								ifFalse: [implementorsCount printString , ' implementors'].
						strm nextPutAll: implementorsCount ].
					[#priorVersionsCount] -> [
						self addPriorVersionsCountForSelector: aSelector ofClass: aClass to: strm].
					[#priorTimeStamp] -> [ | stamp |
						stamp := VersionsBrowser
								timeStampFor: aSelector
								class: aClass
								reverseOrdinal: 2.
						strm nextPutAll: 'prior timestamp: '; nextPutAll: (stamp ifNil: ['None']) ].
					[#packages] -> [
						method notNil ifTrue: [
							(CodePackage packageOfMethod: method methodReference ifNone: nil)
								ifNil: [ strm nextPutAll: 'in no package' ]
								ifNotNil: [ :codePackage |
									strm nextPutAll: 'in package '; nextPutAll: codePackage packageName ]]].
					[#changeSets] -> [ | aList |
						aList := ChangeSet allChangeSetsWithClass: aClass selector: aSelector.
						aList notEmpty
							ifTrue: [ aList size = 1
									ifTrue: [strm nextPutAll: 'only in change set']
									ifFalse: [strm nextPutAll: 'in change sets:'].
								aList
									do: [:aChangeSet | strm nextPut: Character space; nextPutAll: aChangeSet name ]
									separatedBy: [ strm nextPut: $, ]]
							ifFalse: [strm nextPutAll: 'in no change set']].
					[#allChangeSets] -> [ | aList |
						aList := ChangeSet allChangeSetsWithClass: aClass selector: aSelector.
						aList notEmpty
							ifTrue: [ aList size = 1
									ifTrue: [strm nextPutAll: 'only in change set']
									ifFalse: [strm nextPutAll: 'in change sets:'].
								aList
									do: [:aChangeSet | strm nextPut: Character space; nextPutAll: aChangeSet name ]
									separatedBy: [ strm nextPut: $, ]]
							ifFalse: [strm nextPutAll: 'in no change set']].
					[#allBaseSystemChangeSets] -> [ | aList |
						aList := (ChangeSet allChangeSetsWithClass: aClass selector: aSelector) select: [ :it | it isForBaseSystem ].
						aList notEmpty
							ifTrue: [ aList size = 1
									ifTrue: [strm nextPutAll: 'only in base system change set']
									ifFalse: [strm nextPutAll: 'in base system change sets:'].
								aList
									do: [:aChangeSet | strm nextPut: Character space; nextPutAll: aChangeSet name ]
									separatedBy: [ strm nextPut: $, ]]
							ifFalse: [strm nextPutAll: 'in no base system change set']].
					[#closuresInfo] -> [
						strm nextPutAll: (aClass closuresInfoAt: aSelector)].
					
				}]
			separatedBy: [ strm nextPutAll: self annotationSeparator ].
		(method notNil and: [method hasBreakpoint]) ifTrue: [
			strm nextPutAll: self annotationSeparator.
			strm nextPutAll: '[Breakpoint]' ]
	].! !
!ChangeList methodsFor: 'viewing access' stamp: 'jmv 6/18/2024 16:40:39' prior: 16804727 overrides: 16825298!
annotation
	"Answer the string to be shown in an annotation pane.  Make plain that the annotation is associated with the current in-image version of the code, not of the selected disk-based version, and if the corresponding method is missing from the in-image version, mention that fact."

	| change count selectedCount ann1 ann2 |
	change := self currentChange.
	
	change isNil ifTrue: [
		count := listSelections size.
		selectedCount := listSelections count: [ :flag | flag ].
		^ 'Total items: ', count printString, ' - Selected items: ', selectedCount printString ].

	change changeType == #classDefinition ifTrue: [
		ann1 := change isMetaClassChange ifTrue: [ 'Metaclass' ] ifFalse: [ 'Class' ].
		ann2 := (Smalltalk includesKey: change changeClassName) ifTrue: [ ' already exists' ] ifFalse: [ ' not in system' ].
		^ann1, ann2 ].
	
	(self selectedMessageName isNil or: [self selectedClassOrMetaClass isNil])
		ifTrue: [^ ''].

	^ change methodSelector notNil
		ifFalse: [ super annotation]
		ifTrue: [
			(self isNewMethod: change)
				ifTrue: [
					String streamContents: [ :strm | | sel |
						sel := change methodSelector.
						strm
							nextPutAll: change changeClassName;
							nextPutAll: ' >> ';
							nextPutAll: sel;
							nextPutAll: ' is not present in the system. It has '.
							count := Smalltalk numberOfImplementorsOf: sel.
							count = 1
								ifTrue: [strm nextPutAll: '1 implementor']
								ifFalse: [count printOn: strm. strm nextPutAll: ' implementors' ].
							strm nextPutAll: ' and '.
							count := Smalltalk numberOfDirectSendersOf: sel.
							count = 1
								ifTrue: [strm nextPutAll: '1 direct sender.']
								ifFalse: [count printOn: strm. strm nextPutAll: ' direct senders.' ].
						]
					]
				ifFalse: [
					'current version: ', super annotation]]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6483-AvoidRecentAnnotationSeriousSlowdown-JuanVuletich-2024Jun18-16h47m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6483] on 18 June 2024 at 4:10:56 pm'!
!Behavior methodsFor: 'enumerating' stamp: 'sqr 6/18/2024 16:06:10'!
         withAllSuperAndSubclassesDo: aBlock
	self allSuperclassesDo: aBlock.
	aBlock value: self.
	self allSubclassesDo: aBlock! !
!Object methodsFor: 'tracing' stamp: 'sqr 6/18/2024 16:04:34' prior: 16915758!
                      inboundPointersExcluding: objectsToExclude
"Answer a list of all objects in the system that point to me, excluding those in the collection of objectsToExclude. I do my best to avoid creating any temporary objects that point to myself, especially method and block contexts."

	| allObjectsToExclude |
	Smalltalk garbageCollect.
	"Do this to get rid of just created MethodContext instance."
	Smalltalk primitiveGarbageCollect.

	allObjectsToExclude := { thisContext }, objectsToExclude.
	^Smalltalk allObjects select: [ :object |
		((object statePointsTo: self) or: 			[object class == self])
			and: [(allObjectsToExclude statePointsTo: object) not]
		]! !
!SystemDictionary methodsFor: 'class names' stamp: 'sqr 6/18/2024 16:05:04' prior: 16962446!
                   fillCaches
	"Fill cachedClassNames and cachedNonClassNames. Return an array with the calculated values."

	| classNames nonClassNames |
	classNames := IdentitySet new.
	nonClassNames := IdentitySet new.
	self keysAndValuesDo: [ :key :value |
		"The key == value name test below addresses two separate issues:
			1) Obsolete classes, where key = #Foo and value name = 'AnObsoleteFoo'
			2) Aliases, i.e., Smalltalk at: #OtherName put: aClass"
		(value class isMeta and: [ key == value name ])
			ifTrue: [ classNames add: key ]
			ifFalse: [ nonClassNames add: key ] ].
	classNames := classNames asArray sort.
	nonClassNames := nonClassNames asArray sort.
	cachedClassNames := classNames.
	cachedNonClassNames := nonClassNames.
	^{ classNames. nonClassNames }! !
!SystemDictionary methodsFor: 'retrieving' stamp: 'sqr 6/18/2024 16:06:29' prior: 16964836!
          allImplementorsOf: aSelector  localTo: aClass
	"Answer a sorted Collection of all the methods that implement the message
	aSelector in, above, or below the given class."

	| aSet cls |
	aSet := Set new.
	cls := aClass theNonMetaClass.
	cls withAllSuperAndSubclassesDo: [ :class |
		(class includesSelector: aSelector)
			ifTrue: [ aSet add: (MethodReference class: class selector: aSelector) ] ].
	cls class withAllSuperAndSubclassesDo: [ :class |
		(class includesSelector: aSelector)
			ifTrue: [ aSet add: (MethodReference class: class selector: aSelector) ] ].
	^aSet asArray sort! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'sqr 6/18/2024 16:05:15' prior: 16966147!
                 send: startUpOrShutDown toClassesNamedIn: startUpOrShutDownList with: argument
	"Send the message #startUp: or #shutDown: to each class named in the list.
	The argument indicates if the system is about to quit (for #shutDown:) or if
	the image is ia real startup (or just continue after image save) (for #startUp:).
	If any name cannot be found, then remove it from the list."

	| removals class |
	removals := OrderedCollection new.
	startUpOrShutDownList do:
		[:name |
		class := self at: name ifAbsent: nil.
		class
			ifNil: [removals add: name]
			ifNotNil: [class perform: startUpOrShutDown with: argument]].

	"Remove any obsolete entries, but after the iteration"
	"Well, not. Better just ignore them. Maybe it is stuff, like SoundPlayer, that was moved to optional packages, and can be loaded again anytime."
	"startUpOrShutDownList removeAll: removals"! !
!DataStream class methodsFor: 'as yet unclassified' stamp: 'sqr 6/18/2024 16:05:27' prior: 16841684!
                        initCachedState
	"TypeMap maps Smalltalk classes to type ID numbers which identify the data stream primitive formats.  nextPut: writes these IDs to the data stream.  NOTE: Changing these type ID numbers will invalidate all extant data stream files.  Adding new ones is OK.  
	Classes named here have special formats in the file.  If such a class has a subclass, it will use type 9 and write correctly.  It will just be slow.  (Later write the class name in the special format, then subclasses can use the type also.)
	 See nextPut:, next, typeIDFor:, & ReferenceStream>>isAReferenceType:"
	"
	DataStream initCachedState
	"

	| refTypes t |
	refTypes := OrderedCollection new.
	t := TypeMap := Dictionary newWithRoomForMoreThan: 80. "sparse for fast hashing"

	t at: UndefinedObject put: 1.   refTypes add: 0.
	t at: True put: 2.   refTypes add: 0.
	t at: False put: 3.   refTypes add: 0.
	t at: SmallInteger put: 4.	 refTypes add: 0.
	t at: String put: 5.   refTypes add: 1.
	t at: Symbol put: 6.   refTypes add: 1.
	t at: ByteArray put: 7.   refTypes add: 1.
	t at: Array put: 8.   refTypes add: 1.
	"(type ID 9 is for arbitrary instances of any class, cf. typeIDFor:)"
		refTypes add: 1.
	"(type ID 10 is for references, cf. ReferenceStream>>tryToPutReference:)"
		refTypes add: 0.
	t at: Bitmap put: 11.   refTypes add: 1.

	t at: Metaclass put: 12.   refTypes add: 0.
	"Type ID 13 is used for HyperSqueak User classes that must be reconstructed."
		refTypes add: 1.

	t at: Float put: 14.  refTypes add: 1.
	t at: BoxedFloat64 put: 14.
	t at: SmallFloat64 put: 14.

	"15: Deprecated compact Rects."
		refTypes add: 1.

	"type ID 16 is an instance with short header.  See beginInstance:size:"
		refTypes add: 1.

	t at: String put: 17.   refTypes add: 1.	"new String format, 1 or 4 bytes of length"
	t at: WordArray put: 18.  refTypes add: 1.	"bitmap-like"
	"t at: WordArrayForSegment put: 19."  refTypes add: 1.		"bitmap-like"
	t at: Float32Array put: 20.  refTypes add: 1.	"And all other word arrays, both 16-bit and 32-bit.  See methods in ArrayedCollection.  Overridden in SoundBuffer."
	"For all classes that are like WordArrays, store them the way ColorArray is stored.  As bits, and able to change endianness."
	Smalltalk do: [:cls |
		cls isBehavior ifTrue: [
			cls isPointers not & cls isVariable & cls isWords ifTrue: [
				(t includesKey: cls) ifFalse: [t at: cls put: 20]]]].

	t at: CompiledMethod put: 21.  refTypes add: 1.	"special creation method"

	t at: Character put: 22. refTypes add: 0.

	t at: UnicodeString put: 23.   refTypes add: 1.
	t at: UnicodeSymbol put: 24.   refTypes add: 1.

	"t at:  put: 25.  refTypes add: 0."
	ReferenceTypes := refTypes.		"save it"! !
!Behavior methodsFor: 'methods' stamp: 'sqr 6/18/2024 16:06:37' prior: 16789399!
           addTo: aSet methodsThatReferenceInHierarchyTo: aSymbol special: special byte: byte.
	
	self withAllSuperAndSubclassesDo: [ :class |
		class addMethodsTo: aSet thatReferenceTo: aSymbol special: special byte: byte ] 
		! !

UndefinedObject removeSelector: #subclassesDoGently:!

!methodRemoval: UndefinedObject #subclassesDoGently: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
subclassesDoGently: aBlock
	"Evaluate aBlock with all subclasses of nil.  Others are not direct subclasses of Class."

	^ Class subclassesDoGently: [:cl | 
			cl isMeta ifTrue: [aBlock value: cl soleInstance]].!

Metaclass removeSelector: #subclassesDoGently:!

!methodRemoval: Metaclass #subclassesDoGently: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
subclassesDoGently: aBlock
	"Evaluate aBlock for each of the receiver's immediate subclasses."
	thisClass subclassesDo: [:aSubclass |
		"The following test is for Class class which has to exclude
			the Metaclasses being subclasses of Class."
		aSubclass isInMemory ifTrue: [
			aSubclass isMeta ifFalse: [aBlock value: aSubclass class]]].!

Class removeSelector: #subclassesDoGently:!

!methodRemoval: Class #subclassesDoGently: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
subclassesDoGently: aBlock 
	"Evaluate the argument, aBlock, for each of the receiver's immediate subclasses."
	subclasses
		ifNotNil: [subclasses do: aBlock]!

Behavior removeSelector: #allSubclassesDoGently:!

!methodRemoval: Behavior #allSubclassesDoGently: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
allSubclassesDoGently: aBlock 
	"Evaluate the argument, aBlock, for each of the receiver's subclasses."

	self subclassesDoGently: 
		[:cl | 
		cl isInMemory ifTrue: [
			aBlock value: cl.
			cl allSubclassesDoGently: aBlock]]!

Behavior removeSelector: #subclassesDoGently:!

!methodRemoval: Behavior #subclassesDoGently: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
subclassesDoGently: aBlock
	"Evaluate the argument, aBlock, for each of the receiver's immediate subclasses."

	^self subclassesDo: aBlock!

Behavior removeSelector: #withAllSuperAndSubclassesDoGently:!

!methodRemoval: Behavior #withAllSuperAndSubclassesDoGently: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
withAllSuperAndSubclassesDoGently: aBlock
	self allSuperclassesDo: aBlock.
	aBlock value: self.
	self allSubclassesDoGently: aBlock!

Dictionary removeSelector: #at:ifPresentAndInMemory:!

!methodRemoval: Dictionary #at:ifPresentAndInMemory: stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
at: key ifPresentAndInMemory: aBlock
	"Lookup the given key in the receiver. If it is present, answer the value of evaluating the given block with the value associated with the key. Otherwise, answer nil."

	| v |
	v := self at: key ifAbsent: [^ nil].
	v isInMemory ifFalse: [^ nil].
	^ aBlock value: v
!

ProtoObject removeSelector: #isInMemory!

!methodRemoval: ProtoObject #isInMemory stamp: 'Install-6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st 7/8/2024 11:53:09'!
isInMemory
	"All normal objects are."
	^ true!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6484-Cleanup-isInMemory-AndresValloud-2024Jun18-16h03m-sqr.001.cs.st----!

'From Cuis7.1 [latest update: #6452] on 18 June 2024 at 10:38:08 pm'!

WeakSet removeSelector: #do:after:!

!methodRemoval: WeakSet #do:after: stamp: 'Install-6485-Cleanup-Symbol-AndresValloud-2024Jun18-22h32m-sqr.001.cs.st 7/8/2024 11:53:09'!
do: aBlock after: anElement
	| each startIndex |

	tally = 0 ifTrue: [^self].
	startIndex := anElement ifNil: [1] ifNotNil:
		[self findElementOrNil: anElement].
	startIndex + 1 to: array size do:
		[:index |
			((each := array at: index) == nil or: [each == flag])
				ifFalse: [aBlock value: each]
		]!

Symbol class removeSelector: #thatStarts:skipping:!

!methodRemoval: Symbol class #thatStarts:skipping: stamp: 'Install-6485-Cleanup-Symbol-AndresValloud-2024Jun18-22h32m-sqr.001.cs.st 7/8/2024 11:53:09'!
thatStarts: leadingCharacters skipping: skipSym
	"Answer a selector symbol that starts with leadingCharacters.
	Symbols beginning with a lower-case letter handled directly here.
	Ignore case after first char.
	If skipSym is not nil, it is a previous answer; start searching after it.
	If no symbols are found, answer nil.
	Used by Alt-q (Command-q) routines"

	| size firstMatch key |

	size := leadingCharacters size.
	size = 0 ifTrue: [^skipSym ifNil: [#''] ifNotNil: [nil]].

	firstMatch := leadingCharacters at: 1.
	size > 1 ifTrue: [key := leadingCharacters copyFrom: 2 to: size].

	self allSymbolTablesDo: [:each |
			each size >= size ifTrue:
				[
					((each at: 1) == firstMatch and:
						[key == nil or:
							[(each findString: key startingAt: 2 caseSensitive: false) = 2]])
								ifTrue: [^each]
				]
		] after: skipSym.

	^nil

"Symbol thatStarts: 'sf' skipping: nil"
"Symbol thatStarts: 'sf' skipping: #sfpGetFile:with:with:with:with:with:with:with:with:"
"Symbol thatStarts: 'candidate' skipping: nil"
!

Symbol class removeSelector: #allSymbolTablesDo:after:!

!methodRemoval: Symbol class #allSymbolTablesDo:after: stamp: 'Install-6485-Cleanup-Symbol-AndresValloud-2024Jun18-22h32m-sqr.001.cs.st 7/8/2024 11:53:09'!
allSymbolTablesDo: aBlock after: aSymbol

	Symbols do: aBlock after: aSymbol!

SymbolSet removeSelector: #do:after:!

!methodRemoval: SymbolSet #do:after: stamp: 'Install-6485-Cleanup-Symbol-AndresValloud-2024Jun18-22h32m-sqr.001.cs.st 7/8/2024 11:53:09'!
do: aBlock after: aSymbol

	| found |
	found := false.
	self do:
		[:each |
			found ifTrue: [aBlock value: each].
			each = aSymbol ifTrue: [found := true]
		]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6485-Cleanup-Symbol-AndresValloud-2024Jun18-22h32m-sqr.001.cs.st----!

'From Cuis7.1 [latest update: #6452] on 18 June 2024 at 11:05:43 pm'!
!TestCase class methodsFor: 'accessing' stamp: 'sqr 6/18/2024 22:55:03'!
                        sortedTestSelectorsFrom: aCollection

	^(aCollection asArray select: [:each | self isTestSelector: each]) sort! !
!TestCase class methodsFor: 'testing' stamp: 'sqr 6/18/2024 22:50:05'!
       isTestMethod: aCompiledMethod

	^(self isTestSelector: aCompiledMethod selector)
		and: [aCompiledMethod methodClass inheritsFrom: TestCase]! !
!TestCase class methodsFor: 'testing' stamp: 'sqr 6/18/2024 22:52:12'!
         isTestSelector: aSelector

	^aSelector beginsWith: self testSelectorPrefix
		:: and: [aSelector numArgs isZero]! !
!TestCase class methodsFor: 'testing' stamp: 'sqr 6/18/2024 22:48:31'!
      testSelectorPrefix

	^'test'! !
!CompiledMethod methodsFor: 'testing' stamp: 'sqr 6/18/2024 22:48:53' prior: 16833426!
         isTestMethod

    ^TestCase isTestMethod: self! !
!TestCase class methodsFor: 'accessing' stamp: 'sqr 6/18/2024 22:55:16' prior: 16975686!
                     allTestSelectors

	^self sortedTestSelectorsFrom: self allSelectors! !
!TestCase class methodsFor: 'accessing' stamp: 'sqr 6/18/2024 22:55:25' prior: 16975698!
testSelectors

	^self sortedTestSelectorsFrom: self selectors! !

UnicodeSymbol removeSelector: #testSelectorPrefix!

!methodRemoval: UnicodeSymbol #testSelectorPrefix stamp: 'Install-6486-Cleanup-Tests-AndresValloud-2024Jun18-22h38m-sqr.001.cs.st 7/8/2024 11:53:09'!
testSelectorPrefix

	^self class testSelectorPrefix !

UnicodeSymbol removeSelector: #isTestSelector!

!methodRemoval: UnicodeSymbol #isTestSelector stamp: 'Install-6486-Cleanup-Tests-AndresValloud-2024Jun18-22h38m-sqr.001.cs.st 7/8/2024 11:53:09'!
isTestSelector
	
	^(self beginsWith: self testSelectorPrefix) and: [ self numArgs isZero ]!

Symbol removeSelector: #testSelectorPrefix!

!methodRemoval: Symbol #testSelectorPrefix stamp: 'Install-6486-Cleanup-Tests-AndresValloud-2024Jun18-22h38m-sqr.001.cs.st 7/8/2024 11:53:09'!
testSelectorPrefix

	^self class testSelectorPrefix !

Symbol removeSelector: #isTestSelector!

!methodRemoval: Symbol #isTestSelector stamp: 'Install-6486-Cleanup-Tests-AndresValloud-2024Jun18-22h38m-sqr.001.cs.st 7/8/2024 11:53:09'!
isTestSelector
	
	^(self beginsWith: self testSelectorPrefix) and: [ self numArgs isZero ]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6486-Cleanup-Tests-AndresValloud-2024Jun18-22h38m-sqr.001.cs.st----!

'From Cuis7.1 [latest update: #6486] on 19 June 2024 at 9:33:07 am'!

UnicodeSymbol class removeSelector: #testSelectorPrefix!

!methodRemoval: UnicodeSymbol class #testSelectorPrefix stamp: 'Install-6487-Cleaup-JuanVuletich-2024Jun19-09h32m-jmv.001.cs.st 7/8/2024 11:53:09'!
testSelectorPrefix

	^ 'test'.!

Symbol class removeSelector: #testSelectorPrefix!

!methodRemoval: Symbol class #testSelectorPrefix stamp: 'Install-6487-Cleaup-JuanVuletich-2024Jun19-09h32m-jmv.001.cs.st 7/8/2024 11:53:09'!
testSelectorPrefix

	^ 'test'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6487-Cleaup-JuanVuletich-2024Jun19-09h32m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6483] on 18 June 2024 at 4:03:41 pm'!
!CompiledMethod methodsFor: 'literals' stamp: 'sqr 6/18/2024 15:36:24' prior: 16833686!
                      hasLiteral: literal
	"Answer whether the receiver references the argument, literal."
	2 to: self numLiterals - 1 do: "exclude superclass + selector/properties"
		[:index |
		(literal literalEqual: (self objectAt: index)) ifTrue: [^true]].
	^false! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6488-MonomorphicCallsAreFasterThanMegamorphicCalls-AndresValloud-2024Jun18-15h16m-sqr.001.cs.st----!

'From Cuis7.1 [latest update: #6452] on 18 June 2024 at 11:09:05 pm'!
!CodeWindow methodsFor: 'menu commands' stamp: 'sqr 6/18/2024 23:07:20' prior: 16827225!
         browseVersions
	"Create and schedule a Versions Browser, showing all versions of the 
	currently selected message. Answer the browser or nil."
	| method class |
	model selectedMessageName isNil ifTrue: [
		^ VersionsBrowserWindow
			browseCommentOf: model selectedClass ].
	method := model currentCompiledMethod.
	"because maybe the method has been removed --- unhelpful"
	method isNil ifTrue: [^self].
	class := method methodClass.
	^ VersionsBrowserWindow
		browseVersionsOf: method
		class: class
		meta: class isMeta
		category: (class organization categoryOfElement: method selector)
		selector: method selector! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6489-FixWalkbackWhenAskingVersionsOfJustDeletedMEthod-AndresValloud-2024Jun18-23h05m-sqr.001.cs.st----!

'From Cuis7.1 [latest update: #6489] on 26 June 2024 at 9:36:08 am'!
!CodeProvider class methodsFor: 'services' stamp: 'jmv 6/26/2024 09:30:27'!
  normalizeCodeForSaving: aTextOrString in: aClassOrMetaclass
	"Adapt edited code to be suitable or logging.
	Answer is a plain text.
	Additionally, if code was modified for better look and edition experience, normalize it.
	This may include reverting to ':=' for assignment, '^' for return, and any replacements of
	ASCII by Unicode symbols done by Shout.
	See also SHTextStylerST80 >> #privateConvertAssignmentsOffset:
	See also Clipboard >> #storeObject:"

	| answer |
	answer := aTextOrString asPlainString.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkUpArrow asString` with: '^'.
	^answer! !
!Behavior methodsFor: 'compiling' stamp: 'jmv 4/26/2024 12:19:58' prior: 16787472!
 compile: code notifying: requestor 
	"Compile the argument, code, as source code in the context of the 
	receiver and install the result in the receiver's method dictionary. The 
	second argument, requestor, is to be notified if an error occurs. The 
	argument code is either a string or an object that converts to a string or 
	a PositionableStream. This method also saves the source code."
	
	| methodAndNode updatedCode |
	methodAndNode := self
		basicCompile: code
		notifying: requestor
		trailer: self defaultMethodTrailer
		ifFail: [^nil].
	"Re-fetching source code may be needed if, for example, some variable declaration was corrected during compilation."
	updatedCode := CodeProvider normalizeCodeForSaving: (requestor ifNil: [code] ifNotNil: [requestor text]) in: self.
	methodAndNode method putSource: updatedCode fromParseNode: methodAndNode node inFile: 2
			withPreamble: [ :f | f newLine; nextPut: $!!; nextChunkPut: 'Behavior method'; newLine].
	self addSelectorSilently: methodAndNode selector withMethod: methodAndNode method.
	^ methodAndNode selector! !
!ClassDescription methodsFor: 'compiling' stamp: 'jmv 4/26/2024 12:20:06' prior: 16818948!
                  compile: code classified: category withStamp: changeStamp notifying: requestor logSource: logSource
	
	| methodAndNode selector isExistingMethod updatedCode |	
	methodAndNode := self basicCompile: code notifying: requestor 
							trailer: self defaultMethodTrailer ifFail: [^nil].
	selector := methodAndNode selector.
	isExistingMethod := self includesSelector: selector.
	isExistingMethod
		ifTrue: [
			(self theNonMetaClass isOkToChangeMethod: selector isMeta: self isMeta)
				ifFalse: [self error: 'Method modification not allowed']]
		ifFalse: [
			(self theNonMetaClass isOkToAddMethod: selector isMeta: self isMeta)
				ifFalse: [self error: 'Method addition not allowed']].
	logSource ifTrue: [
		"Re-fetching source code may be needed if, for example, some variable declaration was corrected during compilation."
		updatedCode := CodeProvider normalizeCodeForSaving: (requestor ifNil: [code] ifNotNil: [requestor text]) in: self.
		self logMethodSource: updatedCode forMethodWithNode: methodAndNode 
			inCategory: category withStamp: changeStamp notifying: requestor.
	].
	self addAndClassifySelector: selector withMethod: methodAndNode 
		method inProtocol: category notifying: requestor.
	^ methodAndNode selector! !
!Clipboard methodsFor: 'accessing' stamp: 'jmv 4/26/2024 12:21:16' prior: 16821220!
                             storeObject: anObject
	"Set new contents on the clipboard. Also export to OS.
	anObject can be a:
		String
		Text
		Form
		Morph
		Object.
	OS clipboard supports String. Other formats might be supported if ExtendedClipboardInterface is present and operative."

	| primitiveFormat id |

	"Store a copy of the object. This is appropriate in case the original object is modified after being copied to the clipboard.
	Another copy must be made again when pasting, as the same object could be pasted many times.
	Besides, store the original object, but weakly (so we don't prevent it GCed). The original object might be used in workspaces."
	(anObject isString or: [ anObject is: #Text])
		ifTrue: [
			contents := anObject copyForClipboard.
			contentsOriginalObjectWeakly at: 1 put: nil ]
		ifFalse: [
			contents := anObject copyForClipboard.
			contentsOriginalObjectWeakly at: 1 put: anObject ].
	
	self noteRecentClipping: contents.

	"Store on OS clipboard using ExtendedClipboardInterface if present.
	Warning: This has not yet been adapted to UTF-8 Unicode"
	self extendedClipboardInterface ifNotNil: [ :interface |
		interface canStore ifTrue: [
			id := self idFor: contents.
			contents isString
				ifTrue: [ ^interface storeString: contents id: id ].
			(contents is: #Text)
				ifTrue: [ ^interface storeText: contents id: id ].
			(contents is: #Form)
				ifTrue: [ ^interface storeForm: contents id: id ].
			(contents is: #Morph)
				ifTrue: [ ^interface storeForm: (contents imageForm: 32) id: id ].
			^interface storeString: contents asString id: id ]].

	"Otherwise use the clipboard primitives in the VM"
	"The VM uses UTF-8 for clipboard"
	primitiveFormat := self stringOrIdFor: contents.
	"See also SHTextStylerST80 >> #privateConvertAssignmentsOffset:
	See also CodeProvider class >> #normalizeCodeForCodeFiles:	"
	primitiveFormat := primitiveFormat copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	primitiveFormat := primitiveFormat copyReplaceAll: Character smalltalkLeftArrow asString with: ':='.
	primitiveFormat := primitiveFormat copyReplaceAll: Character smalltalkUpArrow asString with: '^'.
	primitiveFormat := primitiveFormat asUtf8Bytes.
	self primitiveClipboardString: primitiveFormat! !

CodeProvider class removeSelector: #normalizeCodeForCodeFiles:!

!methodRemoval: CodeProvider class #normalizeCodeForCodeFiles: stamp: 'Install-6490-autoCodeNormalization-tweaks-JuanVuletich-2024Jun26-09h26m-jmv.001.cs.st 7/8/2024 11:53:09'!
normalizeCodeForCodeFiles: aTextOrString
	"Adapt edited code to be suitable or logging.
	Answer is a plain text.
	Additionally, if code was modified for better look and edition experience, normalize it.
	This may include reverting to ':=' for assignment, '^' for return, and any replacements of
	ASCII by Unicode symbols done by Shout.
	See also SHTextStylerST80 >> #privateConvert
	See also Clipboard >> #storeObject:"

	| answer |
	answer := aTextOrString asPlainString.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkUpArrow asString` with: '^'.
	^answer!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6490-autoCodeNormalization-tweaks-JuanVuletich-2024Jun26-09h26m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6490] on 26 June 2024 at 12:37:36 pm'!

TextProvider subclass: #CodeProvider
	instanceVariableNames: 'currentCompiledMethod contentsSymbol '
	classVariableNames: 'CodeNormalizers '
	poolDictionaries: ''
	category: 'System-Text'!

!classDefinition: #CodeProvider category: #'System-Text' stamp: 'Install-6491-PluggableCodeNormalization-JuanVuletich-2024Jun26-12h24m-jmv.001.cs.st 7/8/2024 11:53:09'!
TextProvider subclass: #CodeProvider
	instanceVariableNames: 'currentCompiledMethod contentsSymbol'
	classVariableNames: 'CodeNormalizers'
	poolDictionaries: ''
	category: 'System-Text'!
!CodeProvider class methodsFor: 'services' stamp: 'jmv 6/26/2024 12:27:35'!
    addCodeNormalizer: aBlock
	"aBlock should have one argument, the code to process,
	and should evaluate to the processed code
	CodeProvider addCodeNormalizer: [ :code :cls | code, 'This is an extra comment1' asSmalltalkComment ].
	CodeProvider addCodeNormalizer: [ :code :cls | cls compilerClass new format: code in: cls notifying: nil. ].
	CodeProvider addCodeNormalizer: [ :code :cls | code, 'This is an extra comment2' asSmalltalkComment ].
	""
	CodeProvider clearCodeNormalizers.
	"
	CodeNormalizers := CodeNormalizers
		ifNil: [ { aBlock } ]
		ifNotNil: [ CodeNormalizers copyWith: aBlock ].! !
!CodeProvider class methodsFor: 'services' stamp: 'jmv 6/26/2024 11:11:31'!
                             clearCodeNormalizers
	"Just forget them."

	CodeNormalizers := nil.
! !
!CodeProvider class methodsFor: 'services' stamp: 'jmv 6/26/2024 12:28:03' prior: 50350682!
                            normalizeCodeForSaving: aTextOrString in: aClassOrMetaclass
	"Adapt edited code to be suitable for saving to sources or changes files.
	Answer is a plain text.
	Additionally, if code was modified for better look and edition experience, normalize it.
	This may include reverting to ':=' for assignment, '^' for return, and any replacements of
	ASCII by Unicode symbols done by Shout.
	See also SHTextStylerST80 >> #privateConvertAssignmentsOffset:
	See also Clipboard >> #storeObject:"

	| answer |
	answer := aTextOrString asPlainString.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkUpArrow asString` with: '^'.
	"Apply code any normalization services. For example, try:
	CodeProvider addCodeNormalizer: [ :code :cls | code, ' 						This is an extra comment1' asSmalltalkComment ].
	CodeProvider addCodeNormalizer: [ :code :cls | cls compilerClass new format: code in: cls notifying: nil. ].
	CodeProvider addCodeNormalizer: [ :code :cls | code, ' 						This is an extra comment2' asSmalltalkComment ].
	""
	CodeProvider clearCodeNormalizers.
	"
	CodeNormalizers ifNotNil: [
		CodeNormalizers do: [ :each |
			answer := each value: answer value: aClassOrMetaclass ]].
	^answer.! !

TextProvider subclass: #CodeProvider
	instanceVariableNames: 'currentCompiledMethod contentsSymbol'
	classVariableNames: 'CodeNormalizers'
	poolDictionaries: ''
	category: 'System-Text'!

!classDefinition: #CodeProvider category: #'System-Text' stamp: 'Install-6491-PluggableCodeNormalization-JuanVuletich-2024Jun26-12h24m-jmv.001.cs.st 7/8/2024 11:53:09'!
TextProvider subclass: #CodeProvider
	instanceVariableNames: 'currentCompiledMethod contentsSymbol'
	classVariableNames: 'CodeNormalizers'
	poolDictionaries: ''
	category: 'System-Text'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6491-PluggableCodeNormalization-JuanVuletich-2024Jun26-12h24m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6491] on 28 June 2024 at 11:01:26 am'!
!Float methodsFor: 'converting' stamp: 'jmv 6/28/2024 10:58:34'!
                         asMatching32BitSingleDecimalRepresentation
	"Answer a Float that prints the same as the 32 bit single precision that best represents us.
	This is not just us with a reduced mantissa.
	Compare the following:

	0.1 print. 										'Regular 64 bit Double (Float). Works as expected'.
	(Float32Array with: 0.1) first print. 										'64 bits Double built from 32 bit Single Precision. Annoying to most users.'.
	(Float32Array with: 0.1) first asMatching32BitSingleDecimalRepresentation print.
		'Last is the 64 bits Double that would have been built from user input if no intermediate 32 bits Single was involved' print.

	Float pi print. 										'Regular 64 bit Double (Float). Works as expected'.
	(Float32Array with: Float pi) first print. 										'64 bits Double built from 32 bit Single Precision. Annoying to most users.'.
	(Float32Array with: Float pi) first asMatching32BitSingleDecimalRepresentation print.
		'Last is the 64 bits Double that would have been built from user input if no intermediate 32 bits Single was involved' print.
	"

	| mantissaBitsToUse answerAbs printed |
	mantissaBitsToUse := 24.
	self isNaN ifTrue: [ ^self ].
	self isInfinite ifTrue: [ ^self ].
	self = 0.0 ifTrue: [ ^self ].
	printed := String streamContents: [ :strm |
		(self > 0 ifTrue: [ self ] ifFalse: [ self negated ])
			absPrintOn: strm base: 10 mantissaSignificantBits: mantissaBitsToUse ].
	answerAbs := Number readFrom: printed.
	^self > 0 ifTrue: [ answerAbs ] ifFalse: [ answerAbs negated ].! !
!Float methodsFor: 'printing' stamp: 'nice 4/20/2010 22:48' prior: 16865134!
                        absPrintExactlyOn: aStream base: base
	"Print my value on a stream in the given base.  Assumes that my value is strictly
	positive; negative numbers, zero, and NaNs have already been handled elsewhere.
	Based upon the algorithm outlined in:
	Robert G. Burger and R. Kent Dybvig
	Printing Floating Point Numbers Quickly and Accurately
	ACM SIGPLAN 1996 Conference on Programming Language Design and Implementation
	June 1996.
	https://www.cs.indiana.edu/~dyb/pubs/FP-Printing-PLDI96.pdf
	This version guarantees that the printed representation exactly represents my value
	by using exact integer arithmetic.
	See also #absPrintOn:base:mantissaSignificantBits:"

	| significand exp baseExpEstimate r s mPlus mMinus scale roundingIncludesLimits d tc1 tc2 fixedFormat decPointCount slowbit shead |
	self isInfinite ifTrue: [aStream nextPutAll: 'Infinity'. ^ self].
	significand := self significandAsInteger.
	roundingIncludesLimits := significand even.
	"What follows is equivalent, but faster than
		exp := self exponentPart - 52."
	exp := (self exponent - 52) max: MinValLogBase2.
	baseExpEstimate := (self exponent * base asFloat reciprocalLogBase2 - 1.0e-10) ceiling.
	exp >= 0
		ifTrue:
			[significand ~= 16r10000000000000
				ifTrue:
					[r := significand bitShift: 1 + exp.
					s := 2.
					mPlus := mMinus := 1 bitShift: exp]
				ifFalse:
					[r := significand bitShift: 2 + exp.
					s := 4.
					mPlus := 2 * (mMinus := 1 bitShift: exp)]]
		ifFalse:
			[(exp = MinValLogBase2 or: [significand ~= 16r10000000000000])
				ifTrue:
					[r := significand bitShift: 1.
					s := 1 bitShift: 1 - exp.
					mPlus := mMinus := 1]
				ifFalse:
					[r := significand bitShift: 2.
					s := 1 bitShift: 2 - exp.
					mPlus := 2.
					mMinus := 1]].
	baseExpEstimate >= 0
		ifTrue: [s := s * (base raisedToInteger: baseExpEstimate)]
		ifFalse:
			[scale := base raisedToInteger: baseExpEstimate negated.
			r := r * scale.
			mPlus := mPlus * scale.
			mMinus := mMinus * scale].
	((r + mPlus < s) not and: [roundingIncludesLimits or: [r + mPlus > s]])
		ifTrue: [baseExpEstimate := baseExpEstimate + 1]
		ifFalse:
			[r := r * base.
			mPlus := mPlus * base.
			mMinus := mMinus * base].
	(fixedFormat := baseExpEstimate between: -3 and: 6)
		ifTrue:
			[decPointCount := baseExpEstimate.
			baseExpEstimate <= 0
				ifTrue: [aStream nextPutAll: ('0.000000' truncateTo: 2 - baseExpEstimate)]]
		ifFalse:
			[decPointCount := 1].
	slowbit := 1 - s lowBit .
	shead := s bitShift: slowbit.
	[d := (r bitShift: slowbit) // shead.
	r := r - (d * s).
	(tc1 := (r > mMinus) not and: [roundingIncludesLimits or: [r < mMinus]]) |
	(tc2 := (r + mPlus < s) not and: [roundingIncludesLimits or: [r + mPlus > s]])] whileFalse:
		[aStream nextPut: (Character digitValue: d).
		r := r * base.
		mPlus := mPlus * base.
		mMinus := mMinus * base.
		decPointCount := decPointCount - 1.
		decPointCount = 0 ifTrue: [aStream nextPut: $.]].
	tc2 ifTrue:
		[(tc1 not or: [r * 2 >= s]) ifTrue: [d := d + 1]].
	aStream nextPut: (Character digitValue: d).
	decPointCount > 0
		ifTrue:
		[decPointCount - 1 to: 1 by: -1 do: [:i | aStream nextPut: $0].
		aStream nextPutAll: '.0'].
	fixedFormat ifFalse:
		[aStream nextPut: $e.
		aStream nextPutAll: (baseExpEstimate - 1) printString]! !
!Float methodsFor: 'printing' stamp: 'jmv 9/24/2018 13:40:36' prior: 16865245!
                    absPrintOn: aStream base: base mantissaSignificantBits: significantBits
	"Print my value on a stream in the given base.  Assumes that my value is strictly
	positive; negative numbers, zero, and NaNs have already been handled elsewhere.
	Based upon the algorithm outlined in:
	Robert G. Burger and R. Kent Dybvig
	Printing Floating Point Numbers Quickly and Accurately
	ACM SIGPLAN 1996 Conference on Programming Language Design and Implementation
	June 1996.
	https://www.cs.indiana.edu/~dyb/pubs/FP-Printing-PLDI96.pdf
	Note: This version performs all calculations with Floats instead of LargeIntegers, and loses
	about 3 lsbs of accuracy compared to an exact conversion. Therefore it is likely to be correct
	with significantBits up to 51.
	See also #absPrintExactlyOn:base:"

	| fBase exp baseExpEstimate r s mPlus mMinus scale d tc1 tc2 fixedFormat decPointCount |
	self isInfinite ifTrue: [aStream nextPutAll: 'Infinity'. ^ self].
	fBase := base asFloat.
	exp := self exponent.
	baseExpEstimate := (exp * fBase reciprocalLogBase2 - 1.0e-10) ceiling.
	exp >= 0
		ifTrue:
			[r := self.
			s := 1.0.
			mPlus := 1.0 timesTwoPower: exp - significantBits.
			mMinus := self significand ~= 1.0 ifTrue: [mPlus] ifFalse: [mPlus / 2.0]]
		ifFalse:
			[r := self timesTwoPower: significantBits.
			s := 1.0 timesTwoPower:  significantBits.
			mMinus := 1.0 timesTwoPower: (exp max: -1024).
			mPlus :=
				(exp = MinValLogBase2) | (self significand ~= 1.0)
					ifTrue: [mMinus]
					ifFalse: [mMinus * 2.0]].
	baseExpEstimate >= 0
		ifTrue:
			[exp = 1023
				ifTrue:   "scale down to prevent overflow to Infinity during conversion"
					[r := r / fBase.
					s := s * (fBase raisedToInteger: baseExpEstimate - 1).
					mPlus := mPlus / fBase.
					mMinus := mMinus / fBase]
				ifFalse:
					[s := s * (fBase raisedToInteger: baseExpEstimate)]]
		ifFalse:
			[exp < -1023
				ifTrue:   "scale up to prevent denorm reciprocals overflowing to Infinity"
					[d := (53 * fBase reciprocalLogBase2 - 1.0e-10) ceiling.
					scale := fBase raisedToInteger: d.
					r := r * scale.
					mPlus := mPlus * scale.
					mMinus := mMinus * scale.
					scale := fBase raisedToInteger: (baseExpEstimate + d) negated]
				ifFalse:
				[scale := fBase raisedToInteger: baseExpEstimate negated].
			s := s / scale].
	(r + mPlus >= s)
		ifTrue: [baseExpEstimate := baseExpEstimate + 1]
		ifFalse:
			[s := s / fBase].
	(fixedFormat := baseExpEstimate between: -3 and: 6)
		ifTrue:
			[decPointCount := baseExpEstimate.
			baseExpEstimate <= 0
				ifTrue: [aStream nextPutAll: ('0.000000' truncateTo: 2 - baseExpEstimate)]]
		ifFalse:
			[decPointCount := 1].
	[d := (r / s) truncated.
	r := r - (d * s).
	(tc1 := r <= mMinus) | (tc2 := r + mPlus >= s)] whileFalse:
		[aStream nextPut: (Character digitValue: d).
		r := r * fBase.
		mPlus := mPlus * fBase.
		mMinus := mMinus * fBase.
		decPointCount := decPointCount - 1.
		decPointCount = 0 ifTrue: [aStream nextPut: $.]].
	tc2 ifTrue:
		[tc1 not | (tc1 & (r*2.0 >= s)) ifTrue: [d := d + 1]].
	aStream nextPut: (Character digitValue: d).
	decPointCount > 0
		ifTrue:
		[decPointCount - 1 to: 1 by: -1 do: [:i | aStream nextPut: $0].
		aStream nextPutAll: '.0'].
	fixedFormat ifFalse:
		[aStream nextPut: $e.
		aStream nextPutAll: (baseExpEstimate - 1) printString]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6492-asMatchingSinglePrecisionDecimalRepresentation-JuanVuletich-2024Jun28-10h51m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6455] on 1 July 2024 at 4:34:08 pm'!
!String methodsFor: 'testing' stamp: 'fgz 7/1/2024 16:33:58'!
                              isIntegerDenotation
	"Answer true if the receiver denotes an integer number."
	
	^(self size > 1 and: [
		self first = $- and: [ (self findFirst: [:each | each isDigit not ] startingAt: 2) = 0 ]
			]) or: [ self size > 0 and: [ self allSatisfy: [:each | each isDigit ] ] ]

! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6493-String-IntegerDenotation-FelipeZak-2024Jul01-16h32m-fgz.001.cs.st----!

'From Cuis7.1 [latest update: #6493] on 5 July 2024 at 12:18:04 pm'!

ArrayedCollection variableDoubleByteSubclass: #DoubleByteArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

!classDefinition: #DoubleByteArray category: #'Collections-Arrayed' stamp: 'Install-6494-DoubleByteArray-DoubleWordArray-LucianoEstebanNotarfrancesco-2024Jul05-12h12m-len.001.cs.st 7/8/2024 11:53:09'!
ArrayedCollection variableDoubleByteSubclass: #DoubleByteArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!
!DoubleByteArray commentStamp: '<historical>' prior: 0!
         DoubleByteArrays store 16-bit unsigned Integer values, between 0 and 16rFFFF.
!

ArrayedCollection variableDoubleWordSubclass: #DoubleWordArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

!classDefinition: #DoubleWordArray category: #'Collections-Arrayed' stamp: 'Install-6494-DoubleByteArray-DoubleWordArray-LucianoEstebanNotarfrancesco-2024Jul05-12h12m-len.001.cs.st 7/8/2024 11:53:09'!
ArrayedCollection variableDoubleWordSubclass: #DoubleWordArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!
!DoubleWordArray commentStamp: '<historical>' prior: 0!
                         DoubleWordArrays store 64-bit unsigned Integer values, between 0 and 16rFFFFFFFFFFFFFFFF.
!
!DoubleByteArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:26:16' overrides: 16946620!
      atAllPut: value
	"Fill the receiver with the given value."
	<primitive: 145>
	super atAllPut: value! !
!DoubleByteArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:16:29' overrides: 16783592!
                           byteSize
	^self size * 2! !
!DoubleByteArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:18:48' overrides: 16783609!
      bytesPerElement
	"Number of bytes in each item.  This multiplied by (self size)*8 gives the number of bits stored."
	^ 2! !
!DoubleByteArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:17:53' overrides: 16783368!
      defaultElement
	^0! !
!DoubleByteArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 12:14:53'!
 signedAt: index
	"Return the 16-bit signed integer value at the given index of the receiver."

	<primitive: 143>
	index isInteger ifTrue: [self errorSubscriptBounds: index].
	index isNumber ifTrue: [^ self at: index truncated].
	self errorNonIntegerIndex.
! !
!DoubleByteArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 12:14:59'!
                   signedAt: index put: value
	"Store the given 16-bit signed integer at the given index in the receiver."

	<primitive: 144>
	index isInteger
		ifTrue: [
			(index >= 1 and: [index <= self size])
				ifTrue: [self errorImproperStore]
				ifFalse: [self errorSubscriptBounds: index]].
	index isNumber ifTrue: [^ self at: index truncated put: value].
	self errorNonIntegerIndex.
! !
!DoubleByteArray methodsFor: 'private' stamp: 'len 5/16/2019 06:21:22' overrides: 16947099!
         replaceFrom: start to: stop with: replacement startingAt: repStart 
	"Primitive. This destructively replaces elements from start to stop in the receiver starting at index, repStart, in the collection, replacement. Answer the receiver. Range checks are performed in the primitive only. Optional. See Object documentation whatIsAPrimitive."
	<primitive: 105>
	super replaceFrom: start to: stop with: replacement startingAt: repStart! !
!DoubleWordArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:26:24' overrides: 16946620!
                atAllPut: value
	"Fill the receiver with the given value."
	<primitive: 145>
	super atAllPut: value! !
!DoubleWordArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:16:45' overrides: 16783592!
                           byteSize
	^self size * 8! !
!DoubleWordArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:19:05' overrides: 16783609!
      bytesPerElement
	"Number of bytes in each item.  This multiplied by (self size)*8 gives the number of bits stored."
	^ 8! !
!DoubleWordArray methodsFor: 'accessing' stamp: 'len 5/16/2019 06:18:00' overrides: 16783368!
      defaultElement
	^0! !
!DoubleWordArray methodsFor: 'private' stamp: 'len 5/16/2019 06:21:40' overrides: 16947099!
              replaceFrom: start to: stop with: replacement startingAt: repStart 
	"Primitive. This destructively replaces elements from start to stop in the receiver starting at index, repStart, in the collection, replacement. Answer the receiver. Range checks are performed in the primitive only. Optional. See Object documentation whatIsAPrimitive."
	<primitive: 105>
	super replaceFrom: start to: stop with: replacement startingAt: repStart! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6494-DoubleByteArray-DoubleWordArray-LucianoEstebanNotarfrancesco-2024Jul05-12h12m-len.001.cs.st----!

'From Cuis7.1 [latest update: #6494] on 5 July 2024 at 12:32:46 pm'!

Smalltalk removeClassNamed: #ShortRunArray!

!classRemoval: #ShortRunArray stamp: 'Install-6495-Remove-ShortRunArray-JuanVuletich-2024Jul05-12h32m-jmv.001.cs.st 7/8/2024 11:53:09'!
ArrayedCollection variableWordSubclass: #ShortRunArray
	instanceVariableNames: ''
	classVariableNames: 'LastSaveOrder'
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6495-Remove-ShortRunArray-JuanVuletich-2024Jul05-12h32m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6494] on 5 July 2024 at 12:37:02 pm'!
!UnicodeString class methodsFor: 'services' stamp: 'jmv 7/5/2024 12:33:23' prior: 16994347!
utf16WordsFromUtf8: utf8ByteArray  includeBOM: wantsBOM
	"Convert the given string from UTF-8 to UTF-16.
	Include BOM if requested.
	https://en.wikipedia.org/wiki/UTF-16
	UnicodeString codePointsFromUtf8: #[36 226 130 172 240 144 144 183 240 164 173 162].
	(UnicodeString utf16WordsFromUtf8: #[36 226 130 172 240 144 144 183 240 164 173 162]
		includeBOM: false) asArray collect: [ :w | w hex ].
	(UnicodeString utf16WordsFromUtf8: #[36 226 130 172 240 144 144 183 240 164 173 162]
		includeBOM: true) asArray collect: [ :w | w hex ].
	"

	^DoubleByteArray streamContents: [ :strm | | s byteIndex n |
		wantsBOM ifTrue: [
			strm nextPut: 16rFEFF ].
		s := utf8ByteArray size.
		byteIndex := 1.
		[  byteIndex <= s ] whileTrue: [
			n := Character utf8BytesAndCodePointAt: byteIndex in: utf8ByteArray
				into: nil
				into: [ :codePoint |
					Character
						evaluate: [ :word | strm nextPut: word ]
						withUtf16WordsOf: codePoint ].
			byteIndex := byteIndex + n ]].! !

Smalltalk removeClassNamed: #ShortWordArray!

!classRemoval: #ShortWordArray stamp: 'Install-6496-UseDoubleByteArrayForUtf16-RemoveShortWordArray-JuanVuletich-2024Jul05-12h32m-jmv.001.cs.st 7/8/2024 11:53:09'!
ShortIntegerArray variableWordSubclass: #ShortWordArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6496-UseDoubleByteArrayForUtf16-RemoveShortWordArray-JuanVuletich-2024Jul05-12h32m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6496] on 5 July 2024 at 3:30:19 pm'!

WordArray removeSelector: #bytesPerElement!

!methodRemoval: WordArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	"Number of bytes in each item.  This multiplied by (self size)*8 gives the number of bits stored."
	^ 4!

ShortPointArray removeSelector: #bytesPerElement!

!methodRemoval: ShortPointArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement

	^ 4.
	!

ShortIntegerArray removeSelector: #bytesPerElement!

!methodRemoval: ShortIntegerArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	^2!

PointArray removeSelector: #bytesPerElement!

!methodRemoval: PointArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement

	^ 8!

Float64Array removeSelector: #bytesPerElement!

!methodRemoval: Float64Array #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	^8!

Float32PointArray removeSelector: #bytesPerElement!

!methodRemoval: Float32PointArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement

	^ 8!

DoubleWordArray removeSelector: #bytesPerElement!

!methodRemoval: DoubleWordArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	"Number of bytes in each item.  This multiplied by (self size)*8 gives the number of bits stored."
	^ 8!

DoubleByteArray removeSelector: #bytesPerElement!

!methodRemoval: DoubleByteArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	"Number of bytes in each item.  This multiplied by (self size)*8 gives the number of bits stored."
	^ 2!

ColorArray removeSelector: #bytesPerElement!

!methodRemoval: ColorArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement

	^4!

ByteArray removeSelector: #bytesPerElement!

!methodRemoval: ByteArray #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	"Number of bytes in each item.  This multiplied by (self size)*8 gives the number of bits stored."
	^ 1!

ArrayedCollection removeSelector: #bytesPerElement!

!methodRemoval: ArrayedCollection #bytesPerElement stamp: 'Install-6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st 7/8/2024 11:53:09'!
bytesPerElement
	^self class isBytes ifTrue: [ 1 ] ifFalse: [ 4 ].
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6497-bytesPerElement-remove-JuanVuletich-2024Jul05-15h29m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6496] on 5 July 2024 at 3:32:23 pm'!
!ArrayedCollection class methodsFor: 'aux' stamp: 'jmv 7/5/2024 15:24:22'!
                        bytesPerBasicElement
	"Answer the number of bytes that each of my basic elements requires.
	In other words:
		self basicSize * self class bytesPerBasicElement
	should equal the space required on disk by my variable sized representation."
	self isBytes ifTrue: [ ^1 ].
	self isDoubleBytes ifTrue: [ ^2 ].
	self isWords ifTrue: [ ^4 ].
	self isDoubleWords ifTrue: [ ^8 ].
	^Smalltalk wordSize.
! !
!AffineTransformation class methodsFor: 'aux' stamp: 'jmv 7/5/2024 15:24:45'!
      bytesPerBasicElement
	"Answer the number of bytes that each of my basic elements requires.
	In other words:
		self basicSize * self class bytesPerBasicElement
	should equal the space required on disk by my variable sized representation."
	self isBytes ifTrue: [ ^1 ].
	self isDoubleBytes ifTrue: [ ^2 ].
	self isWords ifTrue: [ ^4 ].
	self isDoubleWords ifTrue: [ ^8 ].
	^Smalltalk wordSize.
! !
!ArrayedCollection methodsFor: 'objects from disk' stamp: 'jmv 7/5/2024 15:24:51' prior: 16783592!
                 byteSize
	^self basicSize * self class bytesPerBasicElement
! !
!AffineTransformation methodsFor: 'objects from disk' stamp: 'jmv 7/5/2024 15:24:55' prior: 16781164!
                          byteSize
	^self basicSize * self class bytesPerBasicElement! !
!SpaceTally methodsFor: 'fileOut' stamp: 'jmv 7/5/2024 15:25:46' prior: 16957863!
               printSpaceAnalysis: threshold on: aStream
	"Warning!!
	This is most likely wrong. It was written for 32 bit V3 images.
	Please take a look at #spaceForInstancesOf:
	Review both methods, and any other one that might be related.
	"
	"
	SpaceTally new printSpaceAnalysis: 1 on:(FileStream forceNewFileNamed: 'STspace.text')
	"
	"sd-This method should be rewrote to be more coherent within the rest of the class 
	ie using preAllocate and spaceForInstanceOf:"

	"If threshold > 0, then only those classes with more than that number
	of instances will be shown, and they will be sorted by total instance space.
	If threshold = 0, then all classes will appear, sorted by name."

	| codeSpace instCount instSpace totalCodeSpace totalInstCount totalInstSpace eltSize n totalPercent percent |
	Smalltalk garbageCollect.
	totalCodeSpace := totalInstCount := totalInstSpace := n := 0.
	results := OrderedCollection new.
	'Taking statistics...'
		displayProgressAt: Sensor mousePoint
		from: 0 to: Smalltalk classNames size
		during: [ :barBlock |
			Smalltalk allClassesDo: [ :cl |
				codeSpace := cl spaceUsed.
				barBlock value: (n := n+1).
				Smalltalk garbageCollectMost.
				instCount := cl instanceCount.
				instSpace := 8 * instCount. "Object headers""Warning: The 3rd header word for big objects is not considered!!"
				cl isVariable
					ifTrue: [
						eltSize := cl bytesPerBasicElement.
						cl allInstancesDo: [ :x |
							instSpace := instSpace + (x basicSize * eltSize)]]
					ifFalse: [instSpace := instSpace + (cl instSize * instCount * 4)].
				results add: (SpaceTallyItem analyzedClassName: cl name codeSize: codeSpace instanceCount:  instCount spaceForInstances: instSpace).
				totalCodeSpace := totalCodeSpace + codeSpace.
				totalInstCount := totalInstCount + instCount.
				totalInstSpace := totalInstSpace + instSpace]].
	totalPercent := 0.0.

	aStream timeStamp.
	aStream
		nextPutAll: ('Class' padded: #right to: 30 with: $ );
		nextPutAll: ('code space' padded: #left to: 12 with: $ );
		nextPutAll: ('# instances' padded: #left to: 12 with: $ );
		nextPutAll: ('inst space' padded: #left to: 12 with: $ );
		nextPutAll: ('percent' padded: #left to: 8 with: $ ); newLine.

	threshold > 0 ifTrue: [
		"If inst count threshold > 0, then sort by space"
		results := (results select: [:s | s instanceCount >= threshold or: [s spaceForInstances > (totalInstSpace // 500)]])
			asArray sort: [:s :s2 | s spaceForInstances > s2 spaceForInstances]].

	results do: [:s |
		aStream
			nextPutAll: (s analyzedClassName padded: #right to: 30 with: $ );
			nextPutAll: (s codeSize printString padded: #left to: 12 with: $ );
			nextPutAll: (s instanceCount printString padded: #left to: 12 with: $ );
			nextPutAll: (s spaceForInstances printString padded: #left to: 14 with: $ ).
		percent := s spaceForInstances*100.0/totalInstSpace.
		totalPercent := totalPercent + percent.
		percent >= 0.1 ifTrue: [
			percent printOn: aStream integerDigits: 6 padWith: $  fractionDigits: 1 positiveIndicator: nil ].
		aStream newLine].

	aStream
		newLine; nextPutAll: ('Total' padded: #right to: 30 with: $ );
		nextPutAll: (totalCodeSpace printString padded: #left to: 12 with: $ );
		nextPutAll: (totalInstCount printString padded: #left to: 12 with: $ );
		nextPutAll: (totalInstSpace printString padded: #left to: 14 with: $ ).
	totalPercent printOn: aStream integerDigits: 6 padWith: $  fractionDigits: 1 positiveIndicator: nil! !

AffineTransformation removeSelector: #bytesPerBasicElement!

!methodRemoval: AffineTransformation #bytesPerBasicElement stamp: 'Install-6498-better-bytesPerBasicElement-JuanVuletich-2024Jul05-15h30m-jmv.001.cs.st 7/8/2024 11:53:10'!
bytesPerBasicElement
	"Answer the number of bytes that each of my basic elements requires.
	In other words:
		self basicSize * self bytesPerBasicElement
	should equal the space required on disk by my variable sized representation."
	^self class isBytes ifTrue: [ 1 ] ifFalse: [ 4 ]!

ArrayedCollection removeSelector: #bytesPerBasicElement!

!methodRemoval: ArrayedCollection #bytesPerBasicElement stamp: 'Install-6498-better-bytesPerBasicElement-JuanVuletich-2024Jul05-15h30m-jmv.001.cs.st 7/8/2024 11:53:10'!
bytesPerBasicElement
	"Answer the number of bytes that each of my basic elements requires.
	In other words:
		self basicSize * self bytesPerBasicElement
	should equal the space required on disk by my variable sized representation."
	^self class isBytes ifTrue: [ 1 ] ifFalse: [ 4 ]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6498-better-bytesPerBasicElement-JuanVuletich-2024Jul05-15h30m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6498] on 5 July 2024 at 3:34:11 pm'!
!Form methodsFor: 'private' stamp: 'jmv 7/5/2024 15:22:29' prior: 16869541!
                 hackBits64: bitThing
	"This method provides an initialization so that BitBlt may be used, eg, to 
	copy ByteArrays and other non-pointer objects efficiently.
	The resulting form looks 8 wide, 8 deep, and bitThing-size-in-words high."
	bitThing class isBits ifFalse: [self error: 'bitThing must be a non-pointer object'].
	depth := 8.
	width := 8.
	height := bitThing byteSize // width.
	bits := bitThing! !
!Form methodsFor: 'private' stamp: 'jmv 7/5/2024 15:22:23' prior: 16869558!
                             hackBits: bitThing
	"This method provides an initialization so that BitBlt may be used, eg, to 
	copy ByteArrays and other non-pointer objects efficiently.
	The resulting form looks 4 wide, 8 deep, and bitThing-size-in-words high."
	bitThing class isBits ifFalse: [self error: 'bitThing must be a non-pointer object'].
	depth := 8.
	width := 4.
	height := bitThing byteSize // width.
	bits := bitThing! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6499-cleaner-hackBits-JuanVuletich-2024Jul05-15h33m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6498] on 5 July 2024 at 3:34:33 pm'!
!Behavior methodsFor: 'testing' stamp: 'jmv 7/5/2024 15:06:58' prior: 16787065!
                       isBytes
	"Answer whether the receiver's instances have indexed 8-bit integer slots.
	If true, #isBits is also true.
	The class format is
		<5 bits inst spec><16 bits inst size>
	where the 5-bit inst spec is
			0	= 0 sized objects (UndefinedObject True False et al)
			1	= non-indexable objects with inst vars (Point et al)
			2	= indexable objects with no inst vars (Array et al)
			3	= indexable objects with inst vars (MethodContext AdditionalMethodState et al)
			4	= weak indexable objects with inst vars (WeakArray et al)
			5	= weak non-indexable objects with inst vars (ephemerons) (Ephemeron)
			6	= unused
			7	= immediates (SmallInteger, Character)
			8	= unused
			9	= 64-bit indexable
		10-11	= 32-bit indexable (Bitmap)
		12-15	= 16-bit indexable
		16-23	= 8-bit indexable
		24-31	= compiled methods (CompiledMethod)"

	^ self instSpec >= 16! !
!Behavior methodsFor: 'testing' stamp: 'jmv 7/5/2024 15:07:05' prior: 16787100!
                      isDoubleBytes
	"Answer whether the receiver's instances have indexed 16-bit integer slots.
	If true, #isBits is also true.
	The class format is
		<5 bits inst spec><16 bits inst size>
	where the 5-bit inst spec is
			0	= 0 sized objects (UndefinedObject True False et al)
			1	= non-indexable objects with inst vars (Point et al)
			2	= indexable objects with no inst vars (Array et al)
			3	= indexable objects with inst vars (MethodContext AdditionalMethodState et al)
			4	= weak indexable objects with inst vars (WeakArray et al)
			5	= weak non-indexable objects with inst vars (ephemerons) (Ephemeron)
			6	= unused
			7	= immediates (SmallInteger, Character)
			8	= unused
			9	= 64-bit indexable
		10-11	= 32-bit indexable (Bitmap)
		12-15	= 16-bit indexable
		16-23	= 8-bit indexable
		24-31	= compiled methods (CompiledMethod)"

	^ self instSpec = 12! !
!Behavior methodsFor: 'testing' stamp: 'jmv 7/5/2024 15:07:09' prior: 16787129!
                isDoubleWords
	"Answer whether the receiver's instances have indexed 64-bit integer slots.
	If true, #isBits is also true.
	 The class format is
		<5 bits inst spec><16 bits inst size>
	 where the 5-bit inst spec is
			0	= 0 sized objects (UndefinedObject True False et al)
			1	= non-indexable objects with inst vars (Point et al)
			2	= indexable objects with no inst vars (Array et al)
			3	= indexable objects with inst vars (MethodContext AdditionalMethodState et al)
			4	= weak indexable objects with inst vars (WeakArray et al)
			5	= weak non-indexable objects with inst vars (ephemerons) (Ephemeron)
			6	= unused
			7	= immediates (SmallInteger, Character)
			8	= unused
			9	= 64-bit indexable
		10-11	= 32-bit indexable (Bitmap)
		12-15	= 16-bit indexable
		16-23	= 8-bit indexable
		24-31	= compiled methods (CompiledMethod)"

	^ self instSpec = 9! !
!Behavior methodsFor: 'testing' stamp: 'jmv 7/5/2024 15:07:13' prior: 16787261!
               isWords
	"Answer whether the receiver's instances have indexed 32-bit integer slots.
	If true, #isBits is also true.
	The class format is
		<5 bits inst spec><16 bits inst size>
	where the 5-bit inst spec is
			0	= 0 sized objects (UndefinedObject True False et al)
			1	= non-indexable objects with inst vars (Point et al)
			2	= indexable objects with no inst vars (Array et al)
			3	= indexable objects with inst vars (MethodContext AdditionalMethodState et al)
			4	= weak indexable objects with inst vars (WeakArray et al)
			5	= weak non-indexable objects with inst vars (ephemerons) (Ephemeron)
			6	= unused
			7	= immediates (SmallInteger, Character)
			8	= unused
			9	= 64-bit indexable
		10-11	= 32-bit indexable (Bitmap)
		12-15	= 16-bit indexable
		16-23	= 8-bit indexable
		24-31	= compiled methods (CompiledMethod)"

	^ self instSpec = 10! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6500-NicerComments-JuanVuletich-2024Jul05-15h34m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6500] on 5 July 2024 at 3:48:33 pm'!
!DoubleByteArray commentStamp: '<historical>' prior: 50351322!
      DoubleByteArrays store 16-bit unsigned Integer values, between 0 and 16rFFFF, or signed integers in the 16bit range, i.e. between -16r8000 and 16r7FFF.!

DoubleByteArray variableDoubleByteSubclass: #Int16PointArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

!classDefinition: #Int16PointArray category: #'Collections-Arrayed' stamp: 'Install-6501-Int16PointArray-JuanVuletich-2024Jul05-15h47m-jmv.001.cs.st 7/8/2024 11:53:10'!
DoubleByteArray variableDoubleByteSubclass: #Int16PointArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!
!Int16PointArray commentStamp: '<historical>' prior: 0!
                    This class stores points that are in signed short integer range (e.g., -32767 <= value <= 32768).!
!PointArray commentStamp: '<historical>' prior: 16926195!
   This class stores 32bit Signed Integer points in place. It is used to pass data efficiently to the primitive level during high-bandwidth 2D graphics operations.!
!Int16PointArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 15:00:17' overrides: 16913512!
 at: index
	"Return the element (e.g., point) at the given index"
	^(self signedAt: index * 2 - 1) @ (self signedAt: index * 2).
! !
!Int16PointArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 15:00:28' overrides: 16913530!
                               at: index put: aPoint
	"Store the argument aPoint at the given index"
	self signedAt: index * 2 - 1 put: aPoint x asInteger.
	self signedAt: index * 2 put: aPoint y asInteger.
	^aPoint.
! !
!Int16PointArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 15:00:42'!
                         at: index putX: aNumber
	"Store the argument aPoint at the given index"
	self signedAt: index * 2 - 1 put: aNumber asInteger.
! !
!Int16PointArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 15:00:49'!
                     at: index putY: aNumber
	"Store the argument aPoint at the given index"
	self signedAt: index * 2 put: aNumber asInteger.
! !
!Int16PointArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 15:01:31' overrides: 50351368!
     defaultElement
	"Return the default element of the receiver"
	^0@0.
! !
!Int16PointArray methodsFor: 'accessing' stamp: 'jmv 7/5/2024 15:01:59' overrides: 16783334!
                           size
	"Return the number of elements in the receiver"
	^ super size // 2.
! !
!Int16PointArray class methodsFor: 'instance creation' stamp: 'jmv 7/5/2024 15:38:22' overrides: 16783750!
       new: n
	^super new: n * 2.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6501-Int16PointArray-JuanVuletich-2024Jul05-15h47m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6500] on 5 July 2024 at 3:46:50 pm'!
!TrueTypeFontFamily class methodsFor: 'instance creation' stamp: 'jmv 7/5/2024 15:46:15' prior: 16990597!
                    readAllTrueTypeFontsIn: aDirectoryEntry
	"
	TrueTypeFontFamily readAllTrueTypeFontsIn: DirectoryEntry trueTypeFontsDirectory / 'DejaVu' / 'DejaVuSans'
	"
	| readFamilyNames |
	readFamilyNames := TTFontDescription readTrueTypeFontsIn: aDirectoryEntry.
	readFamilyNames do: [ :familyName |
		| ttDescriptions baseTTDescription family |
		ttDescriptions := TTFontDescription withFamilyName: familyName.
		baseTTDescription := ttDescriptions at: 0.
		family := TrueTypeFontFamily baseTTFontDescription: baseTTDescription.
		ttDescriptions do: [ :ttfDesc |
			ttfDesc emphasis = 0 ifFalse: [
				family addTTFontDescription: ttfDesc ]].
		FontFamily addFamily: family ].
	^readFamilyNames! !
!TTGlyph methodsFor: 'private-initialization' stamp: 'jmv 7/5/2024 15:36:46' prior: 16973797!
                   initializeContours: numContours with: endPoints
	"Initialize the contours for creation of the glyph."
	| startPt pts endPt |
	contours := Array new: numContours.
	startPt := -1.
	1 to: numContours do:[:i|
		endPt := endPoints at: i.
		pts := Int16PointArray new: endPt - startPt.
		contours at: i put: (TTContourConstruction on: pts).
		startPt := endPt].! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
TrueTypeFontFamily readAllTrueTypeFontsIn: DirectoryEntry trueTypeFontsDirectory / 'DejaVu' / 'DejaVuSans'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6502-User-Int16PointArray-not-ShortPointArray-JuanVuletich-2024Jul05-15h36m-jmv.003.cs.st----!

'From Cuis7.1 [latest update: #6502] on 5 July 2024 at 3:56:38 pm'!
!ArrayedCollection commentStamp: 'jmv 7/5/2024 15:56:07' prior: 16783287!
                I am an abstract superclass for collections of elements with the same storage size. My subclasses typically allocate storage as fixed size blocks. 

Element access is by an integer index, from 1 to collection size. Usual accessors are #at: and #at:put:

They are declared as having indexable instances. See:
	#variableSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
	#variableByteSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
	#variableDoubleByteSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
	#variableWordSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
	#variableDoubleWordSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
	#weakSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:

This means that they don't have instance variables. They are what is usually called an Array: a contiguous area of memory, that stores ObjectPointers (i.e. references to any objects), Bytes or 16, 32 or 64 bit Words. Each class is free to use that storarge to encode other kinds of data. See, for example, Float32Array Float64Array or DoubleByteArray. Therefore the size in bytes of each element is not constrained, although it is fixed for each class.

Instance size is fixed at creation. They can not grow or shrink.

For these reasons, there are many classes in the system that have Array like acessors (#at: and #at:put: with integer indexes) but are not in the ArrayedCollection hierarchy. These include OrderedCollection, Interval, Text, etc.!

Smalltalk removeClassNamed: #ShortIntegerArray!

!classRemoval: #ShortIntegerArray stamp: 'Install-6503-ShortIntegerArray-ShortPointArray-remove-JuanVuletich-2024Jul05-15h52m-jmv.001.cs.st 7/8/2024 11:53:11'!
ArrayedCollection variableWordSubclass: #ShortIntegerArray
	instanceVariableNames: ''
	classVariableNames: 'LastSaveOrder'
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

Smalltalk removeClassNamed: #ShortPointArray!

!classRemoval: #ShortPointArray stamp: 'Install-6503-ShortIntegerArray-ShortPointArray-remove-JuanVuletich-2024Jul05-15h52m-jmv.001.cs.st 7/8/2024 11:53:11'!
AnObsoleteShortIntegerArray variableWordSubclass: #ShortPointArray
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Collections-Arrayed'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6503-ShortIntegerArray-ShortPointArray-remove-JuanVuletich-2024Jul05-15h52m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6503] on 5 July 2024 at 5:26:42 pm'!
!String commentStamp: 'jmv 7/5/2024 17:07:37' prior: 16959339!
                               A String is an indexed collection of Characters. In Cuis, Characters are represented in the Latin-1 (ISO 8859-1) encoding. Each character takes 1 byte.

String support a vast array of useful methods, which can best be learned by browsing and trying out examples as you find them in the code.

Here are a few useful methods to look at...
	String match:
	String contractTo:

String also inherits many useful methods from its hierarchy, such as
	SequenceableCollection ,
	SequenceableCollection copyReplaceAll:with:

See UnicodeString.!
!UniFileStream commentStamp: '<historical>' prior: 16991428!
             A new FileStream for Cuis.

Writes bytes. Binary content is stored verbatim. String is stored in UTF-8, but invalid UTF-8 sequences are interpreted as Latin-1 Characters (i.e. ISO-8859-1).!
!Character commentStamp: 'jmv 7/5/2024 17:11:09' prior: 16810598!
I represent a character by storing its associated Latin-1 code (ISO 8859-1). My instances are immediate, so that all occurrences of a character ($R, for example) are identical.!
!String methodsFor: 'converting' stamp: 'jmv 7/5/2024 17:09:33' prior: 16959814!
                             asCodePoints
	"Convert the given string to UTF-32 from the internal encoding: ISO Latin-1 (ISO 8859-1).
	Answer a WordArray."

	| inStream codePoint |
	^WordArray streamContents: [ :outStream |
		inStream := self readStream.
		[ inStream atEnd ] whileFalse: [
			codePoint := inStream next codePoint.
			outStream nextPut: codePoint ]]! !
!String methodsFor: 'converting' stamp: 'jmv 7/5/2024 17:09:13' prior: 16959848 overrides: 16813499!
        asUtf8Bytes
	"Convert the given string to UTF-8 from the internal encoding: ISO Latin-1 (ISO 8859-1)
	Answer a ByteArray with a valid UTF-8 sequence."

	| inStream codePoint |
	"Fast lane."
	self isAscii ifTrue: [ ^self asByteArray ].

	"Need to do UTF-8 encoding."
	^ByteArray streamContents: [ :outStream |
		inStream := self readStream.
		[ inStream atEnd ] whileFalse: [
			codePoint := inStream next codePoint.
			Character
				evaluate: [ :byte | outStream nextPut: byte ]
				withUtf8BytesOf: codePoint ]]! !
!String class methodsFor: 'instance creation' stamp: 'jmv 7/5/2024 17:09:53' prior: 16960143 overrides: 16814919!
          fromUtf8Bytes: aByteArray
	"Convert the given bytes from UTF-8 to the internal encoding: ISO Latin-1 (ISO 8859-1).
	Discard any code points that can not be represented.
	Use with caution. If in doubt, send this message to CharacterSequence instead."

	"Fast lane."
	(String isAscii: aByteArray) ifTrue: [
		^aByteArray asString ].

	"Need to do UTF-8 decoding."
	^self fromUtf8Bytes: aByteArray trimLastNull: false! !
!String class methodsFor: 'instance creation' stamp: 'jmv 7/5/2024 17:10:13' prior: 16960159!
fromUtf8Bytes: aByteArray trimLastNull: doTrimLastNullChar
	"Convert the given string from UTF-8 to the internal encoding: ISO Latin-1 (ISO 8859-1).
	Discard any code points that can not be represented."

	^String streamContents: [ :strm | | s byteIndex n |
		s := aByteArray size.
		byteIndex := 1.
		[  byteIndex <= s ] whileTrue: [
			n := Character utf8BytesAndCodePointAt: byteIndex in: aByteArray
				into: nil
				into: [ :codePoint |
					codePoint < 256 ifTrue: [
						strm nextPut: (Character codePoint: codePoint) ]].
			byteIndex := byteIndex + n
		].
		(doTrimLastNullChar and: [ aByteArray last = 0 ]) ifTrue: [
			strm position: strm position - 1 ]].! !
!UnicodeString methodsFor: 'comparing' stamp: 'jmv 7/5/2024 17:20:45' prior: 16993126!
           basicHash
	"Same hash value as a pure ASCII String.
	Some other reasonable hash value otherwise, but not the same as the one of the equivalent String if ISO-8859-1 non ASCII characters are present.
	Note: will answer different values for UnicodeString's  that are equal if #canonicalDecomposition is taken."
	bytes size >  ByteArray minSizeForHashQuick ifTrue: [
		^ bytes hashQuick: String hash ].
	^ByteArray
		hashBytes: bytes
		startingWith: String hash! !
!UnicodeString class methodsFor: 'instance creation' stamp: 'jmv 7/5/2024 17:12:28' prior: 16994106!
              fromBytesStream: aByteStream
	"Handle UTF-8 bytes, but convert invalid UTF-8 assuming it means ISO-8859-1.
	Argument can be, for example, a InflateStream."

	| utf8 codePointCount buffer readBytes leftover byteIndex n |
	buffer := ByteArray new: 10000.
	leftover := nil.
	codePointCount := 0.
	utf8 := ByteArray streamContents: [ :utf8Stream |
		[aByteStream atEnd] whileFalse: [ 
			readBytes := aByteStream nextInto: buffer.
			leftover ifNotNil: [
				readBytes := leftover, readBytes.
				leftover := nil ].
			byteIndex := 1.
			[ byteIndex <= (aByteStream atEnd
						ifFalse: [readBytes size-3] "To be sure we don't break a possible partially read multibyte code point."
						ifTrue: [readBytes size])   						"But do taks _all_ the bytes if they are the last ones."
			] whileTrue: [
				n := Character utf8BytesAndCodePointAt: byteIndex in: readBytes
					into: [ :byte1 :byte2 :byte3 :byte4 |
						utf8Stream nextPut: byte1.
						byte2 ifNotNil: [
							utf8Stream nextPut: byte2.
							byte3 ifNotNil: [
								utf8Stream nextPut: byte3.
								byte4 ifNotNil: [
									utf8Stream nextPut: byte4 ]]].
						codePointCount := codePointCount + 1]
					into: nil.
				byteIndex := byteIndex + n ].
			leftover := byteIndex > readBytes size ifFalse: [
				readBytes copyFrom: byteIndex to: readBytes size ].
		].
	].
	^UnicodeString fromUtf8Bytes: utf8 codePointCount: codePointCount.! !
!UniFileStream methodsFor: 'read, write, position' stamp: 'jmv 7/5/2024 17:13:55' prior: 16991866!
 nextUtf8BytesAndCodePointInto: bytesBlock into: codePointBlock
	"Find the next UTF-8 CodePoint from this file, assuming next byte is ISO 8859-1 if invalid UTF-8,
	or nil if at the end of the file."

	| bytesConsumed previousPosition |
	previousPosition := self position.
	bytesConsumed := 0.
	self nextByte ifNotNil: [ :byte1 |
		bytesConsumed := Character
			utf8BytesAndCodePointFor: byte1
			byte2: self nextByte
			byte3: self nextByte
			byte4: self nextByte
			into: bytesBlock
			into: codePointBlock ].
	self position: previousPosition + bytesConsumed.! !
!UniFileStream methodsFor: 'read, write, position' stamp: 'jmv 7/5/2024 17:16:29' prior: 16992008 overrides: 16927119!
                     skipBack
	| savePos try |
	savePos := self position.

	"Try going back one byte. If ASCII, then OK, we are done.
	If not, don't assume ISO-8859-1 so lightly!!"
	try := savePos-1.
	self position: try.
	self nextByte < 128 ifTrue: [
		^self position: try ].

	"Try going back two bytes. If doing #next leaves us at savePosition, we found a two byte CodePoint."
	try := try-1.
	self position: try.
	(self next notNil and: [ self position = savePos ]) ifTrue: [
		^self position: try ].

	"Try going back three bytes. If doing #next leaves us at savePosition, we found a three byte CodePoint."
	try := try-1.
	self position: try.
	(self next notNil and: [ self position = savePos ]) ifTrue: [
		^self position: try ].

	"Try going back four bytes. If doing #next leaves us at savePosition, we found a four byte CodePoint."
	try := try-1.
	self position: try.
	(self next notNil and: [ self position = savePos ]) ifTrue: [
		^self position: try ].

	"Havent found a valid UTF-8 sequence that ends just before savePos.
	It means back byte is an ISO-8859-1 Character"
	self position: savePos-1.
	! !
!UniFileStream methodsFor: 'accessing' stamp: 'jmv 7/5/2024 17:13:40' prior: 16992316 overrides: 16934973!
                contents
	"Return the full contents of the receiver. Do not close or otherwise touch the receiver.
	Return data in whatever mode the receiver is in (i.e. answer an instance of the appropriate class).
	Stream bytes as CodePoints (prefer UTF-8, but ISO-8859-1 if invalid UTF-8)."

	| savePos answer |
	savePos := self position.
	self position: 0.
	answer := self upToEnd.
	self position: savePos.
	^answer! !
!Character methodsFor: 'accessing' stamp: 'jmv 7/5/2024 17:16:46' prior: 16810606!
                      asciiValue
	"Answer the value of the receiver that represents its ANSI encoding.
	This is the same as ISO 8859-1 for the first 128 characters.
	Answer nil if out of range."

	| n |
	n := self codePoint.
	^ n < 128 ifTrue: [ n ].! !
!Character methodsFor: 'converting' stamp: 'jmv 7/5/2024 17:17:06' prior: 16810956!
    withDiacriticalMark: codePointOrCharacter
	"Answer the character resulting from adding a diacritical mark (accent) to a letter.
	If the result is unsupported in ISO 8859-1, answer the receiver.
	Supported diacritical marks are:
		U+0300 	COMBINING GRAVE ACCENT
		U+0301 	COMBINING ACUTE ACCENT
		U+0302 	COMBINING CIRCUMFLEX ACCENT
		U+0303 	COMBINING TILDE
		U+0308 	COMBINING DIAERESIS
		U+030A 	COMBINING RING ABOVE
		U+030C 	COMBINING CARON
		$a withDiacriticalMark: 16r301
		$N withDiacriticalMark: $~
		$Z withDiacriticalMark: $v
		
		invalid:
		$9 withDiacriticalMark:$v
		$A withDiacriticalMark: $v
		$√Å withDiacriticalMark: $v
		$A withDiacriticalMark: 1244
		"
	| answer i |
	i := ((codePointOrCharacter isNumber
			ifTrue: [#(16r300 16r301 16r302 16r303 16r308 16r30A 16r30C)]
			ifFalse: [#($` $' $^ $~ $" $¬∞ $v)]) indexOf: codePointOrCharacter
				) + 1.
	answer := (Character accentedLetters detect: [ :group | group first = self ] ifNone: [ ^self ]) at: i.
	^answer = $- ifFalse: [answer] ifTrue: [self]! !
!Character class methodsFor: 'class initialization' stamp: 'jmv 7/5/2024 17:16:39' prior: 16811012!
                            accentedLetters
	"Answer all letters with all possible accents (combining diacritical marks).
	Order of this array is:
		unaccented
		U+0300 	COMBINING GRAVE ACCENT
		U+0301 	COMBINING ACUTE ACCENT
		U+0302 	COMBINING CIRCUMFLEX ACCENT
		U+0303 	COMBINING TILDE
		U+0308 	COMBINING DIAERESIS
		U+030A 	COMBINING RING ABOVE
		U+030C 	COMBINING CARON
	Do not include letters that can't have any accent in ISO 8859-1
	Denote unsupported combinations (for example A with caron, or N with accute accent) by a $-"
self flag: #unicodeNeedsImprovement.
	^#(
		'A√Ä√Å√Ç√É√Ñ√Ö-'
		'a√†√°√¢√£√§√•-'
		'E√à√â√ä-√ã--'
		'e√®√©√™-√´--'
		'I√å√ç√é-√è--'
		'i√¨√≠√Æ-√Ø--'
		'O√í√ì√î√ï√ñ--'
		'o√≤√≥√¥√µ√∂--'
		'U√ô√ö√õ-√ú--'
		'u√π√∫√ª-√º--'
		'N---√ë---'
		'n---√±---'
		'S------≈†'
		's------≈°'
		'Y-√ù--≈∏--'
		'y-√Ω--√ø--'
		'Z------≈Ω'
		'z------≈æ'
	).! !
!Character class methodsFor: 'class initialization' stamp: 'jmv 7/5/2024 17:16:51' prior: 16811267!
             uppercaseLowercaseAndUnaccentedLetters
	"Answer all uppercase and lowercase letters in standard collation order.
	For accented characters, include the non-accented ones.
	Note that $√ü is 'LATIN SMALL LETTER SHARP S' and ISO 8859-1 doesn't have an uppercase version.
	Note: for $√ø, 'Latin Small Letter Y with diaeresis' the uppercase version is not Latin 1"
self flag: #unicodeNeedsImprovement.
	^#(
		'Aa' '√Ä√†Aa' '√Å√°Aa' '√Ç√¢Aa' '√É√£Aa' '√Ñ√§Aa' '√Ö√•Aa'
		'Bb' 'Cc' '√á√ß' 'Dd'
			'Ee' '√à√®Ee' '√â√©Ee' '√ä√™Ee' '√ã√´Ee'
		'Ff' 'Gg' 'Hh'
			'Ii' '√å√¨Ii' '√ç√≠Ii' '√é√ÆIi' '√è√ØIi'
		'Jj' 'Kk' 'Ll' 'Mm' 'Nn' '√ë√±'
			'Oo' '√í√≤Oo' '√ì√≥Oo' '√î√¥Oo' '√ï√µOo' '√ñ√∂Oo'
		'Pp' 'Qq' 'Rr'
			'Ss'
		'Tt'
			'Uu' '√ô√πUu' '√ö√∫Uu' '√õ√ªUu' '√ú√ºUu'
		'Vv' 'Ww' 'Xx'
			'Yy' '√ù√ΩYy' '√ø'
			'Zz'
		'√Ü√¶' '√ê√∞' '√ò√∏' '√û√æ' '√ü'
	).! !
!Character class methodsFor: 'converting' stamp: 'jmv 7/5/2024 17:21:06' prior: 16811609!
                           utf8BytesAndCodePointAt: byteIndex in: aByteArray into: bytesBlock into: codePointBlock
	"Find next UTF-8 encoded code point in utf8ByteArray starting at byte byteIndex.
	Evaluate bytesBlock (if not nil). Arguments are utf8 bytes for the codePoint found.
	Evaluate codePointBlock (if not nil) with codePoint found as argument.
	Answer the number of bytes that comprised this codePoint.
	If there is an invalid UTF-8 sequence, consider the first byte an ISO-8859-1 Character (i.e. Latin-1), and answer 1.
	Skip codePoint U+FEFF (BOM, unneededly added by Win clipboard). Still, answer the number of bytes of the BOM sequence, to allow senders to update an index in an iteration.
	See senders."

	| i s byte1 byte2 byte3 byte4 |
	
	s := aByteArray size.
	i := byteIndex.
	byte1 := aByteArray at: i.
	i := byteIndex+1.
	byte2 := i <= s ifTrue: [aByteArray at: i].
	i := byteIndex+2.
	byte3 := i <= s ifTrue: [aByteArray at: i].
	i := byteIndex+3.
	byte4 := i <= s ifTrue: [aByteArray at: i].

	^self
		utf8BytesAndCodePointFor: byte1
		byte2: byte2
		byte3: byte3
		byte4: byte4
		into: bytesBlock
		into: codePointBlock! !
!ByteStringReadAdaptor methodsFor: 'reading' stamp: 'jmv 7/5/2024 17:17:48' prior: 16801620 overrides: 16992565!
               next
	"Stream bytes as Latin-1 / ISO 8859-1 Characters.
	Disregard the fact that stream contents are most likely UTF-8.
	This is valid only if contents are ASCII, or Latin-1 / ISO-8859-1 byte Characters."

	stream nextByte ifNotNil: [ :byte |
		^Character codePoint: byte ].
	^nil! !
!ByteStringReadAdaptor methodsFor: 'reading' stamp: 'jmv 7/5/2024 17:18:08' prior: 16801632 overrides: 16992569!
                   next: n
	"Read n bytes, or until the end of the file.
	Answer them as seen from our perspective:
	Stream bytes as Latin-1 / ISO 8859-1 Characters.
	Disregard the fact that stream contents are most likely UTF-8.
	This is valid only if contents are ASCII, or Latin-1 / ISO-8859-1 byte Characters.
	Answer is a String (i.e. a byte oriented ISO 8859-1 String)"

	^(stream nextBytes: n) asString! !
!ByteStringReadAdaptor methodsFor: 'reading' stamp: 'jmv 7/5/2024 17:18:20' prior: 16801647 overrides: 16992575!
     streamUpToEnd
	"Answer the contents of our stream, from current postion to end, seen from our perspective:
	Stream bytes as Latin-1 / ISO 8859-1 Characters.
	Disregard the fact that stream contents are most likely UTF-8.
	This is valid only if contents are ASCII, or Latin-1 / ISO-8859-1 byte Characters.
	Leave stream at the end position."

	^stream bytesUpToEnd asString! !
!UnicodeReadAdaptor methodsFor: 'reading' stamp: 'jmv 7/5/2024 17:15:36' prior: 16992598 overrides: 16992569!
                          next: n
	"Read n Characters (i.e. n Unicode CodePoints), or until the end of the file.
	Answer them, from current postion to end, seen from our perspective:
	Stream bytes as CodePoints (prefer UTF-8, but answer ISO-8859-1 if invalid UTF-8).
	Answer is an instance of UnicodeString."

	| utf8 codePointCount |
	codePointCount := 0.
	utf8 := ByteArray streamContents: [ :utf8Stream |
		[ codePointCount = n or: [stream atEnd] ] whileFalse: [
			stream
				nextUtf8BytesAndCodePointInto: [ :byte1 :byte2 :byte3 :byte4 |
					utf8Stream nextPut: byte1.
					byte2 ifNotNil: [
						utf8Stream nextPut: byte2.
						byte3 ifNotNil: [
							utf8Stream nextPut: byte3.
							byte4 ifNotNil: [
								utf8Stream nextPut: byte4 ]]].
					codePointCount := codePointCount + 1]
				into: nil ]].
	^UnicodeString fromUtf8Bytes: utf8 codePointCount: codePointCount.! !
!UnicodeReadAdaptor methodsFor: 'reading' stamp: 'jmv 7/5/2024 17:15:43' prior: 16992628 overrides: 16992575!
                       streamUpToEnd
	"Answer the contents of our stream, from current postion to end, seen from our perspective:
	Stream bytes as CodePoints (prefer UTF-8, but answer ISO-8859-1 if invalid UTF-8).
	Leave stream at the end position."

	| utf8 codePointCount |
	codePointCount := 0.
	utf8 := ByteArray streamContents: [ :utf8Stream |
		[ stream atEnd ] whileFalse: [
			stream
				nextUtf8BytesAndCodePointInto: [ :byte1 :byte2 :byte3 :byte4 |
					utf8Stream nextPut: byte1.
					byte2 ifNotNil: [
						utf8Stream nextPut: byte2.
						byte3 ifNotNil: [
							utf8Stream nextPut: byte3.
							byte4 ifNotNil: [
								utf8Stream nextPut: byte4]]].
					codePointCount := codePointCount + 1]
				into: nil ]].
	^UnicodeString fromUtf8Bytes: utf8 codePointCount: codePointCount.! !
!Utilities class methodsFor: 'support windows' stamp: 'jmv 7/5/2024 17:18:56' prior: 16996095!
                        codeManagementInCuisContents
	^ self class firstCommentAt: #codeManagementInCuisContents

"
Managing your code in Cuis
==================

(https://github.com/Cuis-Smalltalk/Cuis-Smalltalk-Dev/blob/master/Documentation/CodeManagementInCuis.md)

Cuis includes tools and procedures for managing Smalltalk code. Code that is not part of the Cuis Core image itself, like applications, frameworks and libraries, should be stored in Packages. New code that are meant as patches, fixes or additions; that could eventually become part of Cuis itself, is not part of any Package, and is therefore automatically stored in ChangeSets.


Packages
-----------

Let's start with Packages. The Package implementation in Cuis is based on PackageInfo, the standard way to specify packages in Squeak and its derivatives, and used, for example, by Monticello. It uses Package names to specify prefixes for Class and Method categories. Classes and Methods whose categories match a Package's prefixes belong in that Package. More details about how PackageInfo decides what code belongs in a package are available at http://wiki.squeak.org/squeak/3329 .

To install packages (.pck.st files) in Cuis, use the FileList, navigate to the appropriate directory (on disk, or in a GitHub repository, etc), select the package file and click on [Install Package].

Cuis includes a tool to manage installed Packages. It is at World / Open / Installed Packages. To create a new package (instead of installing an existing one from a file), click on [Create Package] This creates a new package, and associates with it all the existing code in the image that matches the package name.

The operations available on installed or newly created packages are:

[Save] Saves a package on the file system. Overwrites any existing version. It is good to save the package from time to time, to reduce the risk of losing code.

[Delete] Removes the Package instance from the image. Does not remove any code. This means, effectively, to merge back the code into Cuis.

[Browse unsaved Changes] This opens a ChangeSorter on the ChangeSet that captures all the changes done to the Package since it was last saved. Therefore it shows the work done on the package that would be lost if the package is not saved.

[Browse package code] This opens a Class Browser that only shows the code that belongs in the package. This is useful for working on a package, or studying it.

[Add requirement] This opens a select list of loaded packages.  Each package provides a Feature.  You can CANCEL, require the current Cuis base version (at a minimum) or require any of the packages on the list.  Required packages will be loaded before the selected package (Feature require: #'your-package'.).  When a package is selected, the lower browser pane shows its requirents, which may be deleted.  Don't forget to Save your package after adding or deleting  requirements!!

The tool shows, for each Package, the name, whether it is dirty (has unsaved changes) and the file it was installed from / saved to.

Handling Packages like this, Cuis behaves as a sort of document editor (like, for example a regular text editor) whose documents are Package files (.pck.st). Cuis doesn't handle Package versions, ancestries, etc. If versioning of Packages is desired, the best is to use a versioning file repository, such as Git or Mercurial. The recommendation is to use a GitHub repository with a name beginning with 'Cuis-Smalltalk-', so it will be easy for anybody to find it. Cuis Package files are uncompressed, use Lf (ASCII 10) as newLine, and are encoded in UTF-8. This means they are Git friendly, and Git/GitHub can diff and merge them, and browse them with syntax highlighting.

This is not unlike using Git or GitHub with a file-based development environment such as Eclipse or a text editor. Like Cuis, these tools don't do version handling themselves, they just load and save files; and let Git do its magic.


Changes to the Cuis base image
-----------------------------------------

The way ChangeSets are created and managed in Cuis is different from Squeak. This was done to make ChangeSets a good way to manage changes to the base Cuis Core image, while keeping code in Packages out of the way, so they don't get mixed together.

What is not in a Package belongs (at least temporarily) to the Cuis Core image. Such code is automatically captured in a ChangeSet. The ChangeSet for Core changes is created automatically and named like '1243-CuisCore-JuanVuletich-2012Apr03-22h50m'. The number at the beginning is the next number for the Cuis update stream, and is provided only as a suggestion. The 'CuisCore' part is to reveal that the code belongs in the base image and not in some package. Then we have author name and date / time of creation. These ChangeSets are created automatically. There is no longer a way to manually create them, or make them 'current' or 'active'. It is best to rename them, replacing 'CuisCore' with some meaningful name. These ChangeSets will not capture any code that belongs in a Package.

Opening a Change Sorter will show the CuisCore change set. This is useful, for example, to check that no code that was intended for a Package ends here by mistake (because of the wrong class or method category). But it is also useful when doing changes to the base system. Now, we can do changes both to the base system and to a number of packages, all in the same session, without having to be careful about selecting the proper change set before saving a method: The code is automatically added to the proper Package or ChangeSet, simply following the class or method category. Gone are the days of messed up change sets and lost code!!

When the changes to the base system are complete, it is a good time to review the CuisCore change set and, maybe remove from it changes that we don't want to keep (for example, experiments, halts, etc). Then, just do right click / File out and remove. This saves the ChangeSet on disk. It also removes it from the ChangeSorter (but it doesn't remove any code). This is good, because the next changes done will end in a new CuisCore change set, and there's no risk of having undesired changes in the old one. As changes to the base image progress, and several CuisCore ChangeSets are saved to disk, these numbered files are created in sequence. They will be ready to be loaded back in proper order in a fresh Cuis image, or to be sent to Cuis maintainers for integration in the update stream and in next releases of Cuis.

Installing ChangeSet files into Cuis

[Install] loads all the code in the file into a separate, new ChangeSet object (viewable in the ChangeSorter tool). This is appropriate for loading Cuis updates, or other code that we are not authoring, as it doesn't add new items (class or method definitions) to the current ChangeSet used to record the changes we make to Cuis. Usually any ChangeSets should be installed before doing changes to the image. The reason is that an installed ChangeSet could overwrite changes done by you, or packages you have installed. If this is the case, the affected packages would appear as dirty, and your change set would include any installed changes (that don't belong in a package). Be careful when saving packages or change sets if this was the case!!

Cherry picking individual changes from ChangeSet or Package files
-----------------------------------------------------------------------------------

Additionally, you can study a Package (.pck.st) or ChangeSet (.cs) file without installing it. To do this, use the FileList, navigate to the appropriate directory, select the file and click on [Contents]. You will get a ChangeList tool with the contents of the file. You can select each change, to see the code, and compare it with what is currently loaded in the system (if that is the case). You can also various filters on the list. See the right-click menu. Once you have one or more changes selected, you can do right-click / 'fileIn selections'. Changes that belong in a package that is already there will be captured by that package, that will now be dirty. Code that doesn't belong in a loaded package will be included in the current ChangeSet, together with code you save in a Browser. A new Package or ChangeSet will not be created. This is especially useful when reviewing code, or when we are combining code from more than one source into a single ChangeSet or Package.
"

"
Utilities codeManagementInCuisContents edit
"! !
!Utilities class methodsFor: 'support windows' stamp: 'jmv 7/5/2024 17:24:58' prior: 16996364!
                cuisAndGitHubContents
	^ self class firstCommentAt: #cuisAndGitHubContents

"
Using Git and GitHub to host and manage Cuis code
===================================

(https://github.com/Cuis-Smalltalk/Cuis-Smalltalk-Dev/blob/master/Documentation/CuisAndGitHub.md)

Cuis includes tools and procedures for managing Smalltalk code. Central to this is the management of Packages and Package Files (.pck). But Cuis doesn't do version control. Instead, we suggest using external VCS tools.  In particular, we're using [GitHub](http://www.github.com/), and the first project we're hosting there is [StyledTextEditor](https://github.com/bpieber/Cuis-StyledTextEditor).

The guiding principle is to *not duplicate concepts and behavior*. As we're using an external tool (Git) for version control, then we use it as it meant to be used. Most people use Git for version control and a file based IDE such as Eclipse for development. Such IDEs don't do version control themselves. It is done by Git. Do the same: do not include package version control in Cuis. This is a departure from the Monticello /Git integration (smallsource and MonticelloFileTree) by Otto Behrens, Dale Henrichs, etc.

We use GitHub to host, version, diff and merge external packages (.pck files), i.e. code that is maintained independently and outside Cuis.

Package files need to be simple text files. Cuis code files are encoded in UTF-8, and use the LF (ascii code 10) newline convention. This allows Git/GitHub to diff versions, and merge branches.

Each GitHub repository has one set of users and permissions. Each GitHub repository has one state (Git commits repositories, not individual files). Branch and merges are done on the whole repository and not on individual files. Therefore, we need a separate GitHub repository for each project, i.e., for each package or set of closely related packages that are always loaded and maintained together as a whole.

Development process for External Packages
--------------------------------------------------------

This is the suggested procedure for developing external packages. Usually do this every day.

* Start with a standard (i.e. fresh) Cuis image. Never save the image.

* Set up Git repositories for external packages (if not already done)

* Install packages from Git repositories.

* Develop. Modify and/or create packages.

* Save own packages (to Git repositories).

* Git add / commit / push as appropriate.

* Fileout changes that are not part of any package. These are automatically captured in numbered changesets, separated from changes to packages.

* Exit the image. Usually without saving.
"

"
Utilities cuisAndGitHubContents edit
"! !
!Utilities class methodsFor: 'support windows' stamp: 'jmv 7/5/2024 17:22:58' prior: 16996479!
                 usefulExpressionsContents
	^ self class firstCommentAt: #usefulExpressionsContents

"'Querying the system'.
Smalltalk aboutThisSystem.
SystemVersion current.
SystemDictionary copyright.
SystemOrganization categories.
SystemOrganization categoryOfElement: #Morph.
Editor organization categoryOfElement: #clearSelection.
Smalltalk allUnSentMessages.
Smalltalk browseAllUnSentMessages.
Smalltalk browseAllUnimplementedCalls.


'find selectors
Remember you can also do World / Open / Method Names'.
Symbol selectorsContaining: 'rsCon'.
'Cuis uses ISO 8859-1 for String and UTF8 UnicodeString, Clipboard and Files'.
Symbol selectorsContaining: 'iso8859'.
Symbol selectorsContaining: 'utf8'. 


'Example of loading a package with requirements on other packages'.
Feature require: 'SignalProcessing'.


'To create a *.pck.st file for each category with tests and  then to remove these categories'.
(SystemOrganization categoriesMatching: '*Test*')
	do: [ :cat | (CodePackage named: cat
				createIfAbsent: true
				registerIfNew: false) save.
			SystemOrganization removeSystemCategory: cat.
	].


'List of CodePackages which are not saved and save them in one go'.
'Save dirty packages:' print.
CodePackage installedPackages do: [ :each |
	each hasUnsavedChanges ifTrue: [
		each name print.
		each save ]].


'Globals'.
Cursor wait showWhile: [Sensor waitButton].
Smalltalk  inspectGlobals.


'Source code management'.
ChangeList browseRecentLog.


'Space and object count statistics'.
Smalltalk bytesLeft printStringWithCommas.
Symbol instanceCount.


'Anaylize memory usage by class'.
(String streamContents: [ :strm | SpaceTally new printSpaceAnalysis: 1 on: strm ]) edit.


'Remove a lot of stuff and reduce the image'.
Smalltalk reduceCuis.


'Performance measurement'.
Time millisecondsToRun: [Smalltalk allCallsOn: #asOop].
MessageTally spyOn: [Smalltalk allCallsOn: #asOop].
[Smalltalk allCallsOn: #asOop] bench.


'Opening a Text editor'.
'Something' editLabel: 'Title'.


'Opening a workspace'.
Workspace new
		contents: '';
		openLabel: 'Workspace'.

'Morphic stuff'.
LayoutMorph example1.				'Resize it'.
LayoutMorph example11.			'Resize it. Play with separators.'.
LayoutMorph example2.				'Resize it'.
LayoutMorph example3.				'Resize it'.
LayoutMorph example13.			'Resize it. Play with separators.'.
LayoutMorph example6.				'Resize it'.
LayoutMorph launcherExample.		'Have a Transcript open to use this'.

'Code authors - Potentially slow!!'.
Smalltalk knownInitialsAndNames do: [ :each | each print ].
Smalltalk allContributors do: [ :each | each print ].
Smalltalk contributionsOf: 'KenD'"! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6504-CorrectObsoleteReferencesTo-ISO8859-15-JuanVuletich-2024Jul05-17h07m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6504] on 7 July 2024 at 3:41:55 pm'!
!String class methodsFor: 'services' stamp: 'jmv 7/7/2024 15:41:39' prior: 16960471!
   is: aStringOrByteArray equalTo: another
	"Take advantage of String primitive for comparing, for example, ByteArrays"

	^ (self compare: aStringOrByteArray with: another collated: self caseSensitiveOrder) = 2! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6505-Typo-JuanVuletich-2024Jul07-15h41m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6452] on 5 July 2024 at 9:36:39 am'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6506-Fraction-categorization-AndresValloud-2024Jul05-09h34m-sqr.001.cs.st----!

'From Cuis7.1 [latest update: #6506] on 7 July 2024 at 4:29:24 pm'!
!SystemDictionary methodsFor: 'miscellaneous' stamp: 'jmv 7/7/2024 16:29:05' prior: 16964052!
           getCurrentWorkingDirectory
	"Do our best effort to answer the path from wich Cuis was started.

	Smalltalk getCurrentWorkingDirectory


On Linux, starting as
	juan@juandebian:/media/sf_SharedWithLinux/testPayload03/payload$      coglinux/bin/squeak        Cuis-Smalltalk-Dev-master/Cuis4.2-2367.image
we get:
	Smalltalk vmPath                       					'/media/sf_SharedWithLinux/testPayload03/payload/coglinux/lib/squeak/4.5-3370/'
	Smalltalk imagePath   							'/media/sf_SharedWithLinux/testPayload03/payload/Cuis-Smalltalk-Dev-master'
	Smalltalk primGetCurrentWorkingDirectoryUnix    '/media/sf_SharedWithLinux/testPayload03/payload'
	Smalltalk getCurrentWorkingDirectory 			'/media/sf_SharedWithLinux/testPayload03/payload'


On Windows 7, starting as
	C:\Users\Juan-Tuerca\SharedWithLinux\testPayload03\payload>        cogwin\squeak.exe            Cuis-Smalltalk-Dev-master/Cuis4.2-2367.image
we get:
	Smalltalk vmPath    										'C:\Users\Juan-Tuerca\SharedWithLinux\testPayload03\payload\cogwin\'
	Smalltalk imagePath   									'C:\Users\Juan-Tuerca\SharedWithLinux\testPayload03\payload\Cuis-Smalltalk-Dev-master'
	Smalltalk primGetCurrentWorkingDirectoryWindows       	'C:\Users\Juan-Tuerca\SharedWithLinux\testPayload03\payload\Cuis-Smalltalk-Dev-master'
	Smalltalk getCurrentWorkingDirectory  					'C:\Users\Juan-Tuerca\SharedWithLinux\testPayload03\payload'

	Easy on Unix. Harder on Windows, because #primGetCurrentWorkingDirectoryWindows insists on lying and answers the directory containing the image.
	"
	
	| fullImagePathName imageSpecCmdLineArgument  |

	"Easy on Unix"
	 self primGetCurrentWorkingDirectoryUnix ifNotNil: [ :utf8BytesInAStringInstance | | answer |
		"It seems on Mac, when dropping image on VM, we get '/', that is not really meaningful"
		(utf8BytesInAStringInstance = '/' and: [ self platformName = 'Mac OS' ]) ifFalse: [
			"Primitive answers an instance of String containing the UTF-8 bytes. If not pure ASCII,
			contents are invalid!! Convert it ASAP into a reasonable ByteArray + UnicodeString."
			answer := utf8BytesInAStringInstance.
			(String isAscii: answer) ifFalse: [
				ByteArray adoptInstance: answer.
				answer := UnicodeString fromUtf8Bytes: answer ].
			^ answer ]].

	"On Windows, extract shell path if image is in subtree"
	fullImagePathName := self imageName.

	"Primitive answers an instance of String containing the UTF-8 bytes. If not pure ASCII,
	contents are invalid!! Convert it ASAP into a reasonable ByteArray + UnicodeString."
	imageSpecCmdLineArgument := self getSystemAttribute: 1.
	"May be nil, for instance, when running in SqueakJS."
	imageSpecCmdLineArgument notNil ifTrue: [
		(String isAscii: imageSpecCmdLineArgument) ifFalse: [
			ByteArray adoptInstance: imageSpecCmdLineArgument.
			imageSpecCmdLineArgument := UnicodeString fromUtf8Bytes: imageSpecCmdLineArgument ].

		(imageSpecCmdLineArgument size < fullImagePathName size and: [			
			"Not if they are equal, as if they are both fully qualified (absolute) paths"
			fullImagePathName asPathTokens endsWith: imageSpecCmdLineArgument asPathTokens]) ifTrue: [
				^ fullImagePathName copyFrom: 1 to: fullImagePathName size - imageSpecCmdLineArgument size - 1 ]].

	"If we don't know better, answer nil. If appropriate, senders do:
		Smalltalk getCurrentWorkingDirectory ifNil: [ Smalltalk imagePath ]
	to have, at least, some valid directory
	"
	^ nil! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
PreferenceSet setDefaultFont: 'DejaVu Sans'.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6507-SysAttr1-mayBeNilOnSqueakJS-JuanVuletich-2024Jul07-16h29m-jmv.001.cs.st----!

		Preferences at: #saveReleaseOptionsInWorldMenu put: true.!

----QUIT----(8 July 2024 11:54:36) Cuis7.1-6507.image priorSource: 521011!

----STARTUP---- (18 July 2024 14:51:20) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6507.image!


'From Cuis6.3 [latest update: #6350] on 8 July 2024 at 12:42:26 pm'!
!LiteralVariableNode methodsFor: 'testing' stamp: 'HAW 7/8/2024 10:59:20'!
                 isReferencingClassVariable
	
	"If it is not a global, I assume it is a class var"
	^self isReferencingGlobal not and: [ self isUndeclared not ]! !
!LiteralVariableNode methodsFor: 'testing' stamp: 'HAW 7/8/2024 11:04:22' overrides: 16997091!
              isUndeclared
	
	^Undeclared includesKey: name ! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 11:57:38'!
                       assertHasExtractableBraceElements: aBraceNode asPartOf: methodNode at: trimmedIntervalToReplace   
	
	aBraceNode elementsDo: [ :anElementNode | self assertIsValidToExtract: anElementNode asPartOf: methodNode at: trimmedIntervalToReplace ]! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:18:11'!
                       assertIsNotLeftAssigment: aNode asPartOf: methodNode at: intervalToReplace  
	
	methodNode nodesDo: [ :traversedNode | 
		(self isAssignment: traversedNode and: aNode leftPartIn: methodNode at: intervalToReplace)
			ifTrue: [ self signalInvalidExpressionToExtractAsParameter ]]! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:00:51'!
                assertIsValidAssigmentToExtract: anAssignmentNode asPartOf: methodNode at: intervalToReplace   
	
	self assertIsValidToExtract: anAssignmentNode variable asPartOf: methodNode at: intervalToReplace.
	self assertIsValidToExtract: anAssignmentNode value asPartOf: methodNode at: intervalToReplace ! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:00:39'!
                               assertIsValidBlockNodeToExtract: aBlockNode asPartOf: methodNode at: intervalToReplace   
	
	aBlockNode block statementsDo: [ :aStatement | self assertIsValidToExtract: aStatement asPartOf: methodNode at: intervalToReplace ]! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:00:18'!
     assertIsValidLiteralNodeToExtract: aNode asPartOf: methodNode at: intervalToReplace  

	aNode isBraceNode ifTrue: [ ^self assertHasExtractableBraceElements: aNode asPartOf: methodNode at: intervalToReplace].

	^ (aNode isLiteralNode 
		or: [ aNode isTruePseudoVariable
		or: [ aNode isFalsePseudoVariable 
		or: [ aNode isNilPseudoVariable 
		or: [ (aNode isLiteralVariableNode and: [ 
				aNode isReferencingBehavior 
					or: [ aNode isReferencingGlobal
					or: [ aNode isReferencingClassVariable ]]])]]]]) ifFalse: [ self signalInvalidExpressionToExtractAsParameter ]! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:00:27'!
          assertIsValidMessageNodeToExtract: aNode asPartOf: methodNode at: intervalToReplace  

	self assertIsValidToExtract: aNode receiver asPartOf: methodNode at: intervalToReplace.
	aNode arguments do: [ :anArgument | self assertIsValidToExtract: anArgument asPartOf: methodNode at: intervalToReplace ]! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:14:47'!
                            assertIsValidToExtract: aNode asPartOf: methodNode at: intervalToReplace  

	aNode isMessageNode ifTrue: [ ^self assertIsValidMessageNodeToExtract: aNode asPartOf: methodNode at: intervalToReplace].
	aNode isBlockNode ifTrue: [ ^self assertIsValidBlockNodeToExtract: aNode asPartOf: methodNode at: intervalToReplace ].
	aNode isTempOrArg ifTrue: [  ^self assertIsValidTempOrArgNodeToExtract: aNode ].
	aNode isAssignmentToTemporary ifTrue: [ ^self assertIsValidAssigmentToExtract: aNode asPartOf: methodNode at: intervalToReplace ].
	aNode isInstanceVariableNode ifTrue: [ ^self assertIsNotLeftAssigment: aNode asPartOf: methodNode at: intervalToReplace ].
	self assertIsValidLiteralNodeToExtract: aNode asPartOf: methodNode at: intervalToReplace ! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 12:19:25'!
                          isAssignment: aPotentialAssigmentNode and: aPotentialLeftAssigment leftPartIn: methodNode at: interval

	^ aPotentialAssigmentNode isAssignmentNode 
		and: [ aPotentialLeftAssigment = aPotentialAssigmentNode variable 
		and: [ | assigmentRange |
			assigmentRange := (methodNode completeSourceRangesOf: aPotentialAssigmentNode ifAbsent: [Set with: (0 to: 0)]) anyOne.
			assigmentRange includesAllOf: interval ]]! !
!AssignmentNode methodsFor: 'testing' stamp: 'HAW 7/8/2024 11:31:47' prior: 16784108 overrides: 16918366!
                      isAssignmentToTemporary

	^ variable isTemp ! !
!ExtractAsParameter class methodsFor: 'pre-conditions' stamp: 'HAW 7/8/2024 11:55:21' prior: 16856893!
         assertCanExtractFrom: anInterval for: sourceCode methodNode: methodNode last: lastIntervalsAndNode

	| trimmedIntervalToReplace node intervalToReplace |

	ExtractMethodNewMethod assertIntervalToExtractIsNotEmpty: anInterval.
	ExtractMethodNewMethod assert: anInterval isWithinBoundsOf: sourceCode.
	
	intervalToReplace := self removeDotsAt: anInterval in: sourceCode.
	trimmedIntervalToReplace := intervalToReplace asSourceCodeInterval trimToMatchExpressionOn: sourceCode.
	node := self nodeToExtractFrom: methodNode at: trimmedIntervalToReplace or: intervalToReplace.
	self assertIsValidToExtract: node asPartOf: methodNode at: trimmedIntervalToReplace.
	lastIntervalsAndNode ifNotNil: [ self assertIsSameExpressionToExtractFrom: node to: lastIntervalsAndNode third ].
	
	^{ intervalToReplace. trimmedIntervalToReplace. node }! !

ExtractAsParameter class removeSelector: #assertIsValidBlockNodeToExtract:!

!methodRemoval: ExtractAsParameter class #assertIsValidBlockNodeToExtract: stamp: 'Install-6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st 7/18/2024 14:51:21'!
assertIsValidBlockNodeToExtract: aBlockNode 
	
	aBlockNode block statementsDo: [ :aStatement | self assertIsValidToExtract: aStatement ]!

ExtractAsParameter class removeSelector: #assertIsValidMessageNodeToExtract:!

!methodRemoval: ExtractAsParameter class #assertIsValidMessageNodeToExtract: stamp: 'Install-6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st 7/18/2024 14:51:21'!
assertIsValidMessageNodeToExtract: aNode

	self assertIsValidToExtract: aNode receiver.
	aNode arguments do: [ :anArgument | self assertIsValidToExtract: anArgument ]!

ExtractAsParameter class removeSelector: #assertHasExtractableBraceElements:!

!methodRemoval: ExtractAsParameter class #assertHasExtractableBraceElements: stamp: 'Install-6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st 7/18/2024 14:51:21'!
assertHasExtractableBraceElements: aBraceNode 
	
	aBraceNode elementsDo: [ :anElementNode | self assertIsValidToExtract: anElementNode ]!

ExtractAsParameter class removeSelector: #assertIsValidLiteralNodeToExtract:!

!methodRemoval: ExtractAsParameter class #assertIsValidLiteralNodeToExtract: stamp: 'Install-6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st 7/18/2024 14:51:21'!
assertIsValidLiteralNodeToExtract: aNode

	aNode isBraceNode ifTrue: [ ^self assertHasExtractableBraceElements: aNode].

	^ (aNode isLiteralNode 
		or: [ aNode isTruePseudoVariable
		or: [ aNode isFalsePseudoVariable 
		or: [ aNode isNilPseudoVariable 
		or: [ (aNode isLiteralVariableNode and: [ 
				aNode isReferencingBehavior or: [ aNode isReferencingGlobal ]])]]]]) ifFalse: [ self signalInvalidExpressionToExtractAsParameter ]!

ExtractAsParameter class removeSelector: #assertIsValidAssigmentToExtract:!

!methodRemoval: ExtractAsParameter class #assertIsValidAssigmentToExtract: stamp: 'Install-6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st 7/18/2024 14:51:21'!
assertIsValidAssigmentToExtract: anAssignmentNode 
	
	self assertIsValidToExtract: anAssignmentNode variable.
	self assertIsValidToExtract: anAssignmentNode value !

ExtractAsParameter class removeSelector: #assertIsValidToExtract:!

!methodRemoval: ExtractAsParameter class #assertIsValidToExtract: stamp: 'Install-6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st 7/18/2024 14:51:21'!
assertIsValidToExtract: aNode

	aNode isMessageNode ifTrue: [ ^self assertIsValidMessageNodeToExtract: aNode].
	aNode isBlockNode ifTrue: [ ^self assertIsValidBlockNodeToExtract: aNode ].
	aNode isTempOrArg ifTrue: [  ^self assertIsValidTempOrArgNodeToExtract: aNode ].
	aNode isAssignmentToTemporary ifTrue: [ ^self assertIsValidAssigmentToExtract: aNode ].
	self assertIsValidLiteralNodeToExtract: aNode!

ExtractAsParameter class removeSelector: #assertIsValidMessageNodeToExtract:asPartOf:!

ExtractAsParameter class removeSelector: #assertIsValidBlockNodeToExtract:asPartOf:!

ExtractAsParameter class removeSelector: #assertIsNotLeftAssigment:asPartOf:!

ExtractAsParameter class removeSelector: #assertIsValidLiteralNodeToExtract:asPartOf:!

ExtractAsParameter class removeSelector: #assertHasExtractableBraceElements:asPartOf:!

ExtractAsParameter class removeSelector: #assertIsValidAssigmentToExtract:asPartOf:!

ExtractAsParameter class removeSelector: #assertIsValidToExtract:asPartOf:!

ParseNode removeSelector: #isAssignmentToInstanceVariable!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6508-ExtractAsParameterSupportForInstVarAndClassVar-HernanWilkinson-2024Jul08-09h22m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6507] on 8 July 2024 at 4:22:40 pm'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 7/8/2024 16:19:56'!
                    saveAs: newName
	"Save the image under newName. Don't quit.
	See senders."

	(self fullNameForImageNamed: newName) = self imageName
		ifTrue: [
			"If saving over the our own image file, call #saveImage instead."
			self saveImage ]
		ifFalse: [
			"This method requires saving on a different file."
			self saveAs: newName clearAllClassState: false ].! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 7/8/2024 16:16:02' prior: 16966027!
                          saveAs
	"Put up the 'saveAs' prompt, obtain a name, and save the image  under that new name."

	self request: 'New file name?' initialAnswer: self imageName asFullFileEntry name do: [ :newName |
		(
			"Either both files are new,"
			((self fullNameForImageNamed: newName) asFullFileEntry exists not
				and: [(self fullNameForChangesNamed: newName) asFullFileEntry exists not])
			"Or user confirms overwriting them."
			or: [self confirm: ('{1} already exists. Overwrite?' format: {newName})]
		)
			ifTrue: [
				self saveAs: newName ]].
! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 7/8/2024 16:10:17' prior: 16966045!
                             saveAs: newName clearAllClassState: clearAllStateFlag
	"Save the image under a new name. Don't quit.
	Note: newName must be different from current name.
	See senders."

	| newChangesName |
	self currentChangesName ifNotNil: [ :oldChangesName |
		self closeSourceFiles. "so copying the changes file will always work"
		newChangesName := self fullNameForChangesNamed: newName.
		FileIOAccessor default copy: oldChangesName asFullFileEntry to: newChangesName asFullFileEntry.
		ChangesInitialFileSize ifNotNil: [
			oldChangesName asFullFileEntry appendStreamDo: [ :strm | strm truncate: ChangesInitialFileSize ]]].

	ChangeSet zapAllChangeSets.
	self 
		changeImageNameTo: (self fullNameForImageNamed: newName);
		closeSourceFiles; openSourceFiles;  "so SNAPSHOT appears in new changes file"
		snapshot: true andQuit: false embedded: false clearAllClassState: clearAllStateFlag.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6509-FixBrokenChangesOn-SaveAs-overwritingImage-JuanVuletich-2024Jul08-16h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6509] on 9 July 2024 at 6:26:22 pm'!
!UnicodeString methodsFor: 'private' stamp: 'jmv 7/9/2024 18:17:29' prior: 16993650!
                             computeCountAndIndex
	self isEmpty ifTrue: [
		count := 0.
		strideIndex := #[].
		^ self ].
	"the number of characters cannot be larger than the byte size"
	bytes size <= self stride
		ifTrue: [ self computeCountNoIndex ]
		ifFalse: [ self computeCountAndIndexFull ]! !
!UnicodeString methodsFor: 'private' stamp: 'jmv 7/9/2024 18:20:35' prior: 16993661!
                            computeCountAndIndexFull
	| strideIndexClass byteIndex |
	count := 0.
	strideIndexClass := bytes size < 256
		ifTrue: [ ByteArray ]
		ifFalse: [ bytes size < 65536
			ifTrue: [ DoubleByteArray ]
			ifFalse: [ bytes size < 4294967296
				ifTrue: [ WordArray ]
				ifFalse: [DoubleWordArray ]]].
	strideIndex := strideIndexClass streamContents: [ :out |
		byteIndex := 1.
		[ byteIndex <= bytes size ] whileTrue: [
			count := count + 1.
			(count > self stride and: [ (count - 1 \\ self stride) = 0 ]) 
				ifTrue: [ out nextPut: byteIndex ].
			byteIndex := byteIndex + (self encodedByteCountAt: byteIndex) ] ]! !
!UnicodeString methodsFor: 'private' stamp: 'jmv 7/9/2024 18:20:44' prior: 16993675!
     computeCountNoIndex
	| byteIndex |
	count := 0.
	strideIndex := #[].
	byteIndex := 1.
	[ byteIndex <= bytes size ] whileTrue: [
		count := count + 1.
		byteIndex := byteIndex + (self encodedByteCountAt: byteIndex) ]! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
Smalltalk garbageCollect.
UnicodeString allInstancesDo: [ :s |
	(s instVarNamed: 'strideIndex') class == Array
		ifTrue: [ s computeCountAndIndex ]].
Smalltalk garbageCollect.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6510-Unicode-UseEfficientNumericArraysForStrideIndex-JuanVuletich-2024Jul09-18h17m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6510] on 9 July 2024 at 6:47:45 pm'!
!SmalltalkEditor methodsFor: 'menu messages' stamp: 'jmv 7/9/2024 18:43:12' prior: 16954186!
                             explain
	"Try to shed some light on what kind of entity the current selection is. 
	The selection must be a single token or construct. Insert the answer after 
	the selection. Send private messages whose names begin with 'explain' 
	that return a string if they recognize the selection, else nil."

	| string tiVars cgVars selectors delimitors numbers sorry reply symbol provider |
	sorry := 'Sorry, I can''t explain that.  Please select a single
token, construct, or special character.'.
	(string := self selectedString) isEmpty
		ifTrue: [reply := '']
		ifFalse: [
			string := string withBlanksTrimmed.
			"Remove space, tab, cr"
			"Temps and Instance vars need only test strings that are all letters"
			(string detect: [:char | char isValidInIdentifiers not]
				ifNone: nil) ifNil: [
					tiVars := (self explainTemp: string)
						ifNil: [self explainInst: string]].
					
			provider := self codeProvider.
			(tiVars == nil and: [provider respondsTo: #explainSpecial:])
				ifTrue: [tiVars := provider explainSpecial: string].
			tiVars := tiVars
				ifNil: [ '']
				ifNotNil: [ tiVars , '\' withNewLines].
			"Context, Class, Pool, and Global vars, and Selectors need 
			only test symbols"
			(Symbol hasInterned: string ifTrue: [:s | symbol := s])
				ifTrue: [
					cgVars := (self explainCtxt: symbol) 
						ifNil: [ (self explainClass: symbol)
							ifNil: [ self explainGlobal: symbol]].
					"See if it is a Selector (sent here or not)"
					selectors := (self explainMySel: symbol)
						ifNil: [(self explainPartSel: string)
							ifNil: [ self explainAnySel: symbol]]]
				ifFalse: [selectors := self explainPartSel: string].
			cgVars := cgVars
				ifNil: [ '']
				ifNotNil: [cgVars , '\' withNewLines].
			selectors := selectors
				ifNil: [ '']
				ifNotNil: [ selectors , '\' withNewLines].
			delimitors := string size = 1
				ifTrue: ["single special characters"
					self explainChar: string]
				ifFalse: ["matched delimitors"
					self explainDelimitor: string].
			numbers := self explainNumber: string.
			numbers ifNil: [numbers := ''].
			delimitors ifNil: [delimitors := ''].
			reply := tiVars , cgVars , selectors , delimitors , numbers].
	reply isEmpty ifTrue: [reply := sorry].

	"morph showBalloon: reply.
	self runningWorld ifNotNil: [ :w | w findATranscript ].
	reply print."
	"This could be a preference."
	self afterSelectionInsertAndSelect: reply! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6511-Explain-showInTraditionalST80Way-JuanVuletich-2024Jul09-18h41m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6511] on 10 July 2024 at 3:19:27 pm'!
!Symbol methodsFor: 'testing' stamp: 'jmv 7/10/2024 15:13:50'!
             isValidGlobalName

	^self notEmpty and: [
		self first canBeGlobalVarInitial and: [
			self allSatisfy: [ :character | character isValidInIdentifiers ]]].
! !
!UnicodeSymbol methodsFor: 'testing' stamp: 'jmv 7/10/2024 15:13:58'!
                           isValidGlobalName

	^self notEmpty and: [
		self first canBeGlobalVarInitial and: [
			self allSatisfy: [ :character | character isValidInIdentifiers ]]].
! !
!ClassBuilder methodsFor: 'validation' stamp: 'jmv 7/10/2024 15:15:20' prior: 16816526!
         validateClassName: aSymbol
	"Validate the new class name"

	aSymbol isValidGlobalName ifFalse: [
		self error: 'Invalid class name'.
		^false].
	Smalltalk at: aSymbol ifPresent:[:old|
		(old isKindOf: Behavior) ifFalse:[
			self notify: aSymbol asText allBold, 
						' already exists!!\Proceed will store over it.' withNewLines]].
	^true! !

ClassBuilder removeSelector: #doesClassNameStartWithUppercase:!

!methodRemoval: ClassBuilder #doesClassNameStartWithUppercase: stamp: 'Install-6512-BetterValidationOfClassNames-JuanVuletich-2024Jul10-15h17m-jmv.001.cs.st 7/18/2024 14:51:21'!
doesClassNameStartWithUppercase: aClassName
	
	^ aClassName first isUppercase!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6512-BetterValidationOfClassNames-JuanVuletich-2024Jul10-15h17m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6512] on 10 July 2024 at 3:25:51 pm'!

Object subclass: #IniFile
	instanceVariableNames: 'globalSection namedSections'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'System-Support'!

!classDefinition: #IniFile category: #'System-Support' stamp: 'Install-6513-IniFile-JuanVuletich-2024Jul10-15h24m-jmv.001.cs.st 7/18/2024 14:51:21'!
Object subclass: #IniFile
	instanceVariableNames: 'globalSection namedSections'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'System-Support'!
!IniFile commentStamp: 'jmv 7/10/2024 09:10:24' prior: 0!
               An IniFile is a collection of options grouped in IniFileSections meant to be saved as an .ini file.
IniFiles are used for configuration of software.!

Object subclass: #IniFileSection
	instanceVariableNames: 'name entries'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'System-Support'!

!classDefinition: #IniFileSection category: #'System-Support' stamp: 'Install-6513-IniFile-JuanVuletich-2024Jul10-15h24m-jmv.001.cs.st 7/18/2024 14:51:21'!
Object subclass: #IniFileSection
	instanceVariableNames: 'name entries'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'System-Support'!
!IniFileSection commentStamp: '<historical>' prior: 0!
               Part of an IniFile.!
!IniFile methodsFor: 'accessing sections and entries' stamp: 'jmv 7/10/2024 10:20:04'!
                    atSection: sectionName entry: entryName
	"Answer the value, or nil if it hasn't been set."

	^self atSection: sectionName entry: entryName orDefault: nil.
! !
!IniFile methodsFor: 'accessing sections and entries' stamp: 'jmv 7/10/2024 10:18:59'!
          atSection: sectionName entry: entryName orDefault: aBlock
	"If section or entry is missing, answer the result of evaluating aBlock,
	but don't add the section or entry."

	^(namedSections at: sectionName ifAbsent: [ ^aBlock value ])
		at: entryName orDefault: aBlock.! !
!IniFile methodsFor: 'accessing sections and entries' stamp: 'jmv 7/10/2024 10:18:39'!
                          atSection: sectionName entry: entryName orPutDefault: aBlock
	"If section or entry is missing, answer the result of evaluating aBlock,
	AND add it as the value of the section/entry."

	^(self ensureSectionNamed: sectionName)
		at: entryName orPutDefault: aBlock.! !
!IniFile methodsFor: 'accessing sections and entries' stamp: 'jmv 7/10/2024 10:31:52'!
                               atSection: sectionName entry: entryName put: aValue
	"Just store the value."

	^(self ensureSectionNamed: sectionName)
		at: entryName put: aValue.! !
!IniFile methodsFor: 'accessing sections and entries' stamp: 'jmv 7/10/2024 10:29:40'!
                  ensureSectionNamed: sectionName
	"Make it an empty section if not there."

	^namedSections at: sectionName ifAbsentPut: [ IniFileSection newNamed: sectionName ].
! !
!IniFile methodsFor: 'accessing sections and entries' stamp: 'jmv 7/10/2024 10:20:42'!
   sectionNamed: sectionName
	"Answer nil if not there."

	^namedSections at: sectionName ifAbsent: nil.
! !
!IniFile methodsFor: 'accessing global entries' stamp: 'jmv 7/10/2024 10:34:29'!
     atGlobalEntry: entryName
	^self atGlobalEntry: entryName orDefault: nil.! !
!IniFile methodsFor: 'accessing global entries' stamp: 'jmv 7/10/2024 10:28:22'!
   atGlobalEntry: entryName orDefault: aBlock
	"If section or entry is missing, answer the result of evaluating aBlock,
	but don't add the section or entry."

	globalSection isNil ifTrue: [ ^aBlock value ].
	^globalSection at: entryName orDefault: aBlock.! !
!IniFile methodsFor: 'accessing global entries' stamp: 'jmv 7/10/2024 10:30:34'!
               atGlobalEntry: entryName orPutDefault: aBlock
	"If section or entry is missing, answer the result of evaluating aBlock,
	AND add it as the value of the section/entry."

	^self ensureGlobalSection
		at: entryName orPutDefault: aBlock.
! !
!IniFile methodsFor: 'accessing global entries' stamp: 'jmv 7/10/2024 10:29:34'!
 ensureGlobalSection
	"Make it an empty section if not there."

	^globalSection ifNil: [ globalSection := IniFileSection newGlobal ].
! !
!IniFile methodsFor: 'accessing global entries' stamp: 'jmv 7/10/2024 10:32:24'!
      globalEntry: entryName put: aValue
	"Just store the value."

	^self ensureGlobalSection
		at: entryName put: aValue.! !
!IniFile methodsFor: 'accessing global entries' stamp: 'jmv 7/10/2024 10:37:02'!
                       globalSection
	"Answer nil if not there."

	^globalSection! !
!IniFile methodsFor: 'initialization' stamp: 'jmv 7/10/2024 09:25:44' overrides: 16932029!
       initialize
	globalSection := nil.
	namedSections := OrderedDictionary new.! !
!IniFile methodsFor: 'writing' stamp: 'jmv 7/10/2024 11:23:33'!
                  writeOn: aStream

	globalSection ifNotNil: [
		globalSection writeOn: aStream.
		aStream newLine ].
	namedSections
		do: [:ea | ea writeOn: aStream]
		separatedBy: [ aStream newLine ].
! !
!IniFile class methodsFor: 'instance creation' stamp: 'jmv 7/10/2024 10:50:33'!
                   addSettingFrom: lineString to: section
	| stream key value |
	stream := lineString readStream.
	key := (stream upTo: $=) withBlanksTrimmed.
	value := (stream upToEnd) withBlanksTrimmed.
	section at: key put: (value isEmpty ifTrue: [nil] ifFalse: [value]).! !
!IniFile class methodsFor: 'instance creation' stamp: 'jmv 7/10/2024 11:01:46'!
             newSectionIn: anIniFile from: aString
	| stream |
	stream := aString readStream.
	stream upTo: $[.
	^ anIniFile ensureSectionNamed: (stream upTo: $])! !
!IniFile class methodsFor: 'instance creation' stamp: 'jmv 7/10/2024 11:06:28' overrides: 16916022!
   readFrom: aStream
	| section line ini |
	section := nil.
	ini := self new.
	
	[aStream atEnd] whileFalse:
		[line := aStream nextLine withBlanksTrimmed.
		line isEmpty ifFalse: [
			line first
				caseOf: {
					[ $[ ] -> [section := self newSectionIn: ini from: line].
					[ $; ] -> ["ignore comment line"].
					}
				otherwise: [
					self addSettingFrom: line to: (section ifNil: [ini ensureGlobalSection]) 					]]].
	
	^ ini! !
!IniFileSection methodsFor: 'accessing' stamp: 'jmv 7/10/2024 10:21:05' overrides: 16913512!
                 at: entryName
	"Answer the value, or nil if it hasn't been set."

	^entries at: entryName ifAbsent: nil.
! !
!IniFileSection methodsFor: 'accessing' stamp: 'jmv 7/10/2024 10:21:20'!
          at: entryName orDefault: aBlock 
	"If entry is missing, answer the result of evaluating aBlock,
	but don't add the section or entry."

	^entries at: entryName ifAbsent: aBlock.
! !
!IniFileSection methodsFor: 'accessing' stamp: 'jmv 7/10/2024 10:21:48'!
  at: entryName orPutDefault: aBlock 
	"If entry is missing, answer the result of evaluating aBlock,
	AND add it as the value of the entry."

	^entries at: entryName ifAbsentPut: aBlock.
! !
!IniFileSection methodsFor: 'accessing' stamp: 'jmv 7/10/2024 10:21:57' overrides: 16913530!
      at: entryName put: aValue
	"Just store the value."

	entries at: entryName put: aValue.
	^aValue.! !
!IniFileSection methodsFor: 'initialization' stamp: 'jmv 7/10/2024 09:17:45'!
             initializeGlobal
	"Initialize a Global section. There should be, at most, one of these in an IniFile."

	name := nil.
	entries := OrderedDictionary new.! !
!IniFileSection methodsFor: 'initialization' stamp: 'jmv 7/10/2024 09:17:56'!
                      initializeNamed: aString
	"Initialize a Global section. There should be, at most, one of these in an IniFile."

	name := aString.
	entries := OrderedDictionary new.! !
!IniFileSection methodsFor: 'writing' stamp: 'jmv 7/10/2024 11:22:29'!
                 writeOn: aStream
	name ifNotNil: [ 
		aStream
			nextPut: $[; nextPutAll: name; nextPut: $]; newLine ].
	entries associationsDo: [ :assoc |
		aStream nextPutAll: assoc key; nextPut: $=; nextPutAll: (assoc value ifNil: ['']); newLine ].
! !
!IniFileSection class methodsFor: 'instance creation' stamp: 'jmv 7/10/2024 09:18:33' overrides: 16787725!
     new
	^ self shouldNotImplement! !
!IniFileSection class methodsFor: 'instance creation' stamp: 'jmv 7/10/2024 09:18:49'!
       newGlobal
	^ self basicNew initializeGlobal! !
!IniFileSection class methodsFor: 'instance creation' stamp: 'jmv 7/10/2024 09:19:00'!
                          newNamed: aString
	^ self basicNew initializeNamed: aString! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6513-IniFile-JuanVuletich-2024Jul10-15h24m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6513] on 12 July 2024 at 9:56:39 am'!
!TTGlyph commentStamp: 'jmv 7/12/2024 08:30:22' prior: 16973709!
    This class represents a glyph of a TrueType font.

Instance variables:
	boundsLeft 					xMin in TrueType parlance
	boundsRight 			 		xMax in TrueType parlance
	boundsBottom 					yMin in TrueType parlance (usually close to baseline, i.e. 0)
	boundsTop 					yMax in TrueType parlance (usually positive and large, in TrueType, y axis points up)
	contours					<Array of: TTContourConstruction>
	advanceWidth					<Integer>	advance width of the glyph
	leftSideBearing  					<Integer>	left side bearing
	rightSideBearing  					<Integer>	right side bearing!
!TTFontDescription methodsFor: 'conversion' stamp: 'jmv 7/12/2024 09:15:44' prior: 16972331!
                             formGlyphForUtf8Byte1: aByte1 byte2: aByte2OrNil byte3: aByte3OrNil byte4: aByte4OrNil pixelSize: pixelSize
	"Needed only for BitBltCanvasEngine"
	| byte1 byte2OrNil byte3OrNil byte4OrNil utf8ByteArray toPixelsScale formWidth formHeight leftPixelOffset topPixelOffset xtraSpaceForAntiAliasingAndRounding horizontalStrokesAtPixelCenter form canvas advanceWidth boundsLeft boundsRight boundsBottom boundsTop i deltaToXCenter |

	byte1 := aByte1.
	byte2OrNil := aByte2OrNil.
	byte3OrNil := aByte3OrNil.
	byte4OrNil := aByte4OrNil.
	i := contourDataIndexesByUtf8 at: byte1 + 1.
	utf8ByteArray := ByteArray with: byte1.
	byte2OrNil notNil ifTrue: [
		i := contourDataIndexesByUtf8 at: i negated + byte2OrNil + 1.
		utf8ByteArray := ByteArray with: byte1 with: byte2OrNil.
		byte3OrNil notNil ifTrue: [
			i := contourDataIndexesByUtf8 at: i negated + byte3OrNil + 1.
			utf8ByteArray := ByteArray with: byte1 with: byte2OrNil with: byte3OrNil.
			byte4OrNil notNil ifTrue: [
				i := contourDataIndexesByUtf8 at: i negated + byte4OrNil + 1.
				utf8ByteArray := ByteArray with: byte1 with: byte2OrNil with: byte3OrNil with: byte4OrNil ]]].

	"If glyph not found, take first glyph 'theUnknownGlyph'"
	i = 0 ifTrue: [ i := 1 ].

	advanceWidth := contourDataForUtf8 at: i. i := i + 1.
	boundsLeft := contourDataForUtf8 at: i. i := i + 1.
	boundsRight := contourDataForUtf8 at: i. i := i + 1.
	boundsBottom := contourDataForUtf8 at: i. i := i + 1.
	boundsTop := contourDataForUtf8 at: i. i := i + 1.

	horizontalStrokesAtPixelCenter := 0.5.
	xtraSpaceForAntiAliasingAndRounding := 3.
	toPixelsScale := 0.0 + pixelSize / self letterMTopSideBearing.

	"If positive, pixels we save at the left. if negative, xtra pix needed"
	leftPixelOffset := (boundsLeft * toPixelsScale - xtraSpaceForAntiAliasingAndRounding) floor.
	formWidth := (boundsRight - boundsLeft) * toPixelsScale + (xtraSpaceForAntiAliasingAndRounding*2).

	"Usually positive. Needed pixels above the baseline"
	topPixelOffset := (boundsTop * toPixelsScale + xtraSpaceForAntiAliasingAndRounding) ceiling.
	formHeight := (boundsTop - boundsBottom) * toPixelsScale + (xtraSpaceForAntiAliasingAndRounding*2).
	
	form := Form extent: formWidth@formHeight depth: 32.
	form fillColor: Color white.
	canvas := VectorCanvas onFormWithSubPixelAntiAliasing: form.
	canvas 
		engine
			displayUtf8: utf8ByteArray
			fromByte: 1
			toByte: utf8ByteArray size
			at: leftPixelOffset negated@(topPixelOffset - horizontalStrokesAtPixelCenter)
			trueTypeFont: self
			color: Color black
			scale: 1.0 * pixelSize
			preventMirroring: true.
	deltaToXCenter := (advanceWidth - (boundsRight+boundsLeft * 0.5)) * toPixelsScale.
	"DoubleWidth code points that combine above previous and following characters.
	Codepoints between 16r035C and 16r0363.
	Example: oÕ¢o
	Don't center them"
	(byte1 = 205 and: [ byte2OrNil between: 156 and: 163 ]) ifTrue: [
		deltaToXCenter := 0 ].
	
	^(FormGlyph
		form: form
		leftOffset: leftPixelOffset
		topOffset: topPixelOffset
		advanceWidth: (advanceWidth * toPixelsScale))
			deltaXToCenter: deltaToXCenter! !
!TTFontReader methodsFor: 'processing' stamp: 'jmv 7/12/2024 08:36:07' prior: 16972769!
 processCompositeGlyphFrom: entry
	"Read a composite glyph from the font data."
	| glyph flags glyphIndex hasInstructions ofsX ofsY iLen geometryTransformation xMin yMin xMax yMax |
	glyph := TTCompositeGlyph new.
	"See, for instance, https://learn.microsoft.com/en-us/typography/opentype/otspec190/glyf"
	xMin := entry nextInt16.
	yMin := entry nextInt16.
	xMax := entry nextInt16.
	yMax := entry nextInt16.
	glyph boundsLeft: xMin boundsRight: xMax boundsTop: yMax boundsBottom: yMin.
	hasInstructions := false.
	[
		flags := entry nextUint16.
		glyphIndex := entry nextUint16 + 1.

		(flags allMask: 1 "ARG_1_AND_2_ARE_WORDS") ifTrue: [
			"'Hay Offset short x@y' print."
			ofsX := entry nextInt16.
			ofsY := entry nextInt16.
		] ifFalse: [
			"'Hay Offset byte x@y' print."
			(ofsX := entry nextByte) > 127 ifTrue: [ofsX := ofsX - 256].
			(ofsY := entry nextByte) > 127 ifTrue: [ofsY := ofsY - 256]].

		(flags allMask: 2 "ARGS_ARE_XY_VALUES") ifFalse: [self error: 'Unsupported TrueType format']. "Unsupported"
		"ROUND_XY_TO_GRID = 4. Ignored"
		(flags anyMask: 8+64+128) ifFalse: [
			geometryTransformation := MorphicTranslation withTranslation: ofsX@ofsY ].
		(flags allMask: 8 "WE_HAVE_A_SCALE") ifTrue: [
			geometryTransformation := AffineTransformation withScale: entry nextInt16 asFloat / 16r4000 ].
		(flags allMask: 64 "WE_HAVE_AN_X_AND_Y_SCALE") ifTrue: [
			geometryTransformation := AffineTransformation
				withPointScale: (entry nextInt16 asFloat / 16r4000)@(entry nextInt16 asFloat / 16r4000)
				position: ofsX@ofsY ].
		(flags allMask: 128 "WE_HAVE_A_TWO_BY_TWO") ifTrue: [
			"2x2 transformation"
			geometryTransformation := AffineTransformation new
				a11: entry nextInt16 asFloat / 16r4000;
				a21: entry nextInt16 asFloat / 16r4000;
				a12: entry nextInt16 asFloat / 16r4000;
				a22: entry nextInt16 asFloat / 16r4000;
				a13: ofsX;
				a23: ofsY ].

		glyph addGlyph: glyphIndex transformation: geometryTransformation.
		hasInstructions := hasInstructions or: [ flags allMask: 256 "WE_HAVE_INSTRUCTIONS"].
		"Continue as long as the MORE_COMPONENTS bit is set"
		flags allMask: 32 "MORE_COMPONENTS"
	] whileTrue.
	hasInstructions ifTrue: [
		"Ignore them"
		iLen := entry nextUint16.
		entry skip: iLen].
	^glyph! !
!TTFontReader methodsFor: 'processing' stamp: 'jmv 7/12/2024 08:37:25' prior: 16973141!
                          processSimpleGlyphContours: nContours from: entry

	| glyph endPts nPts iLength flags xMin yMin xMax yMax |
	glyph := TTGlyph new.
	"See, for instance, https://learn.microsoft.com/en-us/typography/opentype/otspec190/glyf"
	xMin := entry nextInt16.
	yMin := entry nextInt16.
	xMax := entry nextInt16.
	yMax := entry nextInt16.
	glyph boundsLeft: xMin boundsRight: xMax boundsTop: yMax boundsBottom: yMin.
	endPts := Array new: nContours.
	1 to: nContours do: [ :i | endPts at: i put: entry nextUint16 ].
	glyph initializeContours: nContours with: endPts.
	nContours = 0 ifTrue: [^ self].
	nPts := endPts last + 1.
	iLength := entry nextUint16. "instruction length"
	entry skip: iLength.
	flags := self getGlyphFlagsFrom: entry size: nPts.
	self readGlyphXCoords: entry glyph: glyph nContours: nContours flags: flags endPoints: endPts.
	self readGlyphYCoords: entry glyph: glyph nContours: nContours flags: flags endPoints: endPts.
	glyph makePointsAbsolute.
	^glyph! !
!TTGlyph methodsFor: 'accessing' stamp: 'jmv 7/12/2024 08:31:51' prior: 16973734!
      boundsBottom
	"yMin in TrueType parlance (usually close to baseline, i.e. 0)"
	^boundsBottom! !
!TTGlyph methodsFor: 'accessing' stamp: 'jmv 7/12/2024 08:30:58' prior: 16973739!
              boundsLeft
	"xMin in TrueType parlance"
	^boundsLeft! !
!TTGlyph methodsFor: 'accessing' stamp: 'jmv 7/12/2024 08:36:50' prior: 16973744!
                      boundsLeft: xMin boundsRight: xMax boundsTop: yMax boundsBottom: yMin
	boundsLeft := xMin.
	boundsRight := xMax.
	boundsTop := yMax.
	boundsBottom := yMin.! !
!TTGlyph methodsFor: 'accessing' stamp: 'jmv 7/12/2024 08:31:18' prior: 16973751!
               boundsRight
	"xMax in TrueType parlance"
	^boundsRight! !
!TTGlyph methodsFor: 'accessing' stamp: 'jmv 7/12/2024 08:31:36' prior: 16973756!
                    boundsTop
	"yMax in TrueType parlance (usually positive and large, in TrueType, y axis points up)"
	^boundsTop! !
!TTGlyph methodsFor: 'accessing' stamp: 'jmv 7/12/2024 09:49:04' prior: 16973780!
                            topSideBearing
	"
	https://www.freetype.org/freetype2/docs/glyphs/glyphs-3.html
	"
	^boundsTop! !
!TTGlyph methodsFor: 'primitive format' stamp: 'jmv 7/12/2024 08:45:22' prior: 16973864!
     addGlyphDataTo: stream tx: aGeometryTransformationOrNil
	| aw lb rt |
	aw := self advanceWidth.
	lb := self boundsLeft @ self boundsBottom.
	rt := self boundsRight @ self boundsTop.
	aGeometryTransformationOrNil ifNotNil: [
		aw := aGeometryTransformationOrNil externalizeScalar: aw.
		lb := aGeometryTransformationOrNil externalizePosition: lb.
		rt := aGeometryTransformationOrNil externalizePosition: rt ].
	stream nextPut: aw.
	stream nextPut: lb x. "left = xMin"
	stream nextPut: rt x. "right = xMax"
	stream nextPut: lb y. "bottom = yMin"
	stream nextPut: rt y. "top = yMax"
	stream nextPut: self contourCount.
	self addContourDataTo: stream tx: aGeometryTransformationOrNil! !
!VectorEngine methodsFor: 'text and multi paths' stamp: 'jmv 7/12/2024 08:46:36' prior: 16998804!
                  displayUtf8: aByteArray fromByte: byteStartIndex toByte: byteStopIndex at: aPoint trueTypeFont: aTTFontDescription color: aColor scale: scale preventMirroring: doPreventMirroring
	"TrueType assumes a Math like coordinate system (Y increasing upwards).
	But Display and Form Y coordinates in Cuis increase downwards, as it is done in most computer hardware and software.
	If doPreventMirroring is true, ensure that glyphs don't look mirrored, by having a negative y scale."
	| nextGlyphX nextGlyphY sx sy contourData contourDataIndexes trueTypeScale ttMoveToX ttMoveToY ttEndX ttEndY ttControlX ttControlY advanceWidth boundsLeft boundsRight boundsBottom boundsTop numContours numBeziers baseIndex x y cx cy contourStart deltaXToCenter deltaXForBaseGlyph deltaXForDiacriticalMark |
	deltaXForBaseGlyph := 0.0.
	trueTypeScale := 1.0 / aTTFontDescription letterMTopSideBearing.	"Perhaps measures in TTFontDescription should be normalized"
	sx := scale * trueTypeScale.
	sy := scale * trueTypeScale.
	(doPreventMirroring and: [ geometryTransformation doesMirror not ]) ifTrue: [ sy := sy negated ].
	contourData := aTTFontDescription contourDataForUtf8.
	contourDataIndexes := aTTFontDescription contourDataIndexesByUtf8.
	self fillColor: aColor do: [
		nextGlyphX := aPoint x.
		nextGlyphY := aPoint y.
		baseIndex := 0.
		byteStartIndex to: byteStopIndex do: [ :byteIndex | | byte i |
			byte := aByteArray at: byteIndex.
			i := contourDataIndexes at: baseIndex + byte + 1.
			i < 0
				ifTrue: [ baseIndex := i negated ]
				ifFalse: [
					advanceWidth := contourData at: i. i := i + 1.
					boundsLeft := contourData at: i. i := i + 1.
					boundsRight := contourData at: i. i := i + 1.
					boundsBottom := contourData at: i. i := i + 1.
					boundsTop := contourData at: i. i := i + 1.
					numContours := (contourData at: i) asInteger. i := i + 1.
					deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.5).
					"TrueType doesn't speciy how to position diacritics wrt base character glyph.
					Horizontally center diacriticals wrt base glyph.
					Apparently OpenType can do better than TrueType, as it includes the GPOS table."
					advanceWidth = 0.0
						ifFalse: [
							deltaXForBaseGlyph := deltaXToCenter.
							deltaXForDiacriticalMark := 0.0 ]
						ifTrue: [
							(deltaXForBaseGlyph = 0.0  						"For instance, if the first code point to display is a diacritic, like when building a FormGlyph for it"
									or: [boundsLeft < 0 and: [boundsRight > 0]])   "Some fonts have diacritics already 'centered'"
								ifTrue: [
									deltaXForDiacriticalMark := 0.0 ]
								ifFalse: [ 	deltaXForDiacriticalMark := deltaXToCenter - deltaXForBaseGlyph * sx ]].
					nextGlyphX := nextGlyphX + deltaXForDiacriticalMark.
					numContours timesRepeat: [
						numBeziers := (contourData at: i) asInteger. i := i + 1.
						ttMoveToX := contourData at: i. i := i + 1.
						ttMoveToY := contourData at: i. i := i + 1.
						x := ttMoveToX * sx + nextGlyphX.
						y := ttMoveToY * sy + nextGlyphY.
						contourStart := x@y.
						self moveTo: contourStart.
						numBeziers timesRepeat: [
							ttEndX := contourData at: i. i := i + 1.
							ttEndY := contourData at: i. i := i + 1.
							ttControlX := contourData at: i. i := i + 1.
							ttControlY := contourData at: i. i := i + 1.
							cx := ttControlX * sx + x.
							cy := ttControlY * sy + y.
							x := ttEndX * sx + x.
							y := ttEndY * sy + y.
							self quadraticBezierTo: x@y control: cx@cy
							].
						self lineTo: contourStart.
						].
					nextGlyphX := nextGlyphX + (advanceWidth * sx) - deltaXForDiacriticalMark.
					baseIndex := 0.
				]
			]
	].
	^ nextGlyphX@nextGlyphY! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
TrueTypeFontFamily readAllTrueTypeFontsIn: DirectoryEntry trueTypeFontsDirectory / 'DejaVu' / 'DejaVuSans'.
FontFamily releaseClassCachedState.
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6514-TrueTypeFonts-fixTopBottomBounds-JuanVuletich-2024Jul12-09h55m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6514] on 12 July 2024 at 10:23:01 am'!
!BitBltCanvasEngine methodsFor: 'private' stamp: 'jmv 7/11/2024 17:14:13' prior: 16792282!
                             basicDisplayUtf8: aByteArray fromByte: byteStartIndex toByte: byteStopIndex at: aPoint trueTypeFont: aTrueTypeFont
	"Answer position to place next glyph"

	| fdestX glyph maxHeight byteIndex n ascent lineGap deltaXToCenter deltaXForBaseGlyph deltaXForDiacriticalMark baseGlyphTopOffset deltaYForDiacriticalMark |
	deltaXForBaseGlyph := 0.
	baseGlyphTopOffset := 0.
	ascent := aTrueTypeFont ascent.		  "expensive"
	lineGap := aTrueTypeFont lineGap."expensive"
	destY := aPoint y.
	fdestX := aPoint x.
	maxHeight := 0.
	byteIndex := byteStartIndex.
	[  byteIndex <= byteStopIndex ] whileTrue: [
		n := Character utf8BytesAndCodePointAt: byteIndex in: aByteArray
			into: [ :byte1 :byte2 :byte3 :byte4 |
				glyph := aTrueTypeFont glyphAtUtf8Byte1: byte1 byte2: byte2 byte3: byte3 byte4: byte4 ] 
			into: nil.
		"Center diacriticals marks.
		See building of FormGlyph at
		formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:
		Implement equivalent behavior at 
			displayUtf8:fromByte:toByte:at:trueTypeFont:color:scale:preventMirroring:
		(Done in Smalltalk VectorEngine, still to be done for VectorEngineWithPlugin)."
		"Tested at various sizes of DejaVu Sans, DejaVu Serif, JetBrains Mono NL, Kiwi Maru Light (except ~ and `), Kurinto Sans, Neo Euler, Source Sans 3
		Test text (at sizes 10, 13, 144):
		(UnicodeString fromUtf8Bytes: #[97 	195 169 97 195 168 	97 	195 177 97 	195 145 195 188 64 97 	101 204 129 97 101 204 128 97 	110 204 131 97 	78 204 131 117 204 136 97	]) edit
		"
		deltaXToCenter := glyph deltaXToCenter.
		deltaXForDiacriticalMark := 0.
		deltaYForDiacriticalMark := 0.
		glyph advanceWidth = 0.0
			ifFalse: [ "Regular glyph"
				deltaXForBaseGlyph := deltaXToCenter.
				baseGlyphTopOffset := glyph topOffset ]
			ifTrue: [ "Diacritical mark"
				deltaXForDiacriticalMark := deltaXToCenter - deltaXForBaseGlyph.
				"Only if placed over a glyph with a top offset"
				baseGlyphTopOffset = 0 					ifFalse: [
					deltaYForDiacriticalMark :=  baseGlyphTopOffset - (glyph topOffset * 0.76).
					deltaYForDiacriticalMark := deltaYForDiacriticalMark max: 0 ]].
		destX := (fdestX + glyph leftOffset + deltaXForDiacriticalMark) roundedHAFZ.
		destY := (aPoint y + ascent + lineGap-1 - glyph topOffset - deltaYForDiacriticalMark) roundedHAFZ.
		"Please keep consistent with #displayOnVectorEngine:from:to:at:font:color:"
		aTrueTypeFont isSuperscript
			ifTrue: [destY := destY - (ascent*0.55)]
			ifFalse: [
				aTrueTypeFont isSubscript
					ifTrue: [destY := destY + (ascent*0.3)]].
		destY := destY roundedHAFZ.
		sourceForm := glyph form.
		height := sourceForm height.
		width := sourceForm width.
		self copyBits.
		fdestX := fdestX + "width + aTrueTypeFont baseKern"glyph advanceWidth.
		maxHeight := maxHeight max: height.
		byteIndex := byteIndex + n
	].
	^ fdestX ceiling@(destY+maxHeight)! !
!TTFontDescription methodsFor: 'conversion' stamp: 'jmv 7/12/2024 10:09:09' prior: 50354189!
                             formGlyphForUtf8Byte1: aByte1 byte2: aByte2OrNil byte3: aByte3OrNil byte4: aByte4OrNil pixelSize: pixelSize
	"Needed only for BitBltCanvasEngine"
	| byte1 byte2OrNil byte3OrNil byte4OrNil utf8ByteArray toPixelsScale formWidth formHeight leftPixelOffset topPixelOffset xtraSpaceForAntiAliasingAndRounding horizontalStrokesAtPixelCenter form canvas advanceWidth boundsLeft boundsRight boundsBottom boundsTop i deltaXToCenter |

	byte1 := aByte1.
	byte2OrNil := aByte2OrNil.
	byte3OrNil := aByte3OrNil.
	byte4OrNil := aByte4OrNil.
	i := contourDataIndexesByUtf8 at: byte1 + 1.
	utf8ByteArray := ByteArray with: byte1.
	byte2OrNil notNil ifTrue: [
		i := contourDataIndexesByUtf8 at: i negated + byte2OrNil + 1.
		utf8ByteArray := ByteArray with: byte1 with: byte2OrNil.
		byte3OrNil notNil ifTrue: [
			i := contourDataIndexesByUtf8 at: i negated + byte3OrNil + 1.
			utf8ByteArray := ByteArray with: byte1 with: byte2OrNil with: byte3OrNil.
			byte4OrNil notNil ifTrue: [
				i := contourDataIndexesByUtf8 at: i negated + byte4OrNil + 1.
				utf8ByteArray := ByteArray with: byte1 with: byte2OrNil with: byte3OrNil with: byte4OrNil ]]].

	"If glyph not found, take first glyph 'theUnknownGlyph'"
	i = 0 ifTrue: [ i := 1 ].

	advanceWidth := contourDataForUtf8 at: i. i := i + 1.
	boundsLeft := contourDataForUtf8 at: i. i := i + 1.
	boundsRight := contourDataForUtf8 at: i. i := i + 1.
	boundsBottom := contourDataForUtf8 at: i. i := i + 1.
	boundsTop := contourDataForUtf8 at: i. i := i + 1.

	horizontalStrokesAtPixelCenter := 0.5.
	xtraSpaceForAntiAliasingAndRounding := 3.
	toPixelsScale := 0.0 + pixelSize / self letterMTopSideBearing.

	"If positive, pixels we save at the left. if negative, xtra pix needed"
	leftPixelOffset := (boundsLeft * toPixelsScale - xtraSpaceForAntiAliasingAndRounding) floor.
	formWidth := (boundsRight - boundsLeft) * toPixelsScale + (xtraSpaceForAntiAliasingAndRounding*2).

	"Usually positive. Needed pixels above the baseline"
	topPixelOffset := (boundsTop * toPixelsScale + xtraSpaceForAntiAliasingAndRounding) ceiling.
	formHeight := (boundsTop - boundsBottom) * toPixelsScale + (xtraSpaceForAntiAliasingAndRounding*2).
	
	form := Form extent: formWidth@formHeight depth: 32.
	form fillColor: Color white.
	canvas := VectorCanvas onFormWithSubPixelAntiAliasing: form.
	canvas 
		engine
			displayUtf8: utf8ByteArray
			fromByte: 1
			toByte: utf8ByteArray size
			at: leftPixelOffset negated@(topPixelOffset - horizontalStrokesAtPixelCenter)
			trueTypeFont: self
			color: Color black
			scale: 1.0 * pixelSize
			preventMirroring: true.

	"TrueType doesn't speciy how to position diacritics wrt base character glyph.
	Horizontally center diacriticals wrt base glyph.
	See
	basicDisplayUtf8:fromByte:toByte:at:trueTypeFont:
	Apparently OpenType can do better than TrueType, as it includes the GPOS table."
	deltaXToCenter := (advanceWidth - (boundsRight+boundsLeft * 0.51)) * toPixelsScale.
	byte1 = 204 ifTrue: [
		byte2OrNil = 128 ifTrue: [ "Combining Grave Accent"
			deltaXToCenter := (advanceWidth - (boundsRight+boundsLeft * 0.43)) * toPixelsScale ].
		byte2OrNil = 129 ifTrue: [ "Combining Acute Accent"
			deltaXToCenter := (advanceWidth - (boundsRight+boundsLeft * 0.65)) * toPixelsScale 			]		].

	"DoubleWidth code points that combine above previous and following characters.
	Codepoints between 16r035C and 16r0363.
	Example: oÕ¢o
	Don't center them"
	(byte1 = 205 and: [ byte2OrNil between: 156 and: 163 ]) ifTrue: [
		deltaXToCenter := 0 ].
	
	^(FormGlyph
		form: form
		leftOffset: leftPixelOffset
		topOffset: topPixelOffset
		advanceWidth: (advanceWidth * toPixelsScale))
			deltaXToCenter: deltaXToCenter.
! !
!VectorEngine methodsFor: 'text and multi paths' stamp: 'jmv 7/12/2024 10:19:18' prior: 50354457!
            displayUtf8: aByteArray fromByte: byteStartIndex toByte: byteStopIndex at: aPoint trueTypeFont: aTTFontDescription color: aColor scale: scale preventMirroring: doPreventMirroring
	"TrueType assumes a Math like coordinate system (Y increasing upwards).
	But Display and Form Y coordinates in Cuis increase downwards, as it is done in most computer hardware and software.
	If doPreventMirroring is true, ensure that glyphs don't look mirrored, by having a negative y scale."
	| nextGlyphX nextGlyphY sx sy contourData contourDataIndexes trueTypeScale ttMoveToX ttMoveToY ttEndX ttEndY ttControlX ttControlY advanceWidth boundsLeft boundsRight boundsBottom boundsTop numContours numBeziers baseIndex x y cx cy contourStart deltaXToCenter deltaXForBaseGlyph deltaXForDiacriticalMark baseBoundsTop deltaYForDiacriticalMark byte1 byte2OrNil |
	deltaXForBaseGlyph := 0.0.
	baseBoundsTop := 0.
	trueTypeScale := 1.0 / aTTFontDescription letterMTopSideBearing.	"Perhaps measures in TTFontDescription should be normalized"
	sx := scale * trueTypeScale.
	sy := scale * trueTypeScale.
	(doPreventMirroring and: [ geometryTransformation doesMirror not ]) ifTrue: [ sy := sy negated ].
	contourData := aTTFontDescription contourDataForUtf8.
	contourDataIndexes := aTTFontDescription contourDataIndexesByUtf8.
	byte1 := aByteArray at: byteStartIndex.
	byte2OrNil := byteStopIndex > byteStartIndex ifTrue: [ aByteArray at: byteStartIndex +1 ].
	self fillColor: aColor do: [
		nextGlyphX := aPoint x.
		nextGlyphY := aPoint y.
		baseIndex := 0.
		byteStartIndex to: byteStopIndex do: [ :byteIndex | | byte i |
			byte := aByteArray at: byteIndex.
			i := contourDataIndexes at: baseIndex + byte + 1.
			i < 0
				ifTrue: [ baseIndex := i negated ]
				ifFalse: [
					advanceWidth := contourData at: i. i := i + 1.
					boundsLeft := contourData at: i. i := i + 1.
					boundsRight := contourData at: i. i := i + 1.
					boundsBottom := contourData at: i. i := i + 1.
					boundsTop := contourData at: i. i := i + 1.
					numContours := (contourData at: i) asInteger. i := i + 1.
					"TrueType doesn't speciy how to position diacritics wrt base character glyph.
					Horizontally center diacriticals wrt base glyph.
					See
						basicDisplayUtf8:fromByte:toByte:at:trueTypeFont:
						formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:
					Apparently OpenType can do better than TrueType, as it includes the GPOS table."
					deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.51).
					byte1 = 204 ifTrue: [
						byte2OrNil = 128 ifTrue: [ "Combining Grave Accent"
							deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.43) ].
						byte2OrNil = 129 ifTrue: [ "Combining Acute Accent"
							deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.65) 			]		].

					"DoubleWidth code points that combine above previous and following characters.
					Codepoints between 16r035C and 16r0363.
					Example: oÕ¢o
					Don't center them"
					(byte1 = 205 and: [ byte2OrNil between: 156 and: 163 ]) ifTrue: [
						deltaXToCenter := 0.0 ].

					deltaXForDiacriticalMark := 0.0.
					deltaYForDiacriticalMark := 0.
					advanceWidth = 0.0
						ifFalse: [ "Regular glyph"
							deltaXForBaseGlyph := deltaXToCenter.
							baseBoundsTop := boundsTop ]
						ifTrue: [ "Diacritical mark"
							deltaXForBaseGlyph = 0.0  						"For instance, if the first code point to display is a diacritic, like when building a FormGlyph for it"
								ifFalse: [
									deltaXForDiacriticalMark := deltaXToCenter - deltaXForBaseGlyph * sx.
									baseBoundsTop > boundsBottom ifTrue: [
										deltaYForDiacriticalMark :=  baseBoundsTop - boundsBottom + 100 * sy ]]].
					nextGlyphX := nextGlyphX + deltaXForDiacriticalMark.
					numContours timesRepeat: [
						numBeziers := (contourData at: i) asInteger. i := i + 1.
						ttMoveToX := contourData at: i. i := i + 1.
						ttMoveToY := contourData at: i. i := i + 1.
						x := ttMoveToX * sx + nextGlyphX.
						y := ttMoveToY * sy + nextGlyphY + deltaYForDiacriticalMark.
						contourStart := x@y.
						self moveTo: contourStart.
						numBeziers timesRepeat: [
							ttEndX := contourData at: i. i := i + 1.
							ttEndY := contourData at: i. i := i + 1.
							ttControlX := contourData at: i. i := i + 1.
							ttControlY := contourData at: i. i := i + 1.
							cx := ttControlX * sx + x.
							cy := ttControlY * sy + y.
							x := ttEndX * sx + x.
							y := ttEndY * sy + y.
							self quadraticBezierTo: x@y control: cx@cy
							].
						self lineTo: contourStart.
						].
					nextGlyphX := nextGlyphX + (advanceWidth * sx) - deltaXForDiacriticalMark.
					baseIndex := 0.
				]
			]
	].
	^ nextGlyphX@nextGlyphY! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
FontFamily releaseClassCachedState!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6515-FixAccentPositionForBitBltAndSmalltalkVGEngines-JuanVuletich-2024Jul12-10h05m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6515] on 12 July 2024 at 11:51:50 am'!
!BitBltCanvasEngine methodsFor: 'private' stamp: 'jmv 7/12/2024 11:51:28' prior: 50354597!
          basicDisplayUtf8: aByteArray fromByte: byteStartIndex toByte: byteStopIndex at: aPoint trueTypeFont: aTrueTypeFont
	"Answer position to place next glyph"

	| fdestX glyph maxHeight byteIndex n ascent lineGap deltaXToCenter deltaXForBaseGlyph deltaXForDiacriticalMark baseGlyphTopOffset deltaYForDiacriticalMark |
	deltaXForBaseGlyph := 0.
	baseGlyphTopOffset := 0.
	ascent := aTrueTypeFont ascent.		  "expensive"
	lineGap := aTrueTypeFont lineGap."expensive"
	destY := aPoint y.
	fdestX := aPoint x.
	maxHeight := 0.
	byteIndex := byteStartIndex.
	[  byteIndex <= byteStopIndex ] whileTrue: [
		n := Character utf8BytesAndCodePointAt: byteIndex in: aByteArray
			into: [ :byte1 :byte2 :byte3 :byte4 |
				glyph := aTrueTypeFont glyphAtUtf8Byte1: byte1 byte2: byte2 byte3: byte3 byte4: byte4 ] 
			into: nil.
		"Center diacriticals marks.
		See building of FormGlyph at
		formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:
		Implement equivalent behavior at 
			displayUtf8:fromByte:toByte:at:trueTypeFont:color:scale:preventMirroring:
		(Done in Smalltalk VectorEngine, still to be done for VectorEngineWithPlugin)."
		"Tested at various sizes of DejaVu Sans, DejaVu Serif, JetBrains Mono NL, Kiwi Maru Light (except ~ and `), Kurinto Sans, Neo Euler, Source Sans 3
		Test text (at sizes 10, 13, 144):
		(UnicodeString fromUtf8Bytes: #[97 	195 169 97 195 168 	97 	195 177 97 	195 145 195 188 64 97 	101 204 129 97 101 204 128 97 	110 204 131 97 	78 204 131 117 204 136 97	]) edit
		"
		deltaXToCenter := glyph deltaXToCenter.
		deltaXForDiacriticalMark := 0.
		deltaYForDiacriticalMark := 0.
		glyph advanceWidth = 0.0
			ifFalse: [ "Regular glyph"
				deltaXForBaseGlyph := deltaXToCenter.
				baseGlyphTopOffset := glyph topOffset ]
			ifTrue: [ "Diacritical mark"
				deltaXForDiacriticalMark := deltaXToCenter - deltaXForBaseGlyph.
				"Alternative implementation, perhaps closer to what  is done at VectorEngine >> #displayUtf8:fromByte:toByte:at:trueTypeFont:color:scale:preventMirroring:"
				"
				xtraSpaceForAntiAliasingAndRounding := 3. 'see #formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:'.
				baseBoundsTop := baseGlyphTopOffset-xtraSpaceForAntiAliasingAndRounding.
				boundsBottom := glyph topOffset-xtraSpaceForAntiAliasingAndRounding - (glyph form height-xtraSpaceForAntiAliasingAndRounding).
				boundsBottom := glyph topOffset - glyph form height.
				baseBoundsTop * 0.9 > boundsBottom ifTrue: [
					deltaYForDiacriticalMark :=  baseBoundsTop - boundsBottom ].
				"
				"Only if placed over a glyph with a top offset"
				baseGlyphTopOffset = 0 					ifFalse: [
					deltaYForDiacriticalMark :=  baseGlyphTopOffset - (glyph topOffset * 0.76).
					deltaYForDiacriticalMark := deltaYForDiacriticalMark max: 0 ]].
		destX := (fdestX + glyph leftOffset + deltaXForDiacriticalMark) roundedHAFZ.
		destY := (aPoint y + ascent + lineGap-1 - glyph topOffset - deltaYForDiacriticalMark) roundedHAFZ.
		"Please keep consistent with #displayOnVectorEngine:from:to:at:font:color:"
		aTrueTypeFont isSuperscript
			ifTrue: [destY := destY - (ascent*0.55)]
			ifFalse: [
				aTrueTypeFont isSubscript
					ifTrue: [destY := destY + (ascent*0.3)]].
		destY := destY roundedHAFZ.
		sourceForm := glyph form.
		height := sourceForm height.
		width := sourceForm width.
		self copyBits.
		fdestX := fdestX + "width + aTrueTypeFont baseKern"glyph advanceWidth.
		maxHeight := maxHeight max: height.
		byteIndex := byteIndex + n
	].
	^ fdestX ceiling@(destY+maxHeight).! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6516-tweak-JuanVuletich-2024Jul12-11h51m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6516] on 12 July 2024 at 4:05:33 pm'!
!BitBltCanvasEngine methodsFor: 'private' stamp: 'jmv 7/12/2024 15:51:06' prior: 50354975!
                   basicDisplayUtf8: aByteArray fromByte: byteStartIndex toByte: byteStopIndex at: aPoint trueTypeFont: aTrueTypeFont
	"Answer position to place next glyph"

	| fdestX glyph firstByte maxHeight byteIndex n ascent lineGap deltaXToCenter deltaXForBaseGlyph deltaXForDiacriticalMark baseGlyphTopOffset deltaYForDiacriticalMark |
	deltaXForBaseGlyph := 0.
	baseGlyphTopOffset := 0.
	ascent := aTrueTypeFont ascent.		  "expensive"
	lineGap := aTrueTypeFont lineGap."expensive"
	destY := aPoint y.
	fdestX := aPoint x.
	maxHeight := 0.
	byteIndex := byteStartIndex.
	[  byteIndex <= byteStopIndex ] whileTrue: [
		n := Character utf8BytesAndCodePointAt: byteIndex in: aByteArray
			into: [ :byte1 :byte2 :byte3 :byte4 |
				glyph := aTrueTypeFont glyphAtUtf8Byte1: byte1 byte2: byte2 byte3: byte3 byte4: byte4.
				firstByte := byte1 ] 
			into: nil.

		"$i followed by a Combining Diacritical Mark is replaced by CodePoint 305 Dotless i, UTF-8 #[196 177]
		(UnicodeString fromUtf8Bytes: #[105 105 204 129 32 105 204 128 32 105 204 130 32 105 204 131 32 105 204 132 32 105 204 133 32 105 204 134 32 105 204 135 32 105 204 136 32 105 204 137	]) edit
		This should also be done for VectorEngineWithPlugin at
			displayUtf8:fromByte:toByte:at:trueTypeFont:color:scale:preventMirroring:
		"
		(firstByte = 105 and: [ byteIndex < (byteStopIndex-1) ] and: [
			(aByteArray at: byteIndex+1) = 204 or: [ (aByteArray at: byteIndex+1) = 205 and: [ (aByteArray at: byteIndex+2) < 176 ]]])
				ifTrue: [ glyph := aTrueTypeFont glyphAtUtf8Byte1: 196 byte2: 177 byte3: nil byte4: nil ].

		"Center diacriticals marks.
		See building of FormGlyph at
		formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:
		Implement equivalent behavior at 
			displayUtf8:fromByte:toByte:at:trueTypeFont:color:scale:preventMirroring:
		(Done in Smalltalk VectorEngine, still to be done for VectorEngineWithPlugin)."
		"Tested at various sizes of DejaVu Sans, DejaVu Serif, JetBrains Mono NL, Kiwi Maru Light (except ~ and `), Kurinto Sans, Neo Euler, Source Sans 3
		Test text (at sizes 10, 13, 144):
		(UnicodeString fromUtf8Bytes: #[97 	195 169 97 195 168 	97 	195 177 97 	195 145 195 188 64 97 	101 204 129 97 101 204 128 97 	110 204 131 97 	78 204 131 117 204 136 97	]) edit
		"
		deltaXToCenter := glyph deltaXToCenter.
		deltaXForDiacriticalMark := 0.
		deltaYForDiacriticalMark := 0.
		glyph advanceWidth = 0.0
			ifFalse: [ "Regular glyph"
				deltaXForBaseGlyph := deltaXToCenter.
				baseGlyphTopOffset := glyph topOffset ]
			ifTrue: [ "Diacritical mark"
				deltaXForDiacriticalMark := deltaXToCenter - deltaXForBaseGlyph.
				"Alternative implementation, perhaps closer to what  is done at VectorEngine >> #displayUtf8:fromByte:toByte:at:trueTypeFont:color:scale:preventMirroring:"
				"
				xtraSpaceForAntiAliasingAndRounding := 3. 'see #formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:'.
				baseBoundsTop := baseGlyphTopOffset-xtraSpaceForAntiAliasingAndRounding.
				boundsBottom := glyph topOffset-xtraSpaceForAntiAliasingAndRounding - (glyph form height-xtraSpaceForAntiAliasingAndRounding).
				boundsBottom := glyph topOffset - glyph form height.
				baseBoundsTop * 0.9 > boundsBottom ifTrue: [
					deltaYForDiacriticalMark :=  baseBoundsTop - boundsBottom ].
				"
				"Only if placed over a glyph with a top offset"
				baseGlyphTopOffset = 0 					ifFalse: [
					deltaYForDiacriticalMark :=  baseGlyphTopOffset - (glyph topOffset * 0.76).
					deltaYForDiacriticalMark := deltaYForDiacriticalMark max: 0 ]].
		destX := (fdestX + glyph leftOffset + deltaXForDiacriticalMark) roundedHAFZ.
		destY := (aPoint y + ascent + lineGap-1 - glyph topOffset - deltaYForDiacriticalMark) roundedHAFZ.
		"Please keep consistent with #displayOnVectorEngine:from:to:at:font:color:"
		aTrueTypeFont isSuperscript
			ifTrue: [destY := destY - (ascent*0.55)]
			ifFalse: [
				aTrueTypeFont isSubscript
					ifTrue: [destY := destY + (ascent*0.3)]].
		destY := destY roundedHAFZ.
		sourceForm := glyph form.
		height := sourceForm height.
		width := sourceForm width.
		self copyBits.
		fdestX := fdestX + "width + aTrueTypeFont baseKern"glyph advanceWidth.
		maxHeight := maxHeight max: height.
		byteIndex := byteIndex + n
	].
	^ fdestX ceiling@(destY+maxHeight).! !
!VectorEngine methodsFor: 'text and multi paths' stamp: 'jmv 7/12/2024 15:51:39' prior: 50354807!
                 displayUtf8: aByteArray fromByte: byteStartIndex toByte: byteStopIndex at: aPoint trueTypeFont: aTTFontDescription color: aColor scale: scale preventMirroring: doPreventMirroring
	"TrueType assumes a Math like coordinate system (Y increasing upwards).
	But Display and Form Y coordinates in Cuis increase downwards, as it is done in most computer hardware and software.
	If doPreventMirroring is true, ensure that glyphs don't look mirrored, by having a negative y scale."
	| nextGlyphX nextGlyphY sx sy contourData contourDataIndexes trueTypeScale ttMoveToX ttMoveToY ttEndX ttEndY ttControlX ttControlY advanceWidth boundsLeft boundsRight boundsBottom boundsTop numContours numBeziers baseIndex x y cx cy contourStart deltaXToCenter deltaXForBaseGlyph deltaXForDiacriticalMark baseBoundsTop deltaYForDiacriticalMark byte1 byte2OrNil |
	deltaXForBaseGlyph := 0.0.
	baseBoundsTop := 0.
	trueTypeScale := 1.0 / aTTFontDescription letterMTopSideBearing.	"Perhaps measures in TTFontDescription should be normalized"
	sx := scale * trueTypeScale.
	sy := scale * trueTypeScale.
	(doPreventMirroring and: [ geometryTransformation doesMirror not ]) ifTrue: [ sy := sy negated ].
	contourData := aTTFontDescription contourDataForUtf8.
	contourDataIndexes := aTTFontDescription contourDataIndexesByUtf8.
	byte1 := nil.
	byte2OrNil := nil.
	self fillColor: aColor do: [
		nextGlyphX := aPoint x.
		nextGlyphY := aPoint y.
		baseIndex := 0.
		byteStartIndex to: byteStopIndex do: [ :byteIndex | | byte i |
			byte := aByteArray at: byteIndex.
			byte1 isNil ifTrue: [byte1 := byte ] ifFalse: [ byte2OrNil isNil ifTrue: [ byte2OrNil := byte ]].
			i := contourDataIndexes at: baseIndex + byte + 1.

			"$i followed by a Combining Diacritical Mark is replaced by CodePoint 305 Dotless i, UTF-8 #[196 177]
			(UnicodeString fromUtf8Bytes: #[105 105 204 129 32 105 204 128 32 105 204 130 32 105 204 131 32 105 204 132 32 105 204 133 32 105 204 134 32 105 204 135 32 105 204 136 32 105 204 137	]) edit
			This should also be done for VectorEngineWithPlugin
			"
			(byte1 = 105 and: [ byteIndex < (byteStopIndex-1) ] and: [
				(aByteArray at: byteIndex+1) = 204 or: [ (aByteArray at: byteIndex+1) = 205 and: [ (aByteArray at: byteIndex+2) < 176 ]]])
					ifTrue: [
						i := contourDataIndexes at: 196 + 1.
						i := contourDataIndexes at: i negated + 177 + 1 						].

			i < 0
				ifTrue: [ baseIndex := i negated ]
				ifFalse: [
					advanceWidth := contourData at: i. i := i + 1.
					boundsLeft := contourData at: i. i := i + 1.
					boundsRight := contourData at: i. i := i + 1.
					boundsBottom := contourData at: i. i := i + 1.
					boundsTop := contourData at: i. i := i + 1.
					numContours := (contourData at: i) asInteger. i := i + 1.
					"TrueType doesn't speciy how to position diacritics wrt base character glyph.
					Horizontally center diacriticals wrt base glyph.
					See
						basicDisplayUtf8:fromByte:toByte:at:trueTypeFont:
						formGlyphForUtf8Byte1:byte2:byte3:byte4:pixelSize:
					This should also be done for VectorEngineWithPlugin
					Apparently OpenType can do better than TrueType, as it includes the GPOS table."
					deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.51).
					byte1 = 204 ifTrue: [
						byte2OrNil = 128 ifTrue: [ "Combining Grave Accent"
							deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.43) ].
						byte2OrNil = 129 ifTrue: [ "Combining Acute Accent"
							deltaXToCenter := advanceWidth - (boundsRight+boundsLeft * 0.65) 			]].

					"DoubleWidth code points that combine above previous and following characters.
					Codepoints between 16r035C and 16r0363.
					Example: oÕ¢o
					Don't center them"
					(byte1 = 205 and: [ byte2OrNil between: 156 and: 163 ]) ifTrue: [
						deltaXToCenter := 0.0 ].

					deltaXForDiacriticalMark := 0.0.
					deltaYForDiacriticalMark := 0.
					advanceWidth = 0.0
						ifFalse: [ "Regular glyph"
							deltaXForBaseGlyph := deltaXToCenter.
							baseBoundsTop := boundsTop ]
						ifTrue: [ "Diacritical mark"
							deltaXForBaseGlyph = 0.0  						"For instance, if the first code point to display is a diacritic, like when building a FormGlyph for it"
								ifFalse: [
									deltaXForDiacriticalMark := deltaXToCenter - deltaXForBaseGlyph * sx.
									baseBoundsTop > boundsBottom ifTrue: [
										deltaYForDiacriticalMark :=  baseBoundsTop - boundsBottom + 100 * sy ]]].
					nextGlyphX := nextGlyphX + deltaXForDiacriticalMark.
					numContours timesRepeat: [
						numBeziers := (contourData at: i) asInteger. i := i + 1.
						ttMoveToX := contourData at: i. i := i + 1.
						ttMoveToY := contourData at: i. i := i + 1.
						x := ttMoveToX * sx + nextGlyphX.
						y := ttMoveToY * sy + nextGlyphY + deltaYForDiacriticalMark.
						contourStart := x@y.
						self moveTo: contourStart.
						numBeziers timesRepeat: [
							ttEndX := contourData at: i. i := i + 1.
							ttEndY := contourData at: i. i := i + 1.
							ttControlX := contourData at: i. i := i + 1.
							ttControlY := contourData at: i. i := i + 1.
							cx := ttControlX * sx + x.
							cy := ttControlY * sy + y.
							x := ttEndX * sx + x.
							y := ttEndY * sy + y.
							self quadraticBezierTo: x@y control: cx@cy
							].
						self lineTo: contourStart.
						].
					nextGlyphX := nextGlyphX + (advanceWidth * sx) - deltaXForDiacriticalMark.
					baseIndex := 0.
					byte1 := nil.
					byte2OrNil := nil.
				]
			]
	].
	^ nextGlyphX@nextGlyphY! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6517-UseDotless-i-ifFollowedByCombiningDiacritics-JuanVuletich-2024Jul12-16h01m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6517] on 15 July 2024 at 11:41:07 am'!
!LayoutMorph methodsFor: 'initialization' stamp: 'jmv 7/15/2024 11:27:34'!
                    doClipSubmorphs
	self setProperty: #doClipSubmorphs toValue: true.! !
!LayoutMorph methodsFor: 'geometry testing' stamp: 'jmv 7/15/2024 11:34:26' prior: 50341517 overrides: 16905625!
         clipsSubmorphs
	"LayoutMorphs usually not do not clip submorphs.
	A special case is Transcript. It doesn't include a ScrollPane (that usually does clipping).
	Note: for this to work, we can't be transparent, as transparent morphs can't clip submorphs.
		Senders may also call #doAdoptWidgetsColor.
	There may be other similar cases in the future."

	^self hasProperty: #doClipSubmorphs.! !
!Transcript class methodsFor: 'ui' stamp: 'jmv 7/15/2024 11:33:02' prior: 50341532!
      open
	"
	Transcript open
	"
	| win m |
	win := TranscriptWindow new.
	win
		setLabel: 'Transcript';
		model: Transcript.
	m := TranscriptMorph new.
	win layoutMorph
		"This is needed so the Layout correctly clips the TranscriptMorph"
		doAdoptWidgetsColor;
		doClipSubmorphs;
		addMorph: m proportionalHeight: 1.
	win model when: #redrawTranscriptArea send: #invalidateBounds to: win.
	^ win openInWorld! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
| found |
found := false.
self runningWorld submorphsDo: [ :m | m class == TranscriptWindow ifTrue: [ m delete. found := true ]].
found ifTrue: [ Transcript open ].!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6518-LayoutMorph-submorphClipping-fix-JuanVuletich-2024Jul15-11h37m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6518] on 15 July 2024 at 12:52:26 pm'!
!Editor methodsFor: 'accessing-selection' stamp: 'jmv 7/15/2024 12:51:29'!
           selection

	self subclassResponsibility ! !
!Editor methodsFor: 'accessing-selection' stamp: 'jmv 7/15/2024 12:51:35' prior: 16851730!
                         selectionIsEmptyOrSeparators
	"Answer true if no selection or selection is just separators (whitespace)"

	self hasSelection ifFalse: [ ^true ].
	^self selection isSeparators.
! !

TextEditor removeSelector: #selectionIsEmptyOrSeparators!

!methodRemoval: TextEditor #selectionIsEmptyOrSeparators stamp: 'Install-6519-Editor-selectionIsEmptyOrSeparators-JuanVuletich-2024Jul15-12h51m-jmv.001.cs.st 7/18/2024 14:51:22'!
selectionIsEmptyOrSeparators
	"Answer true if no selection or selection is just separators (whitespace)"

	self hasSelection ifFalse: [ ^true ].
	^self selection isSeparators!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6519-Editor-selectionIsEmptyOrSeparators-JuanVuletich-2024Jul15-12h51m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6519] on 17 July 2024 at 10:30:09 am'!
!Morph methodsFor: 'layout' stamp: 'jmv 7/17/2024 10:08:48' prior: 16906184!
       someSubmorphPositionOrExtentChanged
	"Some submorph changed at any nested level.
	Must layout submorphs again."

	owner ifNotNil: [ owner someSubmorphPositionOrExtentChanged ].
	self layoutNeeded: true.! !
!InnerTextMorph methodsFor: 'accessing' stamp: 'jmv 7/17/2024 10:08:16' prior: 16880926!
                         model: aTextModel wrappedTo: width
	"Accept new text contents.  Lay it out, wrapping to width.
	Then fit my height to the result."
	| newExtent oldExtent |
	wrapFlag := true.
	model := aTextModel.
	newExtent := width truncated@extent y.
	extent = newExtent ifFalse: [
		oldExtent := extent.
		extent := newExtent.
		self extentChanged: oldExtent.
		self someSubmorphPositionOrExtentChanged.
		self redrawNeeded ].
	self model: aTextModel! !
!InnerTextMorph methodsFor: 'notifications' stamp: 'jmv 7/17/2024 10:09:01' prior: 16881573 overrides: 50355504!
                      someSubmorphPositionOrExtentChanged
	"Some submorph changed at any nested level.
	Must layout submorphs again."

	super someSubmorphPositionOrExtentChanged.
	textComposition ifNotNil: [ 
		textComposition composeAll.
		self fit.
		self selectionChanged ]! !
!PluggableScrollPane methodsFor: 'geometry' stamp: 'jmv 7/17/2024 10:09:04' prior: 16924880 overrides: 50355504!
             someSubmorphPositionOrExtentChanged
	"Some submorph changed at any nested level.
	Must layout submorphs again."

	super someSubmorphPositionOrExtentChanged.
	scroller ifNotNil: [ | scrollerLocation doIt |
		doIt := false.
		scroller hasVariableExtent ifTrue: [
			theScrollerExtent = scroller morphExtentInOwner ifFalse: [
				theScrollerExtent := scroller morphExtentInOwner.
				doIt := true ]].
		scrollerLocation := scroller location.
		scrollerScale = scrollerLocation scale ifFalse: [
			scrollerScale := scrollerLocation scale.
			doIt := true ].
		scrollerRadians = scrollerLocation radians ifFalse: [
			scrollerRadians := scrollerLocation radians.
			doIt := true ].
		doIt ifTrue: [ self setScrollDeltas ]].! !
!HierarchicalListMorph methodsFor: 'geometry' stamp: 'jmv 7/17/2024 10:29:58' prior: 16874328 overrides: 50355544!
                           someSubmorphPositionOrExtentChanged
	"Our extent, or some submorph changed. Must layout submorphs again."

	owner ifNotNil: [ owner someSubmorphPositionOrExtentChanged ].
	self layoutNeeded: true.
	self updateScrollBarsBounds! !
!PluggableListMorph methodsFor: 'geometry' stamp: 'jmv 7/17/2024 10:30:01' prior: 16923590 overrides: 50355544!
           someSubmorphPositionOrExtentChanged
	"Our extent, or some submorph changed. Must layout submorphs again."

	owner ifNotNil: [ owner someSubmorphPositionOrExtentChanged ].
	self layoutNeeded: true.
	self updateScrollBarsBounds! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6520-someSubmorphPositionOrExtentChanged-throughOwnerChain-JuanVuletich-2024Jul17-10h10m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6520] on 17 July 2024 at 10:39:47 am'!
!LayoutMorph methodsFor: 'layout' stamp: 'jmv 7/17/2024 10:39:12' prior: 16890155 overrides: 16906128!
         layoutSubmorphs
	"Compute a new layout based on the given layout bounds."

	submorphs isEmpty ifTrue: [
		self layoutNeeded: false.
		^self].

	"Invariant: morphExtent >=  minimumLayoutExtent"
	self refreshExtent.
	
	direction == #horizontal ifTrue: [
		self layoutSubmorphsHorizontallyIn: self layoutBounds ].

	direction == #vertical ifTrue: [
		self layoutSubmorphsVerticallyIn: self layoutBounds ].

	self invalidateBounds.
	self layoutNeeded: false.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6521-layoutTriggersRefresh-JuanVuletich-2024Jul17-10h39m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6521] on 17 July 2024 at 11:36:51 am'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 7/17/2024 11:33:33' prior: 16966253!
        snapshot: save andQuit: quit embedded: embeddedFlag clearAllClassState: clearAllStateFlag
	"This is the main method for image save and / or quit.
	See senders."
	"WARNING: Current process will be killed. UI Process will be restarted"
	"Mark the changes file and close all files as part of #processShutdownList.
	If save is true, save the current state of this Smalltalk in the image file.
	If quit is true, then exit to the outer OS shell.
	The latter part of this method runs when resuming a previously saved image. This resume logic
	checks for a document file to process when starting up."
	"
	To test the full cleanup and startup procedures, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: true

	To test the cleanup done when saving the image, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: false
	"
	| activeProc |
	activeProc := Processor activeProcess.
[
	| isARealStartup guiRootObject guiRootObjectClass |
	save not & quit
		ifTrue: [ (SourceFiles at: 2) ifNotNil: [ :changes |
				ChangesInitialFileSize ifNotNil: [ changes truncate: ChangesInitialFileSize ]]]
		ifFalse: [ self logSnapshot: save andQuit: quit ].
	clearAllStateFlag ifTrue: [
		TranscriptWindow allInstancesDo: [ :each |
			each isInWorld ifTrue: [ each delete.]].
		UISupervisor ui tearDownDesktop.
		Transcript logToFile: false ].
	ActiveModel flushEventSystem.
	self processShutDownList: quit.
	"These could be moved to some #shutDown"
	self stopLowSpaceWatcher.
	WeakArray stopFinalizationProcess.
	ProcessorScheduler stopBackgroundProcess.
	"Stuff needed to relaunch UI on startup"
	guiRootObjectClass := UISupervisor ui class.
	"Replace with this to create a new world at startup after 'saveAsNewVersion'"
	guiRootObject := clearAllStateFlag ifFalse: [ UISupervisor ui ].

	UISupervisor stopUIProcess.
	activeProc isTerminated ifFalse: [ activeProc terminate ].
	guiRootObject ifNotNil: [ guiRootObject releaseCachedState ].
	clearAllStateFlag ifTrue: [
		Processor processesDo: [ :p |
			(p name = 'Formerly: Morphic UI') ifTrue: [ p terminate ]]].
	MorphicCanvas allSubInstancesDo: [ :c |
		(c ownerProcess notNil and: [c ownerProcess isTerminated]) ifTrue: [
			c releaseEngine			]].

	"Clean Globals"
	self at: #Sensor put: nil.
	self closeSourceFiles.
	self at: #SourceFiles put: nil.
	self allClassesDo: [ :cls |
		cls releaseClassCachedState ].
	clearAllStateFlag ifTrue: [
		self allClassesDo: [ :cls |
			cls releaseClassState ]].
	"To keep cleaning stuff that shouldn't be saved..."
	clearAllStateFlag ifTrue: [
		Transcript clear.
		"Enable this call to actually see the image clean report."
		false ifTrue: [self printStuffToCleanOnImageSave]].
	"Do image save & quit as apropriate"
	(Cursor cursorAt: #writeCursor) activateCursor.
	save
		ifTrue: [
			"The snapshot primitive answers false if it was just called to do the snapshot.
			But image startup is resumed by returning (again) from the primitive, but this time answering true."
			isARealStartup := embeddedFlag
				ifTrue: [ self snapshotEmbeddedPrimitive ]
				ifFalse: [ self snapshotPrimitive ]]
		ifFalse: [ isARealStartup := false ].
	quit & (isARealStartup == false) ifTrue: [ self quitPrimitive ].

	"If starting from absolute scratch, this would be a good time to recreate Global names"
	self at: #Sensor put: nil.
	self at: #SourceFiles put: (Array new: 2).
	self logStartupDebugAid: 'To #openSourceFiles'.
	self openSourceFiles.
	"Here, startup begins!! (isARealStartup might be nil)"
	self logStartupDebugAid: 'To #initClassCachedState'.
	self allClassesDo: [ :cls | cls initClassCachedState ].
	self logStartupDebugAid: 'To #doStartUp:'.
	self doStartUp: isARealStartup == true.
	self logStartupDebugAid: 'To #spawnNewMorphicProcessFor: ', guiRootObject printString.
	UISupervisor spawnNewMorphicProcessFor: (guiRootObject ifNil: [ guiRootObject := guiRootObjectClass newWorld ]).
	isARealStartup == true
		ifTrue: [
			self logStartupDebugAid: 'To #restoreLostChangesIfNecessary'.
			self restoreLostChangesIfNecessary ].
	clearAllStateFlag ifTrue: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #recreateDefaultDesktop'.
			guiRootObject recreateDefaultDesktop; restoreDisplay ]]
	ifFalse: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #restoreDisplay'.
			guiRootObject restoreDisplay ]].
	isARealStartup == true
		ifTrue: [
			"If system is coming up (VM and image just started)"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs.
				self logStartupDebugAid: 'To #processCommandLineArguments'.
				self processCommandLineArguments.
				self logStartupDebugAid: 'To #launchApp'.
				AppLauncher launchApp ]]
		ifFalse: [
			"If we are just saving the image"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs ]].
	"Now it's time to raise an error"
	isARealStartup ifNil: [ self logStartupError: 'Failed to write image file (disk full?)' ]
]
	forkAt: Processor timingPriority - 1
	named: 'Startup process'.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6522-DontAutoRestoreChangesIfSaveNoQuit-JuanVuletich-2024Jul17-11h35m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6522] on 17 July 2024 at 12:46:28 pm'!
!TextModel methodsFor: 'accessing' stamp: 'jmv 7/17/2024 12:28:38'!
                          contentsForFileSaving
	^self actualContents asPlainString! !
!Workspace methodsFor: 'accessing' stamp: 'jmv 7/17/2024 12:34:18' overrides: 50355798!
           contentsForFileSaving
	"See also SHTextStylerST80 >> #privateConvertAssignmentsOffset:
	See also Clipboard >> #storeObject:
	See also CodeProvider class >> #normalizeCodeForSaving:in:	"
	| normalized |
	normalized := self actualContents asPlainString.
	normalized := normalized copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	normalized := normalized copyReplaceAll: Character smalltalkLeftArrow asString with: ':='.
	normalized := normalized copyReplaceAll: Character smalltalkUpArrow asString with: '^'.
	^normalized! !
!CodeProvider class methodsFor: 'services' stamp: 'jmv 7/17/2024 12:33:18' prior: 50350947!
  normalizeCodeForSaving: aTextOrString in: aClassOrMetaclass
	"Adapt edited code to be suitable for saving to sources or changes files.
	Answer is a plain text.
	Additionally, if code was modified for better look and edition experience, normalize it.
	This may include reverting to ':=' for assignment, '^' for return, and any replacements of
	ASCII by Unicode symbols done by Shout.
	See also SHTextStylerST80 >> #privateConvertAssignmentsOffset:
	See also Clipboard >> #storeObject:
	See also Workspace >> #contentsForFileSaving"

	| answer |
	answer := aTextOrString asPlainString.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkLeftArrow asString` with: ':='.
	answer := answer copyReplaceAll: `Character smalltalkUpArrow asString` with: '^'.
	"Apply code any normalization services. For example, try:
	CodeProvider addCodeNormalizer: [ :code :cls | code, ' 						This is an extra comment1' asSmalltalkComment ].
	CodeProvider addCodeNormalizer: [ :code :cls | cls compilerClass new format: code in: cls notifying: nil. ].
	CodeProvider addCodeNormalizer: [ :code :cls | code, ' 						This is an extra comment2' asSmalltalkComment ].
	""
	CodeProvider clearCodeNormalizers.
	"
	CodeNormalizers ifNotNil: [
		CodeNormalizers do: [ :each |
			answer := each value: answer value: aClassOrMetaclass ]].
	^answer.! !
!SystemWindow methodsFor: 'user interface' stamp: 'jmv 7/17/2024 12:29:13' prior: 16971620!
 forceSaveContentsTo: aFileEntry
	"Saves the contents to the given filename.
	
	Force overwrting the file if it exists."

	self hasSaveAs ifFalse: [^self ].
	aFileEntry forceWriteStreamDo: [ :stream |
		stream nextPutAll: model contentsForFileSaving ].
	self 
		setProperty: #lastFilenameUsedToSave toValue: aFileEntry pathName.! !
!SystemWindow methodsFor: 'user interface' stamp: 'jmv 7/17/2024 12:29:08' prior: 16971677!
                         saveContentsTo: aFileEntry
	"Saves the contents to the given filename"

	self hasSaveAs ifFalse: [^self].
	aFileEntry writeStreamDo: [ :stream |
		stream nextPutAll: model contentsForFileSaving ].
	self 
		setProperty: #lastFilenameUsedToSave toValue: aFileEntry pathName;
		notifyUserWith: 'Contents saved to', String newLineString, aFileEntry pathName.! !
!Clipboard methodsFor: 'accessing' stamp: 'jmv 7/17/2024 12:36:42' prior: 50350789!
      storeObject: anObject
	"Set new contents on the clipboard. Also export to OS.
	anObject can be a:
		String
		Text
		Form
		Morph
		Object.
	OS clipboard supports String. Other formats might be supported if ExtendedClipboardInterface is present and operative."

	| primitiveFormat id |

	"Store a copy of the object. This is appropriate in case the original object is modified after being copied to the clipboard.
	Another copy must be made again when pasting, as the same object could be pasted many times.
	Besides, store the original object, but weakly (so we don't prevent it GCed). The original object might be used in workspaces."
	(anObject isString or: [ anObject is: #Text])
		ifTrue: [
			contents := anObject copyForClipboard.
			contentsOriginalObjectWeakly at: 1 put: nil ]
		ifFalse: [
			contents := anObject copyForClipboard.
			contentsOriginalObjectWeakly at: 1 put: anObject ].
	
	self noteRecentClipping: contents.

	"Store on OS clipboard using ExtendedClipboardInterface if present.
	Warning: This has not yet been adapted to UTF-8 Unicode"
	self extendedClipboardInterface ifNotNil: [ :interface |
		interface canStore ifTrue: [
			id := self idFor: contents.
			contents isString
				ifTrue: [ ^interface storeString: contents id: id ].
			(contents is: #Text)
				ifTrue: [ ^interface storeText: contents id: id ].
			(contents is: #Form)
				ifTrue: [ ^interface storeForm: contents id: id ].
			(contents is: #Morph)
				ifTrue: [ ^interface storeForm: (contents imageForm: 32) id: id ].
			^interface storeString: contents asString id: id ]].

	"Otherwise use the clipboard primitives in the VM"
	"The VM uses UTF-8 for clipboard"
	primitiveFormat := self stringOrIdFor: contents.
	"See also CodeProvider class >> #normalizeCodeForSaving:in:	
	See also SHTextStylerST80 >> #privateConvertAssignmentsOffset:
	See also Workspace >> #contentsForFileSaving"
	primitiveFormat := primitiveFormat copyReplaceAll: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString` with: ':='.
	primitiveFormat := primitiveFormat copyReplaceAll: Character smalltalkLeftArrow asString with: ':='.
	primitiveFormat := primitiveFormat copyReplaceAll: Character smalltalkUpArrow asString with: '^'.
	primitiveFormat := primitiveFormat asUtf8Bytes.
	self primitiveClipboardString: primitiveFormat! !
!SmalltalkEditor methodsFor: 'clipboard' stamp: 'jmv 7/17/2024 12:38:55' prior: 16952744 overrides: 16851745!
 clipboardStringOrText
	"When pasting possibly external text into Smalltalk code,
	assume any Unicode left and up arrows are meant to be Assignment and Return.
	This is just a help to users. Not really necessary for the system itself."
	| clipContents |
	clipContents := super clipboardStringOrText.
	self replaceUnicodeArrowsWithSmalltalkArrows ifTrue: [
		clipContents := clipContents copyReplaceAll: `(Character codePoint: 16r2190) asString` with: `(Character smalltalkLeftArrow ) asString`.
		clipContents := clipContents copyReplaceAll: `(Character codePoint: 16r2191) asString` with: `(Character smalltalkUpArrow ) asString`.
		].
	^clipContents.! !
!SHTextStylerST80 methodsFor: 'private' stamp: 'jmv 7/17/2024 12:36:15' prior: 16943431 overrides: 16943209!
    privateConvertAssignmentsOffset: delta
	"See also CodeProvider class >> #normalizeCodeForSaving:in:	
	See also Clipboard >> #storeObject:
	See also Workspace >> #contentsForFileSaving"
	"Turn $_ into a left arrow"

	self
		replaceStringForRangesWithType: #assignment
		with: `Character smalltalkLeftArrow asString`
		offset: delta.
	(Preferences at: #showAssignmentAsLeftArrow)
		ifTrue: [
			"Turn := into a left arrow. Include a #zeroWidthSpace so as not to modify ranges, etc."
			self
				replaceStringForRangesWithType: #ansiAssignment
				with: `Character smalltalkLeftArrow asString, Character zeroWidthSpace asString`
				offset: delta.
			"Turn $^into up arrow"
			self
				replaceStringForRangesWithType: #return
				with: `Character smalltalkUpArrow asString`
				offset: delta ].! !

TextModel removeSelector: #saveOn:!

!methodRemoval: TextModel #saveOn: stamp: 'Install-6523-Workspace-ConvertAssigmentArrowOnSaveToFile-JuanVuletich-2024Jul17-12h40m-jmv.001.cs.st 7/18/2024 14:51:22'!
saveOn: stream
	"Saves the model to the given stream"
	stream binary.
	stream nextPutAll: self actualContents asPlainString.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6523-Workspace-ConvertAssigmentArrowOnSaveToFile-JuanVuletich-2024Jul17-12h40m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6523] on 18 July 2024 at 11:28:17 am'!
!SystemDictionary methodsFor: 'startup' stamp: 'jmv 7/18/2024 11:08:44' prior: 16969059!
  displayCommandLineUsageOn: aStream
	"Display command line usage on standard out."

	[ aStream
		nextPutAll: 'Command line options:'; newLine;
		nextPutAll: '  -h Display this help message and quit'; newLine;
		nextPutAll: '  -v Display the system information, containing the version and quit'; newLine;
		nextPutAll: '  -q Just quit'; newLine;
		nextPutAll: '  -e Do not ignore exceptions, but open a Debugger'; newLine;
		nextPutAll: '  -u Install updates from CoreUpdates directory'; newLine;
		nextPutAll: '  -r <feature> Require <feature>'; newLine;
		nextPutAll: '  -d <code> Evaluate <code>'; newLine;
		nextPutAll: '  -l <codeFile> Load e.g. file in <codeFile>'; newLine;
		nextPutAll: '  -s <scriptFile> Evaluate code in <scriptFile>'; newLine;
		nextPutAll: '  -ud <directory> Set User Directory to be <directory>'; newLine;
		nextPutAll: '  -udIsBase Set User Directory to be Cuis Base directory'; newLine;
		nextPutAll: '  -- end of options; stop processing options'; newLine;
		newLine;
		nextPutAll: 'Arguments for scripts, code files, packages (and <code>):'; newLine;
		nextPutAll: '  are available in ''Smalltalk startUpScriptArguments'''; newLine;
		newLine;
		nextPutAll: 'Multiple options:'; newLine;
		nextPutAll: '  any option can be passed multiple times'; newLine;
		flush ]
	on: UnhandledError
	do: [ :exception | exception return ].! !
!SystemDictionary methodsFor: 'startup' stamp: 'jmv 7/18/2024 11:08:57' prior: 16969104!
                      displaySystemInformationStringOn: aStream
	"Display the system information string on standard output."

	[ aStream
		nextPutAll: 'System information:';		newLine;
		nextPutAll: self systemInformationString;		newLine;
		flush ]
	on: UnhandledError
	do: [ :exception | exception return ].! !
!Transcript class methodsFor: 'preferred protocol' stamp: 'jmv 7/18/2024 11:10:01' prior: 16988099!
                           clearStdout

	logToStdout ifTrue: [
		15 timesRepeat: [ self stdout newLine ].
		self stdout flush
	]! !
!Transcript class methodsFor: 'private' stamp: 'jmv 7/18/2024 11:10:35' prior: 16988337!
                              writeToStdout: anEntry

	logToStdout ifTrue: [ self stdout nextPutAll: anEntry; flush ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6524-Flush-stdout-JuanVuletich-2024Jul18-11h15m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6524] on 18 July 2024 at 11:39:41 am'!
!Feature class methodsFor: 'convenience' stamp: 'jmv 7/18/2024 10:59:15'!
                         requireInformFaiure: featureNameOrFilename
	"
	Answer whether the request is fulfilled.
	Feature require: 'StyledTextInstaller'
	Feature require: 'Sound'
	Feature require: 'Tests'
	"
	^ [ self require: featureNameOrFilename ]
		on: FeatureRequirementUnsatisfied
		do: [ :ex | PopUpMenu inform: ex messageText. false ]! !
!SystemDictionary methodsFor: 'startup' stamp: 'jmv 7/18/2024 11:11:36' prior: 16969249!
      processCommandLineOption: optionString optionArgument: optionArgument raiseExceptions: aBoolean
	"
	A possible example (duplicated single quotes: '' should be double quotes, but not allowed in a Smalltalk comment):
Squeak.app/Contents/MacOS/Squeak Cuis-Smalltalk-Dev/Cuis6.0-????.image -h
Squeak.app/Contents/MacOS/Squeak Cuis-Smalltalk-Dev/Cuis6.0-????.image -v
Squeak.app/Contents/MacOS/Squeak Cuis-Smalltalk-Dev/Cuis6.0-????.image -q
Squeak.app/Contents/MacOS/Squeak Cuis-Smalltalk-Dev/Cuis6.0-????.image -e -d''0 zope''
Squeak.app/Contents/MacOS/Squeak Cuis-Smalltalk-Dev/Cuis6.0-????.image -r YAXO -rJSON -d ''Smalltalk startUpScriptArguments print'' xx YY 3492 -d'' 'here comes another' print'' -d ''{'The answer is: '. Smalltalk startUpScriptArguments first asNumber + Smalltalk startUpScriptArguments second asNumber} print'' 3 4 -- -d'' 'not this' print' ''

Squeak.exe Cuis4.2-2211x.image -r RequiredFeature1 -r RequiredFeature2 -d ''Transcript show: 'popo1'; newLine'' -d ''Transcript show: 'popo2'; newLine'' -s smalltalkScript.st param1ToScript param2ToSCript ''parametro 3 to script ->>>--// 3''
	"
	"You can use 'Smalltalk startUpScriptArguments' inside the startUp script:"


	| exceptionToIgnoreOrNil file directory |
	exceptionToIgnoreOrNil := aBoolean ifFalse: [UnhandledError] ifTrue: [nil].
	optionString caseOf: {
		[ '-h' ] -> [
			self displayCommandLineUsageOn: StdIOWriteStream stdout.
			self quit ].

		[ '-v' ] -> [ 
			self displaySystemInformationStringOn: StdIOWriteStream stdout.
			self quit ].

		[ '-q' ] -> [ self quit ].

		[ '-u' ] -> [ ChangeSet installNewUpdates ].

		[ '-r' ] -> [		"as in 		-rRequiredFeature2        or         -r RequiredFeature2"
			{ 'Feature require: '. optionArgument } print.
			[ Feature require: optionArgument ] on: FeatureRequirementUnsatisfied do: [ :ex |
				StdIOWriteStream stdout nextPutAll: ex messageText; newLine; flush.
				ex messageText print.
				self quit ] ].

		[ '-d' ] -> [		"as in 		-d ''Transcript show: 'popo1'; newLine'' -d''Transcript show: 'popo2'; newLine''        (duplicated singleQuotes should read doubleQuote)"
			{ 'Compiler evaluate: '. optionArgument } print.
			[ Compiler evaluate: optionArgument ] on: exceptionToIgnoreOrNil do: [ :ex | ex return] ].

		['-l' ] -> ["file in the file"
			file := optionArgument isAbsolutePathName
				ifTrue: [ FileEntry withAbsolutePathName: optionArgument ]
				ifFalse: [FileEntry withRelativePathName: optionArgument to: DirectoryEntry currentDirectory ].
			{ 'File in: '. optionArgument. ' -> '. file} print.
			[file readStreamDo: [ :stream | stream fileIn ]] on: exceptionToIgnoreOrNil do: [ :ex | ex return]].

		[ '-s' ] -> [		"as in 		-s smalltalkScript.st paramAlScript1 paramAlSCript2 ''parameter to script script ->>>--// 3'' 			(duplicated singleQuotes should read doubleQuote)"
			file := optionArgument isAbsolutePathName
				ifTrue: [ FileEntry withAbsolutePathName: optionArgument ]
				ifFalse: [FileEntry withRelativePathName: optionArgument to: DirectoryEntry currentDirectory ].
			{ 'Compiler evaluate contents of file named: '. optionArgument. ' -> '. file. ' arguments: '. self startUpScriptArguments } print.
			file exists ifTrue: [
				file readStreamDo: [ :stream |
					[ Compiler evaluate: stream contentsOfEntireFile ] on: exceptionToIgnoreOrNil do: [ :ex | ex return]]]].

		[ '-ud' ] -> [
			directory := optionArgument asDirectoryEntry.
			DirectoryEntry setUserBaseDirectory: directory ].

		[ '-udIsBase' ] -> [ DirectoryEntry setUserBaseDirectoryAsCuisBase ].
	}
	otherwise: [].! !
!NegativePowerError methodsFor: 'exceptionDescription' stamp: 'jmv 7/18/2024 11:04:13' prior: 16910886 overrides: 16782494!
                             defaultAction

	"Disable this preference to have Float nan answer (if Float receiver or argument) or Error message"
	| answer |
	(Preferences at: #askToInstallComplexPackage) ifTrue: [
		answer := PopUpMenu
			withCaption:
'Square (or even) Root of a negative Number:
Complex number support is not loaded
Would you like me to load it for you now?'
			chooseFrom: #(
				'Load Complex package'
				'Do not load Complex package'
				'Do not load Complex package and don''t ask again').
		answer = 1 ifTrue: [
			Feature requireInformFaiure: #'Complex'.
			Smalltalk at: #Complex ifPresent: [ :cplx |
				^ (cplx basicReal: receiver imaginary: 0) perform: selector withArguments: arguments ]].
		answer = 3 ifTrue: [
			(Preferences at: #askToInstallComplexPackage put: false)]].
	^ super defaultAction! !
!Theme class methodsFor: 'user interface' stamp: 'jmv 7/18/2024 11:04:17' prior: 16986444!
  loadAdditionalThemes
	"Load additional themes and reopen menu."
	Feature requireInformFaiure: #'Theme-Themes'.
	self changeTheme! !
!TheWorldMenu methodsFor: 'menu' stamp: 'jmv 7/18/2024 11:04:21' prior: 16984077!
          openCommentGuide
	"In ClassCommentBrowser.pck"
	Smalltalk at: #CommentGuideWindow ifAbsent: [ 
		(PopUpMenu 
		confirm: 'The Class Comment Guide is not loaded', String newLineString, 'Would you like me to load it for you now?')
		ifTrue: [Feature requireInformFaiure: #'ClassCommentBrowser'] 
	].
	Smalltalk at: #CommentGuide ifPresent: [ :cls | ^cls open ].
	self inform: 'Please install optional package ClassCommentBrowser.pck.st', String newLineString, 'Feature require: #''ClassCommentBrowser'' '! !
!TheWorldMenu methodsFor: 'menu' stamp: 'jmv 7/18/2024 11:04:24' prior: 16984095!
                     openPackageDownloader
	"In PackageDownloader.pck"
	Smalltalk at: #PackageDownloaderWindow ifAbsent: [ 
		(PopUpMenu 
		confirm: 'The Package Downloader is not loaded', String newLineString, 'Would you like me to load it for you now?')
		ifTrue: [Feature requireInformFaiure: #'PackageDownloader'] 
	].
	Smalltalk at: #PackageDownloaderWindow ifPresent: [ :cls | ^cls open ].
	self inform: 'Please install optional package PackageDownloader.pck.st', String newLineString, 'Feature require: #''PackageDownloader'' '! !
!TheWorldMenu methodsFor: 'menu' stamp: 'jmv 7/18/2024 11:04:28' prior: 16984113!
         openPackageInstaller
	"In PackageInstaller.pck"
	Smalltalk at: #PackageInstallerWindow ifAbsent: [ 
		(PopUpMenu 
		confirm: 'The Package Installer is not loaded', String newLineString, 'Would you like me to load it for you now?')
		ifTrue: [Feature requireInformFaiure: #PackageInstaller ] 
	].
	Smalltalk at: #PackageInstallerWindow ifPresent: [ :cls | ^cls open ].
	self inform: 'Please install optional package PackageInstaller.pck.st', String newLineString, 'Feature require: #''PackageInstaller'' '! !
!TheWorldMenu methodsFor: 'menu' stamp: 'jmv 7/18/2024 11:04:33' prior: 16984131!
                  openTerseGuide
	"In TerseGuide.pck"
	Smalltalk at: #TerseGuideWindow ifAbsent: [ 
		(PopUpMenu 
		confirm: 'The Terse Guide is not loaded', String newLineString, 'Would you like me to load it for you now?')
		ifTrue: [Feature requireInformFaiure: #'TerseGuide'] 
	].
	Smalltalk at: #TerseGuideWindow ifPresent: [ :cls | ^cls openTerseGuide ].
	self inform: 'Please install optional package TerseGuide.pck.st', String newLineString, 'Feature require: #''TerseGuide'' '! !
!FeatureRequirement methodsFor: 'requires' stamp: 'jmv 7/18/2024 11:01:37' prior: 16859992!
             require
	"See if all the transitive closure of requirements can be met and answer the load order if so"

	| packagesToLoad |
	
	"Preflight before load 
	  [1] Build transitive closure as load order where Feature comes 
	       before its required features."
	packagesToLoad := self
			requireUnlessIn: OrderedCollection new
			main: nil
			requiringFeature: nil
			allRequiringFeatures: #().
	
	"Transcript show: 'packagesToLoad: '; newLine.
	packagesToLoad do: [ :x |Transcript show: x; newLine ].
	Transcript newLine."
	
	"[2] Check to see that each requirement is actually satisfied"
	packagesToLoad do: [ :fReq | fReq checkRequirement ].

	"[3] Load required packages before packages that require them"
	packagesToLoad reverseDo: [ :requirement |
		requirement isAlreadySatisfied ifFalse: [
			requirement install ]].
	self isAlreadySatisfied ifFalse: [
		self install ]! !
!FeatureRequirement methodsFor: 'requires' stamp: 'jmv 7/18/2024 11:02:19' prior: 16860089!
                      satisfyRequirementsAndInstall
	"Like #require, but install me even if already satisified (i.e. installed)"

	| packagesToLoad |
		
	"Preflight before load"
	packagesToLoad := self
			requireUnlessIn: OrderedCollection new
			main: self
			requiringFeature: self
			allRequiringFeatures: #().
	
	"Check to see that each requirement is actually satisfied"
	packagesToLoad do: [ :fReq | fReq checkRequirement ].
	
	"All requirements are satisfied; do the deed"
	packagesToLoad reverseDo: [ :requirement |
		requirement isAlreadySatisfied ifFalse: [
			requirement install ]].
	self install! !
!CodePackageFile class methodsFor: 'services' stamp: 'jmv 7/18/2024 11:03:26' prior: 16824766!
                   installPackage: aFileEntry

	| fullName pkName req |
	fullName := aFileEntry pathName.
	pkName := CodePackageFile packageNameFrom: fullName.
	req := (FeatureRequirement name: pkName)
		pathName: fullName.
	"Install with all requirements"
	[ req satisfyRequirementsAndInstall ]
		on: FeatureRequirementUnsatisfied
		do: [ :ex | PopUpMenu inform: ex messageText ]! !

FeatureRequirementUnsatisfied removeSelector: #defaultAction!

!methodRemoval: FeatureRequirementUnsatisfied #defaultAction stamp: 'Install-6525-Startup-PackageLoadingFailure-JuanVuletich-2024Jul18-11h33m-jmv.001.cs.st 7/18/2024 14:51:22'!
defaultAction
	"The default action taken if the exception is signaled."

	self messageText print.
	PopUpMenu inform: self messageText.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6525-Startup-PackageLoadingFailure-JuanVuletich-2024Jul18-11h33m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6517] on 15 July 2024 at 11:41:07 am'!

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
PreferenceSet setDefaultFont: FontFamily defaultFamilyName.
Smalltalk garbageCollect.
!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6526-GarbageCollect-Cleanup-JuanVuletich-2024Jul15-11h37m-jmv.001.cs.st----!

----QUIT----(18 July 2024 14:51:27) Cuis7.1-6526.image priorSource: 693485!

----STARTUP---- (27 July 2024 22:35:03) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6526.image!


'From Cuis7.1 [latest update: #6526] on 25 July 2024 at 10:39:59 am'!
!CharacterSequence methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:38:29'!
               < another
	"Answer whether the receiver sorts before another.
	The collation order is case sensitive.
	Note: Behavior the same for String, Symbol, UnicodeString, UnicodeSymbol and Text,
	both as receiver and as argument, if they hold same Characters."

	self subclassResponsibility.! !
!CharacterSequence methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:29:56'!
                      <= another
	"Answer whether the receiver sorts after aString.
	The collation order is case sensitive."
	"Reduce all cases to #< and #= to simplify code."

	"Comparing for equality may is faster in most casts. Try it first."
	self = another ifTrue: [ ^true ].

	^self < another.! !
!CharacterSequence methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:38:14' overrides: 16947162!
       = another
	"Note: Behavior the same for String, Symbol, UnicodeString, UnicodeSymbol and Text,
	both as receiver and as argument, if they hold same Characters."

	self subclassResponsibility! !
!CharacterSequence methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:29:53'!
                  > another
	"Answer whether the receiver sorts after aString.
	The collation order is case sensitive."
	"Reduce all cases to #< and #= to simplify code."

	"Comparing for equality may is faster in most casts. Try it first."
	self = another ifTrue: [ ^false ].

	^(self < another) not.! !
!CharacterSequence methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:23:43'!
                     >= another
	"Answer whether the receiver sorts after or equal to aString.
	The collation order is case sensitive."
	"Reduce all cases to #< and #= to simplify code."

	^(self < another) not.! !
!CharacterSequence methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:36:22' overrides: 16947199!
                              hash
	"#hash is implemented, because #= is implemented.
	Note: #hash must be the same for String, Symbol, UnicodeString, UnicodeSymbol and Text
	if they hold same Characters."

	self subclassResponsibility! !
!String methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:29:37' prior: 16959514 overrides: 50356476!
          < aString
	"Answer whether the receiver sorts before aString.
	The collation order is case sensitive."

	"Comparing for equality may is faster in most casts. Try it first."
	self = aString ifTrue: [ ^false ].

	"Let them handle us (already knowing we are not equal)"
	aString isByteString ifFalse: [ ^(aString < self) not ].

	^ (String compare: self with: aString) = 1.! !
!UnicodeString methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:29:46' prior: 16992974 overrides: 50356476!
                              < aString
	"Answer whether the receiver sorts before aString.
	The collation order is case sensitive."

	"Comparing for equality may is faster in most casts. Try it first."
	self = aString ifTrue: [ ^false ].

	"If we are ascii, we have same bytes as equivalent String."
	self isAscii ifTrue: [
		aString isByteString ifTrue: [
			"Do comparison like String does it."
			^ (String compare: bytes with: aString) = 1].
		(aString isUnicodeString and: [aString isAscii]) ifTrue: [
			"aString is also an ascii UnicodeString. Their bytes are also same as equiv String."
			^ (String compare: bytes with: aString bytes) = 1]].

"This needs a reasonable implementation for Unicode (this behavior is INCORRECT).
It is also slow.
At least, it is consistent with #< in Character"
self flag: #unicodeNeedsImprovement.
self flag: #slowUnicode.
	^ (UnicodeString compare: self with: aString) = 1.! !

UnicodeString removeSelector: #>=!

!methodRemoval: UnicodeString #>= stamp: 'Install-6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st 7/27/2024 22:35:03'!
>= aString
	"Answer whether the receiver sorts after or equal to aString.
	The collation order is case sensitive."

	"Any object is equal to itself"
	self == aString ifTrue: [ ^ true ].

	"If we are ascii, we have same bytes as equivalent String."
	self isAscii ifTrue: [
		aString isByteString ifTrue: [
			"Do comparison like String does it."
			^ (String compare: bytes with: aString) >= 2].
		(aString isUnicodeString and: [aString isAscii]) ifTrue: [
			"aString is also an ascii UnicodeString. Their bytes are also same as equiv String."
			^ (String compare: bytes with: aString bytes) >= 2]].

"This needs a reasonable implementation for Unicode (this behavior is INCORRECT).
It is also slow.
At least, it is consistent with #< in Character"
self flag: #unicodeNeedsImprovement.
self flag: #slowUnicode.
	^ (UnicodeString compare: self with: aString) >= 2!

UnicodeString removeSelector: #>!

!methodRemoval: UnicodeString #> stamp: 'Install-6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st 7/27/2024 22:35:03'!
> aString
	"Answer whether the receiver sorts after aString.
	The collation order is case sensitive."

	"Any object is equal to itself"
	self == aString ifTrue: [ ^ false ].

	"If we are ascii, we have same bytes as equivalent String."
	self isAscii ifTrue: [
		aString isByteString ifTrue: [
			"Do comparison like String does it."
			^ (String compare: bytes with: aString) = 3].
		(aString isUnicodeString and: [aString isAscii]) ifTrue: [
			"aString is also an ascii UnicodeString. Their bytes are also same as equiv String."
			^ (String compare: bytes with: aString bytes) = 3]].

"This needs a reasonable implementation for Unicode (this behavior is INCORRECT).
It is also slow.
At least, it is consistent with #< in Character"
self flag: #unicodeNeedsImprovement.
self flag: #slowUnicode.
	^ (UnicodeString compare: self with: aString) = 3!

UnicodeString removeSelector: #<=!

!methodRemoval: UnicodeString #<= stamp: 'Install-6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st 7/27/2024 22:35:03'!
<= aString
	"Answer whether the receiver sorts before or equal to aString.
	The collation order is case sensitive."

	"Any object is equal to itself"
	self == aString ifTrue: [ ^ true ].

	"If we are ascii, we have same bytes as equivalent String."
	self isAscii ifTrue: [
		aString isByteString ifTrue: [
			"Do comparison like String does it."
			^ (String compare: bytes with: aString) <= 2].
		(aString isUnicodeString and: [aString isAscii]) ifTrue: [
			"aString is also an ascii UnicodeString. Their bytes are also same as equiv String."
			^ (String compare: bytes with: aString bytes) <= 2]].

"This needs a reasonable implementation for Unicode (this behavior is INCORRECT).
It is also slow.
At least, it is consistent with #< in Character"
self flag: #unicodeNeedsImprovement.
self flag: #slowUnicode.
	^ (UnicodeString compare: self with: aString) <= 2!

String removeSelector: #>=!

!methodRemoval: String #>= stamp: 'Install-6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st 7/27/2024 22:35:03'!
>= aString
	"Answer whether the receiver sorts after or equal to aString.
	The collation order is case sensitive."

	"Any object is equal to itself"
	self == aString ifTrue: [ ^ true ].

	"Let them handle us"
	aString isByteString ifFalse: [ ^aString <= self ].

	^ (String compare: self with: aString) >= 2!

String removeSelector: #>!

!methodRemoval: String #> stamp: 'Install-6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st 7/27/2024 22:35:03'!
> aString
	"Answer whether the receiver sorts after aString.
	The collation order is case sensitive."

	"Any object is equal to itself"
	self == aString ifTrue: [ ^ false ].

	"Let them handle us"
	aString isByteString ifFalse: [ ^aString < self ].

	^ (String compare: self with: aString) = 3!

String removeSelector: #<=!

!methodRemoval: String #<= stamp: 'Install-6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st 7/27/2024 22:35:03'!
<= aString
	"Answer whether the receiver sorts before or equal to aString.
	The collation order is case sensitive."

	"Any object is equal to itself"
	self == aString ifTrue: [ ^ true ].

	"Let them handle us"
	aString isByteString ifFalse: [ ^aString >= self ].

	^ (String compare: self with: aString) <= 2!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6527-StringSortingSimplification-JuanVuletich-2024Jul25-09h40m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6526] on 25 July 2024 at 10:49:49 am'!
!Character methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:49:21' prior: 16810652!
                    <= aCharacter
	"Answer whether the receiver is less than or equal to the argument."
	"Reduce all cases to #< and #= to simplify code."

	self == aCharacter ifTrue: [ ^true ].
	^self < aCharacter.! !
!Character methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:49:27' prior: 16810658!
     > aCharacter
	"Answer whether the receiver is greater than the argument."
	"Reduce all cases to #< and #= to simplify code."

	self == aCharacter ifTrue: [ ^false ].
	^(self < aCharacter) not.! !
!Character methodsFor: 'comparing' stamp: 'jmv 7/25/2024 10:49:32' prior: 16810671!
        >= aCharacter
	"Answer whether the receiver is greater than or equal to the argument."
	"Reduce all cases to #< and #= to simplify code."

	^(self < aCharacter) not.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6528-CharacterSortingSimplification-JuanVuletich-2024Jul25-10h39m-jmv.002.cs.st----!

'From Cuis7.1 [latest update: #6528] on 25 July 2024 at 2:39:16 pm'!
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:36:28' prior: 16960684!
          basicCaseInsensitiveOrder
	"Case insensitive compare sorts null, space, digits, letters, all the rest..."
	| newOrder order |
	newOrder := Array new: 256.
	order := -1.
	newOrder at: 0+1 put:  (order := order+1).
	32 to: 64 do: [ :c |
		newOrder at: c + 1 put: (order := order+1)].
	#(92 94 124 126 183 215 247) do: [ :c | "\^|~¬∑√∑√ó"
		newOrder at: c + 1 put: (order := order+1)].
	16r90 to: 16r9F do: [:c| "special math operators"
		newOrder at: c + 1 put: (order := order+1)].
	Character uppercaseLowercaseAndUnaccentedLetters do: [ :upperAndLowercase |
		order := order+1.
		newOrder at: upperAndLowercase first codePoint + 1 put: order.
		(upperAndLowercase first = $√ø or: [upperAndLowercase first = $√ü]) ifFalse: [
			newOrder at: upperAndLowercase second codePoint + 1 put: order ]].
	1 to: newOrder size do: [ :i |
		(newOrder at: i) ifNil: [
			newOrder at: i put: (order := order+1)]].
	^newOrder asByteArray.! !
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:36:42' prior: 16960714!
        basicCaseSensitiveOrder
	"Case sensitive compare sorts null, space, digits, letters, all the rest..."
	| newOrder order lowercase |
	newOrder := Array new: 256.
	order := -1.
	newOrder at: 0+1 put:  (order := order+1).
	32 to: 64 do: [ :c |
		newOrder at: c + 1 put: (order := order+1)].
	#(92 94 124 126 183 215 247) do: [ :c | "\^|~¬∑√∑√ó"
		newOrder at: c + 1 put: (order := order+1)].
	16r90 to: 16r9F do: [:c| "special math operators"
		newOrder at: c + 1 put: (order := order+1)].
	Character uppercaseLowercaseAndUnaccentedLetters do: [ :upperAndLowercase |
		(upperAndLowercase first = $√ø or: [upperAndLowercase first = $√ü]) ifFalse: [
			newOrder at: upperAndLowercase first codePoint + 1 put: (order := order+1) ]].
	Character uppercaseLowercaseAndUnaccentedLetters do: [ :upperAndLowercase |
		lowercase := (upperAndLowercase first = $√ø or: [upperAndLowercase first = $√ü])
			ifTrue: [ upperAndLowercase first ]
			ifFalse: [ upperAndLowercase second ].
		newOrder at: lowercase codePoint + 1 put: (order := order+1) ].
	1 to: newOrder size do: [ :i |
		(newOrder at: i) ifNil: [
			newOrder at: i put: (order := order+1)]].
	order = 255 ifFalse: [self error: 'order problem'].
	^newOrder asByteArray.! !
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:37:08' prior: 16960752!
   caseInsensitiveOrder
	^`String basicCaseInsensitiveOrder`.! !
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:37:12' prior: 16960757!
        caseSensitiveOrder
	^`String basicCaseSensitiveOrder`.! !
!Character class methodsFor: 'class initialization' stamp: 'jmv 7/25/2024 14:36:05' prior: 50352551!
 uppercaseLowercaseAndUnaccentedLetters
	"Answer all uppercase and lowercase letters in standard collation order.
	For accented characters, include the non-accented ones.
	Note that $√ü is 'LATIN SMALL LETTER SHARP S' and ISO 8859-1 doesn't have an uppercase version.
	Note: for $√ø, 'Latin Small Letter Y with diaeresis' the uppercase version is not Latin 1"
self flag: #unicodeNeedsImprovement.
	^#(
		'Aa' '√Ä√†Aa' '√Å√°Aa' '√Ç√¢Aa' '√É√£Aa' '√Ñ√§Aa' '√Ö√•Aa'
		'Bb'
		'Cc' '√á√ßCc'
		'Dd'
		'Ee' '√à√®Ee' '√â√©Ee' '√ä√™Ee' '√ã√´Ee'
		'Ff' 'Gg' 'Hh'
		'Ii' '√å√¨Ii' '√ç√≠Ii' '√é√ÆIi' '√è√ØIi'
		'Jj' 'Kk' 'Ll' 'Mm'
		'Nn' '√ë√±Nn'
		'Oo' '√í√≤Oo' '√ì√≥Oo' '√î√¥Oo' '√ï√µOo' '√ñ√∂Oo'
		'Pp' 'Qq' 'Rr' 'Ss' 'Tt'
		'Uu' '√ô√πUu' '√ö√∫Uu' '√õ√ªUu' '√ú√ºUu'
		'Vv' 'Ww' 'Xx'
		'Yy' '√ù√ΩYy' '√øy'
		'Zz'
		'√Ü√¶' '√ê√∞' '√ò√∏' '√û√æ' '√ü'
	).! !
!Character class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:36:48' prior: 16811758!
                        basicLookupTables
	| lowercaseMappingTable uppercaseMappingTable unaccentedTable |
	lowercaseMappingTable := Array new: 256.
	uppercaseMappingTable := Array new: 256.
	unaccentedTable := ByteArray new: 256.
	0
		to: 255
		do: [ :idx | | char |
			"Default to an identity mapping with a false truth mapping"
			char := self codePoint: idx.
			lowercaseMappingTable
				at: idx + 1 put: char.
			uppercaseMappingTable
				at: idx + 1 put: char.
			unaccentedTable at: idx + 1 put: idx].
	"Now override as needed"
	Character uppercaseLowercaseAndUnaccentedLetters do: [ :group | | uppercase lowercase |
		(group first = $√ø or: [group first = $√ü])
			ifFalse: [ | lowercaseChar uppercaseChar |
				uppercase := group first codePoint.
				lowercase := group second codePoint.
				lowercaseChar := self codePoint: lowercase.
				uppercaseChar := self codePoint: uppercase.
				lowercaseMappingTable
					at: lowercase + 1 put: lowercaseChar;
					at: uppercase + 1 put: lowercaseChar.
				uppercaseMappingTable
					at: lowercase + 1 put: uppercaseChar;
					at: uppercase + 1 put: uppercaseChar.
				group size > 2
					ifTrue: [|unaccentedUppercase unaccentedLowercase|
						unaccentedUppercase := group third codePoint.
						unaccentedLowercase := group fourth codePoint.
						unaccentedTable
							at: uppercase+1 put: unaccentedUppercase;
							at: lowercase+1 put: unaccentedLowercase]]
			ifTrue: [ | lowercaseChar |
				lowercase := group first codePoint.
				lowercaseChar := self codePoint: lowercase.
				lowercaseMappingTable
					at: lowercase + 1 put: lowercaseChar.
				uppercaseMappingTable
					at: lowercase + 1 put: lowercaseChar.
				group size > 1
					ifTrue: [|unaccentedLowercase|
						unaccentedLowercase := group second codePoint.
						unaccentedTable
							at: lowercase+1 put: unaccentedLowercase]]].
	^{ lowercaseMappingTable. uppercaseMappingTable. unaccentedTable}.! !
!Character class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:37:20' prior: 16811814!
                   lowercaseMappingTable
	^`Character basicLookupTables at: 1`.! !
!Character class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:37:25' prior: 16811819!
   unaccentedTable
	^`Character basicLookupTables at: 3`.! !
!Character class methodsFor: 'static state' stamp: 'jmv 7/25/2024 14:37:29' prior: 16811824!
         uppercaseMappingTable
	^`Character basicLookupTables at: 2`.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6529-UnaccentedTweaks-JuanVuletich-2024Jul25-14h23m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6529] on 25 July 2024 at 2:45:35 pm'!
!Character class methodsFor: 'class initialization' stamp: 'jmv 7/25/2024 14:42:12' prior: 16811042 overrides: 16916245!
  initialize
	"https://www.unicode.org/Public/UCD/latest/ucd/UnicodeData.txt
	http://www.unicode.org/L2/L1999/UnicodeData.html
	Character initialize
	"

	| fields codePoint codePointName generalCategory canonicalCombiningClass characterDecompositionMapping decomposition composition |
	UppercaseLettersTable := ByteArray newBits: 16r1FFFF. "Basic Multilingual Plane 	+ Supplementary Multilingual Plane"
	LowercaseLettersTable := ByteArray newBits: 16r1FFFF. "Basic Multilingual Plane 	+ Supplementary Multilingual Plane"
	SymbolsLikeTable := ByteArray newBits: 16r1FFFF. "Basic Multilingual Plane 	+ Supplementary Multilingual Plane"
	DiacriticalMarksTable := ByteArray newBits: 16r1FFFF. "Basic Multilingual Plane 	+ Supplementary Multilingual Plane"
	CanonicalCombiningClasses := Dictionary new.
	DecompositionMapping := Dictionary new.
	CompositionMapping := Dictionary new.
	(DirectoryEntry smalltalkImageDirectory // 'UnicodeData.txt') readStreamDo: [ :strm |
		[strm atEnd] whileFalse: [
			fields := strm nextLine substringsSeparatedBy: $;.
			(#(4 5 6) includes: fields first size) ifFalse: [ fields first print. self error: 'Bad UnicodeData.txt file' ].
			codePoint := ('16r', fields first) asNumber.
			codePointName := fields at: 2.
			generalCategory := fields at: 3.
			codePoint <= 16r1FFFF ifTrue: [
				({ 'Lu'. 'Lt' } includes: generalCategory) ifTrue: [ UppercaseLettersTable bitBooleanAt: codePoint+1 put: true ].
				({ 'Ll'. 'Lo' } includes: generalCategory) ifTrue: [ LowercaseLettersTable bitBooleanAt: codePoint+1 put: true ].
				({ 'Pc'. 'Pd'. 'Po'. 'Sm'. 'Sc'. 'Sk'. 'So' } includes: generalCategory) ifTrue: [ SymbolsLikeTable bitBooleanAt: codePoint+1 put: true ].
				({ 'Mn'. 'Mc'. 'Me' } includes: generalCategory) ifTrue: [ DiacriticalMarksTable bitBooleanAt: codePoint+1 put: true ]].
			canonicalCombiningClass := (fields at: 4) asNumber.
			canonicalCombiningClass = 0 ifFalse: [
				CanonicalCombiningClasses at: codePoint put: canonicalCombiningClass ].
			characterDecompositionMapping := fields at: 6.
			(characterDecompositionMapping size > 0 and: [ characterDecompositionMapping first ~= $< ]) ifTrue: [
				decomposition := characterDecompositionMapping substrings collect: [ :s | ('16r', s) asNumber].
				DecompositionMapping at: codePoint put: decomposition.
				decomposition size > 1 ifTrue: [
					composition := CompositionMapping at: decomposition first ifAbsentPut: [Dictionary new].
					composition at: decomposition second put: codePoint.
					decomposition size > 2 ifTrue: [self error: decomposition printString print].
					]].
			"
			uppercaseMapping := fields at: 13. lowercaseMapping := fields at: 14. titlecaseMapping := fields at: 15.
			Random next > 10.999 | (generalCategory = 'So') ifTrue: [
				{codePoint hex. codePointName. generalCategory} print ].
			decimalDigitValue := fields at: 7. digitValue := fields at: 8. numericValue := fields at: 9.
			decimalDigitValue isEmpty & digitValue isEmpty & numericValue isEmpty ifFalse: [
				{'numeric'. codePoint. codePointName. generalCategory. decimalDigitValue. digitValue. numericValue} print].
			"
			]].
	self initializeNamedCharactersMap.! !

Character initialize!

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
Character initialize.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6530-MinusSign-isSymbolLike-JuanVuletich-2024Jul25-14h42m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6530] on 25 July 2024 at 3:09:16 pm'!
!Character methodsFor: 'comparing' stamp: 'jmv 7/25/2024 14:57:44'!
                collatesBefore: aCharacter
	"Compare with the standard case sensitive collation order.
	Sort by #collatingCategory, and if same category,
	sort by unaccented version of the character."

	| myCat theirCat |
	self == aCharacter ifTrue: [ ^false ].

	myCat := self collatingCategory.
	theirCat := aCharacter collatingCategory.
	myCat = theirCat ifFalse: [
		"Lower collating category goes first"
		^myCat < theirCat ].

	self isLetter ifTrue: [ "Then both are"
		| meWithoutDiacritics theyWithoutDiacritics |
		meWithoutDiacritics := self  asUnaccented.
		theyWithoutDiacritics := aCharacter asUnaccented.
		"If not the same base character, compare base character"
		meWithoutDiacritics = theyWithoutDiacritics ifFalse: [
			^meWithoutDiacritics codePoint < theyWithoutDiacritics codePoint ].
		"Same base character... just compare code points"
		^self codePoint < aCharacter codePoint ].
	
	"Non-letters in same collating category? -> Lower codePoint goes first."
	^self codePoint < aCharacter codePoint.! !
!Character methodsFor: 'comparing' stamp: 'jmv 7/25/2024 15:07:16'!
              collatingCategory
	"Needs to be consistent with #basicCaseSensitiveOrder"
	"
	0: Character null
	1: Separators
	2: #isSymbolLine
	3: Decimal digits
	4: Uppercase Letters
	5: Lowercase Letters
	6: other
	"
	self codePoint = 0 ifTrue: [ ^0 ].
	self isSeparator ifTrue: [ ^1 ].
	self isSymbolLike ifTrue: [ ^2 ].
	self isDigit ifTrue: [ ^3 ].
	self isUppercase ifTrue: [ ^4 ].
	self isLowercase ifTrue: [ ^5 ].
	^6! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6531-Character-collatesBefore-JuanVuletich-2024Jul25-14h48m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6531] on 25 July 2024 at 3:56:48 pm'!
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 15:53:31' prior: 50356772!
                          basicCaseInsensitiveOrder
	"Only for the first 256 Unicode code points.
	Case insensitive
	Follow #collatesBefore:"

	| sorted answer order |
	sorted := (0 to: 255) asArray collect: [ :i | Character codePoint: i ] ::
		sort: [ :a :b |
			a asLowercase = b asLowercase
				ifTrue: [ a collatesBefore: b ]
				ifFalse: [	 	a asLowercase collatesBefore: b asLowercase ]].
	answer := Array new: 256.
	order := -1.
	sorted do: [ :c |
		c isUppercase ifFalse: [
			answer at: c codePoint + 1 put: (order := order+1)]].
	sorted do: [ :c |
		c isUppercase ifTrue: [
			answer at: c codePoint + 1 put: (answer at: c asLowercase codePoint + 1)]].
	^answer asByteArray.! !
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 15:53:34' prior: 50356804!
                basicCaseSensitiveOrder
	"Only for the first 256 Unicode code points.
	Case sensitive
	Follow #collatesBefore:"

	| sorted answer order |
	sorted := (0 to: 255) asArray collect: [ :i | Character codePoint: i ] :: sort: [ :a :b | a collatesBefore: b ].
	answer := Array new: 256.
	order := -1.
	sorted do: [ :c | answer at: c codePoint + 1 put: (order := order+1)].
	order = 255 ifFalse: [self error: 'order problem'].
	^answer asByteArray.! !
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 15:53:54' prior: 50356845!
           caseInsensitiveOrder
	^`String basicCaseInsensitiveOrder`.! !
!String class methodsFor: 'static state' stamp: 'jmv 7/25/2024 15:53:47' prior: 50356850!
        caseSensitiveOrder
	^`String basicCaseSensitiveOrder`.! !
!Character methodsFor: 'comparing' stamp: 'jmv 7/25/2024 15:54:18' prior: 16810639!
                  < aCharacter
	"Compare with the standard case sensitive collation order."

	self == aCharacter ifTrue: [ ^false ].

	(self codePoint < 256 and: [ aCharacter codePoint < 256 ]) ifTrue: [
		^String does: self collateBefore: aCharacter ].

	^self collatesBefore: aCharacter.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6532-BetterCharacterCollation-JuanVuletich-2024Jul25-15h12m-jmv.005.cs.st----!

'From Cuis7.1 [latest update: #6526] on 25 July 2024 at 11:45:45 am'!

SmalltalkCompleter initialize.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6533-CharacterCollationJustChanged-JuanVuletich-2024Jul25-10h49m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6533] on 25 July 2024 at 4:15:13 pm'!
!Browser methodsFor: 'message list' stamp: 'jmv 7/25/2024 16:14:48' prior: 16798415 overrides: 50347625!
   messageList
	"Answer an Array of the message selectors of the currently selected message category, provided that the messageCategoryListIndex is in proper range.  Otherwise, answer an empty Array  If messageCategoryListIndex is found to be larger than the number of categories (it happens!!), it is reset to zero."
	| classOrMetaClassOrganizer answer |
	classOrMetaClassOrganizer := self classOrMetaClassOrganizer.
	classOrMetaClassOrganizer isNil ifTrue: [ ^#() ].
	answer := (selectedMessageCategory isNil or: [ selectedMessageCategory == ClassOrganizer allCategory ])
		ifTrue: [classOrMetaClassOrganizer allMethodSelectors]
		ifFalse: [classOrMetaClassOrganizer listAtCategoryNamed: selectedMessageCategory].	
	answer isNil ifTrue: [
		selectedMessageCategory := nil.
		answer := #() ].
	^answer! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6534-SelectorSortingMovedToCharacterCollation-JuanVuletich-2024Jul25-16h14m-jmv.001.cs.st----!

----QUIT----(27 July 2024 22:35:15) Cuis7.1-6534.image priorSource: 794124!

----STARTUP---- (27 July 2024 22:43:56) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6534.image!


'From Cuis7.1 [latest update: #6534] on 25 July 2024 at 6:38:36 pm'!
!HaloMorph methodsFor: 'event handling' stamp: 'jmv 7/25/2024 18:33:53' prior: 16871441!
                      popUpFor: aMorph handPosition: handPosition hand: hand

	hand halo: self.
	hand world addMorphFront: self.
	self target: aMorph.
	positionOffset := handPosition - aMorph morphPositionInWorld.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6535-addHalo-fix-JuanVuletich-2024Jul25-18h38m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6535] on 26 July 2024 at 11:19:51 am'!
!WorldMorph class methodsFor: 'new-morph participation' stamp: 'jmv 7/26/2024 11:10:39' overrides: 16907530!
               includeInNewMorphMenu
	"Not to be instantiated from the menu"
	^ false! !
!ClassNameRequestMorph class methodsFor: 'new-morph participation' stamp: 'jmv 7/26/2024 11:13:48' overrides: 16907530!
                              includeInNewMorphMenu
	"Not to be instantiated from the menu"
	^ false! !
!DraggableButtonMorph class methodsFor: 'new-morph participation' stamp: 'jmv 7/26/2024 11:13:31' overrides: 16923117!
                               includeInNewMorphMenu
	"Not to be instantiated from the menu"
	^ false! !
!HoverableButtonMorph class methodsFor: 'new-morph participation' stamp: 'jmv 7/26/2024 11:13:18' overrides: 16923117!
                               includeInNewMorphMenu
	"Not to be instantiated from the menu"
	^ false! !
!TileResizeMorph class methodsFor: 'new-morph participation' stamp: 'jmv 7/26/2024 11:14:51' overrides: 16796809!
    categoryInNewMorphMenu

	^ 'User Interface'! !
!SmalltalkCompleterMorph class methodsFor: 'new-morph participation' stamp: 'jmv 7/26/2024 11:11:00' overrides: 16907530!
                       includeInNewMorphMenu
	"Not to be instantiated from the menu"
	^ false! !
!AutoCompleterMorph class methodsFor: 'instance creation' stamp: 'jmv 7/26/2024 11:18:23' prior: 16785230 overrides: 16907514!
                       initializedInstance
	| completer m |
	completer := SmalltalkCompleter withModel: (TextModel withText: 'Small').
	completer
		instVarNamed: 'position'
		put: 5.
	completer computeEntries.
	m := completer morphClass
		completer: completer
		position: `10@10`.
	completer instVarNamed: 'menuMorph' put: m.
	^m! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6536-NewMorph-menu-tweaks-JuanVuletich-2024Jul26-11h10m-jmv.001.cs.st----!

----QUIT----(27 July 2024 22:44:01) Cuis7.1-6536.image priorSource: 819513!

----STARTUP---- (27 July 2024 22:51:18) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6536.image!


'From Cuis7.1 [latest update: #6536] on 26 July 2024 at 11:50:13 am'!
!IniFileSection methodsFor: 'enumerating' stamp: 'mir 7/18/2024 17:11:55'!
    entriesDo: aBlock
	entries keysAndValuesDo: [:key :value | aBlock value: key value: value]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6537-IniFileSection-entriesDo-MichaelRueger-2024Jul26-11h48m-mir.001.cs.st----!

----QUIT----(27 July 2024 22:51:22) Cuis7.1-6537.image priorSource: 822200!

----STARTUP---- (28 July 2024 15:53:11) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6537.image!


'From Cuis7.1 [latest update: #6536] on 26 July 2024 at 11:50:29 am'!
!SystemDictionary methodsFor: 'image, changes name' stamp: 'mir 7/23/2024 14:35:49' prior: 16963182!
                             alternativeSourcesName
	"Answer the alternative full path to the sources file.
	If Sources not found at #defaultSourcesName (this image folder), 
	seek for them here (standard image folder)."
	"
	Smalltalk alternativeSourcesName
	"
	"Answer the default full path to the version-stable source code"
	^ self vmPath , 'CuisImage' , '/' , SourceFileVersionString , '.sources'! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6538-alternativeSourcesName-MichaelRueger-2024Jul26-11h50m-mir.001.cs.st----!

'From Cuis7.1 [latest update: #6538] on 27 July 2024 at 3:17:32 pm'!
!WorldMorph methodsFor: 'change reporting' stamp: 'KenD 7/27/2024 07:32:54'!
                addedMorphx: aMorph
	"Notify the receiver that the given morph was just added."
	super addedMorph: aMorph.
	self firstHand newMouseFocus: nil. "Hand need to reset mouseFocus"
	self taskbar ifNotNil: [ :tb |
		tb wasOpened: aMorph ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6539-ReleaseMouseFocus-whenMorphAddedToWorld-KenDickey-2024Jul27-15h16m-KenD.001.cs.st----!

'From Cuis7.1 [latest update: #6539] on 28 July 2024 at 3:50:15 pm'!
!Behavior methodsFor: 'enumerating' stamp: 'jmv 7/28/2024 15:44:50'!
                      allInstancesDoAlt: aBlock
	"Evaluate aBlock with each of the current instances of the receiver."
	"Alternative implementation of #allInstancesDo:
	iterating using #someInstance / #nextInstance.
	Use with care."

	| inst next |
	"Because aBlock might change the class of inst (for example,
	 using become:), it is essential to compute next before aBlock value: inst."
	inst := self someInstance.
	[inst == nil] whileFalse:
		[next := inst nextInstance.
		 aBlock value: inst.
		 inst := next].! !
!Behavior methodsFor: 'enumerating' stamp: 'jmv 7/28/2024 15:45:08'!
           allSubInstancesDoAlt: aBlock 
	"Evaluate the argument, aBlock, for each of the current instances of the 
	receiver and all its subclasses."
	"Alternative implementation for #allSubInstancesDo:
	iterating using #someInstance / #nextInstance.
	Use with care."

	self allInstancesDoAlt: aBlock.
	self allSubclassesDo: [:sub | sub allInstancesDoAlt: aBlock].! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 7/28/2024 15:45:56' prior: 50355626!
                       snapshot: save andQuit: quit embedded: embeddedFlag clearAllClassState: clearAllStateFlag
	"This is the main method for image save and / or quit.
	See senders."
	"WARNING: Current process will be killed. UI Process will be restarted"
	"Mark the changes file and close all files as part of #processShutdownList.
	If save is true, save the current state of this Smalltalk in the image file.
	If quit is true, then exit to the outer OS shell.
	The latter part of this method runs when resuming a previously saved image. This resume logic
	checks for a document file to process when starting up."
	"
	To test the full cleanup and startup procedures, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: true

	To test the cleanup done when saving the image, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: false
	"
	| activeProc |
	activeProc := Processor activeProcess.
[
	| isARealStartup guiRootObject guiRootObjectClass |
	save not & quit
		ifTrue: [ (SourceFiles at: 2) ifNotNil: [ :changes |
				ChangesInitialFileSize ifNotNil: [ changes truncate: ChangesInitialFileSize ]]]
		ifFalse: [ self logSnapshot: save andQuit: quit ].
	clearAllStateFlag ifTrue: [
		TranscriptWindow allInstancesDoAlt: [ :each |
			each isInWorld ifTrue: [ each delete.]].
		UISupervisor ui tearDownDesktop.
		Transcript logToFile: false ].
	ActiveModel flushEventSystem.
	self processShutDownList: quit.
	"These could be moved to some #shutDown"
	self stopLowSpaceWatcher.
	WeakArray stopFinalizationProcess.
	ProcessorScheduler stopBackgroundProcess.
	"Stuff needed to relaunch UI on startup"
	guiRootObjectClass := UISupervisor ui class.
	"Replace with this to create a new world at startup after 'saveAsNewVersion'"
	guiRootObject := clearAllStateFlag ifFalse: [ UISupervisor ui ].

	UISupervisor stopUIProcess.
	activeProc isTerminated ifFalse: [ activeProc terminate ].
	guiRootObject ifNotNil: [ guiRootObject releaseCachedState ].
	clearAllStateFlag ifTrue: [
		Processor processesDo: [ :p |
			(p name = 'Formerly: Morphic UI') ifTrue: [ p terminate ]]].
	MorphicCanvas allSubInstancesDoAlt: [ :c |
		(c ownerProcess notNil and: [c ownerProcess isTerminated]) ifTrue: [
			c releaseEngine			]].

	"Clean Globals"
	self at: #Sensor put: nil.
	self closeSourceFiles.
	self at: #SourceFiles put: nil.
	self allClassesDo: [ :cls |
		cls releaseClassCachedState ].
	clearAllStateFlag ifTrue: [
		self allClassesDo: [ :cls |
			cls releaseClassState ]].
	"To keep cleaning stuff that shouldn't be saved..."
	clearAllStateFlag ifTrue: [
		Transcript clear.
		"Enable this call to actually see the image clean report."
		false ifTrue: [self printStuffToCleanOnImageSave]].
	"Do image save & quit as apropriate"
	(Cursor cursorAt: #writeCursor) activateCursor.
	save
		ifTrue: [
			"The snapshot primitive answers false if it was just called to do the snapshot.
			But image startup is resumed by returning (again) from the primitive, but this time answering true."
			isARealStartup := embeddedFlag
				ifTrue: [ self snapshotEmbeddedPrimitive ]
				ifFalse: [ self snapshotPrimitive ]]
		ifFalse: [ isARealStartup := false ].
	quit & (isARealStartup == false) ifTrue: [ self quitPrimitive ].

	"If starting from absolute scratch, this would be a good time to recreate Global names"
	self at: #Sensor put: nil.
	self at: #SourceFiles put: (Array new: 2).
	self logStartupDebugAid: 'To #openSourceFiles'.
	self openSourceFiles.
	"Here, startup begins!! (isARealStartup might be nil)"
	self logStartupDebugAid: 'To #initClassCachedState'.
	self allClassesDo: [ :cls | cls initClassCachedState ].
	self logStartupDebugAid: 'To #doStartUp:'.
	self doStartUp: isARealStartup == true.
	self logStartupDebugAid: 'To #spawnNewMorphicProcessFor: ', guiRootObject printString.
	UISupervisor spawnNewMorphicProcessFor: (guiRootObject ifNil: [ guiRootObject := guiRootObjectClass newWorld ]).
	isARealStartup == true
		ifTrue: [
			self logStartupDebugAid: 'To #restoreLostChangesIfNecessary'.
			self restoreLostChangesIfNecessary ].
	clearAllStateFlag ifTrue: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #recreateDefaultDesktop'.
			guiRootObject recreateDefaultDesktop; restoreDisplay ]]
	ifFalse: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #restoreDisplay'.
			guiRootObject restoreDisplay ]].
	isARealStartup == true
		ifTrue: [
			"If system is coming up (VM and image just started)"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs.
				self logStartupDebugAid: 'To #processCommandLineArguments'.
				self processCommandLineArguments.
				self logStartupDebugAid: 'To #launchApp'.
				AppLauncher launchApp ]]
		ifFalse: [
			"If we are just saving the image"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs ]].
	"Now it's time to raise an error"
	isARealStartup ifNil: [ self logStartupError: 'Failed to write image file (disk full?)' ]
]
	forkAt: Processor timingPriority - 1
	named: 'Startup process'.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6540-avoid-allInstancesPrim-inImageSnapshot-JuanVuletich-2024Jul28-15h49m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6539] on 28 July 2024 at 3:50:38 pm'!
!VectorCanvas methodsFor: 'private' stamp: 'jmv 7/28/2024 13:48:42' prior: 16998186 overrides: 16908374!
            releaseEngine
	super releaseEngine.
	boundsFinderCanvas notNil ifTrue: [
		boundsFinderCanvas releaseEngine ].
	auxBitBltEngine := nil.! !
!BitBltCanvas methodsFor: 'private' stamp: 'jmv 7/28/2024 13:48:49' prior: 16791687 overrides: 16908374!
            releaseEngine
	super releaseEngine.
	boundsFinderCanvas notNil ifTrue: [
		boundsFinderCanvas releaseEngine ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6541-Robust-releaseEngine-JuanVuletich-2024Jul28-15h50m-jmv.001.cs.st----!

----QUIT----(28 July 2024 15:53:15) Cuis7.1-6541.image priorSource: 822821!

----STARTUP---- (13 August 2024 18:36:54) as C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CuisImage\Cuis7.1-6541.image!


'From Cuis7.1 [latest update: #6538] on 27 July 2024 at 3:17:32 pm'!
!WorldMorph methodsFor: 'change reporting' stamp: 'KenD 7/27/2024 07:32:54' prior: 17007135 overrides: 16903695!
 addedMorph: aMorph
	"Notify the receiver that the given morph was just added."
	super addedMorph: aMorph.
	self firstHand newMouseFocus: nil. "Hand need to reset mouseFocus"
	self taskbar ifNotNil: [ :tb |
		tb wasOpened: aMorph ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6542-ReleaseMouseFocus-whenMorphAddedToWorld-KenDickey-2024Jul27-15h16m-KenD.001.cs.st----!

'From Cuis7.1 [latest update: #6542] on 28 July 2024 at 3:59:13 pm'!

WorldMorph removeSelector: #addedMorphx:!

!methodRemoval: WorldMorph #addedMorphx: stamp: 'Install-6543-cleanup-JuanVuletich-2024Jul28-15h58m-jmv.001.cs.st 8/13/2024 18:36:54'!
addedMorphx: aMorph
	"Notify the receiver that the given morph was just added."
	super addedMorph: aMorph.
	self firstHand newMouseFocus: nil. "Hand need to reset mouseFocus"
	self taskbar ifNotNil: [ :tb |
		tb wasOpened: aMorph ]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6543-cleanup-JuanVuletich-2024Jul28-15h58m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6543] on 28 July 2024 at 7:18:11 pm'!
!WorldMorph methodsFor: 'change reporting' stamp: 'jmv 12/30/2021 13:11:33' prior: 50357649 overrides: 16903695!
                   addedMorph: aMorph
	"Notify the receiver that the given morph was just added."
	super addedMorph: aMorph.
	self taskbar ifNotNil: [ :tb |
		tb wasOpened: aMorph ]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6544-TakeBack-6539-6542-JuanVuletich-2024Jul28-19h17m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6544] on 31 July 2024 at 12:23:13 pm'!
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 7/29/2024 16:09:34' prior: 50348165!
                            allMenuNshortcutsSpecs
	"menuSpec is the Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number. It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window or #model. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	"First, take menu and shortcut specs declared by us (i.e. the widget)"
	self menuNshortcutsSpecsDo: [ :menuItemSpec |
		menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ].
	"Then allow all owners to override or remove them.
	This is done outwards, each morph can override choices made by submorphs.
	This helps building reusable composites, that can be tweaked by user morphs / windows."
	self allOwnersDo: [ :o |
		o menuNshortcutsSpecsFor: self do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6545-CommentTweak-JuanVuletich-2024Jul31-12h22m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6554] on 30 July 2024 at 12:12:33 pm'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/30/2024 11:54:03' prior: 50344769!
                               classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(30		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(40 		'-----')
		#(50		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(60		'run tests (t)' 							$t 	model 			runClassTests 									weatherFewCloudsIcon)
		#(70 		'-----')
		#(80		'rename class... (R)' 							$R 	model 			renameClass 									saveAsIcon)
		#(90		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(100		'copy class...' 							nil 	model 			copyClass 									copyIcon)
		#(110		'remove class (x)' 							$x 	model 			removeClass 									deleteIcon)
		#(120 		'-----')
		#(130		'show classes hierarchically' 							nil 	model 			enableListClassesHierarchically 									goTopIcon)
		#(140		'show classes alphabetically' 							nil 	model 			enableListClassesAlphabetically 									sendReceiveIcon)
		#(150		'show definition' 							nil 	model 			editClass 									editFindReplaceIcon)
		#(160		'show comment' 							nil 	model 			editComment 									editFindReplaceIcon)
		#(170 		'-----')
		#(180		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(190		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(200 		'-----')
		#(210		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(220		'class vars' 							nil 	window 			browseClassVariables 									classIcon)
		#(230		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(240 		'-----')
		#(250		'more' 							nil 	nil 			2000 									listAddIcon)
		#(260		nil 							$r 	model 			recent) "Shortcut only. No menu entry."

		" 'refactorings' SubMenu"
		#(1010		'insert superclass...' 							nil 	model 			insertSuperclass 									saveAsIcon)
		#(1020 		'-----')
		#(1030		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)
		#(1040		'rename inst var...' 							nil 	model 			renameInstVar 									saveAsIcon)
		#(1050		'remove inst var...' 							nil 	model 			removeInstVar 									deleteIcon)
		#(1060		'remove all unreferenced inst var...' 						
											nil 	model 			removeAllUnreferencedInstVar 									deleteIcon)
		#(1070		'push up inst var...' 							nil 	model 			pushUpInstanceVariable 									goTopIcon)
		#(1080		'push down inst var...' 							nil 	model 			pushDownInstanceVariable 									goBottomIcon)
		#(1090 		'-----')
		#(1100		'rename global...' 							nil 	model 			renameGlobal 									saveAsIcon)

		" 'more' SubMenu"
		#(2010		'unsent methods' 							nil 	window 			browseUnusedMethods 									junkIcon
					'browse all methods defined by this class that have no senders')
		#(2020		'unreferenced inst vars' 							nil 	window 			showUnreferencedInstVars 									junkIcon
					'show a list of all instance variables that are not referenced in methods')
		#(2030		'unreferenced class vars' 							nil 	window 			showUnreferencedClassVars 									junkIcon
					'show a list of all class variables that are not referenced in methods')
		#(2040		'subclass template' 							nil 	model 			makeNewSubclass 									classIcon
					'put a template into the code pane for defining of a subclass of this class')
		#(2050 		'-----')
		#(2060		'sample instance' 							nil 	window 			makeSampleInstance 									instanceIcon
					'give me a sample instance of this class, if possible')
		#(2070		'inspect instances' 							nil 	window 			inspectInstances 									inspectIcon
					'open an inspector on all the extant instances of this class')
		#(2080		'inspect subinstances' 							nil 	window 			inspectSubInstances 									inspectIcon
					'open an inspector on all the extant instances of this class and of all of its subclasses')
		#(2090 		'-----')
		#(2100		'create inst var accessors' 							nil 	model 			createInstVarAccessors 									sendReceiveIcon
					'compile instance-variable access methods for any instance variables that do not yet have them')
	)! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6546-classListMenuSpec-BugFix-JuanVuletich-2024Jul30-10h49m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6550] on 30 July 2024 at 9:33:16 am'!
!InnerTextMorph methodsFor: 'accessing' stamp: 'jmv 7/30/2024 09:28:36'!
           textProviderOrModel

	^ (model is: #hasTextProvider) ifTrue: [ model textProvider ] ifFalse: [ model ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6547-textProviderOrModel-JuanVuletich-2024Jul30-09h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6544] on 31 July 2024 at 12:22:11 pm'!
!DebuggerWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/31/2024 12:18:55' prior: 50342478!
        contextStackMenuSpec
	"Spec for the menu and shortcut keys for call stack list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(10		'fullStack (f)' 						$f 	window 			fullStack 						nil 	'show the complete call stack')
		#(20		'proceed (p)' 						$p 	window 			proceed 						nil 	'close the debugger and proceed')
		#(30		'restart (r)' 						$r 	window 			restart 						nil 	'reset this context to its start')
		#(40		'step into send (e)' 						$e 	window 			send 						nil 	'step into message sends')
		#(50		'step over send (t)' 						$t 	window 			doStep 						nil 	'step over message sends')
		#(60		'step into block (T)' 						$T 	window 			stepIntoBlock 						nil 	'step into a code block')
		#(70		'run to cursor' 						nil 	window 			runToCursor 						nil 	'run to cursor')
		#(80		'where (w)' 						$w 	window 			where 						nil 	'select current pc range')
		#(90		'peel to first like this' 						nil 	window 			peelToFirst 						nil 	'peel stack back to the second occurance of selected message')
		#(100 		'-----')
		#(110		'return entered value' 						nil 	window 			returnValue 						nil 	'lets you enter an expression and return method answering result')
		#(120		'toggle break on entry' 						nil 	model 			toggleBreakOnEntry 						nil 	'install or uninstall a breakpoint on method entry')
		
		#(991		nil 						$m 	window 			browseImplementors)
		#(992		nil 						$n 	window 			browseSenders)
		#(993		nil 						$i 	window 			methodInheritance)
		#(994		nil 						$v 	window 			browseVersions)
		#(995		nil 						$N 	window 			browseClassRefs)
	)! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6548-DebuggerStack-shortcuts-JuanVuletich-2024Jul31-12h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6548] on 31 July 2024 at 12:35:21 pm'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/31/2024 12:27:53' prior: 50357785!
                   classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(30		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(40 		'-----')
		#(50		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(60		'run tests (t)' 							$t 	model 			runClassTests 									weatherFewCloudsIcon)
		#(70 		'-----')
		#(80		'rename class... (R)' 							$R 	model 			renameClass 									saveAsIcon)
		#(90		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(100		'copy class...' 							nil 	model 			copyClass 									copyIcon)
		#(110		'remove class (x)' 							$x 	model 			removeClass 									deleteIcon)
		#(120 		'-----')
		#(130		'show classes hierarchically' 							nil 	model 			enableListClassesHierarchically 									goTopIcon)
		#(140		'show classes alphabetically' 							nil 	model 			enableListClassesAlphabetically 									sendReceiveIcon)
		#(150		'show definition' 							nil 	model 			editClass 									editFindReplaceIcon)
		#(160		'show comment' 							nil 	model 			editComment 									editFindReplaceIcon)
		#(170 		'-----')
		#(180		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(190		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(200 		'-----')
		#(210		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(220		'class vars' 							nil 	window 			browseClassVariables 									classIcon)
		#(230		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(240 		'-----')
		#(250		'more' 							nil 	nil 			2000 									listAddIcon)

		"Shortcut only. No menu entry."
		#(991		nil 							$r 	model 			recent)

		" 'refactorings' SubMenu"
		#(1010		'insert superclass...' 							nil 	model 			insertSuperclass 									saveAsIcon)
		#(1020 		'-----')
		#(1030		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)
		#(1040		'rename inst var...' 							nil 	model 			renameInstVar 									saveAsIcon)
		#(1050		'remove inst var...' 							nil 	model 			removeInstVar 									deleteIcon)
		#(1060		'remove all unreferenced inst var...' 						
											nil 	model 			removeAllUnreferencedInstVar 									deleteIcon)
		#(1070		'push up inst var...' 							nil 	model 			pushUpInstanceVariable 									goTopIcon)
		#(1080		'push down inst var...' 							nil 	model 			pushDownInstanceVariable 									goBottomIcon)
		#(1090 		'-----')
		#(1100		'rename global...' 							nil 	model 			renameGlobal 									saveAsIcon)

		" 'more' SubMenu"
		#(2010		'unsent methods' 							nil 	window 			browseUnusedMethods 									junkIcon
					'browse all methods defined by this class that have no senders')
		#(2020		'unreferenced inst vars' 							nil 	window 			showUnreferencedInstVars 									junkIcon
					'show a list of all instance variables that are not referenced in methods')
		#(2030		'unreferenced class vars' 							nil 	window 			showUnreferencedClassVars 									junkIcon
					'show a list of all class variables that are not referenced in methods')
		#(2040		'subclass template' 							nil 	model 			makeNewSubclass 									classIcon
					'put a template into the code pane for defining of a subclass of this class')
		#(2050 		'-----')
		#(2060		'sample instance' 							nil 	window 			makeSampleInstance 									instanceIcon
					'give me a sample instance of this class, if possible')
		#(2070		'inspect instances' 							nil 	window 			inspectInstances 									inspectIcon
					'open an inspector on all the extant instances of this class')
		#(2080		'inspect subinstances' 							nil 	window 			inspectSubInstances 									inspectIcon
					'open an inspector on all the extant instances of this class and of all of its subclasses')
		#(2090 		'-----')
		#(2100		'create inst var accessors' 							nil 	model 			createInstVarAccessors 									sendReceiveIcon
					'compile instance-variable access methods for any instance variables that do not yet have them')
	)! !
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/31/2024 12:28:47' prior: 50347468!
                           messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message List' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutMessage 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(150		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(280		'remove method in hierarchy' 							nil 	model 			removeMessageInHierarchy 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		"Shortcut only. No menu entry."
		#(991		nil 							$m 	window 			browseImplementors)
		#(992		nil 							$n 	window 			browseSenders)
		#(993		nil 							$c 	model 			copySelector)

		" 'refactorings' SubMenu"
		#(1010		'rename... (R)' 											$R 	model 			renameSelector 											saveAsIcon)
		#(1020		'change keyword order...' 											nil 	model 			changeKeywordOrder 											sendReceiveIcon)
		#(1030		'add parameter... (A)' 											$A 	model 			addParameter 											listAddIcon)
		#(1040		'remove parameter... (S)' 											$S 	model 			removeParameter 											listRemoveIcon)
		#(1050 		'-----')
		#(1060		'inline method... (F)' 											$F 	model 			inlineMethod 											saveAsIcon)
		#(1070		'move to instance/class method' 											nil 	model 			moveToInstanceOrClassMethod 											changesIcon)
		#(1080		'push up' 											nil 	model 			pushUpSelector 											goTopIcon)
		#(1090		'add in superclass as subclassResponsability' 											nil 	model 			addAsSubclassResponsabilitySelector 											goTopIcon)
		#(1100		'push down to subclasses' 											nil 	model 			pushDownSelectorToSubclasses 											goBottomIcon)
		#(1110		'push down to one subclass' 											nil 	model 			pushDownSelectorToOneSubclass 											goBottomIcon)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2110		'select method category (C)' 								$C 	model 			showHomeCategory 									editFindReplaceIcon)
		#(2120		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2130		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
	)! !
!ChangeSorterWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/31/2024 12:29:46' prior: 50346362!
                               messageListMenuSpec
	"Spec for the menu and shortcut keys for the message list.
	See coment at Morph >> #getMenu
	"
	^#(
			#(0 		'Message List' 						true)
			#(10 		'delete method from change set (d)' 									$d 	model 			forget 								warningIcon)
			#(20 		'remove method from system (x)' 									$x 	model 			removeMessage 								deleteIcon)
			#(30 		'-----')
			#(40 		'browse full (b)' 									$b 	window 			browseMethodFull 								editFindReplaceIcon)
			#(50 		'browse hierarchy (h)' 									$h 	window 			browseHierarchy 								goTopIcon)
			#(60 		'browse method (O)' 									$O 	window 			openSingleMessageBrowser 								scriptIcon)
			#(70 		'browse protocol (p)' 									$p 	window 			browseFullProtocol 								spreadsheetIcon)
			#(80 		'-----')		
			#(90 		'fileOut (o)' 									$o 	model 			fileOutMessage 								fileOutIcon)
			#(100 		'-----')		
			#(110		'senders of... (n)' 									nil 	window 			browseSendersOfMessages 								mailForwardIcon)
			#(120		'implementors of... (m)' 									nil 	window 			browseMessages 								developmentIcon)
			#(130 		'inheritance (i)' 									$i 	window 			methodInheritance 								goDownIcon)
			#(140 		'versions (v)' 									$v 	window 			browseVersions 								clockIcon)

			"Shortcut only. No menu entry."
			#(991		nil 									$m 	window 			browseImplementors)
			#(992		nil 									$n 	window 			browseSenders)
	).
! !
!MethodSetWindow methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/31/2024 12:31:48' prior: 50346724!
                           messageListMenuSpec
	"Spec for the menu and shortcut keys for the messages list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Message Set' 					false)
		#(10		'what to show...' 							nil 	window 			offerWhatToShowMenu 									preferencesIcon)
		#(20		'toggle break on entry' 							nil 	model 			toggleBreakOnEntry 									debugIcon)
		#(30 		'-----')
		#(40		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(50		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(60		'browse method (O)' 							$O 	window 			openSingleMessageBrowser 									scriptIcon)
		#(70		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(90 		'-----')
		#(100		'fileOut' 							nil 	model 			fileOutMessage 									fileOutIcon)
		#(110		'run test (t)' 							$t 	model 			runMethodTest 									weatherFewCloudsIcon)
		#(120		'debug test (r)' 							$r 	model 			debugMethodTest 									weatherFewCloudsIcon)
		#(130		'inspect CompiledMethod' 							nil 	model 			inspectCompiledMethod 									exploreIcon)
		#(140 		'-----')
		#(160		'senders of... (n)' 							nil 	window 			browseSendersOfMessages 									mailForwardIcon)
		#(170		'implementors of... (m)' 							nil 	window 			browseMessages 									developmentIcon)
		#(180		'inheritance (i)' 							$i 	window 			methodInheritance 									goDownIcon)
		#(190		'versions (v)' 							$v 	window 			browseVersions 									clockIcon)
		#(200 		'-----')
		#(210		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(220		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(230		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(240		'class variabless' 							nil 	window 			browseClassVariables 									classIcon)
		#(250		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(260 		'-----')
		#(270		'remove method (x)' 							$x 	model 			removeMessage 									deleteIcon)
		#(290		'more' 							nil 	nil 			2000 									listAddIcon)

		"Shortcut only. No menu entry."
		#(991		nil 							$m 	window 			browseImplementors)
		#(992		nil 							$n 	window 			browseSenders)
		#(993		nil 							$c 	model 			copySelector)

		" 'more' SubMenu"
		#(2010		'toggle diffing (D)' 								$D 	model 			toggleDiffing 									switchIcon)
		#(2020		'implementors of sent messages' 								nil 	window 			browseAllMessages 									developmentIcon)
		#(2030 		'-----')
		#(2040		'local senders of...' 								nil 	window 			browseLocalSendersOfMessages 									mailForwardIcon)
		#(2050		'local implementors of...' 								nil 	window 			browseLocalImplementors 									classIcon)
		#(2060 		'-----')
		#(2070		'sample instance' 								nil 	window 			makeSampleInstance 									instanceIcon)
		#(2080		'inspect instances' 								nil 	window 			inspectInstances 									inspectIcon)
		#(2090		'inspect subinstances' 								nil 	window 			inspectSubInstances 									inspectIcon)
		#(2100 		'remove from this browser' 								nil 	model 			removeMessageFromBrowser 									listRemoveIcon)
		#(2110 		'filter message list...' 								nil 	window 			filterMessageList 									findIcon)
		#(2120		'change category...' 								nil 	model 			changeCategory 									saveAsIcon)
		#(2130		'change sets with this method' 								nil 	window 			findMethodInChangeSets 									changesIcon)
		#(2140		'revert to previous version' 								nil 	model 			revertToPreviousVersion 									undoIcon)
		#(2150 		'-----')
		#(2160 		'sort by class hierarchy' 								nil 	model 			sortByClassHierarchy 									classIcon)
		#(2170 		'sort by class name' 								nil 	model 			sortByClassName 									classIcon)
		#(2180 		'sort by selector' 								nil 	model 			sortBySelector 									scriptIcon)
		#(2190 		'sort by date' 								nil 	model 			sortByDate 									dateIcon)
		#(2200 		'reverse sort' 								nil 	model 			sortReverse 									redoIcon)
	).
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6549-menuItemNumberTweaks-JuanVuletich-2024Jul31-12h26m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6549] on 31 July 2024 at 3:12:16 pm'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 7/31/2024 15:09:31' prior: 50357447!
                   snapshot: save andQuit: quit embedded: embeddedFlag clearAllClassState: clearAllStateFlag
	"This is the main method for image save and / or quit.
	See senders."
	"WARNING: Current process will be killed. UI Process will be restarted"
	"Mark the changes file and close all files as part of #processShutdownList.
	If save is true, save the current state of this Smalltalk in the image file.
	If quit is true, then exit to the outer OS shell.
	The latter part of this method runs when resuming a previously saved image. This resume logic
	checks for a document file to process when starting up."
	"
	To test the full cleanup and startup procedures, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: true

	To test the cleanup done when saving the image, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: false
	"
	| activeProc |
	activeProc := Processor activeProcess.
[
	| isARealStartup guiRootObject guiRootObjectClass userBaseDirectory |
	save not & quit
		ifTrue: [ (SourceFiles at: 2) ifNotNil: [ :changes |
				ChangesInitialFileSize ifNotNil: [ changes truncate: ChangesInitialFileSize ]]]
		ifFalse: [ self logSnapshot: save andQuit: quit ].
	clearAllStateFlag ifTrue: [
		TranscriptWindow allInstancesDoAlt: [ :each |
			each isInWorld ifTrue: [ each delete.]].
		UISupervisor ui tearDownDesktop.
		Transcript logToFile: false ].
	ActiveModel flushEventSystem.
	self processShutDownList: quit.
	"These could be moved to some #shutDown"
	self stopLowSpaceWatcher.
	WeakArray stopFinalizationProcess.
	ProcessorScheduler stopBackgroundProcess.
	"Stuff needed to relaunch UI on startup"
	guiRootObjectClass := UISupervisor ui class.
	"Replace with this to create a new world at startup after 'saveAsNewVersion'"
	guiRootObject := clearAllStateFlag ifFalse: [ UISupervisor ui ].

	UISupervisor stopUIProcess.
	activeProc isTerminated ifFalse: [ activeProc terminate ].
	guiRootObject ifNotNil: [ guiRootObject releaseCachedState ].
	clearAllStateFlag ifTrue: [
		Processor processesDo: [ :p |
			(p name = 'Formerly: Morphic UI') ifTrue: [ p terminate ]]].
	MorphicCanvas allSubInstancesDoAlt: [ :c |
		(c ownerProcess notNil and: [c ownerProcess isTerminated]) ifTrue: [
			c releaseEngine			]].

	"Clean Globals"
	userBaseDirectory := DirectoryEntry userBaseDirectory.
	self at: #Sensor put: nil.
	self closeSourceFiles.
	self at: #SourceFiles put: nil.
	self allClassesDo: [ :cls |
		cls releaseClassCachedState ].
	clearAllStateFlag ifTrue: [
		self allClassesDo: [ :cls |
			cls releaseClassState ]].
	"To keep cleaning stuff that shouldn't be saved..."
	clearAllStateFlag ifTrue: [
		Transcript clear.
		"Enable this call to actually see the image clean report."
		false ifTrue: [self printStuffToCleanOnImageSave]].
	"Do image save & quit as apropriate"
	(Cursor cursorAt: #writeCursor) activateCursor.
	isARealStartup := false.
	save ifTrue: [
		"The snapshot primitive answers false if it was just called to do the snapshot.
		But image startup is resumed by returning (again) from the primitive, but this time answering true.
		nil means saving image failed"
		isARealStartup := embeddedFlag
			ifTrue: [ self snapshotEmbeddedPrimitive ]
			ifFalse: [ self snapshotPrimitive ]].
	quit & (isARealStartup == false) ifTrue: [ self quitPrimitive ]. "Don't quit on nil (image save failed)"

	isARealStartup == true ifFalse: [ 									"Keep current #userBaseDirectory unless a real startup"
		DirectoryEntry setUserBaseDirectory: userBaseDirectory ].

	"If starting from absolute scratch, this would be a good time to recreate Global names"
	self at: #Sensor put: nil.
	self at: #SourceFiles put: (Array new: 2).
	self logStartupDebugAid: 'To #openSourceFiles'.
	self openSourceFiles.
	"Here, startup begins!! (isARealStartup might be nil)"
	self logStartupDebugAid: 'To #initClassCachedState'.
	self allClassesDo: [ :cls | cls initClassCachedState ].
	self logStartupDebugAid: 'To #doStartUp:'.
	self doStartUp: isARealStartup == true.
	self logStartupDebugAid: 'To #spawnNewMorphicProcessFor: ', guiRootObject printString.
	UISupervisor spawnNewMorphicProcessFor: (guiRootObject ifNil: [ guiRootObject := guiRootObjectClass newWorld ]).
	isARealStartup == true
		ifTrue: [
			self logStartupDebugAid: 'To #restoreLostChangesIfNecessary'.
			self restoreLostChangesIfNecessary ].
	clearAllStateFlag ifTrue: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #recreateDefaultDesktop'.
			guiRootObject recreateDefaultDesktop; restoreDisplay ]]
	ifFalse: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #restoreDisplay'.
			guiRootObject restoreDisplay ]].
	isARealStartup == true
		ifTrue: [
			"If system is coming up (VM and image just started)"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs.
				self logStartupDebugAid: 'To #processCommandLineArguments'.
				self processCommandLineArguments.
				self logStartupDebugAid: 'To #launchApp'.
				AppLauncher launchApp ]]
		ifFalse: [
			"If we are just saving the image"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs ]].
	"Now it's time to raise an error"
	isARealStartup ifNil: [ self logStartupError: 'Failed to write image file (disk full?)' ]
]
	forkAt: Processor timingPriority - 1
	named: 'Startup process'.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6550-DontForget-userBaseDirectory-onImageSave-JuanVuletich-2024Jul31-14h59m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6557] on 31 July 2024 at 3:42:39 pm'!
!PluggableListMorph methodsFor: 'scrolling' stamp: 'jmv 7/31/2024 15:40:07' prior: 16924018 overrides: 16925175!
   scrollSelectionIntoView
	"make sure that the current selection is visible"
	| row r |
	row := self getCurrentSelectionIndex.
	row = 0 
		ifTrue: [
			"Value is 0, but we need to propagate it to model"
			scrollBar internalScrollValue: scrollBar scrollValue ]
		ifFalse: [
			r := scroller externalizeBoundingRectOf: (scroller drawBoundsForRow: row).
			r := r left: 0.
			self scrollToShow: r ].
	self updateSiblingsScroller! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6551-horizontalScrollBar-fix-JuanVuletich-2024Jul31-15h41m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6551] on 31 July 2024 at 4:36:27 pm'!

PluggableScrollPane subclass: #HierarchicalListMorph
	instanceVariableNames: 'selectedMorph getListSelector keystrokeActionSelector autoDeselect autoExpand sortingSelector getSelectionSelector setSelectionSelector menuGetter mainView highlightedMorph doubleClickSelector '
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

!classDefinition: #HierarchicalListMorph category: #'Morphic-Widgets' stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
PluggableScrollPane subclass: #HierarchicalListMorph
	instanceVariableNames: 'selectedMorph getListSelector keystrokeActionSelector autoDeselect autoExpand sortingSelector getSelectionSelector setSelectionSelector menuGetter mainView highlightedMorph doubleClickSelector'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

PluggableScrollPane subclass: #PluggableListMorph
	instanceVariableNames: 'list getListSelector getIndexSelector setIndexSelector keystrokeActionSelector autoDeselect lastKeystrokeTime lastKeystrokes doubleClickSelector menuGetter mainView limitLayoutHeight '
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

!classDefinition: #PluggableListMorph category: #'Morphic-Widgets' stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
PluggableScrollPane subclass: #PluggableListMorph
	instanceVariableNames: 'list getListSelector getIndexSelector setIndexSelector keystrokeActionSelector autoDeselect lastKeystrokeTime lastKeystrokes doubleClickSelector menuGetter mainView limitLayoutHeight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!
!HierarchicalListMorph methodsFor: 'events' stamp: 'jmv 7/31/2024 16:13:53' prior: 50335227 overrides: 50335218!
                              keyStroke: aKeyboardEvent 
	"Process potential command keys"

	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].

	(self arrowKey: aKeyboardEvent) ifNotNil: [
		^ aKeyboardEvent wasHandled: true ].

	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].! !
!PluggableListMorph methodsFor: 'events' stamp: 'jmv 7/31/2024 16:12:06' prior: 50335255 overrides: 50335218!
                              keyStroke: aKeyboardEvent 
	"Process keys"

	| aCharacter |
	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ ^self ].
	
	(self arrowKey: aKeyboardEvent) ifNotNil: [
		^ aKeyboardEvent wasHandled: true ].

	"All the cases below consume the event."
	aKeyboardEvent wasHandled: true.

	aKeyboardEvent isEsc ifTrue: [ " escape key" ^ self mouseButton2Activity ].
	aKeyboardEvent isDelete ifTrue: [ "delete key" ^ self deleteAction ].
	aKeyboardEvent isBackspace ifTrue: [ "backspace key" ^ self deleteAction ].
	
	aCharacter := aKeyboardEvent keyCharacter.
	^ self keyboardSearch: aCharacter! !

PluggableListMorph removeSelector: #mainView:menuGetter:keystrokeAction:!

!methodRemoval: PluggableListMorph #mainView:menuGetter:keystrokeAction: stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel

	mainView := aMainView.
	menuGetter := getMenuSel.
	keystrokeActionSelector := keyActionSel.!

PluggableListMorph removeSelector: #doKeystrokeAction:!

!methodRemoval: PluggableListMorph #doKeystrokeAction: stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
doKeystrokeAction: aChar
	| args |
	keystrokeActionSelector ifNil: [^false].
	args := keystrokeActionSelector numArgs.
	args = 1 ifTrue: [
		mainView perform: keystrokeActionSelector with: aChar.
		^true ].
	args = 2
		ifTrue: [
			mainView
				perform: keystrokeActionSelector
				with: aChar
				with: self.
			^true ].
	^self error: 'keystrokeActionSelector must be a 1- or 2-keyword symbol'.
!

PluggableListMorph removeSelector: #getMenu!

!methodRemoval: PluggableListMorph #getMenu stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
getMenu
	"Answer the menu for this view"

	"Use the new mechanism if provided. See #menuNshortcutsKey"
	super getMenu ifNotNil: [ :menu | 
		^menu ].

	"Fallback to the old way. See #mainView:menuGetter:keystrokeAction:	"
	menuGetter ifNil: [^ nil].
	(menuGetter is: #MessageSend) ifTrue: [
		^menuGetter value ].
	menuGetter numArgs = 0 ifTrue: [
		^ mainView perform: menuGetter ].
	^ self error: 'The menuGetter has an unsupported number of arguments'!

HierarchicalListMorph removeSelector: #mainView:menuGetter:keystrokeAction:!

!methodRemoval: HierarchicalListMorph #mainView:menuGetter:keystrokeAction: stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
mainView: aMainView menuGetter: getMenuSel keystrokeAction: keyActionSel

	mainView := aMainView.
	menuGetter := getMenuSel.
	keystrokeActionSelector := keyActionSel.!

HierarchicalListMorph removeSelector: #getMenu!

!methodRemoval: HierarchicalListMorph #getMenu stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
getMenu
	"Answer the menu for this view"

	"Use the new mechanism if provided. See #menuNshortcutsKey"
	super getMenu ifNotNil: [ :menu | 
		^menu ].

	"Fallback to the old way. See #mainView:menuGetter:keystrokeAction:	"
	menuGetter ifNil: [^ nil].
	(menuGetter is: #MessageSend) ifTrue: [
		^menuGetter value ].
	menuGetter numArgs = 0 ifTrue: [
		^ mainView perform: menuGetter ].
	^ self error: 'The menuGetter has an unsupported number of arguments'!

PluggableScrollPane subclass: #HierarchicalListMorph
	instanceVariableNames: 'selectedMorph getListSelector autoDeselect autoExpand sortingSelector getSelectionSelector setSelectionSelector highlightedMorph doubleClickSelector'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

!classDefinition: #HierarchicalListMorph category: #'Morphic-Widgets' stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
PluggableScrollPane subclass: #HierarchicalListMorph
	instanceVariableNames: 'selectedMorph getListSelector autoDeselect autoExpand sortingSelector getSelectionSelector setSelectionSelector highlightedMorph doubleClickSelector'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

PluggableScrollPane subclass: #PluggableListMorph
	instanceVariableNames: 'list getListSelector getIndexSelector setIndexSelector autoDeselect lastKeystrokeTime lastKeystrokes doubleClickSelector limitLayoutHeight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

!classDefinition: #PluggableListMorph category: #'Morphic-Widgets' stamp: 'Install-6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st 8/13/2024 18:36:54'!
PluggableScrollPane subclass: #PluggableListMorph
	instanceVariableNames: 'list getListSelector getIndexSelector setIndexSelector autoDeselect lastKeystrokeTime lastKeystrokes doubleClickSelector limitLayoutHeight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Widgets'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6552-ListsMorphs-cleanup-JuanVuletich-2024Jul31-16h32m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6459] on 10 June 2024 at 3:23:07 pm'!
!TextEditor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/10/2024 15:18:35'!
                               defaultMenuSpec
	"Spec for the menu and shortcut keys for the regular text editors.
	See coment at Morph >> #getMenu
	"
	| acceptEntry |
	acceptEntry := self hasUnacceptedEdits
		ifTrue: [ #((110				'Accept (s)' 					$s 	editor 			acceptContents 						acceptIcon)) ]
		ifFalse: [ #((110 				'Accept (s)' 					nil 	editor 			nil 						acceptIcon)) ].
	^#(
		#(0 		'Text Editor' 					true)
		#(10		'Help... (h)' 							$h 	editor 			openHelp 						helpIcon)
		#(20 		'-----')
		#(30		'Find...(f)' 							$f 	editor 			find 						findIcon)
		#(40		'Find Again (g)' 							$g 	editor 			findAgain 						systemIcon)
		#(50		'Use Selection for Find (j)' 							$j 	editor 			setSearchString 						saveAsIcon)
		#(60 		'-----')
		#(70		'Undo - multiple (z)' 							$z 	editor 			undo 						undoIcon)
		#(80		'Redo - multiple (Z)' 							$Z 	editor 			redo 						redoIcon)
		#(90		'Undo / Redo history' 							nil 	editor 			offerUndoHistory 						changesIcon)
		#(100 		'-----')
	),
	acceptEntry,
	#(
		#(120		'Copy (c)' 							$c 	editor 			copySelection 						copyIcon)
		#(130		'Cut (x)' 							$x 	editor 			cut 						cutIcon)
		#(140		'Paste (v)' 							$v 	editor 			paste 						pasteIcon)
		#(150		'Paste without Format' 							nil 	editor 			pasteString 						pasteIcon)
		#(160		'Paste...' 							nil 	editor 			pasteRecent 						worldIcon)
		#(180 		'-----')
		#(190		'Toggle WordWrap' 							nil 	editor 			wrapOnOff 						genericTextIcon)
		#(200		'Clear Font' 							nil 	editor 			clearFont 						newIcon)
		#(210		'Set Font... (k)' 							$k 	editor 			offerFontMenu 						preferencesDesktopFontIcon)
		#(220		'Set Font Size' 							nil 	editor 			offerFontSizeMenu 						preferencesDesktopFontIcon)
		#(230		'Set Style' 							nil 	editor 			offerFontStyleMenu 						preferencesDesktopFontIcon)
		#(240		'Set Text Color' 							nil 	editor 			offerColorMenu 						graphicsIcon)
		#(250		'Set Alignment...' 							nil 	editor 			chooseAlignment 						formatJustifyLeftIcon)
	).
	
	"como es que h trae el help? ver shortcuts..."! !
!SmalltalkEditor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/10/2024 15:19:03' overrides: 50358919!
defaultMenuSpec
	"Spec for the menu and shortcut keys for the regular text editors.
	See coment at Morph >> #getMenu
	"
	| acceptEntry |
	acceptEntry := self hasUnacceptedEdits
		ifTrue: [ #((240				'Accept (s)' 					$s 	editor 			acceptContents 						acceptIcon)) ]
		ifFalse: [ #((240 				'Accept (s)' 					nil 	editor 			nil 						acceptIcon)) ].
	^#(
		#(0 		'Smalltalk Editor' 					true)
		#(10		'Help... (h)' 							$h 	editor 			openHelp 						helpIcon)
		#(20 		'-----')
		#(30		'Do it (d)' 							$d 	editor 			doIt 						doItIcon)
		#(40		'Print it (p)' 							$p 	editor 			printIt 						printIcon)
		#(50		'Inspect it (i)' 							$i 	editor 			inspectIt 						inspectIcon)
		#(60		'Explore it (I)' 							$I 	editor 			exploreIt 						exploreIcon)
		#(70		'Debug it (D)' 							$D 	editor 			debugIt 						debugIcon)
		#(80		'Profile it' 							nil 	editor 			profileIt 						clockIcon)
		#(90 		'-----')
		#(100		'Edit' 							nil 	nil 			1000 						textEditorIcon)
		#(110 		'-----')
		#(120		'Explain' 							nil 	editor 			explain 						helpIcon)
		#(130		'Browse it (b)' 							$b 	editor 			browseIt 						editFindReplaceIcon)
		#(140		'Senders of it (n)' 							$n 	editor 			sendersOfIt 						mailForwardIcon)
		#(150		'Implementors of it (m)' 							$m 	editor 			implementorsOfIt 						developmentIcon)
		#(160		'References to it (N)' 							$N 	editor 			referencesToIt 						addressBookIcon)
		#(170 		'-----')
		#(180		'Refactorings' 							nil 	nil 			2000 						listAddIcon)
		#(190 		'-----')
		#(200		'Method Strings with it (E)' 							$E	editor 			methodStringsContainingIt 								genericTextIcon)
		#(210		'Method Source with it (e)' 							$e 	editor 			methodSourceContainingIt 								scriptIcon)
		#(220		'Class Comments with it' 							nil 	editor 			classCommentsContainingIt 								chatIcon)
		#(230 		'-----')
	),
	acceptEntry,
	#(
		#(250		'Accept & Run Test in Class (t)' 									$t 	editor 			acceptAndTest 						weatherFewCloudsIcon)
		#(260		'Accept & Run Test in Category (y)' 									$y 	editor 			acceptAndTestAll 						weatherFewCloudsIcon)
		#(270		'Accept & Debug Test (r)' 									$r 	editor 			acceptAndDebugTest 						weatherFewCloudsIcon)


		" 'Edit' SubMenu"
		#(1010 		'-----')
		#(1020		'Find...(f)' 							$f 	editor 			find 						findIcon)
		#(1030		'Find Again (g)' 							$g 	editor 			findAgain 						systemIcon)
		#(1040		'Use Selection for Find (j)' 							$j 	editor 			setSearchString 						saveAsIcon)
		#(1050 		'-----')
		#(1060		'Undo - multiple (z)' 							$z 	editor 			undo 						undoIcon)
		#(1070		'Redo - multiple (Z)' 							$Z 	editor 			redo 						redoIcon)
		#(1080		'Undo / Redo history' 							nil 	editor 			offerUndoHistory 						changesIcon)
		#(1090 		'-----')
		#(1100		'Copy (c)' 							$c 	editor 			copySelection 						copyIcon)
		#(1110		'Cut (x)' 							$x 	editor 			cut 						cutIcon)
		#(1120		'Paste (v)' 							$v 	editor 			paste 						pasteIcon)
		#(1130		'Paste without Format' 							nil 	editor 			pasteString 						pasteIcon)
		#(1140		'Paste...' 							nil 	editor 			pasteRecent 						worldIcon)
		#(1150 		'-----')
		#(1160		'Toggle WordWrap' 							nil 	editor 			wrapOnOff 						genericTextIcon)
		#(1170		'Clear Font' 							nil 	editor 			clearFont 						newIcon)
		#(1180		'Set Font... (k)' 							$k 	editor 			offerFontMenu 						preferencesDesktopFontIcon)
		#(1190		'Set Font Size' 							nil 	editor 			offerFontSizeMenu 						preferencesDesktopFontIcon)

		" 'Refactorings' SubMenu"
		#(2010 		'-----')
		#(2020		'Rename... (R)' 									$R 	editor 			contextualRename 										saveAsIcon)
		#(2030		'Extract as Parameter... (V)' 									$V 	editor 			contextualExtractAsParameter 										listAddIcon)
		#(2040		'Add Parameter... (A)' 									$A 	editor 			contextualAddParameter 										listAddIcon)
		#(2050		'Remove Parameter... (S)' 									$S 	editor 			contextualRemoveParameter 										listRemoveIcon)
		#(2060 		'-----')
		#(2070		'Extract Temporary... (J)' 									$J 	editor 			extractToTemporary 										saveAsIcon)
		#(2080		'Extract Method... (K)' 									$K 	editor 			extractMethod 										saveAsIcon)
		#(2090 		'-----')
		#(2100		'Inline Temporary... (O)' 									$O 	editor 			inlineTemporaryVariable 										saveAsIcon)
		#(2110		'Inline Method... (F)' 									$F 	editor 			contextualInlineMethod 										saveAsIcon)
		#(2120 		'-----')
		#(2130		'Temporary to Instance Variable (G)' 									$G 	editor 			temporaryToInstanceVariable 										saveAsIcon)
		#(2140		'Push Up Instance Variable' 									nil 	editor 			contextualPushUpInClassDefinition 										goTopIcon)
		#(2150		'Push Down Instance Variable' 									nil 	editor 			contextualPushDownInClassDefinition 										goBottomIcon)
	).
! !
!InnerTextMorph methodsFor: 'menu' stamp: 'jmv 6/10/2024 10:07:58' overrides: 50348229!
    menuNshortcutsSpecsDo: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for themselves.
	See implementors."

	self editor defaultMenuSpec do: aBlock! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 6/10/2024 15:18:27' prior: 50348290!
   getMenu
	"Answer the right-click (contextual) menu."
	"Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'help text (optional)')
		- itemId is a number (integer or float). It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window, #model or #editor. If nil, receiver is the widget itself.
		- selector is #aSymbol. No arguments.
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"

	| menuNshortcutsSpecs itemSpec menu submenus |
	menuNshortcutsSpecs := self allMenuNshortcutsSpecs.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].
	menu := MenuMorph new.
	submenus := nil.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2 ifTrue: [
				self addLineTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [ itemSpec size = 3 ifTrue: [
				self addTitleTo: menu fromSpec: itemSpec ]
			ifFalse: [ itemSpec fifth isNumber ifTrue: [
				submenus ifNil: [submenus := Dictionary new ].
				self addSubmenuTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [
				self addItemTo: menu fromSpec: itemSpec submenus: submenus ]]]].
	^ menu! !
!TextModelMorph methodsFor: 'event handling' stamp: 'jmv 6/10/2024 10:27:01' prior: 16983100 overrides: 50333460!
                            mouseButton2Activity
	"Button 2 presses inside us, but not inside our InnerTextMorph (i.e. scroller) are caught here.
	Forward them to the InnerTextMorph, so they behave the same as if the button press actually occured there."

	scroller mouseButton2Activity! !

TextModelMorph removeSelector: #menuNshortcutsSpecsDo:!

InnerTextMorph removeSelector: #getMenu!

!methodRemoval: InnerTextMorph #getMenu stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
getMenu

	^self editor getMenu!

SmalltalkEditor class removeSelector: #smalltalkEditorMenuOptions!

!methodRemoval: SmalltalkEditor class #smalltalkEditorMenuOptions stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
smalltalkEditorMenuOptions
	
	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'Help...'.
				#selector 			-> 		#openHelp.
				#icon 			-> 		#helpIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'Do it (d)'.
				#selector 			-> 		#doIt.
				#icon 			-> 		#doItIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'Print it (p)'.
				#selector 			-> 		#printIt.
				#icon 			-> 		#printIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'Inspect it (i)'.
				#selector 			-> 		#inspectIt.
				#icon 			-> 		#inspectIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		40.
				#label 			-> 		'Explore it (I)'.
				#selector 			-> 		#exploreIt.
				#icon 			-> 		#exploreIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		50.
				#label 			-> 		'Debug it (D)'.
				#selector 			-> 		#debugIt.
				#icon 			-> 		#debugIcon
			} asDictionary.
			{
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		60.
				#label 			-> 		'Profile it'.
				#selector 			-> 		#profileIt.
				#icon 			-> 		#clockIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		5.
				#label 			-> 		SmalltalkEditor editMenuLabel.
				#selector 			-> 		#yourself.
				#icon 			-> 		#textEditorIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'Explain'.
				#selector 			-> 		#explain.
				#icon 			-> 		#helpIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'Browse it (b)'.
				#selector 			-> 		#browseIt.
				#icon 			-> 		#editFindReplaceIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		30.
				#label 			-> 		'Senders of it (n)'.
				#selector 			-> 		#sendersOfIt.
				#icon 			-> 		#mailForwardIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		40.
				#label 			-> 		'Implementors of it (m)'.
				#selector 			-> 		#implementorsOfIt.
				#icon 			-> 		#developmentIcon
			} asDictionary.
			{
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		50.
				#label 			-> 		'References to it (N)'.
				#selector 			-> 		#referencesToIt.
				#icon 			-> 		#addressBookIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'Method Strings with it (E)'.
				#selector 			-> 		#methodStringsContainingIt.
				#icon 			-> 		#genericTextIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'Method Source with it (e)'.
				#selector 			-> 		#methodSourceContainingIt.
				#icon 			-> 		#scriptIcon
			} asDictionary.
			{
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'Class Comments with it'.
				#selector 			-> 		#classCommentsContainingIt.
				#icon 			-> 		#chatIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		10.
				#label 			-> 		'Accept (s)'.
				#selector 			-> 		#acceptContents.
				#icon 			-> 		#acceptIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		30.
				#label 			-> 		'Accept & Run Test in Class (t)'.
				#selector 			-> 		#acceptAndTest.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		40.
				#label 			-> 		'Accept & Run Test in Category (y)'.
				#selector 			-> 		#acceptAndTestAll.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
			{
				#itemGroup 			-> 		50.
				#itemOrder 			-> 		50.
				#label 			-> 		'Accept & Debug Test (r)'.
				#selector 			-> 		#acceptAndDebugTest.
				#icon 			-> 		#weatherFewCloudsIcon
			} asDictionary.
		}, SmalltalkEditor smalltalkEditorEditingMenuOptions `. !

SmalltalkEditor class removeSelector: #smalltalkEditorEditingMenuOptions!

!methodRemoval: SmalltalkEditor class #smalltalkEditorEditingMenuOptions stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
smalltalkEditorEditingMenuOptions

	self flag: #assumesKeyboardShortcuts.
	^`{
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		10.
				#label 			-> 		'Find...(f)'.
				#selector 			-> 		#find.
				#icon 			-> 		#findIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		20.
				#label 			-> 		'Find Again (g)'.
				#selector 			-> 		#findAgain.
				#icon 			-> 		#systemIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		10.
				#itemOrder 			-> 		30.
				#label 			-> 		'Use Selection for Find (j)'.
				#selector 			-> 		#setSearchString.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		10.
				#label 			-> 		'Undo - multiple (z)'.
				#selector 			-> 		#undo.
				#icon 			-> 		#undoIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		20.
				#label 			-> 		'Redo - multiple (Z)'.
				#selector 			-> 		#redo.
				#icon 			-> 		#redoIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		20.
				#itemOrder 			-> 		30.
				#label 			-> 		'Undo / Redo history'.
				#selector 			-> 		#offerUndoHistory.
				#icon 			-> 		#changesIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		10.
				#label 			-> 		'Copy (c)'.
				#selector 			-> 		#copySelection.
				#icon 			-> 		#copyIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		20.
				#label 			-> 		'Cut (x)'.
				#selector 			-> 		#cut.
				#icon 			-> 		#cutIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		30.
				#label 			-> 		'Paste (v)'.
				#selector 			-> 		#paste.
				#icon 			-> 		#pasteIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		40.
				#label 			-> 		'Paste without Format'.
				#selector 			-> 		#pasteString.
				#icon 			-> 		#pasteIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		30.
				#itemOrder 			-> 		50.
				#label 			-> 		'Paste...'.
				#selector 			-> 		#pasteRecent.
				#icon 			-> 		#worldIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		10.
				#label 			-> 		'Toggle WordWrap'.
				#selector 			-> 		#wrapOnOff.
				#icon 			-> 		#genericTextIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		30.
				#label 			-> 		'Clear Font'.
				#selector 			-> 		#clearFont.
				#icon 			-> 		#newIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'Set Font... (k)'.
				#selector 			-> 		#offerFontMenu.
				#icon 			-> 		#preferencesDesktopFontIcon
			} asDictionary.
			{
				#submenuOf -> SmalltalkEditor editMenuLabel.
				#itemGroup 			-> 		40.
				#itemOrder 			-> 		20.
				#label 			-> 		'Set Font Size'.
				#selector 			-> 		#offerFontSizeMenu.
				#icon 			-> 		#preferencesDesktopFontIcon
			} asDictionary.
		}`.!

SmalltalkEditor class removeSelector: #editMenuLabel!

!methodRemoval: SmalltalkEditor class #editMenuLabel stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
editMenuLabel

	^'Edit'!

SmalltalkEditor removeSelector: #getMenu!

!methodRemoval: SmalltalkEditor #getMenu stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
getMenu
	
	^self createMenuCollectingOptionsWith: #smalltalkEditorMenuOptions!

TextEditor removeSelector: #addCutAndPasteMenuSectionTo:!

!methodRemoval: TextEditor #addCutAndPasteMenuSectionTo: stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
addCutAndPasteMenuSectionTo: aMenu
	"Adds  typical cut and paste operations section to a menu"

	self flag: #assumesKeyboardShortcuts.
	self hasUnacceptedEdits ifTrue: [
		aMenu
			add: 'Accept (s)'
			action: #acceptContents
			icon: #acceptIcon
	].
	
	aMenu
		add: 'Copy (c)'
		action: #copySelection
		icon: #copyIcon.
	
	aMenu
		add: 'Cut (x)'
		action: #cut
		icon: #cutIcon.

	aMenu
		add: 'Paste (v)'
		action: #paste
		icon: #pasteIcon.
		
	aMenu
		add: 'Paste without Format'
		action: #pasteString
		icon: #pasteIcon.
	
	aMenu
		add: 'Paste...'
		action: #pasteRecent
		icon: #worldIcon.
	
	^aMenu!

TextEditor removeSelector: #getMenu!

!methodRemoval: TextEditor #getMenu stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
getMenu
	| aMenu | 
	aMenu := MenuMorph new defaultTarget: self.
	aMenu
		addTitle: self class name;
		addStayUpIcons.
		
	aMenu
		add: 'Help...'
		action: #openHelp
		icon: #helpIcon.
	aMenu addLine.
	
	self addFinderMenuSectionTo: aMenu.
	self addUndoMenuSectionTo: aMenu.
	aMenu addLine.
	
	self addCutAndPasteMenuSectionTo: aMenu.
	aMenu addLine.
	
	self addStyleMenuSectionTo: aMenu.
	
	^aMenu !

TextEditor removeSelector: #addUndoMenuSectionTo:!

!methodRemoval: TextEditor #addUndoMenuSectionTo: stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
addUndoMenuSectionTo: aMenu
	"Adds undo operations to the given menu"

	self flag: #assumesKeyboardShortcuts.
	aMenu
		addItemsFromDictionaries: 
		`{	
			nil.
			{
				#label 			-> 		'Undo - multiple (z)'.
				#selector 			-> 		#undo.
				#icon 			-> 		#undoIcon
			} asDictionary.
			{
				#label 			-> 		'Redo - multiple (Z)'.
				#selector 			-> 		#redo.
				#icon 			-> 		#redoIcon
			} asDictionary.
			{
				#label 			-> 		'Undo / Redo history'.
				#selector 			-> 		#offerUndoHistory.
				#icon 			-> 		#changesIcon
			} asDictionary.
		}`.
		
	^aMenu.!

TextEditor removeSelector: #addStyleMenuSectionTo:!

!methodRemoval: TextEditor #addStyleMenuSectionTo: stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
addStyleMenuSectionTo: aMenu
	"Adds to the given menu text styiling related operations"

	self flag: #assumesKeyboardShortcuts.
	aMenu
		addItemsFromDictionaries: 
	`{
		{
				#label 			-> 		'Toggle WordWrap'.
				#selector 			-> 		#wrapOnOff.
				#icon 			-> 		#genericTextIcon
			} asDictionary.
			{
				#label 			-> 		'Clear Font'.
				#selector 			-> 		#clearFont.
				#icon 			-> 		#newIcon
			} asDictionary.
			{
				#label 			-> 		'Set Font... (k)'.
				#selector 			-> 		#offerFontMenu.
				#icon 			-> 		#preferencesDesktopFontIcon
			} asDictionary.
			{
				#label 			-> 		'Set Font Size'.
				#selector 			-> 		#offerFontSizeMenu.
				#icon 			-> 		#preferencesDesktopFontIcon
			} asDictionary.
			{
				#label 			-> 		'Set Style'.
				#selector 			-> 		#offerFontStyleMenu.
				#icon 			-> 		#preferencesDesktopFontIcon
			} asDictionary.
			{
				#label 			-> 		'Set Text Color'.
				#selector 			-> 		#offerColorMenu.
				#icon 			-> 		#graphicsIcon
			} asDictionary.
			{
				#label 			-> 		'Set Alignment...'.
				#selector 			-> 		#chooseAlignment.
				#icon 			-> 		#formatJustifyLeftIcon
			} asDictionary.
		}`.
		^aMenu!

TextEditor removeSelector: #addFinderMenuSectionTo:!

!methodRemoval: TextEditor #addFinderMenuSectionTo: stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:54'!
addFinderMenuSectionTo: aMenu
	"Build a submenu with finding related operations"

	self flag: #assumesKeyboardShortcuts.
	aMenu addItemsFromDictionaries:
	 `{
			{
				#label 			-> 		'Find...(f)'.
				#selector 			-> 		#find.
				#icon 			-> 		#findIcon
			} asDictionary.
			{
				#label 			-> 		'Find Again (g)'.
				#selector 			-> 		#findAgain.
				#icon 			-> 		#systemIcon
			} asDictionary.
			{
				#label 			-> 		'Use Selection for Find (j)'.
				#selector 			-> 		#setSearchString.
				#icon 			-> 		#saveAsIcon
			} asDictionary.
		}`.
		^aMenu!

Smalltalk removeClassNamed: #RefactoringMenues!

!classRemoval: #RefactoringMenues stamp: 'Install-6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st 8/13/2024 18:36:55'!
Object subclass: #RefactoringMenues
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tools-Refactoring'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6553-TextEditor-Menus-JuanVuletich-2024Jun10-15h03m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6483] on 18 June 2024 at 12:01:35 pm'!
!TextEditor methodsFor: 'menu messages' stamp: 'jmv 6/18/2024 12:00:50' prior: 16980945!
                           find
	"Prompt the user for a string to search for, and search the receiver from the current selection onward for it.  1/26/96 sw"

	self
		request: 'Find what?'
		initialAnswer: self class findText
		do: [:aString|
			aString isEmpty ifFalse: [
				"Set focus on our text morph, so that cmd-g does the search again"
				morph world activeHand newKeyboardFocus: morph.
				self setSearch: aString.
				ChangeText := self class findText.  "Implies no replacement to againOnce: method"
				morph handleInteraction: [
					(self findAndReplaceMany: false)
						ifFalse: [ self flash ]].
				morph scrollSelectionIntoView ]].
! !
!TextEditor methodsFor: 'menu messages' stamp: 'jmv 6/18/2024 12:00:47' prior: 16980967!
                     findAgain
	"Find the text-to-find again.  1/24/96 sw"

	morph handleInteraction: [
		(self findAndReplaceMany: false)
			ifFalse: [ self flash ]].
	morph scrollSelectionIntoView.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6554-Fix-JuanVuletich-2024Jun18-11h58m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6461] on 11 June 2024 at 9:20:33 am'!
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:16:39'!
         changeEmphasisBold
	^self changeEmphasisTo: 1! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:16:58'!
       changeEmphasisItalic
	^self changeEmphasisTo: 2! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:56:05'!
     changeEmphasisNormal
	"Change the emphasis of the current selection or prepare to accept characters with the change in emphasis."
	"This is a user command, and generates undo"

	| attributesToRemove |

	"Remove all TextEmphasis"
	attributesToRemove := emphasisHere.
	attributesToRemove ifNotNil: [ self unapplyAttributes: attributesToRemove ].
	^ true! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:17:21'!
                     changeEmphasisStruckThrough
	^self changeEmphasisTo: 4! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:17:40'!
                              changeEmphasisSubscript
	^self changeEmphasisTo: 6! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:17:29'!
  changeEmphasisSuperscript
	^self changeEmphasisTo: 5! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:57:01'!
changeEmphasisTo: emphasisCode
	"Change the emphasis of the current selection or prepare to accept characters with the change in emphasis."
	"This is a user command, and generates undo"

	| attributeToAdd attributesToRemove oldAttributes |
	oldAttributes := emphasisHere.

	"Toggle the indicated TextEmphasis"
	(emphasisCode between: 1 and: 6) ifTrue: [
		attributeToAdd := TextEmphasis perform: (
			#(#bold #italic #underlined #struckThrough #superscript #subscript)
				at: emphasisCode).
		oldAttributes do: [ :oldAtt |
			oldAtt = attributeToAdd ifTrue: [
				attributeToAdd := nil.
				attributesToRemove := {oldAtt} ]]].

	attributeToAdd ifNotNil: [ self applyAttribute: attributeToAdd ].
	attributesToRemove ifNotNil: [ self unapplyAttributes: attributesToRemove ].
	^ true! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:17:11'!
       changeEmphasisUnderlined
	^self changeEmphasisTo: 3! !
!SmalltalkEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 16:44:41'!
                            cancel
	"Cancel all edits done. Revert to saved version."
	model refetch.! !
!SmalltalkEditor methodsFor: 'typing/selecting keys' stamp: 'jmv 6/10/2024 16:45:46'!
                             argNext
	"Invoked by cmd-A.
	 Search forward from the end of the selection for a colon followed by
		a space.  Place the text cursor after the space.  If none are found, place the
		text cursor at the end of the text.."

	| start t |
	t := model actualContents.
	start := t findString: ': ' startingAt: self startIndex.
	start = 0 ifTrue: [ start := t size + 1].
	self deselectAndPlaceCursorAt: start + 2.
	^true! !
!SmalltalkEditor methodsFor: 'typing/selecting keys' stamp: 'jmv 6/10/2024 16:45:42'!
          argPrev
	"Invoked by cmd-Q.
	 Search backwards from the start of the selection for a colon followed by
		a space.  Place the text cursor after the space.  If none are found, place the
		text cursor at the start of the text.."

	| t i |
	t := model actualContents.
	i := self stopIndex.
	i > 1 ifTrue: [
		i := i -2.
		[i > 0 and: [ (t at: i) ~= $  or: [(t at: i-1) ~= $: ]]] whileTrue: [
			i := i -1 ].
		self deselectAndPlaceCursorAt: i + 1.
	].
	^true! !
!SmalltalkEditor methodsFor: 'typing/selecting keys' stamp: 'jmv 6/10/2024 16:50:31'!
displayIfFalse
	"Replace the current text selection with the text 'ifFalse:'--initiated by 
	cmd-F."

	self addString: 'ifFalse:'.! !
!SmalltalkEditor methodsFor: 'typing/selecting keys' stamp: 'jmv 6/10/2024 16:50:23'!
    displayIfTrue
	"Replace the current text selection with the text 'ifTrue:'--initiated by 
	cmd-T."

	self addString: 'ifTrue:'.! !
!InnerTextMorph methodsFor: 'events' stamp: 'jmv 6/10/2024 15:56:50' overrides: 50348263!
   keyboardShortcut: aKeyboardEvent
	"Handle a keyboard shortcut.
	See coment at Morph >> #getMenu
	"
	"ctrl and option (if on Mac) are used to enter #normalCharacter:"
	aKeyboardEvent commandAltKeyPressed ifFalse: [ ^false ].
	(aKeyboardEvent keyValue between: 32 and: 126) ifFalse: [ ^false ].
	^super keyboardShortcut: aKeyboardEvent! !
!TextEditor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/10/2024 16:48:55' prior: 50358919!
               defaultMenuSpec
	"Spec for the menu and shortcut keys for the regular text editors.
	See coment at Morph >> #getMenu
	"
	| acceptEntry |
	acceptEntry := self hasUnacceptedEdits
		ifTrue: [ #((110				'Accept (s)' 					$s 	editor 			acceptContents 						acceptIcon)) ]
		ifFalse: [ #((110 				'Accept (s)' 					nil 	editor 			nil 						acceptIcon)) ].
	^#(
		#(0 		'Text Editor' 					true)
		#(10		'Help... (h)' 							$h 	editor 			openHelp 						helpIcon)
		#(20 		'-----')
		#(30		'Find...(f)' 							$f 	editor 			find 						findIcon)
		#(40		'Find Again (g)' 							$g 	editor 			findAgain 						systemIcon)
		#(50		'Use Selection for Find (j)' 							$j 	editor 			setSearchString 						saveAsIcon)
		#(60 		'-----')
		#(70		'Undo - multiple (z)' 							$z 	editor 			undo 						undoIcon)
		#(80		'Redo - multiple (Z)' 							$Z 	editor 			redo 						redoIcon)
		#(90		'Undo / Redo history' 							nil 	editor 			offerUndoHistory 						changesIcon)
		#(100 		'-----')
	),
	acceptEntry,
	#(
		#(120		'Copy (c)' 							$c 	editor 			copySelection 						copyIcon)
		#(130		'Cut (x)' 							$x 	editor 			cut 						cutIcon)
		#(140		'Paste (v)' 							$v 	editor 			paste 						pasteIcon)
		#(150		'Paste without Format' 							nil 	editor 			pasteString 						pasteIcon)
		#(160		'Paste...' 							nil 	editor 			pasteRecent 						worldIcon)
		#(180 		'-----')
		#(190		'Toggle WordWrap' 							nil 	editor 			wrapOnOff 						genericTextIcon)
		#(200		'Clear Font' 							nil 	editor 			clearFont 						newIcon)
		#(210		'Set Font... (k)' 							$k 	editor 			offerFontMenu 						preferencesDesktopFontIcon)
		#(220		'Set Font Size' 							nil 	editor 			offerFontSizeMenu 						preferencesDesktopFontIcon)
		#(230		'Set Style' 							nil 	editor 			offerFontStyleMenu 						preferencesDesktopFontIcon)
		#(240		'Set Text Color (8)' 							$8 	editor 			offerColorMenu 						graphicsIcon)
		#(250		'Set Alignment... (u)' 							$u 	editor 			chooseAlignment 						formatJustifyLeftIcon)

		"Keyboard shortcuts only"
		#(500		nil 							$0 	editor 			changeEmphasisNormal)
		#(501		nil 							$1 	editor 			changeEmphasisBold)
		#(502		nil 							$2 	editor 			changeEmphasisItalic)
		#(503		nil 							$3 	editor 			changeEmphasisUnderlined)
		#(504		nil 							$4 	editor 			changeEmphasisStruckThrough)
		#(505		nil 							$5 	editor 			changeEmphasisSuperscript)
		#(506		nil 							$6 	editor 			changeEmphasisSubscript)
	).! !
!SmalltalkEditor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/10/2024 16:52:56' prior: 50358986 overrides: 50359822!
      defaultMenuSpec
	"Spec for the menu and shortcut keys for the regular text editors.
	See coment at Morph >> #getMenu
	"
	| acceptEntry |
	acceptEntry := self hasUnacceptedEdits
		ifTrue: [ #((240				'Accept (s)' 					$s 	editor 			acceptContents 						acceptIcon)) ]
		ifFalse: [ #((240 				'Accept (s)' 					nil 	editor 			nil 						acceptIcon)) ].
	^#(
		#(0 		'Smalltalk Editor' 					true)
		#(10		'Help... (h)' 							$h 	editor 			openHelp 						helpIcon)
		#(20 		'-----')
		#(30		'Do it (d)' 							$d 	editor 			doIt 						doItIcon
					'Do it (selection is a valid expression)')
		#(40		'Print it (p)' 							$p 	editor 			printIt 						printIcon
					'Print it (selection is a valid expression)')
		#(50		'Inspect it (i)' 							$i 	editor 			inspectIt 						inspectIcon
					'Inspect it (selection is a valid expression, or selection is over an inspect-ilst)')
		#(60		'Explore it (I)' 							$I 	editor 			exploreIt 						exploreIcon
					'Inspect via Object Explorer')
		#(70		'Debug it (D)' 							$D 	editor 			debugIt 						debugIcon
					'Debug it')
		#(80		'Profile it' 							nil 	editor 			profileIt 						clockIcon)
		#(90 		'-----')
		#(100		'Edit' 							nil 	nil 			1000 						textEditorIcon)
		#(110 		'-----')
		#(120		'Explain' 							nil 	editor 			explain 						helpIcon)
		#(130		'Browse it (b)' 							$b 	editor 			browseIt 						editFindReplaceIcon
					'Browse it (selection is a class name or cursor is over a class-list or message-list)')
		#(140		'Senders of it (n)' 							$n 	editor 			sendersOfIt 						mailForwardIcon
					'Senders of it (selection is a message selector or cursor is over a class-list or message-list)')
		#(150		'Implementors of it (m)' 							$m 	editor 			implementorsOfIt 						developmentIcon
					'Implementors of it (selection is a message selector or cursor is over a class-list or message-list)')
		#(160		'References to it (N)' 							$N 	editor 			referencesToIt 						addressBookIcon
					'References to it (selection is a class name, or cursor is over a class-list or message-list)')
		#(170 		'-----')
		#(180		'Refactorings' 							nil 	nil 			2000 						listAddIcon)
		#(190 		'-----')
		#(200		'Method Strings with it (E)' 							$E	editor 			methodStringsContainingIt 								genericTextIcon
					'Method strings containing it')
		#(210		'Method Source with it (e)' 							$e 	editor 			methodSourceContainingIt 								scriptIcon
					'Method source containing it')
		#(220		'Class Comments with it' 							nil 	editor 			classCommentsContainingIt 								chatIcon)
		#(230 		'-----')
	),
	acceptEntry,
	#(
		#(250		'Accept & Run Test in Class (t)' 									$t 	editor 			acceptAndTest 						weatherFewCloudsIcon
					'Saves method, runs it as test and then all tests in class. Opens debugger if error.')
		#(260		'Accept & Run Test in Category (y)' 									$y 	editor 			acceptAndTestAll 						weatherFewCloudsIcon
					'Saves method, runs it as test and then all tests in class category. Opens debugger if error.')
		#(270		'Accept & Debug Test (r)' 									$r 	editor 			acceptAndDebugTest 						weatherFewCloudsIcon
					'Saves method and debugs it')

		"Keyboard shortcuts only"
		#(500		nil 							$0 	editor 			changeEmphasisNormal)
		#(501		nil 							$1 	editor 			changeEmphasisBold)
		#(502		nil 							$2 	editor 			changeEmphasisItalic)
		#(503		nil 							$3 	editor 			changeEmphasisUnderlined)
		#(504		nil 							$4 	editor 			changeEmphasisStruckThrough)
		#(505		nil 							$5 	editor 			changeEmphasisSuperscript)
		#(506		nil 							$6 	editor 			changeEmphasisSubscript)
		#(507		nil 							$l 	editor 			cancel)
		#(508		nil 							$Q 	editor 			argPrev)
		#(509		nil 							$W 	editor 			argNext)
		#(510		nil 							$T 	editor 			displayIfTrue)
		#(511		nil 							$F 	editor 			displayIfFalse)


		" 'Edit' SubMenu"
		#(1010 		'-----')
		#(1020		'Find...(f)' 							$f 	editor 			find 						findIcon)
		#(1030		'Find Again (g)' 							$g 	editor 			findAgain 						systemIcon)
		#(1040		'Use Selection for Find (j)' 							$j 	editor 			setSearchString 						saveAsIcon)
		#(1050 		'-----')
		#(1060		'Undo - multiple (z)' 							$z 	editor 			undo 						undoIcon)
		#(1070		'Redo - multiple (Z)' 							$Z 	editor 			redo 						redoIcon)
		#(1080		'Undo / Redo history' 							nil 	editor 			offerUndoHistory 						changesIcon)
		#(1090 		'-----')
		#(1100		'Copy (c)' 							$c 	editor 			copySelection 						copyIcon)
		#(1110		'Cut (x)' 							$x 	editor 			cut 						cutIcon)
		#(1120		'Paste (v)' 							$v 	editor 			paste 						pasteIcon)
		#(1130		'Paste without Format' 							nil 	editor 			pasteString 						pasteIcon)
		#(1140		'Paste...' 							nil 	editor 			pasteRecent 						worldIcon)
		#(1150 		'-----')
		#(1160		'Toggle WordWrap' 							nil 	editor 			wrapOnOff 						genericTextIcon)
		#(1170		'Clear Font' 							nil 	editor 			clearFont 						newIcon)
		#(1180		'Set Font... (k)' 							$k 	editor 			offerFontMenu 						preferencesDesktopFontIcon)
		#(1190		'Set Font Size' 							nil 	editor 			offerFontSizeMenu 						preferencesDesktopFontIcon)

		" 'Refactorings' SubMenu"
		#(2010 		'-----')
		#(2020		'Rename... (R)' 									$R 	editor 			contextualRename 										saveAsIcon)
		#(2030		'Extract as Parameter... (V)' 									$V 	editor 			contextualExtractAsParameter 										listAddIcon)
		#(2040		'Add Parameter... (A)' 									$A 	editor 			contextualAddParameter 										listAddIcon)
		#(2050		'Remove Parameter... (S)' 									$S 	editor 			contextualRemoveParameter 										listRemoveIcon)
		#(2060 		'-----')
		#(2070		'Extract Temporary... (J)' 									$J 	editor 			extractToTemporary 										saveAsIcon)
		#(2080		'Extract Method... (K)' 									$K 	editor 			extractMethod 										saveAsIcon)
		#(2090 		'-----')
		#(2100		'Inline Temporary... (O)' 									$O 	editor 			inlineTemporaryVariable 										saveAsIcon)
		#(2110		'Inline Method... (F)' 									$F 	editor 			contextualInlineMethod 										saveAsIcon)
		#(2120 		'-----')
		#(2130		'Temporary to Instance Variable (G)' 									$G 	editor 			temporaryToInstanceVariable 										saveAsIcon)
		#(2140		'Push Up Instance Variable' 									nil 	editor 			contextualPushUpInClassDefinition 										goTopIcon)
		#(2150		'Push Down Instance Variable' 									nil 	editor 			contextualPushDownInClassDefinition 										goBottomIcon)
	).
! !
!InnerTextMorph methodsFor: 'events' stamp: 'jmv 6/10/2024 16:31:01' prior: 50335203 overrides: 50335601!
                  keyStroke: aKeyboardEvent

	super keyStroke: aKeyboardEvent.
	aKeyboardEvent wasHandled ifTrue: [ 
		self selectionChanged.  "Note new selection"
		self updateFromTextComposition.
		^self ].

	autoCompleter 
		ifNil: [ self processKeystrokeEvent: aKeyboardEvent ]
		ifNotNil: [
			autoCompleter
				autoCompletionAround: [ self processKeystrokeEvent: aKeyboardEvent ]
				keyStroke: aKeyboardEvent ].

	aKeyboardEvent wasHandled: true.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6555-TextEditor-Shortcuts-JuanVuletich-2024Jun11-09h17m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6461] on 11 June 2024 at 9:35:37 am'!
!Editor methodsFor: 'typing/selecting keys' stamp: 'jmv 6/10/2024 19:07:06'!
                  cursorTopHome
	"Put cursor at beginning of text -- invoked from cmd-H shortcut, useful for keyboards that have no home key."

	self deselectAndPlaceCursorAt: 1.! !
!Editor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/10/2024 18:14:19'!
                defaultMenuSpec
	#()! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 19:03:41'!
changeLineEndsToLf
	"Replace all CRs and CrLfs by LFs.
	Triggered by Cmd-U -- useful when getting code from FTP sites"
	"This is a user command, and generates undo"
	
	self replaceSelectionWith: self selectedString withCuisLineEndings.! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:25:05'!
         encloseWith: aCharacter
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	| left right startIndex stopIndex oldSelection which |
	startIndex := self startIndex.
	stopIndex := self stopIndex.
	oldSelection := self selection.
	which := '([<{"''`' indexOf: aCharacter ifAbsent: [ ^true ].
	left := '([<{"''`' at: which.
	right := ')]>}"''`' at: which.
	((startIndex > 1 and: [stopIndex <= model textSize])
			and: [ (model actualContents at: startIndex-1) = left
				and: [(model actualContents at: stopIndex) = right]])
		ifTrue: [
			"already enclosed; strip off brackets"
			self selectFrom: startIndex-1 to: stopIndex.
			self replaceSelectionWith: oldSelection]
		ifFalse: [
			"not enclosed; enclose by matching brackets"
			self replaceSelectionWith:
				(Text string: (UnicodeString with: left) attributes: emphasisHere),
				oldSelection,
				(Text string: (UnicodeString with: right) attributes: emphasisHere).
			self selectFrom: startIndex+1 to: stopIndex].
	^ true.! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:27:22'!
  encloseWithAngleBrackets
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: $<! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:27:52'!
                 encloseWithBackTicks
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: $`! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:27:12'!
                     encloseWithCurlyBrackets
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: ${! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:27:44'!
                 encloseWithDoubleQuotes
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: $"! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:26:18'!
                  encloseWithParenthesis
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: $(! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:27:38'!
                   encloseWithSingleQuotes
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: $'! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:26:59'!
                  encloseWithSquareBrackets
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	^self encloseWith: $[! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 19:18:11'!
                makeCapitalized
	"Force the current selection to uppercase.  Triggered by Cmd-X."
	"This is a user command, and generates undo"

	| prev |
	prev := $-.  "not a letter"
	self replaceSelectionWith: 
		(self selectedString collect:
			[:c | prev := prev isLetter ifTrue: [c asLowercase] ifFalse: [c asUppercase]]).! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 19:18:06'!
                             makeLowercase
	"Force the current selection to lowercase.  Triggered by Cmd-X."
	"This is a user command, and generates undo"

	self replaceSelectionWith: self selectedString asLowercase.! !
!TextEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 19:18:03'!
                         makeUppercase
	"Force the current selection to uppercase.  Triggered by Cmd-Y."
	"This is a user command, and generates undo"

	self replaceSelectionWith: self selectedString asUppercase.! !
!SmalltalkEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 17:24:53' overrides: 50360150!
encloseWith: aCharacter
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	| startIndex stopIndex oldSelection new enlargedBy |
	"This implementation is only for commenting and uncommenting code.
	Other cases are handled by the super implementation.
	This implementation only handles String and discards Text attributes."
	aCharacter = $" ifFalse: [
		^super encloseWith: aCharacter ].

	startIndex := self startIndex.
	stopIndex := self stopIndex.
	oldSelection := self selection string.
	((startIndex > 1 and: [stopIndex <= model textSize])
			and: [ (model actualContents at: startIndex-1) = $"
				and: [(model actualContents at: stopIndex) = $"]])
		ifTrue: [
			"already enclosed in double colons; make selection no longer a comment"
			self selectFrom: startIndex-1 to: stopIndex.
			self replaceSelectionWith: oldSelection withDoubleColonsUndoubled ]
		ifFalse: [
			"not enclosed in double colons; make selection a comment"
			new := oldSelection withDoubleColonsDoubled.
			enlargedBy := new size - oldSelection size.
			self replaceSelectionWith: $" asString, new, $" asString.
			self selectFrom: startIndex+1 to: stopIndex + enlargedBy ].
	^ true.! !
!SmalltalkEditor methodsFor: 'editing keys' stamp: 'jmv 6/10/2024 19:26:54'!
     pasteInitials
	"Replace the current text selection by an authorship name/date stamp; invoked by cmd-shift-v, easy way to put an authorship stamp in the comments of an editor."
	"This is a user command, and generates undo"

	| i |
	i := self stopIndex.
	self replaceSelectionWith: (Text fromString: Utilities changeStamp).
	self deselectAndPlaceCursorAt: i.! !
!Editor methodsFor: 'accessing' stamp: 'jmv 6/10/2024 18:34:25' prior: 16851694!
       help
	"
	TextEditor new help edit
	SmalltalkEditor new help edit
	"
	| tabs |
	^ String streamContents: [ :strm |
		tabs := String tab, String tab, String tab, String tab.
		self class allShiftShortcutsSpec do: [ :triplet | | c |
			c := triplet first = Character space
				ifFalse: [ triplet first asString, '   	' ]
				ifTrue: [ 'Space'].
			strm nextPutAll: ('Shift', '-', c, tabs, triplet third).
			strm newLine ].
		tabs := String tab, String tab, String tab, String tab, String tab.
		self defaultMenuSpec do: [ :menuItemNshortcutSpec |
			menuItemNshortcutSpec size > 6 ifTrue: [
				menuItemNshortcutSpec third ifNotNil: [ :shortcutCharacter |
					strm nextPutAll: ('Command', '-', shortcutCharacter asString, tabs, menuItemNshortcutSpec seventh).
				strm newLine ].
			].
		].
	]! !
!TextEditor methodsFor: 'typing support' stamp: 'jmv 6/11/2024 09:30:04' prior: 16981228!
          dispatchOn: aKeyboardEvent
	"Carry out the action associated with this character, if any."

	| codePoint asciiValue c |
	self clearParens.
  	codePoint := aKeyboardEvent keyValue.
	
	codePoint > 255 ifTrue: [
		^self normalCharacter: aKeyboardEvent ].

	c := aKeyboardEvent keyCharacter.
	(')]}' includes: c)
		ifTrue: [ self blinkPrevParen: c ].

	asciiValue := codePoint.
	^ self perform: (self shortcuts at: asciiValue + 1) with: aKeyboardEvent.! !
!TextEditor methodsFor: 'testing' stamp: 'jmv 6/10/2024 18:26:16' prior: 16981940!
         hasUnacceptedEdits

	^morph notNil and: [ morph hasUnacceptedEdits ].! !
!TextEditor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/10/2024 19:11:17' prior: 50359822 overrides: 50360137!
   defaultMenuSpec
	"Spec for the menu and shortcut keys for the regular text editors.
	See coment at Morph >> #getMenu
	"
	| acceptEntry |
	acceptEntry := self hasUnacceptedEdits
		ifTrue: [ #((110				'Accept (s)' 					$s 	editor 			acceptContents 						acceptIcon 								'Save')) ]
		ifFalse: [ #((110 				'Accept' 					nil 	editor 			nil 						acceptIcon 								'Save')) ].
	^#(
		#(0 		'Text Editor' 					true)
		#(10		'Help... (h)' 							$h 	editor 			openHelp 						helpIcon 								'Open Help')
		#(20 		'-----')
		#(30		'Find...(f)' 							$f 	editor 			find 						findIcon 								'Find')
		#(40		'Find Again (g)' 							$g 	editor 			findAgain 						systemIcon 								'Find again')
		#(50		'Use Selection for Find (j)' 							$j 	editor 			setSearchString 						saveAsIcon 								'Set selection as search string for find again')
		#(60 		'-----')
		#(70		'Undo - multiple (z)' 							$z 	editor 			undo 						undoIcon 								'Undo (multiple levels)')
		#(80		'Redo - multiple (Z)' 							$Z 	editor 			redo 						redoIcon 								'Redo (multiple levels)')
		#(90		'Undo / Redo history' 							nil 	editor 			offerUndoHistory 						changesIcon)
		#(100 		'-----')
	),
	acceptEntry,
	#(
		#(120		'Copy (c)' 							$c 	editor 			copySelection 						copyIcon 								'Copy selection to the Clipboard')
		#(130		'Cut (x)' 							$x 	editor 			cut 						cutIcon 								'Cut selection and store it in the Clipboard')
		#(140		'Paste (v)' 							$v 	editor 			paste 						pasteIcon 								'Paste Clipboard contents')
		#(150		'Paste without Format' 							nil 	editor 			pasteString 						pasteIcon)
		#(160		'Paste...' 							nil 	editor 			pasteRecent 						worldIcon)
		#(180 		'-----')
		#(190		'Toggle WordWrap' 							nil 	editor 			wrapOnOff 						genericTextIcon)
		#(200		'Clear Font' 							nil 	editor 			clearFont 						newIcon)
		#(210		'Set Font... (k)' 							$k 	editor 			offerFontMenu 						preferencesDesktopFontIcon 								'Set font')
		#(220		'Set Font Size' 							nil 	editor 			offerFontSizeMenu 						preferencesDesktopFontIcon)
		#(230		'Set Style' 							nil 	editor 			offerFontStyleMenu 						preferencesDesktopFontIcon)
		#(240		'Set Text Color (8)' 							$8 	editor 			offerColorMenu 						graphicsIcon)
		#(250		'Set Alignment... (u)' 							$u 	editor 			chooseAlignment 						formatJustifyLeftIcon 								'Toggle alignment')

		"Keyboard shortcuts only"
		#(500		nil 							$0 	editor 			changeEmphasisNormal 									nil 			'Normal')
		#(501		nil 							$1 	editor 			changeEmphasisBold 									nil 			'Bold')
		#(502		nil 							$2 	editor 			changeEmphasisItalic 									nil 			'Italic')
		#(503		nil 							$3 	editor 			changeEmphasisUnderlined 									nil 			'Underlined')
		#(504		nil 							$4 	editor 			changeEmphasisStruckThrough 									nil 			'Struck Through')
		#(505		nil 							$5 	editor 			changeEmphasisSuperscript 									nil 			'Superscript')
		#(506		nil 							$6 	editor 			changeEmphasisSubscript 									nil 			'Subscript')
		#(601 		nil 							$a 	editor 			selectAll 									nil 			'Select all')
		#(602 		nil 							$C 	editor 			compareToClipboard 									nil 			'Compare argument to clipboard')
		#(603 		nil 							$U 	editor 			changeLineEndsToLf 									nil 			'Convert line endings to LF characters (Cuis convention) in selection')
		#(604 		nil 							$( 	editor 			encloseWithParenthesis 									nil 			'Enclose within ( and ), or remove enclosing ( and )')
		#(605 		nil 							$[ 	editor 			encloseWithSquareBrackets 									nil 			'Enclose within [ and ], or remove enclosing [ and ]')
		#(606 		nil 							${ 	editor 			encloseWithCurlyBrackets 									nil 			'Enclose within { and }, or remove enclosing { and }')
		#(607 		nil 							$' 	editor 			encloseWithSingleQuotes 									nil 			'Enclose within single quotes, or remove enclosing single quotes')
		#(608 		nil 							$" 	editor 			encloseWithDoubleQuotes 									nil 			'Enclose within double quotes, or remove enclosing double quotes')
		#(609 		nil 							$` 	editor 			encloseWithBackTicks 									nil 			'Enclose within backticks, or remove enclosing backticks')
		"#(610 		nil 							$< 	editor 			encloseWithAngleBrackets 									nil 			'Enclose within < and >, or remove enclosing ( and )')"
		#(611 		nil 							$H 	editor 			cursorTopHome 									nil 			'Move cursor to start of text')
	).
! !
!SmalltalkEditor methodsFor: 'tdd' stamp: 'jmv 6/10/2024 19:22:14' prior: 16954520!
                               acceptAndTest
	
	self acceptThenTestMethodAndSuite: [ :aMethod | self testSuiteOf: aMethod methodClass ].! !
!SmalltalkEditor methodsFor: 'tdd' stamp: 'jmv 6/10/2024 19:22:36' prior: 16954526!
                               acceptAndTestAll
	
	self acceptThenTestMethodAndSuite: [ :aMethod | self testSuiteForCategoryOf: aMethod methodClass ].! !
!SmalltalkEditor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/11/2024 09:31:44' prior: 50359902 overrides: 50360378!
            defaultMenuSpec
	"Spec for the menu and shortcut keys for the regular text editors.
	See coment at Morph >> #getMenu
	"
	| acceptEntry |
	acceptEntry := self hasUnacceptedEdits
		ifTrue: [ #((240				'Accept (s)' 					$s 	editor 			acceptContents 						acceptIcon 							'Save')) ]
		ifFalse: [ #((240 				'Accept' 					nil 	editor 			nil 						acceptIcon 							'Save')) ].
	^#(
		#(0 		'Smalltalk Editor' 					true)
		#(10		'Help... (h)' 							$h 	editor 			openHelp 						helpIcon 							'Open Help')
		#(20 		'-----')
		#(30		'Do it (d)' 							$d 	editor 			doIt 						doItIcon 							'Do it (selection is a valid expression)')
		#(40		'Print it (p)' 							$p 	editor 			printIt 						printIcon 							'Print it (selection is a valid expression)')
		#(50		'Inspect it (i)' 							$i 	editor 			inspectIt 						inspectIcon 							'Inspect it (selection is a valid expression, or selection is over an inspect-ilst)')
		#(60		'Explore it (I)' 							$I 	editor 			exploreIt 						exploreIcon
					'Inspect via Object Explorer')
		#(70		'Debug it (D)' 							$D 	editor 			debugIt 						debugIcon
					'Debug it')
		#(80		'Profile it' 							nil 	editor 			profileIt 						clockIcon)
		#(90 		'-----')
		#(100		'Edit' 							nil 	nil 			1000 						textEditorIcon)
		#(110 		'-----')
		#(120		'Explain' 							nil 	editor 			explain 						helpIcon)
		#(130		'Browse it (b)' 							$b 	editor 			browseIt 						editFindReplaceIcon 							'Browse it (selection is a class name or cursor is over a class-list or message-list)')
		#(140		'Senders of it (n)' 							$n 	editor 			sendersOfIt 						mailForwardIcon 							'Senders of it (selection is a message selector or cursor is over a class-list or message-list)')
		#(150		'Implementors of it (m)' 							$m 	editor 			implementorsOfIt 						developmentIcon 							'Implementors of it (selection is a message selector or cursor is over a class-list or message-list)')
		#(160		'References to it (N)' 							$N 	editor 			referencesToIt 						addressBookIcon 							'References to it (selection is a class name, or cursor is over a class-list or message-list)')
		#(170 		'-----')
		#(180		'Refactorings' 							nil 	nil 			2000 						listAddIcon)
		#(190 		'-----')
		#(200		'Method Strings with it (E)' 							$E	editor 			methodStringsContainingIt 								genericTextIcon 					'Method strings containing it')
		#(210		'Method Source with it (e)' 							$e 	editor 			methodSourceContainingIt 								scriptIcon 					'Method source containing it')
		#(220		'Class Comments with it' 							nil 	editor 			classCommentsContainingIt 								chatIcon)
		#(230 		'-----')
	),
	acceptEntry,
	#(
		#(250		'Accept & Run Test in Class (t)' 									$t 	editor 			acceptAndTest 						weatherFewCloudsIcon 							'Saves method, runs it as test and then all tests in class. Opens debugger if error.')
		#(260		'Accept & Run Test in Category (y)' 									$y 	editor 			acceptAndTestAll 						weatherFewCloudsIcon 							'Saves method, runs it as test and then all tests in class category. Opens debugger if error.')
		#(270		'Accept & Debug Test (r)' 									$r 	editor 			acceptAndDebugTest 						weatherFewCloudsIcon 							'Saves method and debugs it')

		" 'Edit' SubMenu"
		#(1010 		'-----')
		#(1020		'Find...(f)' 							$f 	editor 			find 						findIcon 									'Find')
		#(1030		'Find Again (g)' 							$g 	editor 			findAgain 						systemIcon 									'Find again')
		#(1040		'Use Selection for Find (j)' 							$j 	editor 			setSearchString 						saveAsIcon 									'Set selection as search string for find again')
		#(1050 		'-----')
		#(1060		'Undo - multiple (z)' 							$z 	editor 			undo 						undoIcon 									'Undo (multiple levels)')
		#(1070		'Redo - multiple (Z)' 							$Z 	editor 			redo 						redoIcon 									'Redo (multiple levels)')
		#(1080		'Undo / Redo history' 							nil 	editor 			offerUndoHistory 						changesIcon)
		#(1090 		'-----')
		#(1100		'Copy (c)' 							$c 	editor 			copySelection 						copyIcon 									'Copy selection to the Clipboard')
		#(1110		'Cut (x)' 							$x 	editor 			cut 						cutIcon 									'Cut selection and store it in the Clipboard')
		#(1120		'Paste (v)' 							$v 	editor 			paste 						pasteIcon 									'Paste Clipboard contents')
		#(1130		'Paste without Format' 							nil 	editor 			pasteString 						pasteIcon)
		#(1140		'Paste...' 							nil 	editor 			pasteRecent 						worldIcon)
		#(1150 		'-----')
		#(1160		'Toggle WordWrap' 							nil 	editor 			wrapOnOff 						genericTextIcon)
		#(1170		'Clear Font' 							nil 	editor 			clearFont 						newIcon)
		#(1180		'Set Font... (k)' 							$k 	editor 			offerFontMenu 						preferencesDesktopFontIcon 									'Set font')
		#(1190		'Set Font Size' 							nil 	editor 			offerFontSizeMenu 						preferencesDesktopFontIcon)

		"Keyboard shortcuts only"
		#(1500		nil 							$0 	editor 			changeEmphasisNormal 									nil 		'Normal')
		#(1501		nil 							$1 	editor 			changeEmphasisBold 									nil 		'Bold')
		#(1502		nil 							$2 	editor 			changeEmphasisItalic 									nil 		'Italic')
		#(1503		nil 							$3 	editor 			changeEmphasisUnderlined 									nil 		'Underlined')
		#(1504		nil 							$4 	editor 			changeEmphasisStruckThrough 									nil 		'Struck Through')
		#(1505		nil 							$5 	editor 			changeEmphasisSuperscript 									nil 		'Superscript')
		#(1506		nil 							$6 	editor 			changeEmphasisSubscript 									nil 		'Subscript')
		#(1507		nil 							$l 	editor 			cancel 									nil 		'Cancel all edits')
		#(1508		nil 							$Q 	editor 			argPrev 									nil 		'Previous argument')
		#(1509		nil 							$W 	editor 			argNext 									nil 		'Next argument')
		#(1510		nil 							$T 	editor 			displayIfTrue)
		#(1511		nil 							$F 	editor 			displayIfFalse)
		#(1601 		nil 							$a 	editor 			selectAll 									nil 		'Select all')
		#(1602 		nil 							$C 	editor 			compareToClipboard 									nil 		'Compare argument to clipboard')
		#(1603 		nil 							$U 	editor 			changeLineEndsToLf 									nil 		'Convert line endings to LF characters (Cuis convention) in selection')
		#(1604 		nil 							$( 	editor 			encloseWithParenthesis 									nil 		'Enclose within ( and ), or remove enclosing ( and )')
		#(1605 		nil 							$[ 	editor 			encloseWithSquareBrackets 									nil 		'Enclose within [ and ], or remove enclosing [ and ]')
		#(1606 		nil 							${ 	editor 			encloseWithCurlyBrackets 									nil 		'Enclose within { and }, or remove enclosing { and }')
		#(1607 		nil 							$' 	editor 			encloseWithSingleQuotes 									nil 		'Enclose within single quotes, or remove enclosing single quotes')
		#(1608 		nil 							$" 	editor 			encloseWithDoubleQuotes 									nil 		'Enclose within double quotes, or remove enclosing double quotes')
		#(1609 		nil 							$` 	editor 			encloseWithBackTicks 									nil 		'Enclose within backticks, or remove enclosing backticks')
		"#(1610 		nil 							$< 	editor 			encloseWithAngleBrackets 									nil 		'Enclose within < and >, or remove enclosing ( and )')"
		#(1611 		nil 							$H 	editor 			cursorTopHome 									nil 		'Move cursor to start of text')

		" 'Refactorings' SubMenu"
		#(2010 		'-----')
		#(2020		'Rename... (R)' 									$R 	editor 			contextualRename 										saveAsIcon 				'Renames what is under cursor')
		#(2030		'Extract as Parameter... (V)' 									$V 	editor 			contextualExtractAsParameter 										listAddIcon 				'Extracts the selected code as parameter')
		#(2040		'Add Parameter... (A)' 									$A 	editor 			contextualAddParameter 										listAddIcon 				'Adds parameter to message that is under cursor')
		#(2050		'Remove Parameter... (S)' 									$S 	editor 			contextualRemoveParameter 										listRemoveIcon 'Removes parameter to message that is under cursor')
		#(2060 		'-----')
		#(2070		'Extract Temporary... (J)' 									$J 	editor 			extractToTemporary 										saveAsIcon 				'Extracts the selected code into a temporary variable')
		#(2080		'Extract Method... (K)' 									$K 	editor 			extractMethod 										saveAsIcon 				'Extracts the selected code into a separate method')
		#(2090 		'-----')
		#(2100		'Inline Temporary... (O)' 									$O 	editor 			inlineTemporaryVariable 										saveAsIcon 				'Inlines the selected temporary variable into each usage')
		#(2110		'Inline Method... (F)' 									$F 	editor 			contextualInlineMethod 										saveAsIcon  				'Inlines the selected message send into desired colaborations')
		#(2120 		'-----')
		#(2130		'Temporary to Instance Variable (G)' 									$G 	editor 			temporaryToInstanceVariable 										saveAsIcon 				'Extracts temporary variable to instance variable')
		#(2140		'Push Up Instance Variable' 									nil 	editor 			contextualPushUpInClassDefinition 										goTopIcon)
		#(2150		'Push Down Instance Variable' 									nil 	editor 			contextualPushDownInClassDefinition 										goBottomIcon)
	).
! !

TextEditor removeSelector: #shouldHandleUsingCmdShortcuts:!

!methodRemoval: TextEditor #shouldHandleUsingCmdShortcuts: stamp: 'Install-6556-TextEditor-AdditionalShortcuts-Help-JuanVuletich-2024Jun11-09h20m-jmv.001.cs.st 8/13/2024 18:36:55'!
shouldHandleUsingCmdShortcuts: aKeyboardEvent 
	^ (aKeyboardEvent keyValue between: 32 and: 126) and: [ aKeyboardEvent commandAltKeyPressed ]!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6556-TextEditor-AdditionalShortcuts-Help-JuanVuletich-2024Jun11-09h20m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6461] on 11 June 2024 at 10:20:39 am'!
!SystemDictionary methodsFor: 'shrinking' stamp: 'jmv 6/11/2024 09:47:30' prior: 16965426!
              presumedSentMessages
	| sent |
	"
	In addition to those here, if it is desired to preserve some methods from deletion, see #nominallyUnsent:
	Smalltalk presumedSentMessages
	"

	"The following should be preserved for doIts, etc"
	sent := IdentitySet new.
	#( rehashWithoutBecome
		browseAllSelect:  lastRemoval
		vScrollBarValue: hScrollBarValue: 
		to: removeClassNamed:
		dragon: hilberts: mandala: web test3 factorial tinyBenchmarks benchFib
		newDepth: restoreAfter: zapAllMethods obsoleteClasses
		removeAllUnSentMessages abandonSources removeUnreferencedKeys
		zapOrganization condenseSources condenseChanges browseObsoleteReferences
		subclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		methodsFor:stamp: methodsFor:stamp:prior: instanceVariableNames:
		startTimerEventLoop unusedClasses allClasses
		unimplemented
		reduceCuis
		variableSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		variableByteSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		variableWordSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		weakSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		printSpaceAnalysis:on:) do: [ :sel |
			sent add: sel].
	"The following may be sent by perform: in dispatchOnChar..."
	Editor withAllSubclassesDo: [ :c |
		c shortcuts asSet do: [ :sel | sent add: sel ].
		c new defaultMenuSpec do: [ :spec |
			spec size >= 5 ifTrue: [
				spec fifth isSymbol ifTrue: [ sent add: spec fifth ]]]].
	#(beReadOnlyBinding beReadWriteBinding) do: [ :sel |
		sent add: sel].
	AppLauncher appSelector ifNotNil: [ :sel |
		sent add: sel ].
	^ sent! !
!Editor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 6/11/2024 09:44:29' prior: 50360137!
       defaultMenuSpec
	^#()! !
!Editor class methodsFor: 'class initialization' stamp: 'jmv 6/11/2024 10:19:40' prior: 16852494 overrides: 16916245!
                 initialize
	"
	Editor initialize
	"
	self withAllSubclassesDo: [ :c | c initializeShortcuts ].! !
!Editor class methodsFor: 'cached state access' stamp: 'jmv 6/11/2024 09:57:01' prior: 16852644 overrides: 16789255!
         releaseClassCachedState

	shortcuts := nil.! !
!TextEditor class methodsFor: 'cached state access' stamp: 'jmv 6/11/2024 09:57:09' prior: 16982044 overrides: 50360902!
                        releaseClassCachedState

	FindText := nil.
	ChangeText := nil.
	"We are not calling super to avoid cleansing class vars many times.
	So, repeat inherited class instVars!!"
	shortcuts := nil.! !
!SmalltalkEditor class methodsFor: 'cached state access' stamp: 'jmv 6/11/2024 09:57:05' prior: 16955253 overrides: 50360908!
releaseClassCachedState

	"We are not calling super to avoid cleansing class vars many times.
	So, repeat inherited class instVars!!"
	shortcuts := nil.! !

SmalltalkEditor class removeSelector: #cmdShortcutsSpec!

!methodRemoval: SmalltalkEditor class #cmdShortcutsSpec stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cmdShortcutsSpec
	"
	Editor initialize
	"
	"arranged in QWERTY keyboard order"
	self flag: #definesKeyboardShortcuts.
	^#(
		#(		$0 	changeEmphasis:							'Normal')
		#(		$1 	changeEmphasis:							'Bold')
		#(		$2 	changeEmphasis:							'Italic')
		#(		$3 	changeEmphasis:							'Underline')
		#(		$4 	changeEmphasis:							'Strikeout')
		#(		$5 	changeEmphasis:							'Superscript')
		#(		$6 	changeEmphasis:							'Subscript')
		#(		$8	#offerColorMenu:							'Change color')
	
		#(		$e	#methodSourceContainingIt:							'Method source containing it')
		#(		$r	#acceptAndDebugTest:							'Saves method and debugs it')
		#(		$t	#acceptAndTest:							'Saves method, runs it as test and then all tests in class. Opens debugger if error')
		#(		$y	#acceptAndTestAll:							'Saves method, runs it as test and then all tests in class category. Opens debugger if error')
		#(		$u	#align:							'Toggle alignment')
		#(		$i	#inspectIt:							'Inspect it (selection is a valid expression, or selection is over an inspect-ilst)')
		#(		$p	#printIt:							'Print it (selection is a valid expression)')

		#(		$d	#doIt:							'Do it (selection is a valid expression)')
		#(		$k	#offerFontMenu:							'Set font')
		#(		$l	#cancel:							'Cancel all edits')

		#(		$b	#browseIt:							'Browse it (selection is a class name or cursor is over a class-list or message-list)')
		#(		$n	#sendersOfIt:							'Senders of it (selection is a message selector or cursor is over a class-list or message-list)')
		#(		$m	#implementorsOfIt:							'Implementors of it (selection is a message selector or cursor is over a class-list or message-list)')

		#(		$Q	#argPrev:							'Previous argument')
		#(		$W	#argNext:							'Next argument')
		#(		$E	#methodStringsContainingIt:							'Method strings containing it')
		#(		$I	#exploreIt:							'Inspect via Object Explorer')

		#(		$D	#debugIt:							'Debug it')

		#(		$N	#referencesToIt:							'References to it (selection is a class name, or cursor is over a class-list or message-list)')
	)!

SmalltalkEditor removeSelector: #exploreIt:!

!methodRemoval: SmalltalkEditor #exploreIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
exploreIt: aKeyboardEvent
	"Explore the selection -- invoked via cmd-shift-I.  If there is no current selection, use the current line."

	self exploreIt.
	^ true!

SmalltalkEditor removeSelector: #printIt:!

!methodRemoval: SmalltalkEditor #printIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
printIt: aKeyboardEvent
	"Print the results of evaluting the selection -- invoked via cmd-p.  If there is no current selection, use the current line.  1/17/96 sw
	 2/29/96 sw: don't call selectLine now, since it's called by doIt"

	self printIt.
	^ true!

SmalltalkEditor removeSelector: #extractToTemporary:!

!methodRemoval: SmalltalkEditor #extractToTemporary: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
extractToTemporary: aKeyboardEvent

	self extractToTemporary.
	^true!

SmalltalkEditor removeSelector: #browseIt:!

!methodRemoval: SmalltalkEditor #browseIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
browseIt: aKeyboardEvent
	"Triggered by Cmd-B; browse the thing represented by the current selection, if plausible.  1/18/96 sw"

	self browseIt.
	^ true!

SmalltalkEditor removeSelector: #methodStringsContainingIt:!

!methodRemoval: SmalltalkEditor #methodStringsContainingIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
methodStringsContainingIt: aKeyboardEvent
	"Triggered by Cmd-E"

	self methodStringsContainingIt.
	^ true!

SmalltalkEditor removeSelector: #temporaryToInstanceVariable:!

!methodRemoval: SmalltalkEditor #temporaryToInstanceVariable: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
temporaryToInstanceVariable: aKeyboardEvent

	self temporaryToInstanceVariable.

	^true.!

SmalltalkEditor removeSelector: #contextualInlineMethod:!

!methodRemoval: SmalltalkEditor #contextualInlineMethod: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
contextualInlineMethod: aKeyboardEvent

	self contextualInlineMethod.
	^true.

	!

SmalltalkEditor removeSelector: #enclose:!

!methodRemoval: SmalltalkEditor #enclose: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
enclose: aKeyboardEvent
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	| startIndex stopIndex oldSelection new enlargedBy |
	"This implementation is only for commenting and uncommenting code.
	Other cases are handled by the super implementation.
	This implementation only handles String and discards Text attributes."
	aKeyboardEvent keyCharacter = $" ifFalse: [
		^super enclose: aKeyboardEvent ].

	startIndex := self startIndex.
	stopIndex := self stopIndex.
	oldSelection := self selection string.
	((startIndex > 1 and: [stopIndex <= model textSize])
			and: [ (model actualContents at: startIndex-1) = $"
				and: [(model actualContents at: stopIndex) = $"]])
		ifTrue: [
			"already enclosed in double colons; make selection no longer a comment"
			self selectFrom: startIndex-1 to: stopIndex.
			self replaceSelectionWith: oldSelection withDoubleColonsUndoubled ]
		ifFalse: [
			"not enclosed in double colons; make selection a comment"
			new := oldSelection withDoubleColonsDoubled.
			enlargedBy := new size - oldSelection size.
			self replaceSelectionWith: $" asString, new, $" asString.
			self selectFrom: startIndex+1 to: stopIndex + enlargedBy ].
	^ true.!

SmalltalkEditor removeSelector: #displayIfFalse:!

!methodRemoval: SmalltalkEditor #displayIfFalse: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
displayIfFalse: aKeyboardEvent
	"Replace the current text selection with the text 'ifFalse:'--initiated by 
	cmd-F."

	self addString: 'ifFalse:'.
	^false!

SmalltalkEditor removeSelector: #contextualRemoveParameter:!

!methodRemoval: SmalltalkEditor #contextualRemoveParameter: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
contextualRemoveParameter: aKeyboardEvent 
	
	self contextualRemoveParameter.
	^true!

SmalltalkEditor removeSelector: #debugIt:!

!methodRemoval: SmalltalkEditor #debugIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
debugIt: aKeyboardEvent

	self debugIt.
	^true!

SmalltalkEditor removeSelector: #implementorsOfIt:!

!methodRemoval: SmalltalkEditor #implementorsOfIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
implementorsOfIt: aKeyboardEvent
	"Triggered by Cmd-m; browse implementors of the selector represented by the current selection, if plausible. 2/1/96 sw"

	self implementorsOfIt.
	^ true!

SmalltalkEditor removeSelector: #inspectIt:!

!methodRemoval: SmalltalkEditor #inspectIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
inspectIt: aKeyboardEvent
	"Inspect the selection -- invoked via cmd-i.  If there is no current selection, use the current line.  1/17/96 sw
	 2/29/96 sw: don't call selectLine; it's done by inspectIt now"

	self inspectIt.
	^ true!

SmalltalkEditor removeSelector: #methodSourceContainingIt:!

!methodRemoval: SmalltalkEditor #methodSourceContainingIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
methodSourceContainingIt: aKeyboardEvent
	"Triggered by Cmd-e"

	self methodSourceContainingIt.
	^ true!

SmalltalkEditor removeSelector: #pasteInitials:!

!methodRemoval: SmalltalkEditor #pasteInitials: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
pasteInitials: aKeyboardEvent 
	"Replace the current text selection by an authorship name/date stamp; invoked by cmd-shift-v, easy way to put an authorship stamp in the comments of an editor."
	"This is a user command, and generates undo"

	| i |
	i := self stopIndex.
	self replaceSelectionWith: (Text fromString: Utilities changeStamp).
	self deselectAndPlaceCursorAt: i.
	^ true!

SmalltalkEditor removeSelector: #referencesToIt:!

!methodRemoval: SmalltalkEditor #referencesToIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
referencesToIt: aKeyboardEvent
	"Triggered by Cmd-N; browse references to the current selection"

	self referencesToIt.
	^ true!

SmalltalkEditor removeSelector: #contextualExtractAsParameter:!

!methodRemoval: SmalltalkEditor #contextualExtractAsParameter: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
contextualExtractAsParameter: aKeyboardEvent 
	
	self contextualExtractAsParameter.
	^true!

SmalltalkEditor removeSelector: #argNext:!

!methodRemoval: SmalltalkEditor #argNext: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
argNext: aKeyboardEvent
	"Invoked by cmd-A.
	 Search forward from the end of the selection for a colon followed by
		a space.  Place the text cursor after the space.  If none are found, place the
		text cursor at the end of the text.."

	| start t |
	t := model actualContents.
	start := t findString: ': ' startingAt: self startIndex.
	start = 0 ifTrue: [ start := t size + 1].
	self deselectAndPlaceCursorAt: start + 2.
	^true!

SmalltalkEditor removeSelector: #fileItIn:!

!methodRemoval: SmalltalkEditor #fileItIn: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
fileItIn: aKeyboardEvent
	"File in the selection; invoked via a keyboard shortcut, -- for now, cmd-shift-G."

	self fileItIn.
	^ true!

SmalltalkEditor removeSelector: #argPrev:!

!methodRemoval: SmalltalkEditor #argPrev: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
argPrev: aKeyboardEvent
	"Invoked by cmd-Q.
	 Search backwards from the start of the selection for a colon followed by
		a space.  Place the text cursor after the space.  If none are found, place the
		text cursor at the start of the text.."

	| t i |
	t := model actualContents.
	i := self stopIndex.
	i > 1 ifTrue: [
		i := i -2.
		[i > 0 and: [ (t at: i) ~= $  or: [(t at: i-1) ~= $: ]]] whileTrue: [
			i := i -1 ].
		self deselectAndPlaceCursorAt: i + 1.
	].
	^true!

SmalltalkEditor removeSelector: #contextualAddParameter:!

!methodRemoval: SmalltalkEditor #contextualAddParameter: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
contextualAddParameter: aKeyboardEvent 
	
	self contextualAddParameter.
	^true!

SmalltalkEditor removeSelector: #extractMethod:!

!methodRemoval: SmalltalkEditor #extractMethod: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
extractMethod: aKeyboardEvent

	self extractMethod.
	^true!

SmalltalkEditor removeSelector: #inlineTemporaryVariable:!

!methodRemoval: SmalltalkEditor #inlineTemporaryVariable: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
inlineTemporaryVariable: aKeyboardEvent

	self inlineTemporaryVariable.
	^true!

SmalltalkEditor removeSelector: #displayIfTrue:!

!methodRemoval: SmalltalkEditor #displayIfTrue: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
displayIfTrue: aKeyboardEvent
	"Replace the current text selection with the text 'ifTrue:'--initiated by 
	cmd-T."

	self addString: 'ifTrue:'.
	^false!

SmalltalkEditor removeSelector: #acceptAndDebugTest:!

!methodRemoval: SmalltalkEditor #acceptAndDebugTest: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
acceptAndDebugTest: aKeyboardEvent 
	
	^self acceptAndDebugTest !

SmalltalkEditor removeSelector: #openMenu:!

!methodRemoval: SmalltalkEditor #openMenu: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
openMenu: aMenu
	
	aMenu popUpInWorld: morph world!

SmalltalkEditor removeSelector: #sendersOfIt:!

!methodRemoval: SmalltalkEditor #sendersOfIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
sendersOfIt: aKeyboardEvent
	"Triggered by Cmd-n; browse implementors of the selector represented by the current selection, if plausible. 2/1/96 sw"

	self sendersOfIt.
	^ true!

SmalltalkEditor removeSelector: #doIt:!

!methodRemoval: SmalltalkEditor #doIt: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
doIt: aKeyboardEvent
	"Called when user hits cmd-d.  Select the current line, if relevant, then evaluate and execute.  2/1/96 sw.
	2/29/96 sw: don't call selectLine; it's done by doIt now"

	self doIt.
	^ true!

SmalltalkEditor removeSelector: #acceptAndTestAll:!

!methodRemoval: SmalltalkEditor #acceptAndTestAll: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
acceptAndTestAll: aKeyboardEvent

	^self acceptAndTestAll!

SmalltalkEditor removeSelector: #cancel:!

!methodRemoval: SmalltalkEditor #cancel: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cancel: aKeyboardEvent
	"Cancel all edits done. Revert to saved version."

	model refetch.
	^ true!

SmalltalkEditor removeSelector: #contextualRename:!

!methodRemoval: SmalltalkEditor #contextualRename: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
contextualRename: aKeyboardEvent

	self contextualRename.
	^true!

SmalltalkEditor removeSelector: #acceptAndTest:!

!methodRemoval: SmalltalkEditor #acceptAndTest: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
acceptAndTest: aKeyboardEvent

	^self acceptAndTest!

TextEditor class removeSelector: #cmdShortcutsSpec!

!methodRemoval: TextEditor class #cmdShortcutsSpec stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cmdShortcutsSpec
	"
	Editor initialize
	"
	"arranged in QWERTY keyboard order"
	self flag: #definesKeyboardShortcuts.
	^#(
		#(		$0 	changeEmphasis:			'Normal')
		#(		$1 	changeEmphasis:			'Bold')
		#(		$2 	changeEmphasis:			'Italic')
		#(		$3 	changeEmphasis:			'Underline')
		#(		$4 	changeEmphasis:			'Strikeout')
		#(		$5 	changeEmphasis:			'Superscript')
		#(		$6 	changeEmphasis:			'Subscript')
		#(		$8	#offerColorMenu:		'Change color')

		#(		$u	#align:				'Toggle alignment')

		#(		$k	#offerFontMenu:			'Set font')
	)!

TextEditor class removeSelector: #basicCmdShortcutsSpec!

!methodRemoval: TextEditor class #basicCmdShortcutsSpec stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
basicCmdShortcutsSpec
	"
	Editor initialize
	"

	"arranged in QWERTY keyboard order"
	self flag: #definesKeyboardShortcuts.
	^#(
		#(		$( 	#enclose:					'Enclose within ( and ), or remove enclosing ( and )')
		#(		$[ 	#enclose:					'Enclose within [ and ], or remove enclosing [ and ]')
		#(		${ 	#enclose:					'Enclose within { and }, or remove enclosing { and }')
		#(		$' 	#enclose:					'Enclose within single quotes, or remove enclosing single quotes')
		#(		$" 	#enclose:					'Enclose within double quotes, or remove enclosing double quotes')
		#(		$` 	#enclose:					'Enclose within backticks, or remove enclosing backticks')
		#(		$< 	#enclose:					'Enclose within < and >, or remove enclosing < and >')

		#(		$a 	#selectAll:					'Select all')
		#(		$s 	#save:					'Save')
		#(		$f 	#find:					'Find')
		#(		$g 	#findAgain:					'Find again')
		#(		$h 	#help:					'Open this help')
		#(		$j 	#setSearchString:					'Set selection as search string for find again')

		#(		$z 	#undo:					'Undo (multiple levels)')
		#(		$x 	#cut:					'Cut selection and store it in the Clipboard')
		#(		$c 	#copySelection:					'Copy selection to the Clipboard')
		#(		$v 	#paste:					'Paste Clipboard contents')

		#(		$U	#changeLineEndsToLf:		'Convert line endings to LF characters (Cuis convention) in selection')

		#(		$H	#cursorTopHome:					'Move cursor to start of text')

		#(		$Z	#redo:					'Redo (multiple levels)')
		#(		$C	#compareToClipboard:		'Compare argument to clipboard')
	)!

TextEditor removeSelector: #makeUppercase:!

!methodRemoval: TextEditor #makeUppercase: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
makeUppercase: aKeyboardEvent
	"Force the current selection to uppercase.  Triggered by Cmd-Y."
	"This is a user command, and generates undo"

	self replaceSelectionWith: self selectedString asUppercase.
	^ true!

TextEditor removeSelector: #undo:!

!methodRemoval: TextEditor #undo: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
undo: aKeyboardEvent 
	"Undo the last edit."

	self undo.
	^true!

TextEditor removeSelector: #makeCapitalized:!

!methodRemoval: TextEditor #makeCapitalized: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
makeCapitalized: aKeyboardEvent
	"Force the current selection to uppercase.  Triggered by Cmd-X."
	"This is a user command, and generates undo"

	| prev |
	prev := $-.  "not a letter"
	self replaceSelectionWith: 
		(self selectedString collect:
			[:c | prev := prev isLetter ifTrue: [c asLowercase] ifFalse: [c asUppercase]]).
	^ true!

TextEditor removeSelector: #save:!

!methodRemoval: TextEditor #save: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
save: aKeyboardEvent
	"Submit the current text.  Equivalent to 'accept' 1/18/96 sw"

	self acceptContents.
	^ true!

TextEditor removeSelector: #offerFontMenu:!

!methodRemoval: TextEditor #offerFontMenu: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
offerFontMenu: aKeyboardEvent 
	"The user typed the command key that requests a font change; Offer the font menu.  5/27/96 sw"

	self offerFontMenu.
	^ true!

TextEditor removeSelector: #makeLowercase:!

!methodRemoval: TextEditor #makeLowercase: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
makeLowercase: aKeyboardEvent
	"Force the current selection to lowercase.  Triggered by Cmd-X."
	"This is a user command, and generates undo"

	self replaceSelectionWith: self selectedString asLowercase.
	^ true!

TextEditor removeSelector: #help:!

!methodRemoval: TextEditor #help: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
help: aKeyboardEvent
	"Show a help screen"

	self openHelp.
	^ true!

TextEditor removeSelector: #enclose:!

!methodRemoval: TextEditor #enclose: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
enclose: aKeyboardEvent
	"Insert or remove bracket characters around the current selection."
	"This is a user command, and generates undo"

	| left right startIndex stopIndex oldSelection which |
	startIndex := self startIndex.
	stopIndex := self stopIndex.
	oldSelection := self selection.
	which := '([<{"''`' indexOf: aKeyboardEvent keyCharacter ifAbsent: [ ^true ].
	left := '([<{"''`' at: which.
	right := ')]>}"''`' at: which.
	((startIndex > 1 and: [stopIndex <= model textSize])
			and: [ (model actualContents at: startIndex-1) = left
				and: [(model actualContents at: stopIndex) = right]])
		ifTrue: [
			"already enclosed; strip off brackets"
			self selectFrom: startIndex-1 to: stopIndex.
			self replaceSelectionWith: oldSelection]
		ifFalse: [
			"not enclosed; enclose by matching brackets"
			self replaceSelectionWith:
				(Text string: (UnicodeString with: left) attributes: emphasisHere),
				oldSelection,
				(Text string: (UnicodeString with: right) attributes: emphasisHere).
			self selectFrom: startIndex+1 to: stopIndex].
	^ true.!

TextEditor removeSelector: #compareToClipboard:!

!methodRemoval: TextEditor #compareToClipboard: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
compareToClipboard: aKeyboardEvent
	"Compare the receiver to the text on the clipboard."

	self compareToClipboard.
	^ true!

TextEditor removeSelector: #findAgain:!

!methodRemoval: TextEditor #findAgain: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
findAgain: aKeyboardEvent 
	"Find the desired text again.  1/24/96 sw"

	self findAgain.
	^ true!

TextEditor removeSelector: #offerColorMenu:!

!methodRemoval: TextEditor #offerColorMenu: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
offerColorMenu: aKeyboardEvent 
	"The user typed the command key that requests a font change; Offer the color menu."

	self offerColorMenu.
	^ true!

TextEditor removeSelector: #changeLineEndsToLf:!

!methodRemoval: TextEditor #changeLineEndsToLf: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
changeLineEndsToLf: aKeyboardEvent
	"Replace all CRs and CrLfs by LFs.
	Triggered by Cmd-U -- useful when getting code from FTP sites"
	"This is a user command, and generates undo"
	
	self replaceSelectionWith: self selectedString withCuisLineEndings.
	^ true!

TextEditor removeSelector: #redo:!

!methodRemoval: TextEditor #redo: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
redo: aKeyboardEvent 
	"Redo the last edit."

	self redo.
	^true!

TextEditor removeSelector: #align!

!methodRemoval: TextEditor #align stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
align
	"Align text according to the next greater alignment value,
	cycling among leftFlush, rightFlush, center, and justified."
	self chooseAlignment!

TextEditor removeSelector: #setSearchString:!

!methodRemoval: TextEditor #setSearchString: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
setSearchString: aKeyboardEvent
	"Establish the current selection as the current search string."

	| aString |
	self lineSelectAndEmptyCheck: [^ true].
	aString :=  self selectedString.
	aString isEmpty
		ifTrue: [ self flash ]
		ifFalse: [ self setSearch: aString ].
	^ true!

TextEditor removeSelector: #find:!

!methodRemoval: TextEditor #find: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
find: aKeyboardEvent
	"Prompt the user for what to find, then find it, searching from the current selection onward.  1/24/96 sw"

	self find.
	^ true!

TextEditor removeSelector: #align:!

!methodRemoval: TextEditor #align: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
align: aKeyboardEvent
	"Triggered by Cmd-u;  cycle through alignment alternatives.  8/11/96 sw"

	self align.
	^ true!

TextEditor removeSelector: #changeEmphasis:!

!methodRemoval: TextEditor #changeEmphasis: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
changeEmphasis: aKeyboardEvent
	"Change the emphasis of the current selection or prepare to accept characters with the change in emphasis."
	"control 0..9 -> 0..9"
	"This is a user command, and generates undo"

	| keyCode attributeToAdd attributesToRemove oldAttributes |
	keyCode := ('0123456'
		indexOf: aKeyboardEvent keyCharacter
		ifAbsent: [ 1 ]) - 1.
	oldAttributes := emphasisHere.

	keyCode = 0
		ifTrue: [
			"Remove all TextEmphasis"
			attributeToAdd := nil.
			attributesToRemove := oldAttributes ]
		ifFalse: [
			"Toggle the indicated TextEmphasis"
			(keyCode between: 1 and: 6) ifTrue: [
				attributeToAdd := TextEmphasis perform: (
					#(#bold #italic #underlined #struckThrough #superscript #subscript)
						at: keyCode).
				oldAttributes do: [ :oldAtt |
					oldAtt = attributeToAdd ifTrue: [
						attributeToAdd := nil.
						attributesToRemove := {oldAtt} ]]]].

	attributeToAdd ifNotNil: [ self applyAttribute: attributeToAdd ].
	attributesToRemove ifNotNil: [ self unapplyAttributes: attributesToRemove ].
	^ true!

Editor class removeSelector: #formatShortcutsUsingModifierKey:andSpecs:!

!methodRemoval: Editor class #formatShortcutsUsingModifierKey:andSpecs: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
formatShortcutsUsingModifierKey: aModifierKey andSpecs: aSpecs
	"Format shortcuts specs with a modifier key"
	^ String streamContents: [ :strm |
		aSpecs do: [ :triplet | | c |
			c := triplet first = Character space
				ifFalse: [ triplet first asString, '   	' ]
				ifTrue: [ 'Space'].
			strm nextPutAll: (aModifierKey, '-', c, String tab, String tab, triplet third).
			strm newLine ]]!

Editor class removeSelector: #allCmdShortcutsSpec!

!methodRemoval: Editor class #allCmdShortcutsSpec stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
allCmdShortcutsSpec

	^ (self collectCmdShortcutsSpecUsing: #basicCmdShortcutsSpec), (self collectCmdShortcutsSpecUsing: #cmdShortcutsSpec)!

Editor class removeSelector: #basicInitialize!

!methodRemoval: Editor class #basicInitialize stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
basicInitialize
	"
	Editor initialize
	"
	self withAllSubclassesDo: [ :c | c initializeShortcuts; initializeCmdShortcuts ]!

Editor class removeSelector: #cmdShortcutsSpec!

!methodRemoval: Editor class #cmdShortcutsSpec stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cmdShortcutsSpec

	^#()!

Editor class removeSelector: #cmdShortcuts!

!methodRemoval: Editor class #cmdShortcuts stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cmdShortcuts
	"Same for all instances.
	A subclass could handle specific keyboard shortcuts for each instance, though."
	
	cmdShortcuts ifNil: [self initializeCmdShortcuts ].
	
	^cmdShortcuts!

Editor class removeSelector: #help!

!methodRemoval: Editor class #help stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
help
	"
	TextEditor help edit
	SmalltalkEditor help edit
	"
	^ (self formatShortcutsUsingModifierKey: 'Shift' andSpecs: self allShiftShortcutsSpec) ,
		(self formatShortcutsUsingModifierKey: 'Cmd' andSpecs: self allCmdShortcutsSpec).
!

Editor class removeSelector: #collectCmdShortcutsSpecUsing:!

!methodRemoval: Editor class #collectCmdShortcutsSpecUsing: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
collectCmdShortcutsSpecUsing: anInitializationMessage

	| shortcutsSpec dynamicInitializationMessage |
	
	shortcutsSpec := self perform: anInitializationMessage.

	dynamicInitializationMessage := (self name asPlainString uncapitalized, anInitializationMessage asPlainString capitalized) asSymbol.
	(Smalltalk allClassesImplementing: dynamicInitializationMessage) do: [ :aClass | 
		shortcutsSpec := shortcutsSpec, (aClass soleInstance perform: dynamicInitializationMessage) ].

	^shortcutsSpec

!

Editor class removeSelector: #putIntoCmdShortcuts:!

!methodRemoval: Editor class #putIntoCmdShortcuts: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
putIntoCmdShortcuts: shortcutsSpec

	shortcutsSpec do: [ :ary | | i previous |
		i := ary first codePoint + 1.
		previous := cmdShortcuts at: i.
		previous = #noop:
			ifTrue: [
				cmdShortcuts at: i put: ary second ]
			ifFalse: [ 
				('Editor shortcut: ', ary first printString, ' already taken for: ', previous, 
				'. Override request for: ', ary second, '  ignored') print ]].!

Editor class removeSelector: #basicCmdShortcutsSpec!

!methodRemoval: Editor class #basicCmdShortcutsSpec stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
basicCmdShortcutsSpec

	^#()!

Editor class removeSelector: #initializeCmdShortcuts!

!methodRemoval: Editor class #initializeCmdShortcuts stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
initializeCmdShortcuts
	"Initialize the (unshifted) command-key (or alt-key if not on Mac) shortcut table.
	If you want to add a new shortcut for an specific editor, for example SmalltalkEditor, you should
	define the message #smalltalkEditorCmdShortcutsSpec in a class of your category and it will
	be dynamically send"

	"NOTE: if you don't know what your keyboard generates, use Sensor test"

	"
	Editor initialize
	"

	cmdShortcuts := Array new: 256 withAll: #noop:.

	self putIntoCmdShortcuts: self allCmdShortcutsSpec
!

Editor removeSelector: #selectAll:!

!methodRemoval: Editor #selectAll: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
selectAll: aKeyboardEvent 
	"select everything, invoked by cmd-a.  1/17/96 sw"

	self selectAll.
	^ true!

Editor removeSelector: #selectWord:!

!methodRemoval: Editor #selectWord: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
selectWord: aKeyboardEvent

	self selectWord.
	^ true!

Editor removeSelector: #cmdShortcuts!

!methodRemoval: Editor #cmdShortcuts stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cmdShortcuts
	"Same for all instances.
	A subclass could handle specific keyboard shortcuts for each instance, though."
	^self class cmdShortcuts!

Editor removeSelector: #paste:!

!methodRemoval: Editor #paste: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
paste: aKeyboardEvent 
	"Replace the current text selection by the text in the shared buffer."

	self paste.
	^true!

Editor removeSelector: #cut:!

!methodRemoval: Editor #cut: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cut: aKeyboardEvent 
	"Cut out the current text selection."

	self cut.
	^true!

Editor removeSelector: #cursorTopHome:!

!methodRemoval: Editor #cursorTopHome: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
cursorTopHome: aKeyboardEvent
	"Put cursor at beginning of text -- invoked from cmd-H shortcut, useful for keyboards that have no home key."

	self deselectAndPlaceCursorAt: 1.
	^ true!

Editor removeSelector: #copySelection:!

!methodRemoval: Editor #copySelection: stamp: 'Install-6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st 8/13/2024 18:36:55'!
copySelection: aKeyboardEvent
	"Copy the current text selection."

	self copySelection.
	^true!

Editor initialize!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6557-TextEditor-cleanup-JuanVuletich-2024Jun11-09h35m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6461] on 11 June 2024 at 10:31:04 am'!

Editor class
	instanceVariableNames: 'shortcuts cmdShortcuts keyboardActions '!

!classDefinition: 'Editor class' category: #'System-Text' stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
Editor class
	instanceVariableNames: 'shortcuts cmdShortcuts keyboardActions'!
!Editor methodsFor: 'typing support' stamp: 'jmv 6/10/2024 19:40:43'!
     keyboardActions
	"Same for all instances.
	A subclass could handle specific keyboard actions for each instance, though."
	^self class keyboardActions! !
!Editor class methodsFor: 'class initialization' stamp: 'jmv 6/10/2024 19:39:12'!
                     initializeKeyboardActions
	"Initialize the table for regular (i.e. non-command) keystroke dispatch"
	"
	self initializeKeyboardActions
	"
	| actions |
	actions := Array new: 256 withAll: #normalCharacter:.
	0 to: 31 do: [ :i | actions at: i+1 put: #noop: ].
	actions at: 1 + 1 put: #cursorHome:.				"home key"
	actions at: 3 + 1 put: #enter:.						"enter / return key"
	actions at: 4 + 1 put: #cursorEnd:.				"end key"
	actions at: 5 + 1 put: #noop:.						"insert key"
	actions at: 8 + 1 put: #backspace:.				"macDelete winBackspace key"
	actions at: 9 + 1 put: #normalCharacter:.		"tab"
	actions at: 11 + 1 put: #cursorPageUp:.			"page up key"
	actions at: 12 + 1 put: #cursorPageDown:.		"page down key"
	actions
		at:  InputSensor returnKey + 1
		put: #returnKey:.									"return (sometimes labelled enter) key"
	actions at: 27 + 1 put: #offerMenuFromEsc:.	"escape key"
	actions at: 28 + 1 put: #cursorLeft:.				"left arrow key"
	actions at: 29 + 1 put: #cursorRight:.				"right arrow key"
	actions at: 30 + 1 put: #cursorUp:.				"up arrow key"
	actions at: 31 + 1 put: #cursorDown:.			"down arrow key"
	actions at: 127 + 1 put: #forwardDelete:.		"winDelete key"
	keyboardActions := actions! !
!Editor class methodsFor: 'keyboard shortcut tables' stamp: 'jmv 6/11/2024 10:28:08'!
                             keyboardActions
	"Same for all instances.
	A subclass could handle specific keyboard actions for each instance, though."
	
	keyboardActions ifNil: [ self initializeKeyboardActions ].
	^keyboardActions! !
!TextEditor class methodsFor: 'class initialization' stamp: 'jmv 6/10/2024 19:39:06' overrides: 50361946!
          initializeKeyboardActions
	
	super initializeKeyboardActions.
	keyboardActions at: 9 + 1 put: #tabKey:.! !
!SystemDictionary methodsFor: 'shrinking' stamp: 'jmv 6/11/2024 10:24:41' prior: 50360834!
                          presumedSentMessages
	| sent |
	"
	In addition to those here, if it is desired to preserve some methods from deletion, see #nominallyUnsent:
	Smalltalk presumedSentMessages
	"

	"The following should be preserved for doIts, etc"
	sent := IdentitySet new.
	#( rehashWithoutBecome
		browseAllSelect:  lastRemoval
		vScrollBarValue: hScrollBarValue: 
		to: removeClassNamed:
		dragon: hilberts: mandala: web test3 factorial tinyBenchmarks benchFib
		newDepth: restoreAfter: zapAllMethods obsoleteClasses
		removeAllUnSentMessages abandonSources removeUnreferencedKeys
		zapOrganization condenseSources condenseChanges browseObsoleteReferences
		subclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		methodsFor:stamp: methodsFor:stamp:prior: instanceVariableNames:
		startTimerEventLoop unusedClasses allClasses
		unimplemented
		reduceCuis
		variableSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		variableByteSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		variableWordSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		weakSubclass:instanceVariableNames:classVariableNames:poolDictionaries:category:
		printSpaceAnalysis:on:) do: [ :sel |
			sent add: sel].
	"The following may be sent by perform: in dispatchOnChar..."
	Editor withAllSubclassesDo: [ :c |
		c keyboardActions asSet do: [ :sel | sent add: sel ].
		c new defaultMenuSpec do: [ :spec |
			spec size >= 5 ifTrue: [
				spec fifth isSymbol ifTrue: [ sent add: spec fifth ]]]].
	#(beReadOnlyBinding beReadWriteBinding) do: [ :sel |
		sent add: sel].
	AppLauncher appSelector ifNotNil: [ :sel |
		sent add: sel ].
	^ sent! !
!Editor class methodsFor: 'class initialization' stamp: 'jmv 6/11/2024 10:26:28' prior: 50360895 overrides: 16916245!
       initialize
	"
	Editor initialize
	"
	self withAllSubclassesDo: [ :c | c initializeKeyboardActions ].! !
!Editor class methodsFor: 'cached state access' stamp: 'jmv 6/10/2024 19:41:53' prior: 50360902 overrides: 16789255!
   releaseClassCachedState

	keyboardActions := nil.! !
!TextEditor methodsFor: 'typing support' stamp: 'jmv 6/10/2024 19:41:16' prior: 50360355!
                 dispatchOn: aKeyboardEvent
	"Carry out the action associated with this character, if any."

	| codePoint asciiValue c |
	self clearParens.
  	codePoint := aKeyboardEvent keyValue.
	
	codePoint > 255 ifTrue: [
		^self normalCharacter: aKeyboardEvent ].

	c := aKeyboardEvent keyCharacter.
	(')]}' includes: c)
		ifTrue: [ self blinkPrevParen: c ].

	asciiValue := codePoint.
	^ self perform: (self keyboardActions at: asciiValue + 1) with: aKeyboardEvent.! !
!TextEditor class methodsFor: 'cached state access' stamp: 'jmv 6/10/2024 19:42:01' prior: 50360908 overrides: 50362068!
                             releaseClassCachedState

	FindText := nil.
	ChangeText := nil.
	"We are not calling super to avoid cleansing class vars many times.
	So, repeat inherited class instVars!!"
	keyboardActions := nil.! !
!SmalltalkEditor class methodsFor: 'cached state access' stamp: 'jmv 6/10/2024 19:41:57' prior: 50360918 overrides: 50362092!
                          releaseClassCachedState

	"We are not calling super to avoid cleansing class vars many times.
	So, repeat inherited class instVars!!"
	keyboardActions := nil.! !

SmalltalkEditor removeSelector: #createMenuCollectingOptionsWith:!

!methodRemoval: SmalltalkEditor #createMenuCollectingOptionsWith: stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
createMenuCollectingOptionsWith: aMenuOptionsSelector
	
	^(DynamicMenuBuilder buildTitled: self class name targeting: self collectingMenuOptionsWith: aMenuOptionsSelector)
		addStayUpIcons;
		yourself
		
!

TextEditor class removeSelector: #initializeShortcuts!

!methodRemoval: TextEditor class #initializeShortcuts stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
initializeShortcuts
	
	super initializeShortcuts.
	shortcuts at: 9 + 1 put: #tabKey:.!

Editor class removeSelector: #shortcuts!

!methodRemoval: Editor class #shortcuts stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
shortcuts
	"Same for all instances.
	A subclass could handle specific keyboard shortcuts for each instance, though."
	
	shortcuts ifNil: [ self initializeShortcuts ].
	
	^shortcuts!

Editor class removeSelector: #initializeShortcuts!

!methodRemoval: Editor class #initializeShortcuts stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
initializeShortcuts
	"Initialize the table for regular (i.e. non-command) keystroke dispatch"
	"
	self initializeShortcuts
	"
	| actions |
	actions := Array new: 256 withAll: #normalCharacter:.
	0 to: 31 do: [ :i | actions at: i+1 put: #noop: ].
	actions at: 1 + 1 put: #cursorHome:.				"home key"
	actions at: 3 + 1 put: #enter:.						"enter / return key"
	actions at: 4 + 1 put: #cursorEnd:.				"end key"
	actions at: 5 + 1 put: #noop:.						"insert key"
	actions at: 8 + 1 put: #backspace:.				"macDelete winBackspace key"
	actions at: 9 + 1 put: #normalCharacter:.		"tab"
	actions at: 11 + 1 put: #cursorPageUp:.			"page up key"
	actions at: 12 + 1 put: #cursorPageDown:.		"page down key"
	actions
		at:  InputSensor returnKey + 1
		put: #returnKey:.									"return (sometimes labelled enter) key"
	actions at: 27 + 1 put: #offerMenuFromEsc:.	"escape key"
	actions at: 28 + 1 put: #cursorLeft:.				"left arrow key"
	actions at: 29 + 1 put: #cursorRight:.				"right arrow key"
	actions at: 30 + 1 put: #cursorUp:.				"up arrow key"
	actions at: 31 + 1 put: #cursorDown:.			"down arrow key"
	actions at: 127 + 1 put: #forwardDelete:.		"winDelete key"
	shortcuts := actions!

Editor removeSelector: #shortcuts!

!methodRemoval: Editor #shortcuts stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
shortcuts
	"Same for all instances.
	A subclass could handle specific keyboard shortcuts for each instance, though."
	^self class shortcuts!

Editor initialize!

Editor class
	instanceVariableNames: 'keyboardActions'!

!classDefinition: 'Editor class' category: #'System-Text' stamp: 'Install-6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st 8/13/2024 18:36:55'!
Editor class
	instanceVariableNames: 'keyboardActions'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6558-TextEditor-shortcuts-renameAs-keyboardActions-JuanVuletich-2024Jun11-10h21m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6552] on 31 July 2024 at 11:30:46 am'!
!Editor methodsFor: 'menu & kbd shortcuts' stamp: 'jmv 7/29/2024 16:00:01'!
                               editorClassesInHierarchyOrderDo: aBlock
	"maybe name differently"
	(self class withAllSuperclassesUpTo: Editor) reverseDo: aBlock! !
!InnerTextMorph methodsFor: 'menu' stamp: 'jmv 7/31/2024 11:30:11' prior: 50359138 overrides: 50348229!
                   menuNshortcutsSpecsDo: aBlock
	"Subclasses may implement specific ways of providing menu items and
	keyboard shortcuts for themselves.
	See implementors."

	"First take default editor menu and shortcut specs"
	self editor defaultMenuSpec do: aBlock.

	self window ifNotNil: [ :window |
		"Then include additions, overrides and deletions registered for #Editor, #TextEditor, #SmalltalkEditor, etc.
		Hierarchy order allows more specific classes to override choices made by superclasses."
		self editor editorClassesInHierarchyOrderDo: [ :editorClass |
			(window class registeredMenuAndShortcutsSpecProviders: editorClass name) ifNotNil: [ :providers |
				providers do: [ :eachMessageSend |
					(eachMessageSend valueWithPossibleArgument: self) do: aBlock ]]		].
		"Also allow registering menu+shortcut entries for specific TextModels or TextProviders"
		(window class registeredMenuAndShortcutsSpecProviders: self textProviderOrModel class name) ifNotNil: [ :providers |
			providers do: [ :eachMessageSend |
				(eachMessageSend valueWithPossibleArgument: self) do: aBlock ]]		.]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6559-EditorClassAndCodeProvider-specificMenuEntryRegistries-JuanVuletich-2024Jul31-11h27m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6559] on 5 August 2024 at 11:23:54 am'!
!Morph methodsFor: 'events' stamp: 'jmv 8/5/2024 09:47:54' prior: 50348263!
         keyboardShortcut: aKeyboardEvent
	"Handle a keyboard shortcut.
	See coment at Morph >> #getMenu
	"
	| menuNshortcutsSpecs shortcutCharacter target |
	menuNshortcutsSpecs := self allMenuNshortcutsSpecs.
	menuNshortcutsSpecs ifEmpty: [ ^false ].
	menuNshortcutsSpecs valuesDo: [ :itemSpec |
		itemSpec size >= 5 ifTrue: [
			shortcutCharacter := itemSpec third.
			shortcutCharacter = aKeyboardEvent keyCharacter ifTrue: [
				target := itemSpec fourth
					ifNotNil: [ :targetOrGetter |
						targetOrGetter isSymbol
							ifTrue: [ 	self perform: targetOrGetter ]
							ifFalse: [ targetOrGetter ]]
					ifNil: [ self ].
				itemSpec fifth
					ifNotNil: [ :selector |
						itemSpec size >= 8
							ifTrue: [ target perform: selector with: itemSpec eighth ]
							ifFalse: [ target perform: selector ].
						^true ]
					ifNil: [
						^false ]
				]
			]
		].
	^false! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 8/5/2024 09:46:41' prior: 50347132!
                             addItemTo: topMenu fromSpec: itemSpec submenus: submenusDictionary
	"
	See coment at Morph >> #getMenu
	"
	| submenuId menu label target selector arguments iconSymbol helpText menuItem |
	label := itemSpec second.
	label ifNil: [ ^self ]. "Only a keyboard shortcut, not a real menu item."
	submenuId := itemSpec first // 1000.
	menu := submenuId = 0 ifTrue: [ topMenu ] ifFalse: [ submenusDictionary at: submenuId ].
	target := itemSpec fourth
		ifNotNil: [ :targetOrGetter |
			targetOrGetter isSymbol
				ifTrue: [ 	self perform: targetOrGetter ]
				ifFalse: [ targetOrGetter ]]
		ifNil: [ self ].
	selector := itemSpec fifth.
	arguments := itemSpec size >= 8 ifTrue: [ {itemSpec eighth} ] ifFalse: [ #() ].
	menuItem := label isSymbol
		ifTrue: [ menu addUpdating: label target: target action: selector argumentList: arguments ]
		ifFalse: [ menu add: label target: target action: selector argumentList: arguments ].
	selector ifNil: [
		menuItem isEnabled: false ].
	iconSymbol := itemSpec size >= 6 ifTrue: [ itemSpec sixth ].
	iconSymbol ifNotNil: [ menuItem setIcon: iconSymbol ].
	helpText := itemSpec size >= 7 ifTrue: [ itemSpec seventh ].
	helpText ifNotNil: [ menuItem setBalloonText: helpText ].! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 8/5/2024 11:22:39' prior: 50357704!
              allMenuNshortcutsSpecs
	"Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'helpText(optional)'    selectorArgument(optional))
		- itemId is a number (integer or float). It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window, #model or #editor. If nil, receiver is the widget itself.
		- selector is #aSymbol. Usually no arguments, or one single argument in 8th entry. 
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
		- selectorArgument is optional, but required if selector takes an argument.
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"
	"Several nested morphs may provide their own menu items and keyboard shortcuts for submorphs.
	A morph could also provide its own."

	| menuNshortcutsSpecs |

	menuNshortcutsSpecs := Dictionary new.
	"First, take menu and shortcut specs declared by us (i.e. the widget)"
	self menuNshortcutsSpecsDo: [ :menuItemSpec |
		menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ].
	"Then allow all owners to override or remove them.
	This is done outwards, each morph can override choices made by submorphs.
	This helps building reusable composites, that can be tweaked by user morphs / windows."
	self allOwnersDo: [ :o |
		o menuNshortcutsSpecsFor: self do: [ :menuItemSpec |
			(menuItemSpec size = 2 and: [ 		menuItemSpec second first = $X ])
				"#(12 		'XXX') means 'remove menu item numbered 12'"
				ifTrue: [ menuNshortcutsSpecs removeKey: menuItemSpec first ifAbsent: nil ]
				ifFalse: [ menuNshortcutsSpecs at: menuItemSpec first put: menuItemSpec ]]].
	^ menuNshortcutsSpecs! !
!Morph methodsFor: 'submorphs-menus' stamp: 'jmv 8/5/2024 11:22:48' prior: 50359147!
           getMenu
	"Answer the right-click (contextual) menu."
	"Spec for the menu and shortcut keys.
	Each entry is
		#(itemId 			'menu item label'    shortcut    receiverGetter    selector     iconOrNil(optional)    'helpText(optional)'    selectorArgument(optional))
		- itemId is a number (integer or float). It specifies the position of the item in the menu, and is also an id, allowing for overrides and deletions.
		- label is a string or symbol. Symbol means self updating menu entry. nil means just keyboard shortcut, no menu entry.
		- shortcut is a Character or nil
		- receiverGetter sent to the widget to get the actual receiver for selector.
			Typically #window, #model or #editor. If nil, receiver is the widget itself.
		- selector is #aSymbol. Usually no arguments, or one single argument in 8th entry. 
			If a Number (multiple of 1000), indicates a subMenu. ItemsIds must be in range. See BrowserWindow>>#classListMenuSpec.
			If nil, the menu entry is created but disabled. The keyboard shortcut is disabled too.
		- icon may be nil. It is also optional (but must be there if there is help text)
		- help text is optional
		- selectorArgument is optional, but required if selector takes an argument.
	Entries of size 2 are separators, unless first character is $X, meaning 'remove menu item'.
	An entry of size 3 (usually with key 0 and at the first position), if present, tells a menu title, whether to #addStayUpIcons.
	"

	| menuNshortcutsSpecs itemSpec menu submenus |
	menuNshortcutsSpecs := self allMenuNshortcutsSpecs.
	menuNshortcutsSpecs ifEmpty: [ ^nil ].
	menu := MenuMorph new.
	submenus := nil.
	menuNshortcutsSpecs keys sorted do: [ :key |
		itemSpec := menuNshortcutsSpecs at: key.
		itemSpec size <= 2 ifTrue: [
				self addLineTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [ itemSpec size = 3 ifTrue: [
				self addTitleTo: menu fromSpec: itemSpec ]
			ifFalse: [ itemSpec fifth isNumber ifTrue: [
				submenus ifNil: [submenus := Dictionary new ].
				self addSubmenuTo: menu fromSpec: itemSpec submenus: submenus ]
			ifFalse: [
				self addItemTo: menu fromSpec: itemSpec submenus: submenus ]]]].
	^ menu! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6560-MenuNShortcutSpecs-allowOneArgument-JuanVuletich-2024Aug05-11h19m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6559] on 5 August 2024 at 11:30:59 am'!
!BrowserWindow class methodsFor: 'GUI building' stamp: 'jmv 8/5/2024 11:27:04' prior: 16799906!
                            findClassFrom: potentialClassNames ifFound: aBlock

	self classNameRequester 
		request: 'Class name or fragment?'
		initialAnswer: '' 
		do: [ :pattern | self findClassFrom: potentialClassNames ifFound: aBlock with: pattern ]! !
!Editor methodsFor: 'accessing' stamp: 'jmv 8/5/2024 11:30:11' prior: 50360327!
          help
	"
	TextEditor new help edit
	SmalltalkEditor new help edit
	"
	| tabs |
	tabs := String tab, String tab, String tab, String tab, String tab.
	^ String streamContents: [ :strm |
		self defaultMenuSpec do: [ :menuItemNshortcutSpec |
			menuItemNshortcutSpec size > 6 ifTrue: [
				menuItemNshortcutSpec third ifNotNil: [ :shortcutCharacter |
					strm nextPutAll: ('Command', '-', shortcutCharacter asString, tabs, menuItemNshortcutSpec seventh).
				strm newLine ]]]].! !

Editor class removeSelector: #allShiftShortcutsSpec!

!methodRemoval: Editor class #allShiftShortcutsSpec stamp: 'Install-6561-Cleanup-JuanVuletich-2024Aug05-11h23m-jmv.001.cs.st 8/13/2024 18:36:55'!
allShiftShortcutsSpec

	^ self shiftShortcutsSpec!

Editor class removeSelector: #shiftShortcutsSpec!

!methodRemoval: Editor class #shiftShortcutsSpec stamp: 'Install-6561-Cleanup-JuanVuletich-2024Aug05-11h23m-jmv.001.cs.st 8/13/2024 18:36:55'!
shiftShortcutsSpec
	"Only for help. See senders."

	^#(
		#(		'Enter' 	#globalFindClass: 'Global Find class name or fragment')
	)!

BrowserWindow class removeSelector: #findClassDialogTitle!

!methodRemoval: BrowserWindow class #findClassDialogTitle stamp: 'Install-6561-Cleanup-JuanVuletich-2024Aug05-11h23m-jmv.001.cs.st 8/13/2024 18:36:55'!
findClassDialogTitle

	^ 'Class name or fragment?'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6561-Cleanup-JuanVuletich-2024Aug05-11h23m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6561] on 5 August 2024 at 2:46:28 pm'!
!SystemDictionary methodsFor: 'code authors' stamp: 'jmv 8/5/2024 14:45:49' prior: 50349040!
                              knownInitialsAndNames
	"This list could include people who hasn't contributed code to the Cuis image, but to some optional package."
"
| all ok |
all := Smalltalk allContributors asSet.
ok := (Smalltalk knownInitialsAndNames collect: [ :pair | pair first ]) asSet.
(all copyWithoutAll: ok) print

		initials         				name"
^ #(
	#('ab' 						'Alexandre Bergel')
	#('abc' 						'Colin Putney')
	#('acg' 						'Andrew C. Greenberg')
	#('ads' 						'Adam Spitz')
	#('AFi' 						'Alain Fischer')
	#('ajh' 						'Anthony Hannan')
	#('al' 						'Adrian Lienhard')
	#('and' 						'Alan Dao')
	#('aoy' 						'Andres Otaduy')
	#('apb' 						'Andrew P. Black')
	#('ar' 						'Andreas Raab')
	#('asm' 						'Alejandro Magistrello')
	#('avi' 						'Avi Bryant')
	#('AY'						'Angel Yan')
	#('BAP'						'Barry Perryman')
	#('BenComan' 						'Ben Coman')
	#('bf' 						'Bert Freudenberg')
	#('BG' 						'Boris Gaertner')
	#('bgs' 						'Boris G. Shingarov')
	#('BJP' 						'Bijan Parsia')
	#('bkv' 						'Brent Vukmer')
	#('bolot' 						'Bolot Kerimbaev')
	#('bp' 						'Bernhard Pieber')
	#('BP' 						'Brent Pinkney') 
	#('brp' 						'Brent Pinkney')
	#('cbc' 						'Chris Cunningham')
	#('cbr'						'Casey Ransberger')
	#('ccn' 						'Chris Norton')
	#('chaider'						'Christian Haider')
	#('cmm' 						'Chris Muller')
	#('crl' 						'Craig Latta')
	#('cwp' 						'Colin Putney')
	#('das' 						'David A Smith')
	#('db' 						'Douglas Brebner')
	#('dc' 						'Damien Cassou')
	#('dew' 						'Doug Way')
	#('DF'						'David Faitelson')
	#('dgd' 						'Diego Gomez Deck')
	#('dhn'	 					'Dan Norton')
	#('dhhi' 						'Dan Ingalls')
	#('di' 						'Dan Ingalls')
	#('djp' 						'David J. Pennell')
	#('dkh'						'Dale Henrichs')
	#('DKL'						'Daniel K Lyons')
	#('DM' 						'Duncan Mak')
	#('DSG'						'David Graham')
	#('DSM' 						'Duane Maxwell')
	#('dtl' 						'Dave Lewis')
	#('dvf'	 					'Daniel Vainsencher')
	#('eat' 						'Eric Arseneau Tremblay')
	#('EB'						'Eric Brandwein')
	#('eem'						'Eliot Emilio Miranda')
	#('eliot'						'Eliot Emilio Miranda')
	#('efc' 						'Eddie Cottongim')
	#('em' 						'Ernest Micklei?')
	#('emm' 						'Ernest Micklei')
	#('Ez3' 						'Ezequiel Birman')
	#('fbs' 						'Frank Shearar')
	#('FBS' 						'Frank Shearar')
	#('fc' 						'Frank Caggiano')
	#('fcs' 						'Frank Sergeant')
	#('FernandoOlivero' 						'Fernando Olivero')
	#('FernanodOlivero' 						'Fernando Olivero')
	#('FGJ'						'Fernando Gasperi Jabalera')
	#('fgz'						'Felipe Zak')
	#('FJG'				 		'Facundo Javier Gelatti')
	#('GabrielOmarCotelli' 						'Gabriel Omar Cotelli')
	#('GC' 						'Gast√≥n Caruso')
	#('gera' 						'Gerardo Richarte')
	#('gh' 						'Goran Krampe (nee Hultgren)')
	#('gk' 						'Goran Krampe (nee Hultgren)')
	#('gm' 						'German Morales')
	#('go' 						'Georg Gollmann')
	#('gsa' 						'German Arduino')
	#('HAW' 						'Hernan Wilkinson')
	#('HB' 						'Hari Balaraman')
	#('hjh' 						'Hannes Hirzel')
	#('hlsf' 						'Hilaire Fernandes')
	#('hmm' 						'Hans-Martin Mosner')
	#('hsj' 						'Henrik Sperre Johansen')
	#('Igor.Stasenko' 						'Igor Stasenko')
	#('ikp' 						'Ian Piumarta')
	#('jar' 						'Jaromir Matas')
	#('Jb' 						'Jean Baptiste Arnaud')
	#('jcg' 						'Joshua Gargus')
	#('jdr' 						'Javier Diaz-Reinoso')
	#('je' 						'Joern Eyrich')
	#('jf' 						'Julian Fitzell')
	#('JF' 						'Julian Fitzell')
	#('jfr' 						'Jon Raiford')
	#('jhm' 						'John Maloney')
	#('jk'						'Jonathan Kelly')
	#('jlb' 						'Jim Benson')
	#('jm' 						'John Maloney')
	#('jmb' 						'Hans Baveco')
	#('JMG'						'Jeff Gonis')
	#('JMM' 						'John McIntosh')
	#('jmv' 						'Juan Vuletich')
	#('JMV' 						'Juan Vuletich')
	#('JO'						'Javier Olaechea')
	#('jp' 						'Joseph Pelrine')
	#('jrm' 						'John-Reed Maffeo')
	#('jrp' 						'John Pierce')
	#('jsp' 						'Jeff Pierce')
	#('kdpm' 						'Kevin P√©rez Machado')
	#('KenD' 						'Ken Dickey')
	#('kfr' 						'Karl Ramberg')
	#('KLC'			 			'Ken Causey')
	#('KLG'			 			'Gerald Klix')
	#('kph'						'Keith Hodges')
	#('KTT' 						'Kurt Thams')
	#('laza' 						'Alexander Lazarevic')
	#('LC' 						'Leandro Caniglia')
	#('len' 						'Luciano Esteban Notarfrancesco')
	#('lpc'						'Laura Perez Cerrato')
	#('lr' 						'Lukas Renggli')
	#('Lukas Renggli' 						'Lukas Renggli')
	#('ls' 						'Lex Spoon')
	#('md' 						'Marcus Denker')
	#('MarcusDenker' 						'Marcus Denker')
	#('marcus.denker' 						'Marcus Denker')
	#('mdr' 						'Mike Rutenberg')
	#('MEGL' 						'MarceloLamperti')
	#('mga' 						'Markus Galli')
	#('MGD'						'Mat√≠as Dinota')
	#('MH'						'Mat√≠as Halperin')
	#('mha' 						'Michael Haupt')
	#('mir' 						'Michael Rueger')
	#('mjg' 						'Mark Guzdial')
	#('mk'	 					'Matej Kosik')
	#('MM'	 					'Mariano Montone')
	#('mnqpr'	 					'Szabolcs Komaromi')
	#('MPH'	 					'Michael Hewner')
	#('mpw' 						'Marcel Weiher')
	#('MPW' 						'Marcel Weiher')
	#('mrm' 						'Martin McClure')
	#('mtf' 						'Matthew Fulmer')
	#('mu' 						'Masashi Umezawa')
	#('nb' 						'Naala Brewer')
	#('nice'					 	'Nicolas Cellier')
	#('nk' 						'Ned Konz')
	#('NM' 						'Nicola Mingotti')
	#('NMS'						'Nicol√°s Sarfati')
	#('nop' 						'Jay Carlson')
	#('NS' 						'Nathanael Schaerli')
	#('panda' 						'Michael Rueger')
	#('pau'						'Paula Perez Bianchi')
	#('pb'						'Phil Bellalouna')
	#('PB'						'Paolo Belforte')
	#('PHK' 						'Peter Keeler')
	#('pmon'						'Paolo Montrasi')
	#('PM' 						'Peter Mikkelsen')
	#('Pmm' 						'Philippe Marschall')
	#('pnm' 						'Paul McDonough')
	#('r++' 						'Gerardo Richarte')
	#('raa' 						'Bob Arning')
	#('RAA' 						'Bob Arning')
	#('raok' 						'Richard A. O''Keefe')
	#('rca' 						'Russell Allen')
	#('reThink'				 		'Paul McDonough')
	#('rew' 						'Roger Whitney')
	#('rhi' 						'Robert Hirschfeld')
	#('RJT' 						'Ron Teitelbaum')
	#('RNG' 						'Nahuel Garbezza')
	#('rr' 						'Romain Robbes')
	#('rss' 						'Ron Spengler')
	#('rw' 						'Robert Withers')
	#('rww' 						'Robert Withers')
	#('Sames' 						'Samuel S. Shuster')
	#('sbw' 						'Stephan B. Wessels')
	#('sd' 						'Stephane Ducasse')
	#('SD' 						'Stephane Ducasse')
	#('sge' 						'Steve Elkins')
	#('sjd' 						'Santiago Jose Dandois')
	#('SLD'						'Steve Davies')
	#('sma' 						'Stefan Matthias Aust')
	#('sps' 						'Steven Swerling')
	#('SqR' 						'Andres Valloud')
	#('sqr' 						'Andres Valloud')
	#('Squeak1.0'						'Squeak 1.0, September 20, 1996')
	#('Squeak1.1'						'Squeak 1.1, September 23, 1996')
	#('Squeak1.2'						'Squeak 1.2, June 29, 1997')
	#('Squeak1.3'						'Squeak 1.3, January 16, 1998')
	#('sr' 						'Stephan Rudlof')
	#('ss'						'Sebastian Sujarchuk')
	#('SSC' 						'Santiago Salvador Cubino')
	#('SSS' 						'Samuel S. Shuster')
	#('ST-80'						'Smalltalk-80, version 2, of April 1, 1983')
	#('stephane.ducasse' 						'Stephane Ducasse')
	#('stephaneducasse'	 					'Stephane Ducasse')
	#('stp' 						'Stephen Travis Pope')
	#('sumim' 						'Masato Sumi')
	#('S.V.' 						'Sebasti√°n M. Vinto√±uke')
	#('svc' 						'Sven Van Caekenberghe')
	#('svp' 						'Stephen Vincent Pair')
	#('sw' 						'Scott Wallace')
	#('TAG' 						'Travis Griggs')
	#('tak' 						'Takashi Yamamiya')
	#('tao' 						'Tim Olson')
	#('TBn' 						'Torsten Bergmann')
	#('tfei' 						'The Fourth Estate, Inc.')
	#('tfel' 						'Tim Felgentreff')
	#('th' 						'Torge Husfeldt')
	#('tk' 						'Ted Kaehler')
	#('tlk' 						'Tom Koenig')
	#('tpr' 						'Tim Rowledge')
	#('TPR' 						'Tim Rowledge')
	#('TS' 						'Tom√°s Spognardi')
	#('tsl' 						'Thiago da Silva Lino')
	#('tween' 						'Andy Tween')
	#('ul' 						'Levente Uzonyi')
	#('vb' 						'Vassili Bykov')
	#('ward' 						'Ward Cunningham')
	#('wiz' 						'Jerome Peace')
	#('wod' 						'Bill Dargel')
	#('yo' 						'Yoshiki Ohshima')
	#('zz' 						'Serge Stinckwich'))! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6562-Add-Jon-AsKnownAuthor-JuanVuletich-2024Aug05-14h45m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6561] on 5 August 2024 at 2:49:33 pm'!
!CodePackage methodsFor: 'testing' stamp: 'jfr 8/3/2024 10:43:36' prior: 16823993!
          isForeignClassExtension: categoryName
	"Answer true if <categoryName> is a foreign class extension reference"
	
	categoryName ifNil: [ ^false ].
	(categoryName size = 0) ifTrue:[^false].
	^ categoryName first = $* and: [(self isYourClassExtension: categoryName) not]! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6563-FixWalkbackWhenFileInWithoutCategory-JonRaiford-2024Aug05-14h46m-jfr.001.cs.st----!

'From Cuis7.1 [latest update: #6563] on 5 August 2024 at 3:31:10 pm'!
!CompiledMethod methodsFor: 'source code management' stamp: 'jmv 8/5/2024 15:27:23' prior: 16834268!
                     putSource: sourceStr fromParseNode: methodNode inFile: fileIndex withPreamble: preambleBlock
	"Store the source code for the receiver on an external file.
	If no sources are available, i.e., SourceFile is nil, do nothing.
	If the fileIndex is 1, print on *.sources;  if it is 2, print on *.changes,
	in each case, storing a 4-byte source code pointer at the method end."

	| file remoteString  |
	(SourceFiles notNil and: [(file := SourceFiles at: fileIndex) notNil]) ifTrue: [
		file setToEnd.
		preambleBlock value: file.  "Write the preamble"
		remoteString := RemoteString newString: sourceStr onFileNumber: fileIndex toFile: file.
		file nextChunkPut: ' '.
		InMidstOfFileinNotification signal ifFalse: [file flush].
		self checkOKToAdd: sourceStr size at: remoteString position in: fileIndex.
		self setSourcePosition: remoteString position inFile: fileIndex ].

	Utilities logsUserChanges ifTrue: [
		DirectoryEntry userChangesDirectory // Smalltalk userChangesFileName appendStreamDo: [ :stream |
			preambleBlock value: stream.  "Write the preamble"
			stream nextChunkPut: sourceStr.
			stream nextChunkPut: ' ' ]]! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/5/2024 15:27:32' prior: 16965833!
                      logSnapshot: save andQuit: quit
	"Log quitting to changes file"
	| msg |
	msg := self snapshotMessageFor: save andQuit: quit.
	(SourceFiles at: 2) ifNotNil: [
		save ifTrue: [
			LastQuitLogPosition := (SourceFiles at: 2)
				 setToEnd;
				 position ]].
	self logChange: msg.
	Transcript
		 newLine;
		 show: msg;
		 newLine! !
!SystemDictionary methodsFor: 'sources, change log' stamp: 'jmv 8/5/2024 15:28:13' prior: 16966507!
                   assureStartupStampLogged
	"If there is a startup stamp not yet actually logged to disk, do it now."
	| changesFile directory oldUserChanges oldUserChangesName |
	(SourceFiles notNil and: [(changesFile := SourceFiles at: 2) notNil]) ifTrue: [
		changesFile isReadOnly ifFalse: [
			changesFile setToEnd; newLine; newLine.
			changesFile nextChunkPut: StartupStamp; newLine.
			self forceChangesToDisk ]].
	(Preferences at: #autoNumberUserChanges) ifTrue: [
		oldUserChanges := DirectoryEntry userChangesDirectory // self userChangesFileName.
		oldUserChanges exists ifTrue: [
			directory := oldUserChanges parent.
			oldUserChangesName := directory nextNameFor: oldUserChanges nameWithoutExtension extension: 'changes'.
			oldUserChanges rename: oldUserChangesName ]].
	DirectoryEntry userChangesDirectory // self userChangesFileName appendStreamDo: [ :stream |
		stream newLine; newLine.
		stream nextChunkPut: StartupStamp; newLine.
		stream flush ].! !
!SystemDictionary methodsFor: 'sources, change log' stamp: 'jmv 8/5/2024 15:27:28' prior: 16966737!
logChange: aStringOrText preamble: preambleOrNil
	"Write the argument, aString, onto the changes file."
	| aString changesFile |
	aString := aStringOrText asPlainString.
	aString firstNonSeparator = 0 ifTrue: [^ self].  "null doits confuse replay"
	
	(SourceFiles notNil and: [(changesFile := SourceFiles at: 2) notNil]) ifTrue: [
		changesFile isReadOnly ifFalse: [
			changesFile setToEnd; newLine; newLine.
			preambleOrNil ifNotNil: [
				changesFile nextPut: $!!; nextChunkPut: preambleOrNil; newLine ].
			changesFile nextChunkPut: aString.
			self forceChangesToDisk ]].
	self logToUserChanges: aString preamble: preambleOrNil! !
!SystemDictionary methodsFor: 'startup' stamp: 'jmv 8/5/2024 15:25:17' prior: 16969370!
           setStartupStamp

	| dateAndTime |
	dateAndTime := DateAndTime now.
	StartupStamp := String streamContents: [ :stream |
		stream nextPutAll: '----STARTUP---- ('.
		dateAndTime date printOn: stream.
		stream space.
		dateAndTime time print24: true showSeconds: true on: stream.
		stream
			nextPutAll: ') as ';
			nextPutAll: self imageName ].
	self assureStartupStampLogged.
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6564-dontDelayUserChangesCreation-JuanVuletich-2024Aug05-15h25m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6564] on 5 August 2024 at 5:53:11 pm'!
!FileList methodsFor: 'stepping' stamp: 'jmv 8/5/2024 16:47:58' overrides: 16915328!
                               stepAt: millisecondSinceLast
	self updateFileList.! !
!FileList methodsFor: 'stepping' stamp: 'jmv 8/5/2024 15:43:45' overrides: 16915332!
                     wantsSteps
	^ true! !
!FileListWindow methodsFor: 'stepping' stamp: 'jmv 8/5/2024 17:25:53' overrides: 16971496!
               stepTime
	^ 1000 "milliseconds"! !
!FileList methodsFor: 'initialization' stamp: 'jmv 8/5/2024 16:24:33' prior: 16861902 overrides: 16932029!
                  initialize
	listIndex := 0.
	showDirsInFileList := false.
	showHidden := false.! !
!FileList methodsFor: 'volume list and pattern' stamp: 'jmv 8/5/2024 17:53:01' prior: 16862209!
             listForSelectingPatterns: patternsThatSelect rejectingPatterns: patternsThatReject
	"Make the list be those file names which match the patterns."

	| sizePad selected newList namePad sizeWithCommasPad font |
	directory ifNil: [^#()].
	directory invalidateChildren.
	selected := Set new.
	patternsThatSelect do: [ :pat |
		directory childrenDo: [ :entry |
			(entry isDirectory
				ifTrue: [ showDirsInFileList ]
				ifFalse: [ self doesPattern: pat allow: entry])
					ifTrue: [ selected add: entry ]]].
	newList := selected copy.
	patternsThatReject do: [ :pat |
		selected do: [ :entry |
			(entry isDirectory not and: [ pat match: entry name]) ifTrue: [
				newList remove: entry ]]].
		
	newList := newList asArray sort: self sortBlock.
	font := Preferences at: #standardListFont.
	namePad := newList inject: 0 into: [ :mx :entry | mx max: (font widthOfString: entry name)].
	sizePad := (newList inject: 0 into: [ :mx :entry | mx max: (entry fileSize)]) printString size.
	sizeWithCommasPad := (newList inject: 0 into: [ :mx :entry | mx max: (entry fileSize)]) printStringWithCommas size.
	newList := newList collect: [ :e |
		self fileNameFormattedFrom: e namePad: namePad sizePad: sizePad sizeWithCommasPad: sizeWithCommasPad ].
	^ newList! !
!FileList methodsFor: 'private' stamp: 'jmv 8/5/2024 17:48:03' prior: 16862360!
               put: aText
	"Private - put the supplied text onto the file"

	| type |
	brevityState == #fullFile ifTrue: [
		acceptedContentsCache := aText.
		directory // fileName writeStreamDo: [ :stream |
			stream nextPutAll: acceptedContentsCache asPlainString ].
		directory invalidateChildren.
		self updateFileList.
		^ true  "accepted"].
	listIndex = 0 ifTrue: [
		self inform: 'No fileName is selected'.
		^ false  "failed"].
	type := 'These'.
	brevityState = #briefFile ifTrue: [type := 'Abbreviated'].
	brevityState = #briefHex ifTrue: [type := 'Abbreviated'].
	brevityState = #fullHex ifTrue: [type := 'Hexadecimal'].
	brevityState = #FileList ifTrue: [type := 'Directory'].
	self inform: ('{1} contents cannot
meaningfully be saved at present.' format:{type}).
	^ false  "failed"
! !
!FileList methodsFor: 'private' stamp: 'jmv 8/5/2024 16:44:13' prior: 16862541!
 updateFileList
	"Update my files list with file names in the current directory  
	that match the pattern.
	The pattern string may have embedded newlines or semicolons; these separate different patterns."
	| patterns patternsThatReject patternsThatSelect newList |
	patterns := OrderedCollection new.
	(pattern findTokens: (String with: Character cr with: Character lf with: $;))
		do: [ :each |
			(each includes: $*) | (each includes: $?)
				ifTrue: [ patterns add: (each copyReplaceAll: '?' with: '#')]
				ifFalse: [
					each isEmpty
						ifTrue: [ patterns add: '*']
						ifFalse: [ patterns add: '*' , each , '*']]].
	"A pattern that starts with $/ is used to reject entries
	Rejecting patterns are applied after selecting patterns."
	patternsThatSelect := patterns reject: [ :any | any first = $/ ].
	patternsThatSelect isEmpty ifTrue: [ patternsThatSelect add: '*' ]. 
	patternsThatReject := patterns select: [ :any | any first = $/ ] thenCollect: [ :each | each copyFrom: 2 to: each size ].
	newList := self listForSelectingPatterns: patternsThatSelect rejectingPatterns: patternsThatReject.

	newList = list ifFalse: [
		"If we had a selection, ensure it is valid, or discard it."
		listIndex = 0 ifFalse: [
			(listIndex > newList size or: [(list at: listIndex) ~= (newList at: listIndex)]) ifTrue: [
				listIndex := newList indexOf: (list at: listIndex) ]].
		list := newList.
		listIndex > 0 ifFalse: [ "Had no selection or it was discarded"
			fileName := nil.
			acceptedContentsCache := ''.
			self acceptedContentsChanged.
			self changed: #fileListIndex ].
		self changed: #fileList.
		self triggerEvent: #updateButtonRow ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6565-FileList-AutoUpdate-JuanVuletich-2024Aug05-17h50m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6565] on 6 August 2024 at 4:29:05 pm'!
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 8/6/2024 16:27:19' prior: 16845082!
          buildMorphicWindow
	"Open a full morphic debugger with the given label"

	| bottomMorph |
	bottomMorph := LayoutMorph newRow.
	bottomMorph
		addMorph: self receiverInspector proportionalWidth: 0.2;
		addAdjusterAndMorph: self receiverInspectorText proportionalWidth: 0.3;
		addAdjusterAndMorph: self contextVariableInspector proportionalWidth: 0.2;
		addAdjusterAndMorph: self contextVariableInspectorText proportionalWidth: 0.3.

	self layoutMorph
		addMorph: self stackList proportionalHeight: 0.25;
		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.55;
		addAdjusterAndMorph: bottomMorph proportionalHeight: 0.2.! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 8/6/2024 16:27:58' prior: 50337892!
          contextVariableInspector

	^ contextVariableInspector ifNil: [
		contextVariableInspector := (PluggableListMorph
			withModel: model contextVariablesInspector 
			listGetter: #fieldList
			indexGetter: #selectionIndex 
			indexSetter: #toggleIndex:)
				doubleClickSelector: #inspectContextSelection;
				menuNshortcutsKey: #contextVariablesListMenuSpec ].		! !
!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 8/6/2024 16:28:05' prior: 50337905!
                           receiverInspector

	^ receiverInspector ifNil: [
		receiverInspector := (PluggableListMorph
			withModel: model receiverInspector
			listGetter: #fieldList
			indexGetter: #selectionIndex 
			indexSetter: #toggleIndex:)
				doubleClickSelector: #inspectReceiverSelection;
				menuNshortcutsKey: #receiverVariablesListMenuSpec ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6566-Debugger-InspectOnDoubleClickOnVariables-JuanVuletich-2024Aug06-16h26m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6566] on 6 August 2024 at 5:25:57 pm'!
!UniFileStream class methodsFor: 'error handling' stamp: 'jmv 8/6/2024 17:07:23' prior: 16992462!
                    fileExistsUserHandling: fullFileName
	| dir localName choice newName entry |
	entry := fullFileName asFullFileEntry.
	dir := entry parent.
	localName := entry name.
	choice := (PopUpMenu
		labels:
'overwrite that file\choose another name\cancel' withNewLines)
		startUpWithCaption: localName, '
already exists.'.

	"overwrite that file"
	choice = 1 ifTrue: [
		dir removeKey: localName
			ifAbsent: [self error: 'Could not delete the old version of that file'].
		^ self new open: fullFileName forWrite: true].

	"choose another name"
	choice = 2 ifTrue: [
		newName := self request: 'Enter a new file name' initialAnswer: fullFileName.
		^ FileIOAccessor default privateNewFile: newName asFileEntry ].

	"choice = 3: cancel"
	"Answer nil. Let callers decide whether to continue or not"
	^nil.! !
!FileEntry methodsFor: 'accessing-stream' stamp: 'jmv 8/6/2024 17:08:46' prior: 50335385!
         writeStreamDo: blockWithArg 
	"If the file already exists raise FileExistsException.
	Creates the directory if it doesn't exist.
	Note: If file already exists and user selects 'cancel', the block is passed nil as argument!!"
	| stream |
	stream := self writeStream.
	[ blockWithArg value: stream ]
		ensure: [
			stream
				ifNotNil: [ :s | s close ].
			self invalidate ].
! !
!FileEntry methodsFor: 'accessing' stamp: 'jmv 8/6/2024 16:55:45' prior: 16860712!
                   writeStream
	"If the file already exists raise FileExistsException.
	Note: You need to eventually close the stream.
	Usually prefer #writeStreamDo: that closes the file for you.
	Creates the directory if it doesn't exist.
	Note: Answer nil if for whatever reason the file can not be created.
	"

	self invalidate.
	self parent exists ifFalse: [self parent assureExistence].
	^self fileAccessor privateNewFile: self! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6567-AnswerNilIfUSerCancelsFileCreation-JuanVuletich-2024Aug06-17h25m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6566] on 6 August 2024 at 5:28:00 pm'!
!ClassDescription methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:10:18' prior: 16819335!
           fileOutCategory: catName
	"FileOut the named category"

	DirectoryEntry fileOutsDirectory // (self name , '-' , catName , '.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			fileStream timeStamp.
			self fileOutCategory: catName on: fileStream moveSource: false toFile: 0 ]].! !
!ClassDescription methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:10:34' prior: 16819416!
fileOutMethod: selector
	"Write source code of a single method on a file.  Make up a name for the file."

	| nameBody |
	(selector == #Comment) ifTrue: [^ self inform: 'Sorry, cannot file out class comment in isolation.'].
	(self includesSelector: selector) ifFalse: [^ self error: 'Selector ', selector asPlainString, ' not found'].
	nameBody := self name , '-' , (selector copyReplaceAll: ':' with: '').
	DirectoryEntry fileOutsDirectory // (nameBody asFileName, '.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			fileStream timeStamp.
			self printMethodChunk: selector withPreamble: true
				on: fileStream moveSource: false toFile: 0 ]].! !
!Class methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:11:01' prior: 16815581!
                           fileOut
	"File a description of the receiver onto a new file whose base name is the name of the receiver."

	DirectoryEntry fileOutsDirectory // (self name, '.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			fileStream timeStamp.
			self sharedPools size > 0 ifTrue: [
				self shouldFileOutPools
					ifTrue: [ self fileOutSharedPoolsOn: fileStream ]].
			self fileOutOn: fileStream moveSource: false toFile: 0 ]].! !
!Class methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:11:42' prior: 16815596!
                              fileOutHierarchy
	"File a description of the receiver onto a new file whose base name is the name of the receiver.
	Morph fileOutHierarchy
	"

	DirectoryEntry fileOutsDirectory // (self name, '-hierarcy.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			fileStream timeStamp.
			self sharedPools size > 0 ifTrue: [
				self shouldFileOutPools
					ifTrue: [ self fileOutSharedPoolsOn: fileStream ]].
			self withAllSubclassesDo: [ :each |
				each fileOutOn: fileStream moveSource: false toFile: 0 ]]].! !
!SystemOrganizer methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:13:30' prior: 16970125!
                               fileOutAllCategories
	"
	Cursor write showWhile: [
		SystemOrganization fileOutAllCategories ]
	"
	DirectoryEntry fileOutsDirectory // 'Cuis-AllCode.st' writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			self categories do: [ :category |
				self fileOutCategoryNoPoolsNoInit: category on: fileStream ]]].! !
!SystemOrganizer methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:13:54' prior: 16970137!
         fileOutCategory: aCategoryRoot
	"FileOut all the classes in the named system category."

	DirectoryEntry fileOutsDirectory // (aCategoryRoot asFileName , '.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			(self withSubCategoriesOf: aCategoryRoot) do: [ :category | 
				self fileOutCategory: category on: fileStream initializing: true ]]].! !
!InstructionPrinter class methodsFor: 'printing' stamp: 'jmv 8/6/2024 17:21:17' prior: 16883928!
                         printClass: class 
	"Create a file whose name is the argument followed by '.bytes'. Store on 
	the file the symbolic form of the compiled methods of the class."

	DirectoryEntry fileOutsDirectory // (class name , '.bytes') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			class selectorsDo: [ :sel | 
				fileStream newLine; nextPutAll: sel; newLine.
				(self on: (class compiledMethodAt: sel)) printInstructionsOn: fileStream ]]].

	"
	InstructionPrinter printClass: Parser.
	"! !
!CodeProvider methodsFor: 'message list menu' stamp: 'jmv 8/6/2024 17:20:43' prior: 50347634!
                     fileOutMessage
	"Put a description of the selected message on a file"

	self selectedMessageName ifNotNil:
		[^self selectedClassOrMetaClass fileOutMethod: self selectedMessageName].
	self messageList ifNotNil:
		[:theMethods|
		self request: 'Enter file name'
			initialAnswer: 'methods.st'
			do: [ :filename |
				DirectoryEntry fileOutsDirectory // filename writeStreamDo:
					[ :fileStream |
					fileStream ifNotNil: [
						fileStream timeStamp.
						theMethods do:
							[ :methodRef |
							methodRef actualClass
								printMethodChunk: methodRef methodSymbol
								withPreamble: true
								on: fileStream
								moveSource: false
								toFile: 0 ]]]]].! !
!ChangeList methodsFor: 'menu actions' stamp: 'jmv 8/6/2024 17:20:23' prior: 16804357!
  fileOutCurrentVersionsOfSelections

	self request: 'Enter file name' initialAnswer: 'CurrentVersions.st' do: [ :filename |
		DirectoryEntry fileOutsDirectory // filename writeStreamDo: [ :fileStream |
			fileStream ifNotNil: [
				fileStream timeStamp.
				self currentVersionsOfSelections do: [ :methodRef |
					methodRef actualClass
						printMethodChunk: methodRef methodSymbol
						withPreamble: true
						on: fileStream
						moveSource: false
						toFile: 0 ]]]].! !
!ChangeList methodsFor: 'menu actions' stamp: 'jmv 8/6/2024 17:20:02' prior: 16804373!
           fileOutSelections

	self request: 'Enter file name' initialAnswer: 'SelectedChanges.st' do: [ :filename |
		DirectoryEntry fileOutsDirectory // filename writeStreamDo: [ :fileStream |
			fileStream ifNotNil: [
				fileStream timeStamp.
				listSelections with: changeList do: [ :selected :item |
					selected ifTrue: [ item fileOutOn: fileStream ]]]]].! !
!FileList methodsFor: 'private' stamp: 'jmv 8/6/2024 17:15:20' prior: 50363033!
           put: aText
	"Private - put the supplied text onto the file"

	| type |
	brevityState == #fullFile ifTrue: [
		acceptedContentsCache := aText.
		directory // fileName writeStreamDo: [ :fileStream |
			fileStream ifNotNil: [
				fileStream nextPutAll: acceptedContentsCache asPlainString ]].
		directory invalidateChildren.
		self updateFileList.
		^ true  "accepted"].
	listIndex = 0 ifTrue: [
		self inform: 'No fileName is selected'.
		^ false  "failed"].
	type := 'These'.
	brevityState = #briefFile ifTrue: [type := 'Abbreviated'].
	brevityState = #briefHex ifTrue: [type := 'Abbreviated'].
	brevityState = #fullHex ifTrue: [type := 'Hexadecimal'].
	brevityState = #FileList ifTrue: [type := 'Directory'].
	self inform: ('{1} contents cannot
meaningfully be saved at present.' format:{type}).
	^ false  "failed"! !
!SystemWindow methodsFor: 'user interface' stamp: 'jmv 8/6/2024 17:16:06' prior: 50355886!
                   saveContentsTo: aFileEntry
	"Saves the contents to the given filename"

	self hasSaveAs ifFalse: [^self].
	aFileEntry writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			fileStream nextPutAll: model contentsForFileSaving.
			self 
				setProperty: #lastFilenameUsedToSave toValue: aFileEntry pathName;
				notifyUserWith: 'Contents saved to', String newLineString, aFileEntry pathName ]].! !
!TheWorldMenu methodsFor: 'commands' stamp: 'jmv 8/6/2024 17:16:22' prior: 16983912!
                            saveWorldInFile
	"Save the world's submorphs, model, and stepList in a file.  "

	self request: 'File name for this morph?' do: [ :fileName |
		fileName isEmpty ifTrue: [^ self].  "abort"
		"Save only model, stepList, submorphs in this world"
		myWorld submorphsDo: [ :m | m allMorphsDo: [ :subM | subM prepareToBeSaved ]].	"Amen"
		(fileName, '.morph') asFileEntry writeStreamDo: [ :fileStream |
			fileStream ifNotNil: [
				fileStream fileOutObject: myWorld ]]].! !
!ChangeSet methodsFor: 'fileIn/Out' stamp: 'jmv 8/6/2024 17:16:46' prior: 16808409!
                       fileOut
	"File out the receiver, to a file whose name is a function of the  
	change-set name and either of the date & time or chosen to have a  
	unique numeric tag, depending on the preference  
	'changeSetVersionNumbers'"
	| folder slips nameToUse |
	folder := DirectoryEntry savedChangeSetsDirectory.
	nameToUse := self name.
	nameToUse := nameToUse copyReplaceAll: 'AuthorName' with: Utilities authorName asUnaccented asCamelCase.
	nameToUse := (Preferences at: #changeSetVersionNumbers)
				ifTrue: [
					folder
						nextNameFor: nameToUse coda: '-', Utilities authorInitials
						extension: 'cs.st' ]
				ifFalse: [ (nameToUse , '.' , Utilities dateTimeSuffix , '.cs.st') asFileName ].

	folder // nameToUse writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			fileStream timeStamp.
			self fileOutPreambleOn: fileStream.
			self fileOutOn: fileStream.
			self fileOutPostscriptOn: fileStream ]].

	self hasUnsavedChanges: false.
	(Preferences at: #checkForSlips) 		ifFalse: [^ self].
	slips := self checkForSlips.
	(slips notEmpty
			and: [(PopUpMenu withCaption: 'Methods in this fileOut have halts
or references to the Transcript
or other ''slips'' in them.
Would you like to browse them?' chooseFrom: 'Ignore\Browse slips')
					= 2])
		ifTrue: [ Smalltalk browseMessageList: slips name: 'Possible slips in ' , name ]! !
!CodeFile methodsFor: 'fileIn/fileOut' stamp: 'jmv 8/6/2024 17:17:43' prior: 16822427!
            fileOut
	self request: 'Enter the file name' initialAnswer: '' do: [ :aString |
		DirectoryEntry fileOutsDirectory // aString writeStreamDo: [ :fileStream |
			fileStream ifNotNil: [
				sourceSystem isEmpty
					ifFalse: [ fileStream nextChunkPut: sourceSystem printString; newLine ].
				self fileOutOn: fileStream.
				fileStream newLine; newLine.
				classes do: [ :cls |
					cls needsInitialize
						ifTrue: [ fileStream newLine; nextChunkPut: cls name,' initialize']].
				fileStream newLine ]]].! !
!PseudoClass methodsFor: 'fileIn/fileOut' stamp: 'jmv 8/6/2024 17:18:24' prior: 16932837!
          fileOut

	DirectoryEntry fileOutsDirectory // (self name, '.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			self fileOutOn: fileStream.
			self needsInitialize ifTrue: [
				fileStream newLine; nextChunkPut: self name,' initialize' ]]].! !
!PseudoClass methodsFor: 'fileIn/fileOut' stamp: 'jmv 8/6/2024 17:18:43' prior: 16932847!
      fileOutCategory: categoryName

	DirectoryEntry fileOutsDirectory // (self name,'-',categoryName,'.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			self fileOutMethods: (self organization listAtCategoryNamed: categoryName) on: fileStream ]].! !
!PseudoClass methodsFor: 'fileIn/fileOut' stamp: 'jmv 8/6/2024 17:19:02' prior: 16932866!
   fileOutMethod: selector

	DirectoryEntry fileOutsDirectory // (name,'-', selector asFileName, '.st') writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			self fileOutMethods: (Array with: selector) on: fileStream ]].! !
!SpaceTally methodsFor: 'fileOut' stamp: 'jmv 8/6/2024 17:19:21' prior: 16957855!
            printSpaceAnalysis	
	"
	SpaceTally new printSpaceAnalysis
	"

	DirectoryEntry logsDirectory // 'STspace.text' writeStreamDo: [ :fileStream |
		fileStream ifNotNil: [
			self printSpaceAnalysis: 1 on: fileStream ]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6568-Fileout-DoNothingIfUserCancelsFileCreation-JuanVuletich-2024Aug06-17h25m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6568] on 7 August 2024 at 1:09:05 pm'!
!Form methodsFor: 'accessing' stamp: 'jmv 8/7/2024 10:45:39'!
        bitsSizeForWidth: aWidth height: aHeight depth: aDepth

	^ (self wordsPerLine: aWidth depth: aDepth) * aHeight! !
!Form methodsFor: 'accessing' stamp: 'jmv 8/7/2024 10:38:53'!
                pixelsPerWord: aDepth
	^32 // aDepth! !
!Form methodsFor: 'accessing' stamp: 'jmv 8/7/2024 10:42:37'!
                          wordsPerLine: aWidth depth: aDepth
	| pixPerWord |
	pixPerWord := self pixelsPerWord: aDepth.
	^ aWidth + pixPerWord - 1 // pixPerWord! !
!Form methodsFor: 'accessing' stamp: 'jmv 8/7/2024 10:46:07' prior: 16867155!
        bitsSize

	^self bitsSizeForWidth: width height: height depth: self depth! !
!Form methodsFor: 'accessing' stamp: 'jmv 8/7/2024 10:46:56' prior: 16867194!
     pixelsPerWord
	^self pixelsPerWord: self depth! !
!Form methodsFor: 'accessing' stamp: 'jmv 8/7/2024 10:43:58' prior: 16867207!
wordsPerLine

	^self wordsPerLine: width depth: self depth.
! !
!Form methodsFor: 'private' stamp: 'jmv 8/7/2024 13:08:37' prior: 16869587!
                    setExtent: extent depth: bitsPerPixel
	"Create a virtual bit map with the given extent and bitsPerPixel."

	| newBits newDepth newHeight newWidth |

	"Find parameters and allocate new bits before modifying this instance.
	If, for whatever reason, allocation fails, an exception will be raised
	and this instance (if already initialized) will still be in a consistent state."
	newWidth := extent x asInteger max: 0.
	newHeight := extent y asInteger max: 0.
	newDepth := bitsPerPixel.
	newBits := Bitmap new: (self bitsSizeForWidth: newWidth height: newHeight depth: newDepth abs).

	"If we get to this point, allocation succeeded. If we are already initialized (bits notNil), then set
	width, height and depth before setting bits, only if bits will later shrink. This is to avoid an unlikely
	invalid access in some other process if this instance is used elsewhere. This could be a serious problem
	for instance for Display."
	(bits notNil and: [ 		newBits size < bits size ]) ifTrue: [
		width := newWidth.
		height := newHeight.
		depth := newDepth ].

	"All good. Assign the new state."
	bits := newBits.
	width := newWidth.
	height := newHeight.
	depth := newDepth.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6569-MoreRobustFormAllocation-JuanVuletich-2024Aug07-12h59m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6517] on 7 August 2024 at 10:49:00 am'!
!WorldMorph methodsFor: 'update cycle' stamp: 'jfr 8/7/2024 10:48:53' prior: 17007813!
      checkForNewScreenSize
	"Check whether the screen size has changed and if so take appropriate actions"

	| newScaleFactor e p |
	DisplayScreen isDisplayExtentOk ifFalse: [
		"If host OS scale factor has changed, try to recover our previous Display extent"
		newScaleFactor := DisplayScreen hostOSScaleFactor.
		newScaleFactor = ScaleFactor ifFalse: [
			ScaleFactor := newScaleFactor.
			e := DisplayScreen hostOSWindowExtent ifNotNil: [ :ee |
				ee * ScaleFactor - DisplayScreen actualScreenSize + Display extent ].
			p := DisplayScreen hostOSWindowPosition.
			e ifNotNil: [DisplayScreen hostOSWindowExtent: e].
			p ifNotNil: [DisplayScreen hostOSWindowPosition: p].
		].
		[
			"This allocates new memory for Display and is critical."
			DisplayScreen setupDisplay.
			UISupervisor newUIProcess.
			self whenUIinSafeState: [ Cursor defaultCursor activateCursor ]
		] on: OutOfMemory do: [
			"In case of allocation failure, don't allocate Display right now,
			but start a new UI process. This will retry the Display resize real soon."
			'Display allocation failed'  print.
			UISupervisor newUIProcess 		]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6570-MainWindowResize-protectAgainstAllocationFailure-JonRaiford-2024Aug07-10h48m-jfr.001.cs.st----!

'From Cuis7.1 [latest update: #6570] on 7 August 2024 at 4:53:01 pm'!
!LayoutMorph class methodsFor: 'instance creation' stamp: 'jmv 8/7/2024 16:49:47' prior: 16890529 overrides: 16787725!
       new
	"Answer a row by default so the 'new morph' menu doesn't fail..."
	^self newRow! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6571-LayoutMorph-new-cleanup-JuanVuletich-2024Aug07-16h48m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6571] on 8 August 2024 at 12:34:10 pm'!
!SUnitNameResolver class methodsFor: 'Camp Smalltalk' stamp: 'jmv 8/8/2024 12:19:22' prior: 16943625!
                    errorObject
	^Error! !
!TestResult methodsFor: 'running' stamp: 'jmv 8/8/2024 12:09:39' prior: 16976114!
                       runCase: aTestCase

	| testCasePassed |

	testCasePassed :=
		[
			[
				self reportAboutToRun: aTestCase.
				aTestCase runCase.
				self reportPassed: aTestCase.
				true]
					on: self class failure
					do: [ :signal |
						self reportFailed: aTestCase because: signal.
						(self failures isEmpty or: [ failures last ~~ aTestCase ])
							ifTrue: [ failures add: aTestCase ].
						signal sunitExitWith: false ]]
							on: UnhandledError
							do: [ :signal |
								self reportError: aTestCase because: signal.
								aTestCase errored: signal.
								self errors add: aTestCase.
								signal sunitExitWith: false ].

	testCasePassed
		ifTrue: [ self passed add: aTestCase ]! !
!TestResult class methodsFor: 'exceptions' stamp: 'jmv 8/8/2024 12:12:24' prior: 16976183!
               signalErrorWith: aString 
	TestResult exError sunitSignalWith: aString.! !

TestResult class removeSelector: #error!

!methodRemoval: TestResult class #error stamp: 'Install-6572-SUnit-dontRaiseUnhandledError-JuanVuletich-2024Aug08-12h31m-jmv.001.cs.st 8/13/2024 18:36:55'!
error
	^self exError
			!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6572-SUnit-dontRaiseUnhandledError-JuanVuletich-2024Aug08-12h31m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6427] on 7 August 2024 at 8:46:42 pm'!
!TestResult methodsFor: 'accessing' stamp: 'HAW 8/7/2024 20:39:53'!
                             addAll: tests asFailureBecause: aReason

	tests do: [ :aFailedTest |
		self reportFailed: aFailedTest because: aReason.
		self failures add: aFailedTest ]! !
!TestResource class methodsFor: 'creation' stamp: 'HAW 8/7/2024 20:40:19' prior: 16975943!
       signalInitializationError
	^TestResult signalFailureWith: 'Resource ' , self name , ' could not be initialized'
			! !
!TestSuite methodsFor: 'running' stamp: 'HAW 8/7/2024 20:39:09' prior: 16977160!
                        run

	| result |
 
	result := TestResult new.
	
	[ self setUpResources ] 
		on: result class failure 
		do: [ :aFailure |
			result addAll: tests asFailureBecause: aFailure messageText.
			self tearDownResources.
			^result ].
		
	[self run: result] ensure: [self tearDownResources].
	
	^result
			! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6573-FailWhenResourceNotAvailable-HernanWilkinson-2024Aug07-20h39m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6573] on 8 August 2024 at 3:16:03 pm'!
!LayoutMorph class methodsFor: 'instance creation' stamp: 'KenD 8/8/2024 06:52:13' overrides: 16907514!
                     initializedInstance

	^self newRow! !
!LayoutMorph class methodsFor: 'instance creation' stamp: 'KenD 8/8/2024 06:53:03' prior: 50363726 overrides: 16787725!
  new
	"Answer a row by default so the 'new morph' menu doesn't fail..."
	^self error: 'Use LayoutMorph newRow or LayoutMorph newColumn'.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6574-LayoutMorph-tweaks-KenDickey-2024Aug08-15h15m-KenD.001.cs.st----!

'From Cuis7.1 [latest update: #6574] on 8 August 2024 at 5:24:53 pm'!
!CharacterSequence methodsFor: 'accessing' stamp: 'jmv 8/8/2024 16:48:51'!
    utf8BytesSize
	"Optimized where appropriate."
	^self asUtf8Bytes size! !
!String methodsFor: 'accessing' stamp: 'jmv 8/8/2024 16:54:52' overrides: 50363844!
   utf8BytesSize
	"Avoid creating the actual byte array."

	| byteCount |
	"Fast lane."
	self isAscii ifTrue: [ ^self size ].

	"Need to do UTF-8 encoding."
	byteCount := 0.
	self do: [ :c |
		Character
			evaluate: [ :byte | byteCount := byteCount + 1 ]
			withUtf8BytesOf: c codePoint ].
	^byteCount! !
!UnicodeString methodsFor: 'accessing' stamp: 'jmv 8/8/2024 16:56:37' overrides: 50363844!
                       utf8BytesSize
	"We are already UTF-8 encoded."

	^bytes size! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6575-Strings-utf8BytesSize-JuanVuletich-2024Aug08-17h24m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6575] on 9 August 2024 at 10:47:21 am'!
!MessageNode methodsFor: 'macro transformations' stamp: 'jmv 8/9/2024 10:39:09' prior: 16897053!
                   transformToDo: encoder
	" var := rcvr. L1: [var <= arg1] Bfp(L2) [block body. var := var + inc] Jmp(L1) L2: "
	| limit increment block initStmt test incStmt limitInit blockVar myRange blockRange limitIsAssignedTo |
	block := arguments last.
	"First check for valid arguments"
	(block notNil
	 and: [block isBlockNode
	 and: [block numberOfArguments = 1
	 and: [block firstArgument isVariableReference "As with debugger remote vars"]]]) ifFalse:
		[^false].
	arguments size = 3
		ifTrue: [increment := arguments at: 2.
				(increment isConstantNumber
				 and: [increment literalValue ~= 0]) ifFalse: [^false]]
		ifFalse: [increment := encoder encodeLiteral: 1].
	(limit := arguments at: 1) isVariableReference ifTrue:
		[limitIsAssignedTo := false.
		 block nodesDo:
			[:node|
			(node isAssignmentNode and: [node variable = limit]) ifTrue:
				[limitIsAssignedTo := true]].
		 limitIsAssignedTo ifTrue:
			[^false]].
	arguments size < 3 ifTrue:   "transform to full form"
		[selector := SelectorNode new key: #to:by:do: code: #macro].

	"Now generate auxiliary structures"
	myRange := encoder rawSourceRanges at: self ifAbsent: [1 to: 0].
	blockRange := encoder rawSourceRanges at: block ifAbsent: [1 to: 0].
	blockVar := block firstArgument.
	initStmt := AssignmentNode new variable: blockVar value: receiver.
	limit isVariableReference | limit isConstantNumber
		ifTrue: [limitInit := nil]
		ifFalse:  "Need to store limit in a var"
			[limit := encoder bindBlockArg: blockVar key, 'LimiT' within: block.
			 limit scope: -2.  "Already done parsing block; flag so it won't print"
			 block addArgument: limit.
			 limitInit := AssignmentNode new
							variable: limit
							value: arguments first].
	test := MessageNode new
				receiver: blockVar
				selector: (increment key > 0 ifTrue: [#<=] ifFalse: [#>=])
				arguments: {limit}
				precedence: precedence
				from: encoder
				sourceRange: (myRange first to: blockRange last+1).
	incStmt := AssignmentNode new
				variable: blockVar
				value: (MessageNode new
							receiver: blockVar selector: #+
							arguments: {increment}
							precedence: precedence
							from: encoder
							sourceRange: (myRange last to: (myRange last max: blockRange last)))
				from: encoder
				sourceRange: (myRange last to: (myRange last max: blockRange last)).
	arguments := {limit. increment. block. initStmt. test. incStmt. limitInit}.
	block noteOptimizedIn: self.
	^true! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6576-fixDebuggerHighlightOf-to-do-JuanVuletich-2024Aug09-10h45m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6575] on 9 August 2024 at 10:53:08 am'!
!CharacterSequence methodsFor: 'accessing' stamp: 'jmv 8/8/2024 17:07:24' prior: 16812917!
                        subStrings: separators 
	"Answer an array containing the substrings in the receiver separated 
	by any of the elements of separators.
	Answer will not include empty strings
	'Hello World' subStrings: ' '
	'1Hello12World1This1211Are31Words1' subStrings: '123'
	'1Hello12World1This1211Are31Words1' subStrings: #($1 $2 $3)
	"

	| delimiterCharacters out |
	delimiterCharacters := separators asArray.
	^Array streamContents: [ :answer |
		out := self species writeStream.
		self do: [ :char |
			(delimiterCharacters identityIncludes:			char)
				ifFalse: [ out nextPut: char ]
				ifTrue: [
					out isEmpty ifFalse: [
						answer nextPut: out contents.
						out := self species writeStream ]]].
		out isEmpty ifFalse: [
			answer nextPut: out contents ]].! !
!CharacterSequence methodsFor: 'accessing' stamp: 'jmv 8/8/2024 17:07:57' prior: 16812946!
              substringsSeparatedBy: delimiterCharacter
	"Find substrings delimited by aCharacter.
	Answer may include empty strings
	'0063;LATIN SMALL LETTER C;Ll;0;L;;;;;N;;;0043;;0043' substringsSeparatedBy: $;
	"

	| out |
	^Array streamContents: [ :answer |
		out := self species writeStream.
		self do: [ :char |
			char = delimiterCharacter
				ifFalse: [ out nextPut: char ]
				ifTrue: [
					answer nextPut: out contents.
					out := self species writeStream ]].
		answer nextPut: out contents.
		out := nil ].! !
!CharacterSequence methodsFor: 'converting' stamp: 'jmv 8/8/2024 17:05:51' prior: 16813300!
      asCamelCase
	"Answer a new String, without any whitespace, and with words capitalized (Except for the first one)
	' how do you do? ' asCamelCase
	"
	^ self species streamContents: [ :outStream | | capitalize wroteSome |
		wroteSome := false.
		capitalize := false.
		self do: [ :each | | c |
			c := each.
			c isSeparator
				ifTrue: [ capitalize := true ]
				ifFalse: [
					capitalize & wroteSome ifTrue: [ c := c asUppercase ].
					outStream nextPut: c.
					wroteSome := true.
					capitalize := false ]]].! !
!String methodsFor: 'converting' stamp: 'jmv 8/8/2024 17:10:33' prior: 50352260!
          asCodePoints
	"Convert the given string to UTF-32 from the internal encoding: ISO Latin-1 (ISO 8859-1).
	Answer a WordArray."
	
	^WordArray streamContents: [ :outStream |
		self do: [ :c |
			outStream nextPut: c codePoint ]].! !
!String methodsFor: 'converting' stamp: 'jmv 8/8/2024 17:11:12' prior: 50352274 overrides: 16813499!
                     asUtf8Bytes
	"Convert the given string to UTF-8 from the internal encoding: ISO Latin-1 (ISO 8859-1)
	Answer a ByteArray with a valid UTF-8 sequence."

	"Fast lane."
	self isAscii ifTrue: [ ^self asByteArray ].

	"Need to do UTF-8 encoding."
	^ByteArray streamContents: [ :outStream |
		self do: [ :c |
			Character
				evaluate: [ :byte | outStream nextPut: byte ]
				withUtf8BytesOf: c codePoint ]].! !
!String methodsFor: 'converting' stamp: 'jmv 8/8/2024 17:11:54' prior: 16959868 overrides: 16813503!
     asUtf8BytesOrByteString
	"Similar to #asUtf8Bytes.
	May answer an instance of String as an optimization.
	See senders"

	"Fast lane."
	self isAscii ifTrue: [ ^self ].

	"Need to do UTF-8 encoding."
	^ByteArray streamContents: [ :outStream |
		self do: [ :c |
			Character
				evaluate: [ :byte | outStream nextPut: byte ]
				withUtf8BytesOf: c codePoint ]].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6577-String-cleanup-JuanVuletich-2024Aug09-10h47m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6427] on 8 August 2024 at 8:10:36 pm'!
!TestCase class methodsFor: 'instance creation' stamp: 'HAW 8/8/2024 20:04:14'!
  debugAsFailure: aSymbol 

	^(self selector: aSymbol) debugAsFailure! !
!Browser methodsFor: 'tdd' stamp: 'HAW 8/8/2024 20:04:36' prior: 16799059!
              debugMethodTest
	
	currentCompiledMethod isTestMethod ifTrue: [
		currentCompiledMethod methodClass debugAsFailure: currentCompiledMethod selector ]
! !
!MethodSet methodsFor: 'run tests' stamp: 'HAW 8/8/2024 20:04:43' prior: 16901927!
                    debugMethodTest
	
	currentCompiledMethod isTestMethod ifTrue: [
		currentCompiledMethod methodClass debugAsFailure: currentCompiledMethod selector ]
! !
!SmalltalkEditor methodsFor: 'tdd' stamp: 'HAW 8/8/2024 20:04:51' prior: 16954508!
                    acceptAndDebugTest
	
	^self acceptAndWithMethodDo: [ :aPotencialTestMethod | 
		aPotencialTestMethod isTestMethod ifTrue: [ 
			aPotencialTestMethod methodClass debugAsFailure: aPotencialTestMethod selector ]]! !
!TestCase methodsFor: 'debugging' stamp: 'HAW 8/8/2024 20:03:50' prior: 16975514!
                         debugAsFailure
	
	^self debugInstance runCaseAsFailure! !

TestCase class removeSelector: #debugAsFailure:ifCanNot:!

!methodRemoval: TestCase class #debugAsFailure:ifCanNot: stamp: 'Install-6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st 8/13/2024 18:36:55'!
debugAsFailure: aSymbol ifCanNot: handler

	^(self selector: aSymbol) debugAsFailureIfCanNot: handler
	!

TestCase class removeSelector: #canNotDebugMethodErrorDescription!

!methodRemoval: TestCase class #canNotDebugMethodErrorDescription stamp: 'Install-6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st 8/13/2024 18:36:55'!
canNotDebugMethodErrorDescription

	^'Quick methods can not be debugged'!

TestCase removeSelector: #debugAsFailureIfCanNot:!

!methodRemoval: TestCase #debugAsFailureIfCanNot: stamp: 'Install-6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st 8/13/2024 18:36:55'!
debugAsFailureIfCanNot: handler
	self ifCanNotDebugDo: [^ handler value].
	self debugInstance runCaseAsFailure!

TestCase removeSelector: #signalCanNotDebugMethod!

!methodRemoval: TestCase #signalCanNotDebugMethod stamp: 'Install-6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st 8/13/2024 18:36:55'!
signalCanNotDebugMethod 

	self error: self canNotDebugMethodErrorDescription!

TestCase removeSelector: #canNotDebugMethodErrorDescription!

!methodRemoval: TestCase #canNotDebugMethodErrorDescription stamp: 'Install-6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st 8/13/2024 18:36:55'!
canNotDebugMethodErrorDescription

	^self class canNotDebugMethodErrorDescription!

TestCase removeSelector: #ifCanNotDebugDo:!

!methodRemoval: TestCase #ifCanNotDebugDo: stamp: 'Install-6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st 8/13/2024 18:36:55'!
ifCanNotDebugDo: handler

	^self methodForTest isQuick ifTrue: handler!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6578-RemoveCannotDebugTest-HernanWilkinson-2024Aug08-20h03m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6578] on 10 August 2024 at 10:24:09 pm'!
!Class methodsFor: 'accessing class hierarchy' stamp: 'HAW 8/10/2024 22:21:41' prior: 50348887 overrides: 16787874!
                             superclass: aClassOrNil
	"Change the receiver's superclass to be aClass.
	Keep the subclass / superclass invariant.
	Not to be used lightly!!
	Usually used only to create subclasses of nil."

	| oldSuperclass |
	oldSuperclass := superclass.
	super superclass: aClassOrNil.
	oldSuperclass == superclass ifFalse: [
		oldSuperclass removeSubclass: self.
		aClassOrNil addSubclass: self ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6579-ChangeSuperclassFix-HernanWilkinson-2024Aug10-22h19m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6579] on 11 August 2024 at 8:03:33 pm'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/11/2024 20:01:11' prior: 50358479!
           snapshot: save andQuit: quit embedded: embeddedFlag clearAllClassState: clearAllStateFlag
	"This is the main method for image save and / or quit.
	See senders."
	"WARNING: Current process will be killed. UI Process will be restarted"
	"Mark the changes file and close all files as part of #processShutdownList.
	If save is true, save the current state of this Smalltalk in the image file.
	If quit is true, then exit to the outer OS shell.
	The latter part of this method runs when resuming a previously saved image. This resume logic
	checks for a document file to process when starting up."
	"
	To test the full cleanup and startup procedures, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: true

	To test the cleanup done when saving the image, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: false
	"
	| activeProc |
	activeProc := Processor activeProcess.
[
	| isARealStartup guiRootObject guiRootObjectClass userBaseDirectory |
	save not & quit
		ifTrue: [ (SourceFiles at: 2) ifNotNil: [ :changes |
				ChangesInitialFileSize ifNotNil: [ changes truncate: ChangesInitialFileSize ]]]
		ifFalse: [ self logSnapshot: save andQuit: quit ].
	clearAllStateFlag ifTrue: [
		TranscriptWindow allInstancesDoAlt: [ :each |
			each isInWorld ifTrue: [ each delete.]].
		UISupervisor ui tearDownDesktop.
		Transcript logToFile: false ].
	ActiveModel flushEventSystem.
	self processShutDownList: quit.
	"These could be moved to some #shutDown"
	self stopLowSpaceWatcher.
	WeakArray stopFinalizationProcess.
	ProcessorScheduler stopBackgroundProcess.
	"Stuff needed to relaunch UI on startup"
	guiRootObjectClass := UISupervisor ui class.
	"Replace with this to create a new world at startup after 'saveAsNewVersion'"
	guiRootObject := clearAllStateFlag ifFalse: [ UISupervisor ui ].

	UISupervisor stopUIProcess.
	activeProc isTerminated ifFalse: [ activeProc terminate ].
	guiRootObject ifNotNil: [ guiRootObject releaseCachedState ].
	clearAllStateFlag ifTrue: [
		Processor processesDo: [ :p |
			(p name = 'Formerly: Morphic UI') ifTrue: [ p terminate ]]].
	MorphicCanvas allSubInstancesDoAlt: [ :c |
		(c ownerProcess notNil and: [c ownerProcess isTerminated]) ifTrue: [
			c releaseEngine			]].

	"Clean Globals"
	userBaseDirectory := DirectoryEntry userBaseDirectory.
	self at: #Sensor put: nil.
	self closeSourceFiles.
	self at: #SourceFiles put: nil.
	self allClassesDo: [ :cls |
		cls releaseClassCachedState ].
	clearAllStateFlag ifTrue: [
		self allClassesDo: [ :cls |
			cls releaseClassState ]].
	"To keep cleaning stuff that shouldn't be saved..."
	clearAllStateFlag ifTrue: [
		Transcript clear.
		"Enable this call to actually see the image clean report."
		false ifTrue: [self printStuffToCleanOnImageSave]].
	"Do image save & quit as apropriate"
	(Cursor cursorAt: #writeCursor) activateCursor.
	isARealStartup := false.
	save ifTrue: [
		"The snapshot primitive answers false if it was just called to do the snapshot.
		But image startup is resumed by returning (again) from the primitive, but this time answering true.
		nil means saving image failed"
		isARealStartup := embeddedFlag
			ifTrue: [ self snapshotEmbeddedPrimitive ]
			ifFalse: [ self snapshotPrimitive ]].
	quit & (isARealStartup == false) ifTrue: [ self quitPrimitive ]. "Don't quit on nil (image save failed)"

	isARealStartup == true ifFalse: [ 									"Keep current #userBaseDirectory unless a real startup"
		DirectoryEntry setUserBaseDirectory: userBaseDirectory ].

	"If starting from absolute scratch, this would be a good time to recreate Global names"
	self at: #Sensor put: nil.
	self at: #SourceFiles put: (Array new: 2).
	self logStartupDebugAid: 'To #openSourceFiles'.
	self openSourceFiles.
	"Here, startup begins!! (isARealStartup might be nil)"
	self logStartupDebugAid: 'To #initClassCachedState'.
	self allClassesDo: [ :cls | cls initClassCachedState ].
	self logStartupDebugAid: 'To #doStartUp:'.
	self doStartUp: isARealStartup == true.
	self logStartupDebugAid: 'To #spawnNewMorphicProcessFor: ', guiRootObject printString.
	UISupervisor spawnNewMorphicProcessFor: (guiRootObject ifNil: [ guiRootObject := guiRootObjectClass newWorld ]).
	isARealStartup == true
		ifTrue: [
			self logStartupDebugAid: 'To #restoreLostChangesIfNecessary'.
			self restoreLostChangesIfNecessary ].
	self assureStartupStampLogged.
	clearAllStateFlag ifTrue: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #recreateDefaultDesktop'.
			guiRootObject recreateDefaultDesktop; restoreDisplay ]]
	ifFalse: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #restoreDisplay'.
			guiRootObject restoreDisplay ]].
	isARealStartup == true
		ifTrue: [
			"If system is coming up (VM and image just started)"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs.
				self logStartupDebugAid: 'To #processCommandLineArguments'.
				self processCommandLineArguments.
				self logStartupDebugAid: 'To #launchApp'.
				AppLauncher launchApp ]]
		ifFalse: [
			"If we are just saving the image"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs ]].
	"Now it's time to raise an error"
	isARealStartup ifNil: [ self logStartupError: 'Failed to write image file (disk full?)' ]
]
	forkAt: Processor timingPriority - 1
	named: 'Startup process'.! !
!SystemDictionary methodsFor: 'startup' stamp: 'HAW 1/17/2024 20:50:59' prior: 50362948!
                        setStartupStamp

	| dateAndTime |
	dateAndTime := DateAndTime now.
	StartupStamp := String streamContents: [ :stream |
		stream nextPutAll: '----STARTUP---- ('.
		dateAndTime date printOn: stream.
		stream space.
		dateAndTime time print24: true showSeconds: true on: stream.
		stream
			nextPutAll: ') as ';
			nextPutAll: self imageName ] 
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6580-LogStartupAfterRecoveringChangesNotBefore-JuanVuletich-2024Aug11-20h03m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6580] on 11 August 2024 at 9:05:10 pm'!
!BrowserWindow methodsFor: 'menu & kbd shortcuts' stamp: 'HAW 8/11/2024 21:01:04' prior: 50358003!
   classListMenuSpec
	"Spec for the menu and shortcut keys for the class list.
	See coment at Morph >> #getMenu
	"
	^#(
		#(0 		'Class List' 					false)
		#(10		'browse full (b)' 							$b 	window 			browseMethodFull 									editFindReplaceIcon)
		#(20		'browse hierarchy (h)' 							$h 	window 			browseHierarchy 									goTopIcon)
		#(30		'browse protocol (p)' 							$p 	window 			browseFullProtocol 									spreadsheetIcon)
		#(40 		'-----')
		#(50		'fileOut' 							nil 	model 			fileOutClass 									fileOutIcon)
		#(60		'run tests (t)' 							$t 	model 			runClassTests 									weatherFewCloudsIcon)
		#(70 		'-----')
		#(90		'refactorings' 							nil 	nil 			1000 									listAddIcon)
		#(100		'copy class...' 							nil 	model 			copyClass 									copyIcon)
		#(110		'remove class (x)' 							$x 	model 			removeClass 									deleteIcon)
		#(120 		'-----')
		#(130		'show classes hierarchically' 							nil 	model 			enableListClassesHierarchically 									goTopIcon)
		#(140		'show classes alphabetically' 							nil 	model 			enableListClassesAlphabetically 									sendReceiveIcon)
		#(150		'show definition' 							nil 	model 			editClass 									editFindReplaceIcon)
		#(160		'show comment' 							nil 	model 			editComment 									editFindReplaceIcon)
		#(170 		'-----')
		#(180		'inst var refs...' 							nil 	window 			browseInstVarRefs 									instanceIcon)
		#(190		'inst var defs...' 							nil 	window 			browseInstVarDefs 									instanceIcon)
		#(200 		'-----')
		#(210		'class var refs...' 							nil 	window 			browseClassVarRefs 									classIcon)
		#(220		'class vars' 							nil 	window 			browseClassVariables 									classIcon)
		#(230		'class refs (N)' 							$N 	window 			browseClassRefs 									classIcon)
		#(240 		'-----')
		#(250		'more' 							nil 	nil 			2000 									listAddIcon)

		"Shortcut only. No menu entry."
		#(991		nil 							$r 	model 			recent)

		" 'refactorings' SubMenu"
		#(1005		'rename class... (R)' 							$R 	model 			renameClass 									saveAsIcon)
		#(1010		'insert superclass...' 							nil 	model 			insertSuperclass 									saveAsIcon)
		#(1020 		'-----')
		#(1030		'add inst var...' 							nil 	model 			addInstVar 									listAddIcon)
		#(1040		'rename inst var...' 							nil 	model 			renameInstVar 									saveAsIcon)
		#(1050		'remove inst var...' 							nil 	model 			removeInstVar 									deleteIcon)
		#(1060		'remove all unreferenced inst var...' 						
											nil 	model 			removeAllUnreferencedInstVar 									deleteIcon)
		#(1070		'push up inst var...' 							nil 	model 			pushUpInstanceVariable 									goTopIcon)
		#(1080		'push down inst var...' 							nil 	model 			pushDownInstanceVariable 									goBottomIcon)
		#(1090 		'-----')
		#(1100		'rename global...' 							nil 	model 			renameGlobal 									saveAsIcon)

		" 'more' SubMenu"
		#(2010		'unsent methods' 							nil 	window 			browseUnusedMethods 									junkIcon
					'browse all methods defined by this class that have no senders')
		#(2020		'unreferenced inst vars' 							nil 	window 			showUnreferencedInstVars 									junkIcon
					'show a list of all instance variables that are not referenced in methods')
		#(2030		'unreferenced class vars' 							nil 	window 			showUnreferencedClassVars 									junkIcon
					'show a list of all class variables that are not referenced in methods')
		#(2040		'subclass template' 							nil 	model 			makeNewSubclass 									classIcon
					'put a template into the code pane for defining of a subclass of this class')
		#(2050 		'-----')
		#(2060		'sample instance' 							nil 	window 			makeSampleInstance 									instanceIcon
					'give me a sample instance of this class, if possible')
		#(2070		'inspect instances' 							nil 	window 			inspectInstances 									inspectIcon
					'open an inspector on all the extant instances of this class')
		#(2080		'inspect subinstances' 							nil 	window 			inspectSubInstances 									inspectIcon
					'open an inspector on all the extant instances of this class and of all of its subclasses')
		#(2090 		'-----')
		#(2100		'create inst var accessors' 							nil 	model 			createInstVarAccessors 									sendReceiveIcon
					'compile instance-variable access methods for any instance variables that do not yet have them')
	)! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6581-RenameClassToRefactoringMenu-HernanWilkinson-2024Aug11-21h01m-HAW.001.cs.st----!

'From Cuis7.1 [latest update: #6581] on 12 August 2024 at 9:30:08 am'!

LayoutMorph removeSelector: #addMorph:!

!methodRemoval: LayoutMorph #addMorph: stamp: 'Install-6582-LayoutMorph-Cleanup-HilaireFernandes-2024Aug12-09h28m-hlsf.001.cs.st 8/13/2024 18:36:55'!
addMorph: aMorph
	"Add a submorph, at the bottom or right, with a default LayoutSpec if none was provided."

	aMorph isPlacedMorph ifFalse: [ self error: 'Only PlacedMorphs can be used in Layouts' ].
	aMorph layoutSpec.
	super addMorphFront: aMorph!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6582-LayoutMorph-Cleanup-HilaireFernandes-2024Aug12-09h28m-hlsf.001.cs.st----!

'From Cuis7.1 [latest update: #6582] on 12 August 2024 at 9:49:09 am'!
!LayoutMorph methodsFor: 'submorphs-add/remove' stamp: 'KenD 8/11/2024 07:22:55' overrides: 16906908!
                       addMorphBack: aMorph
	"Add a submorph, at the top or left, with a default LayoutSpec if none was provided."

	aMorph isPlacedMorph ifFalse: [ self error: 'Only PlacedMorphs can be used in Layouts' ].
	aMorph layoutSpec.
	super addMorphBack: aMorph.! !
!LayoutMorph methodsFor: 'submorphs-add/remove' stamp: 'jmv 8/12/2024 09:46:40' prior: 16890452!
   addMorph: aMorph layoutSpec: aLayoutSpec
	"Add a submorph, at the bottom or right, with aLayoutSpec"

	aMorph isPlacedMorph ifFalse: [ self error: 'Only PlacedMorphs can be used in Layouts' ].
	aMorph layoutSpec: aLayoutSpec.
	self addMorphFront: aMorph.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6583-LayourMorph-addMorphBack-KenDickey-2024Aug12-09h48m-KenD.001.cs.st----!

'From Cuis7.1 [latest update: #6583] on 13 August 2024 at 2:29:26 pm'!
!Browser methodsFor: 'class list' stamp: 'jmv 8/13/2024 14:28:33' prior: 50333840!
                              classListIndex: anInteger 
	"Set anInteger to be the index of the current class selection."

	| className recent canSelectClass classList prevSelectedClassName prevSelectedMessage |
	classList := self classList.
	canSelectClass := classList isInBounds: anInteger.
	prevSelectedClassName := selectedClassName.
	selectedClassName := canSelectClass ifTrue: [
		| newClassName |
		newClassName := classList at: anInteger ifAbsent: [ nil ].
		newClassName := newClassName ifNotNil: [newClassName withoutLeadingBlanks asSymbol].
		newClassName ].
	self setClassOrganizer.
	prevSelectedMessage := selectedMessage.
	selectedMessage := nil.
	
	self classCommentIndicated ifFalse: [
		self editSelection: (canSelectClass
			ifTrue: [#editClass]
			ifFalse: [ metaClassIndicated | selectedSystemCategory isNil
				ifTrue: [#none]
				ifFalse: [#newClass]])].

	self selectedClass ifNotNil: [
		recent := self class recentClasses.
		className := self selectedClass name.
		(recent includes: className) ifTrue: [recent remove: className].
		recent addFirst: className.
		recent size > 16 ifTrue: [recent removeLast]].

	"Clear selectedMessageCategory if there is no match in the new list of categories"
	(self messageCategoryList indexOf: selectedMessageCategory) = 0 ifTrue: [
		selectedMessageCategory := nil].
		
	"We have to refresh the class list if somebody wants to select a class that does not exist anymore"
	anInteger > classList size ifTrue: [ self changed: #classList ].
	self changed: #classSelectionChanged.
	self changed: #classCommentText.
	self changed: #classListIndex.	"update my selection"
	self changed: #messageCategoryList.
	self changed: #messageList.
	self changed: #relabel.
	self acceptedContentsChanged.
	prevSelectedClassName = selectedClassName ifFalse: [
		"If clicked on already selected class, deselect selector, so class definition is shown"
		self setSelector: prevSelectedMessage ].
! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6584-ClickingOnSelectedClassShowsClassDefinition-JuanVuletich-2024Aug13-14h25m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6584] on 13 August 2024 at 3:58:11 pm'!
!ChangeList class methodsFor: 'public access' stamp: 'jmv 8/13/2024 15:26:31'!
                         browseCondensedChanges: aFileEntry
	"Opens a changeList on a fileStream
	Condense older versions. Remove doits."
	| changeList |
	changeList := self new.
	aFileEntry readStreamDo: [ :stream |
		changeList scanFile: stream from: 0 to: stream size ].
	changeList
		removeOlderMethodVersions;
		removeDoIts.
	ChangeListWindow open: changeList label: 'Condensed changes from: ', aFileEntry name.! !
!ChangeList class methodsFor: 'fileIn/Out' stamp: 'jmv 8/13/2024 15:22:12'!
         serviceCondensedChanges
	"Answer a service for opening a changelist browser on a file"

	^ (SimpleServiceEntry 
		provider: self 
		label: 'open condensed changes'
		selector: #browseCondensedChanges:
		description: 'open a changes tool on this file, including only the last version of methods and avoiding doits'
		buttonLabel: 'real changes'
		icon: #changesIcon)
			sortOrder: 20! !
!ChangeList class methodsFor: 'fileIn/Out' stamp: 'jmv 8/13/2024 15:18:54' prior: 16805154!
  fileReaderServicesForFileEntry: filename suffix: suffix
	"FileList buttons that open a ChangeListWindow on contents"

	| coda sampleCoda |
	(#('st' 'cs' 'cs.st') includes: suffix)
		ifTrue: [ ^ {self serviceContents}  ].

	(suffix = 'pck') | (suffix = 'pck.st')
		ifTrue: [ ^ {self servicePackageContents} ].


	suffix = 'changes'
		ifTrue: [
			sampleCoda := '.user.159.changes'.
			filename name size > sampleCoda size ifTrue: [
				coda := filename name last: sampleCoda size.
				((coda beginsWith: '.user.') and: [ coda endsWith: '.changes' ]) ifTrue: [
					^ { self serviceContents. self serviceCondensedChanges} ]].
			^ {self serviceRecentChanges} ].

	^#()! !
!ChangeList class methodsFor: 'fileIn/Out' stamp: 'jmv 8/13/2024 15:21:32' prior: 16805168!
      serviceContents
	"Answer a service for opening a changelist browser on a file"

	^ (SimpleServiceEntry 
		provider: self 
		label: 'open code changes'
		selector: #browseContents:
		description: 'open a code file contents tool on this file'
		buttonLabel: 'all changes'
		icon: #changesIcon)
			sortOrder: 20! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6585-SpecificFileListServicesForUserChanges-JuanVuletich-2024Aug13-15h57m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6584] on 13 August 2024 at 3:59:57 pm'!

IdentityDictionary subclass: #SystemDictionary
	instanceVariableNames: 'cachedClassNames cachedNonClassNames startUpScriptArguments startUpArguments '
	classVariableNames: 'ChangesInitialFileSize EndianCache LastImageName LastQuitLogPosition LowSpaceProcess LowSpaceSemaphore ShutDownList SourceFileVersionString SpecialSelectors StartUpList StartupStamp PreviousUserChangesName '
	poolDictionaries: ''
	category: 'System-Support'!

!classDefinition: #SystemDictionary category: #'System-Support' stamp: 'Install-6586-RecordPreviousUserChangesFileName-JuanVuletich-2024Aug13-15h58m-jmv.001.cs.st 8/13/2024 18:36:56'!
IdentityDictionary subclass: #SystemDictionary
	instanceVariableNames: 'cachedClassNames cachedNonClassNames startUpScriptArguments startUpArguments'
	classVariableNames: 'ChangesInitialFileSize EndianCache LastImageName LastQuitLogPosition LowSpaceProcess LowSpaceSemaphore PreviousUserChangesName ShutDownList SourceFileVersionString SpecialSelectors StartUpList StartupStamp'
	poolDictionaries: ''
	category: 'System-Support'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 13:06:11' prior: 16965893!
                processShutDownList: quitting
	"Send #shutDown to each class that needs to wrap up before a snapshot."

	self send: #shutDown: toClassesNamedIn: ShutDownList with: quitting.
	EndianCache := nil.
	PreviousUserChangesName := nil.! !
!SystemDictionary methodsFor: 'sources, change log' stamp: 'jmv 8/13/2024 13:03:20' prior: 50362892!
                    assureStartupStampLogged
	"If there is a startup stamp not yet actually logged to disk, do it now."
	| changesFile directory oldUserChanges |
	(SourceFiles notNil and: [(changesFile := SourceFiles at: 2) notNil]) ifTrue: [
		changesFile isReadOnly ifFalse: [
			changesFile setToEnd; newLine; newLine.
			changesFile nextChunkPut: StartupStamp; newLine.
			self forceChangesToDisk ]].
	(Preferences at: #autoNumberUserChanges) ifTrue: [
		oldUserChanges := DirectoryEntry userChangesDirectory // self userChangesFileName.
		oldUserChanges exists ifTrue: [
			directory := oldUserChanges parent.
			PreviousUserChangesName := directory nextNameFor: oldUserChanges nameWithoutExtension extension: 'changes'.
			oldUserChanges rename: PreviousUserChangesName ]].
	DirectoryEntry userChangesDirectory // self userChangesFileName appendStreamDo: [ :stream |
		stream newLine; newLine.
		stream nextChunkPut: StartupStamp; newLine.
		stream flush ].! !

IdentityDictionary subclass: #SystemDictionary
	instanceVariableNames: 'cachedClassNames cachedNonClassNames startUpScriptArguments startUpArguments'
	classVariableNames: 'ChangesInitialFileSize EndianCache LastImageName LastQuitLogPosition LowSpaceProcess LowSpaceSemaphore PreviousUserChangesName ShutDownList SourceFileVersionString SpecialSelectors StartUpList StartupStamp'
	poolDictionaries: ''
	category: 'System-Support'!

!classDefinition: #SystemDictionary category: #'System-Support' stamp: 'Install-6586-RecordPreviousUserChangesFileName-JuanVuletich-2024Aug13-15h58m-jmv.001.cs.st 8/13/2024 18:36:56'!
IdentityDictionary subclass: #SystemDictionary
	instanceVariableNames: 'cachedClassNames cachedNonClassNames startUpScriptArguments startUpArguments'
	classVariableNames: 'ChangesInitialFileSize EndianCache LastImageName LastQuitLogPosition LowSpaceProcess LowSpaceSemaphore PreviousUserChangesName ShutDownList SourceFileVersionString SpecialSelectors StartUpList StartupStamp'
	poolDictionaries: ''
	category: 'System-Support'!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6586-RecordPreviousUserChangesFileName-JuanVuletich-2024Aug13-15h58m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6584] on 13 August 2024 at 4:05:18 pm'!
!SystemDictionary methodsFor: 'startup' stamp: 'jmv 8/13/2024 16:04:10'!
                      checkIfAlreadyRunningOrStoppedNoExit
	"
	If the Changes file is not clean during startup, it may mean either:
	- last run crashed or was killed (code recovery may be in order)
	- Cuis is already running. Running it again may mean inconsistent updates to .changes file.
	Smalltalk checkIfAlreadyRunningOrStoppedNoExit
	"
	| imageSaveChunk postImageSaveChunk |
	imageSaveChunk := nil.
	postImageSaveChunk := nil.
	self withChangesFileDo: [ :changesFile |
		changesFile position: self lastQuitLogPosition.
		changesFile atEnd ifFalse: [ imageSaveChunk := changesFile nextChunk ].
		changesFile atEnd ifFalse: [ postImageSaveChunk := changesFile nextChunk ]].

	"If we can't find the image save chunk at the image save position, something is wrong."
	(imageSaveChunk isNil or: [ (self isQuitRecord: imageSaveChunk) not])
		ifTrue: [
			UISupervisor whenUIinSafeState: [
				self notify:
					self currentChangesName asFullFileEntry pathName, String newLineString,
					'Image save chunk not found. Possible image / changes file corruption. Proceed with caution.' ].
				^self ].

	"If there is already a post-imageSave chunk, it may mean Cuis is running in another OS process,
	or in a previous run, it was killed or crashed."
	postImageSaveChunk notNil ifTrue: [
		(Preferences at: #checkLostChangesOnStartUp)
			ifTrue: [
				"Let the user chose automatic or manual recovery from .changes file.
				Used mainly by CuisUniversity."
				UISupervisor whenUIinSafeState: [self restoreLostChanges ]]
			ifFalse: [
				"Notify user about the situation, open changes recovery tool on last User Changes file."
				(Preferences at: #warnAndOfferLastUserChanges) ifTrue: [
					UISupervisor whenUIinSafeState: [self warnAndOfferLastUserChanges]]]].! !
!SystemDictionary methodsFor: 'startup - recover user changes' stamp: 'jmv 8/13/2024 15:45:19'!
                    warnAndOfferLastUserChanges
"
Smalltalk warnAndOfferLastUserChanges
"
 	| userChanges |
	PreviousUserChangesName ifNil: [
		self notify: 
			self currentChangesName asFullFileEntry pathName, ' is not clean.', String newLineString, String newLineString,
			'- Cuis may already be running (and running it twice may lead to .changes file corruption).', String newLineString,
			'		Suggestion: Exit this session and resume work on the other, already running, one.', String newLineString, String newLineString,
			'- Cuis may have crashed in a previous run.', String newLineString,
			'		However the appropriate User Changes file could not be automatically determined.', String newLineString, String newLineString,
			'Proceed with caution.' .
		^ self ].
		
	userChanges := DirectoryEntry userChangesDirectory // PreviousUserChangesName.
	self notify: 
		self currentChangesName asFullFileEntry pathName, ' is not clean.', String newLineString, String newLineString,
		'- Cuis may already be running (and running it twice may lead to .changes file corruption).', String newLineString,
		'		Suggestion: Exit this session and resume work on the other, already running, one.', String newLineString, String newLineString,
		'- Cuis may have crashed in a previous run.', String newLineString,
		'		Proceed to review and recover code from last saved User Changes file:', String newLineString,
		'		', userChanges pathName, String newLineString, String newLineString,
		'Proceed with caution.' .
	ChangeList browseCondensedChanges: userChanges.! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 09:17:29' prior: 50364201!
                            snapshot: save andQuit: quit embedded: embeddedFlag clearAllClassState: clearAllStateFlag
	"This is the main method for image save and / or quit.
	See senders."
	"WARNING: Current process will be killed. UI Process will be restarted"
	"Mark the changes file and close all files as part of #processShutdownList.
	If save is true, save the current state of this Smalltalk in the image file.
	If quit is true, then exit to the outer OS shell.
	The latter part of this method runs when resuming a previously saved image. This resume logic
	checks for a document file to process when starting up."
	"
	To test the full cleanup and startup procedures, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: true

	To test the cleanup done when saving the image, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: false
	"
	| activeProc |
	activeProc := Processor activeProcess.
[
	| isARealStartup guiRootObject guiRootObjectClass userBaseDirectory |
	save not & quit
		ifTrue: [ (SourceFiles at: 2) ifNotNil: [ :changes |
				ChangesInitialFileSize ifNotNil: [ changes truncate: ChangesInitialFileSize ]]]
		ifFalse: [ self logSnapshot: save andQuit: quit ].
	clearAllStateFlag ifTrue: [
		TranscriptWindow allInstancesDoAlt: [ :each |
			each isInWorld ifTrue: [ each delete.]].
		UISupervisor ui tearDownDesktop.
		Transcript logToFile: false ].
	ActiveModel flushEventSystem.
	self processShutDownList: quit.
	"These could be moved to some #shutDown"
	self stopLowSpaceWatcher.
	WeakArray stopFinalizationProcess.
	ProcessorScheduler stopBackgroundProcess.
	"Stuff needed to relaunch UI on startup"
	guiRootObjectClass := UISupervisor ui class.
	"Replace with this to create a new world at startup after 'saveAsNewVersion'"
	guiRootObject := clearAllStateFlag ifFalse: [ UISupervisor ui ].

	UISupervisor stopUIProcess.
	activeProc isTerminated ifFalse: [ activeProc terminate ].
	guiRootObject ifNotNil: [ guiRootObject releaseCachedState ].
	clearAllStateFlag ifTrue: [
		Processor processesDo: [ :p |
			(p name = 'Formerly: Morphic UI') ifTrue: [ p terminate ]]].
	MorphicCanvas allSubInstancesDoAlt: [ :c |
		(c ownerProcess notNil and: [c ownerProcess isTerminated]) ifTrue: [
			c releaseEngine			]].

	"Clean Globals"
	userBaseDirectory := DirectoryEntry userBaseDirectory.
	self at: #Sensor put: nil.
	self closeSourceFiles.
	self at: #SourceFiles put: nil.
	self allClassesDo: [ :cls |
		cls releaseClassCachedState ].
	clearAllStateFlag ifTrue: [
		self allClassesDo: [ :cls |
			cls releaseClassState ]].
	"To keep cleaning stuff that shouldn't be saved..."
	clearAllStateFlag ifTrue: [
		Transcript clear.
		"Enable this call to actually see the image clean report."
		false ifTrue: [self printStuffToCleanOnImageSave]].
	"Do image save & quit as apropriate"
	(Cursor cursorAt: #writeCursor) activateCursor.
	isARealStartup := false.
	save ifTrue: [
		"The snapshot primitive answers false if it was just called to do the snapshot.
		But image startup is resumed by returning (again) from the primitive, but this time answering true.
		nil means saving image failed"
		isARealStartup := embeddedFlag
			ifTrue: [ self snapshotEmbeddedPrimitive ]
			ifFalse: [ self snapshotPrimitive ]].
	quit & (isARealStartup == false) ifTrue: [ self quitPrimitive ]. "Don't quit on nil (image save failed)"

	isARealStartup == true ifFalse: [ 									"Keep current #userBaseDirectory unless a real startup"
		DirectoryEntry setUserBaseDirectory: userBaseDirectory ].

	"If starting from absolute scratch, this would be a good time to recreate Global names"
	self at: #Sensor put: nil.
	self at: #SourceFiles put: (Array new: 2).
	self logStartupDebugAid: 'To #openSourceFiles'.
	self openSourceFiles.
	"Here, startup begins!! (isARealStartup might be nil)"
	self logStartupDebugAid: 'To #initClassCachedState'.
	self allClassesDo: [ :cls | cls initClassCachedState ].
	self logStartupDebugAid: 'To #doStartUp:'.
	self doStartUp: isARealStartup == true.
	self logStartupDebugAid: 'To #spawnNewMorphicProcessFor: ', guiRootObject printString.
	UISupervisor spawnNewMorphicProcessFor: (guiRootObject ifNil: [ guiRootObject := guiRootObjectClass newWorld ]).
	isARealStartup == true
		ifTrue: [
			self logStartupDebugAid: 'To #checkIfAlreadyRunningOrStoppedNoExit'.
			self checkIfAlreadyRunningOrStoppedNoExit ].
	self assureStartupStampLogged.
	clearAllStateFlag ifTrue: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #recreateDefaultDesktop'.
			guiRootObject recreateDefaultDesktop; restoreDisplay ]]
	ifFalse: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #restoreDisplay'.
			guiRootObject restoreDisplay ]].
	isARealStartup == true
		ifTrue: [
			"If system is coming up (VM and image just started)"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs.
				self logStartupDebugAid: 'To #processCommandLineArguments'.
				self processCommandLineArguments.
				self logStartupDebugAid: 'To #launchApp'.
				AppLauncher launchApp ]]
		ifFalse: [
			"If we are just saving the image"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs ]].
	"Now it's time to raise an error"
	isARealStartup ifNil: [ self logStartupError: 'Failed to write image file (disk full?)' ]
]
	forkAt: Processor timingPriority - 1
	named: 'Startup process'.! !
!SystemDictionary methodsFor: 'startup - restore lost changes' stamp: 'jmv 8/13/2024 12:52:07' prior: 16969452!
                   lostChangesDetectedCaption
	
	^
'Last changes may have been lost
(maybe the VM crashed or you had to kill it)
(or maybe Cuis is already running)
What do you want to do?'! !
!PreferenceSet class methodsFor: 'sys data' stamp: 'jmv 8/13/2024 15:46:40' prior: 16928447!
                      prefSystem
	^ #( #(allowNonLocalReturnsInExceptionHandlers true )
		#(askConfirmationOnQuit true )
		#(askToInstallComplexPackage true )
		#(automaticPlatformSettings true )
		#(autoNumberUserChanges true )
		#(caseSensitiveFinds false )
		#(changeSetVersionNumbers true )
		#(checkForSlips true )
		#(checkLostChangesOnStartUp false )
		#(warnAndOfferLastUserChanges true )
		#(cmdDotEnabled true )
		#(cmdDotInterruptTakesStatistics false )
		#(dismissAllOnOptionClose false )
		#(initialFileListDirectories #cuis #(cuis roots) )
		#(machine default #(default slow smalltalk80) machine: )
		#(pointer mouse #(touch mouse) pointer:)
		#(selectionsMayShrink true )
		#(serverMode false )
		#(systemWindowEmbedOK false )
		#(transcriptLogVerbose true )
		#(useUserPrefsFile true )
		#(userChangesFileNameExtension '.user.changes' )
		#(warnAboutNonLocalReturnsInExceptionHandlers false )
		#(warnIfNoChangesFile true )
		#(warnIfNoSourcesFile true )
		#(saveReleaseOptionsInWorldMenu false)
	)! !

SystemDictionary removeSelector: #hasToRestoreChanges!

!methodRemoval: SystemDictionary #hasToRestoreChanges stamp: 'Install-6587-WarnOfPossiblyAlreadyRunningOrCrashedCuis-recoverUserChanges-JuanVuletich-2024Aug13-15h59m-jmv.001.cs.st 8/13/2024 18:36:56'!
hasToRestoreChanges

	^(Preferences at: #checkLostChangesOnStartUp) and: [ 
		self withChangesFileDo: [ :changesFile | self hasToRestoreChangesFrom: changesFile ]].
	!

SystemDictionary removeSelector: #restoreLostChangesIfNecessary!

!methodRemoval: SystemDictionary #restoreLostChangesIfNecessary stamp: 'Install-6587-WarnOfPossiblyAlreadyRunningOrCrashedCuis-recoverUserChanges-JuanVuletich-2024Aug13-15h59m-jmv.001.cs.st 8/13/2024 18:36:56'!
restoreLostChangesIfNecessary

	"
	Smalltalk restoreLostChangesIfNecessary
	"
	
	self hasToRestoreChanges ifTrue: [ UISupervisor whenUIinSafeState: [self restoreLostChanges ]].
!

SystemDictionary removeSelector: #hasToRestoreChangesFrom:!

!methodRemoval: SystemDictionary #hasToRestoreChangesFrom: stamp: 'Install-6587-WarnOfPossiblyAlreadyRunningOrCrashedCuis-recoverUserChanges-JuanVuletich-2024Aug13-15h59m-jmv.001.cs.st 8/13/2024 18:36:56'!
hasToRestoreChangesFrom: changesFile

	| chunk  |
	
	changesFile position: self lastQuitLogPosition.
	[ changesFile atEnd ] whileFalse: [ chunk := changesFile nextChunk ].
	
	^chunk notNil and: [(self isSnapshotQuitOrQuitNoSaveRecord: chunk) not]
!

SystemDictionary removeSelector: #isSnapshotQuitOrQuitNoSaveRecord:!

!methodRemoval: SystemDictionary #isSnapshotQuitOrQuitNoSaveRecord: stamp: 'Install-6587-WarnOfPossiblyAlreadyRunningOrCrashedCuis-recoverUserChanges-JuanVuletich-2024Aug13-15h59m-jmv.001.cs.st 8/13/2024 18:36:56'!
isSnapshotQuitOrQuitNoSaveRecord: chunk

	^(self isSnapshotRecord: chunk) 
		or: [ (self isQuitRecord: chunk) 
		or: [ self isQuitNoSaveRecord: chunk ]]!

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
Preferences
	name: #warnAndOfferLastUserChanges
	description: 'Warn user of recent crash or possibly already running Cuis. Open code recovery on User Changes.'
	category: #system type: Boolean value: true.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6587-WarnOfPossiblyAlreadyRunningOrCrashedCuis-recoverUserChanges-JuanVuletich-2024Aug13-15h59m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6587] on 13 August 2024 at 4:37:42 pm'!
!PositionableStream methodsFor: 'fileIn/Out' stamp: 'Install-toton 8/13/2024 16:34:26' prior: 16927235!
           compileNextChunkWhenStartsWithExclamationMark

	| chunk |
	
	chunk := self nextChunk.
	
	"These are the ones that should do nothing, 
	because next line is a doit that does the stuff
	(or because it is handled elsewhere)"
	
	(chunk isEmpty or: [(chunk beginsWith: 'description:  ') 
		or: [ ChangeList knownFileInPreambles anySatisfy: [ :aPreamble | chunk beginsWith: aPreamble ]]])
			ifFalse: [
				self evaluate: [ (Compiler evaluate: chunk logged: false) scanFrom: self ] printingErrorWith: chunk ].! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6588-CodeInstall-TolerateEmptyChunks-JuanVuletich-2024Aug13-16h36m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6588] on 13 August 2024 at 5:53:46 pm'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 17:51:38' prior: 50364968!
            snapshot: save andQuit: quit embedded: embeddedFlag clearAllClassState: clearAllStateFlag
	"This is the main method for image save and / or quit.
	See senders."
	"WARNING: Current process will be killed. UI Process will be restarted"
	"Mark the changes file and close all files as part of #processShutdownList.
	If save is true, save the current state of this Smalltalk in the image file.
	If quit is true, then exit to the outer OS shell.
	The latter part of this method runs when resuming a previously saved image. This resume logic
	checks for a document file to process when starting up."
	"
	To test the full cleanup and startup procedures, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: true

	To test the cleanup done when saving the image, evaluate:
		Smalltalk snapshot: false andQuit: false embedded: false clearAllClassState: false
	"
	| activeProc |
	activeProc := Processor activeProcess.
[
	| isARealStartup guiRootObject guiRootObjectClass userBaseDirectory |
	save not & quit
		ifTrue: [ (SourceFiles at: 2) ifNotNil: [ :changes |
				ChangesInitialFileSize ifNotNil: [ changes truncate: ChangesInitialFileSize ]]]
		ifFalse: [ self logSnapshot: save andQuit: quit ].
	clearAllStateFlag ifTrue: [
		TranscriptWindow allInstancesDoAlt: [ :each |
			each isInWorld ifTrue: [ each delete.]].
		UISupervisor ui tearDownDesktop.
		Transcript logToFile: false ].
	ActiveModel flushEventSystem.
	self processShutDownList: quit.
	"These could be moved to some #shutDown"
	self stopLowSpaceWatcher.
	WeakArray stopFinalizationProcess.
	ProcessorScheduler stopBackgroundProcess.
	"Stuff needed to relaunch UI on startup"
	guiRootObjectClass := UISupervisor ui class.
	"Replace with this to create a new world at startup after 'saveAsNewVersion'"
	guiRootObject := clearAllStateFlag ifFalse: [ UISupervisor ui ].

	UISupervisor stopUIProcess.
	activeProc isTerminated ifFalse: [ activeProc terminate ].
	guiRootObject ifNotNil: [ guiRootObject releaseCachedState ].
	clearAllStateFlag ifTrue: [
		Processor processesDo: [ :p |
			(p name = 'Formerly: Morphic UI') ifTrue: [ p terminate ]]].
	MorphicCanvas allSubInstancesDoAlt: [ :c |
		(c ownerProcess notNil and: [c ownerProcess isTerminated]) ifTrue: [
			c releaseEngine			]].

	"Clean Globals"
	userBaseDirectory := DirectoryEntry userBaseDirectory.
	self at: #Sensor put: nil.
	self closeSourceFiles.
	self at: #SourceFiles put: nil.
	self allClassesDo: [ :cls |
		cls releaseClassCachedState ].
	clearAllStateFlag ifTrue: [
		self allClassesDo: [ :cls |
			cls releaseClassState ]].
	"To keep cleaning stuff that shouldn't be saved..."
	clearAllStateFlag ifTrue: [
		Transcript clear.
		"Enable this call to actually see the image clean report."
		false ifTrue: [self printStuffToCleanOnImageSave]].
	"Do image save & quit as apropriate"
	(Cursor cursorAt: #writeCursor) activateCursor.
	isARealStartup := false.
	save ifTrue: [
		"The snapshot primitive answers false if it was just called to do the snapshot.
		But image startup is resumed by returning (again) from the primitive, but this time answering true.
		nil means saving image failed"
		isARealStartup := embeddedFlag
			ifTrue: [ self snapshotEmbeddedPrimitive ]
			ifFalse: [ self snapshotPrimitive ]].
	quit & (isARealStartup == false) ifTrue: [ self quitPrimitive ]. "Don't quit on nil (image save failed)"

	isARealStartup == true ifFalse: [ 									"Keep current #userBaseDirectory unless a real startup"
		DirectoryEntry setUserBaseDirectory: userBaseDirectory ].

	"If starting from absolute scratch, this would be a good time to recreate Global names"
	self at: #Sensor put: nil.
	self at: #SourceFiles put: (Array new: 2).
	self logStartupDebugAid: 'To #openSourceFiles'.
	self openSourceFiles.
	"Here, startup begins!! (isARealStartup might be nil)"
	self logStartupDebugAid: 'To #initClassCachedState'.
	self allClassesDo: [ :cls | cls initClassCachedState ].
	self logStartupDebugAid: 'To #doStartUp:'.
	self doStartUp: isARealStartup == true.
	self logStartupDebugAid: 'To #spawnNewMorphicProcessFor: ', guiRootObject printString.
	UISupervisor spawnNewMorphicProcessFor: (guiRootObject ifNil: [ guiRootObject := guiRootObjectClass newWorld ]).
	isARealStartup == true
		ifTrue: [
			self logStartupDebugAid: 'To #checkIfAlreadyRunningOrStoppedNoExit'.
			self checkIfAlreadyRunningOrStoppedNoExit.
			self assureStartupStampLogged ].
	clearAllStateFlag ifTrue: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #recreateDefaultDesktop'.
			guiRootObject recreateDefaultDesktop; restoreDisplay ]]
	ifFalse: [
		UISupervisor whenUIinSafeState: [
			self logStartupDebugAid: 'To #restoreDisplay'.
			guiRootObject restoreDisplay ]].
	isARealStartup == true
		ifTrue: [
			"If system is coming up (VM and image just started)"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs.
				self logStartupDebugAid: 'To #processCommandLineArguments'.
				self processCommandLineArguments.
				self logStartupDebugAid: 'To #launchApp'.
				AppLauncher launchApp ]]
		ifFalse: [
			"If we are just saving the image"
			UISupervisor whenUIinSafeState: [
				self logStartupDebugAid: 'To #readAndApplyUserPrefs'.
				self readAndApplyUserPrefs ]].
	"Now it's time to raise an error"
	isARealStartup ifNil: [ self logStartupError: 'Failed to write image file (disk full?)' ]
]
	forkAt: Processor timingPriority - 1
	named: 'Startup process'.! !

"Postscript:
Leave the line above, and replace the rest of this comment by a useful one.
Executable statements should follow this comment, and should
be separated by periods, with no exclamation points (!!).
Be sure to put any further comments in double-quotes, like this one."
Smalltalk setStartupStamp.!

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6589-assureStartupStampLogged-onlyIfRealStartup-JuanVuletich-2024Aug13-17h51m-jmv.001.cs.st----!

'From Cuis7.1 [latest update: #6589] on 13 August 2024 at 6:31:47 pm'!
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 18:31:06' prior: 16965960!
          saveAndQuit
	"Save image and quit. No questions asked.
	Smalltalk saveAndQuit.
	"
	ChangeSet zapAllChangeSets.
	self garbageCollect.
	^ self
		snapshot: true
		andQuit: true
		embedded: false
		clearAllClassState: false.! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 18:31:11' prior: 16965969!
                             saveAndQuitAs: newName clearAllClassState: clearAllStateFlag
	"Save the image  under a new name. Don't quit.
	See senders."

	| newChangesName |
	self currentChangesName ifNotNil: [ :oldChangesName |
		self closeSourceFiles. "so copying the changes file will always work"
		newChangesName := self fullNameForChangesNamed: newName.
		FileIOAccessor default copy: oldChangesName asFullFileEntry to: newChangesName asFullFileEntry.
		ChangesInitialFileSize ifNotNil: [
			oldChangesName asFullFileEntry appendStreamDo: [ :strm | strm truncate: ChangesInitialFileSize ]]].

	ChangeSet zapAllChangeSets.
	self garbageCollect.
	self 
		changeImageNameTo: (self fullNameForImageNamed: newName);
		closeSourceFiles; openSourceFiles;  "so SNAPSHOT appears in new changes file"
		snapshot: true andQuit: true embedded: false clearAllClassState: clearAllStateFlag.! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 18:31:15' prior: 16965998!
    saveAndStayAs: newName clearAllClassState: clearAllStateFlag
	"Save the image  under a new name. Don't quit.
	See senders."

	| newChangesName |
	self currentChangesName ifNotNil: [ :oldChangesName |
		self closeSourceFiles. "so copying the changes file will always work"
		newChangesName := self fullNameForChangesNamed: newName.
		FileIOAccessor default copy: oldChangesName asFullFileEntry to: newChangesName asFullFileEntry.
		ChangesInitialFileSize ifNotNil: [
			oldChangesName asFullFileEntry appendStreamDo: [ :strm | strm truncate: ChangesInitialFileSize ]]].

	ChangeSet zapAllChangeSets.
	self garbageCollect.
	self 
		changeImageNameTo: (self fullNameForImageNamed: newName);
		closeSourceFiles; openSourceFiles;  "so SNAPSHOT appears in new changes file"
		snapshot: true andQuit: false embedded: false clearAllClassState: clearAllStateFlag.! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 18:31:18' prior: 50353666!
   saveAs: newName clearAllClassState: clearAllStateFlag
	"Save the image under a new name. Don't quit.
	Note: newName must be different from current name.
	See senders."

	| newChangesName |
	self currentChangesName ifNotNil: [ :oldChangesName |
		self closeSourceFiles. "so copying the changes file will always work"
		newChangesName := self fullNameForChangesNamed: newName.
		FileIOAccessor default copy: oldChangesName asFullFileEntry to: newChangesName asFullFileEntry.
		ChangesInitialFileSize ifNotNil: [
			oldChangesName asFullFileEntry appendStreamDo: [ :strm | strm truncate: ChangesInitialFileSize ]]].

	ChangeSet zapAllChangeSets.
	self garbageCollect.
	self 
		changeImageNameTo: (self fullNameForImageNamed: newName);
		closeSourceFiles; openSourceFiles;  "so SNAPSHOT appears in new changes file"
		snapshot: true andQuit: false embedded: false clearAllClassState: clearAllStateFlag.! !
!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'jmv 8/13/2024 18:31:22' prior: 16966074!
                       saveImage
	"Save image. Don't quit. No questions asked.
	Smalltalk saveImage.
	"
	ChangeSet zapAllChangeSets.
	self garbageCollect.
	^ self
		snapshot: true
		andQuit: false
		embedded: false
		clearAllClassState: false.! !

----End fileIn of C:\Users\Juan Vuletich\Cuis-Smalltalk\Cuis-Smalltalk-Dev\CoreUpdates\6590-addAFewGarbageCollects-JuanVuletich-2024Aug13-18h31m-jmv.001.cs.st----!

----QUIT----(13 August 2024 18:36:58) Cuis7.1-6590.image priorSource: 831636!