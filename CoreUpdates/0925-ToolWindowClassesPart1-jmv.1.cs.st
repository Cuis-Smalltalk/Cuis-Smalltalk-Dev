'From Cuis 3.2 of 12 April 2011 [latest update: #914] on 18 April 2011 at 3:10:54 pm'!!FileList2 commentStamp: '<historical>' prior: 0!Some variations on FileList that- use a hierarchical pane to show folder structure- use different pane combinations, button layouts and prefiltering for specific usesFileList2 openMorphicViewInWorld!!classDefinition: #CodeWindow category: #'Morphic-Tools'!SystemWindow subclass: #CodeWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!CodeWindow commentStamp: '<historical>' prior: 0!A hierarchy of views, parallel to the CodeProvider models hierarchy.!!classDefinition: #BrowserWindow category: #'Morphic-Tools'!CodeWindow subclass: #BrowserWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!BrowserWindow commentStamp: 'jmv 3/21/2011 16:48' prior: 0!A window for Browser models.(BrowserWindow new model: Browser new; buildMorphicWindow) openInWorldinstead ofBrowser openBrowser----No dejar en clases de modelo comportamiento que se haya implementado aca!!!!!!!!el unico protocolo repetido deberia ser delegacion!!classDefinition: #ChangeListWindow category: #'Morphic-Tools'!CodeWindow subclass: #ChangeListWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #ChangeSorterWindow category: #'Morphic-Tools'!CodeWindow subclass: #ChangeSorterWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #DebuggerWindow category: #'Morphic-Tools'!CodeWindow subclass: #DebuggerWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #DualChangeSorterWindow category: #'Morphic-Tools'!CodeWindow subclass: #DualChangeSorterWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #FileContentsBrowserWindow category: #'Morphic-Tools'!BrowserWindow subclass: #FileContentsBrowserWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #FileListWindow category: #'Morphic-Tools'!SystemWindow subclass: #FileListWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #HierarchyBrowserWindow category: #'Morphic-Tools'!BrowserWindow subclass: #HierarchyBrowserWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #MessageSetWindow category: #'Morphic-Tools'!BrowserWindow subclass: #MessageSetWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #MessageNamesWindow category: #'Morphic-Tools'!MessageSetWindow subclass: #MessageNamesWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!classDefinition: #VersionsBrowserWindow category: #'Morphic-Tools'!ChangeListWindow subclass: #VersionsBrowserWindow	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'Morphic-Tools'!!Object methodsFor: 'message handling' stamp: 'jmv 3/22/2011 09:46'!perform: selector orSendTo: otherTarget	"If I wish to intercept and handle selector myself, do it; else send it to otherTarget"	"All this crap should be killed when each menu item has the proper target!!"	self flag: #ugly.	(self respondsTo: selector) ifTrue: [ ^self perform: selector ].	^ otherTarget perform: selector! !!CodeProvider methodsFor: 'contents' stamp: 'jmv 4/15/2011 19:00'!acceptedContentsChanged	self changed: #acceptedContents.	self changed: #annotation.	self changed: #decorateButtons! !!CodeProvider methodsFor: 'commands' stamp: 'jmv 3/21/2011 22:16'!browseProtocol	"Create and schedule a new protocol browser on the currently selected class or meta."	self selectedClassOrMetaClass ifNotNil: [ :classOrMetaclass |       	ProtocolBrowser openSubProtocolForClass: classOrMetaclass]! !!CodeProvider methodsFor: 'commands' stamp: 'jmv 3/21/2011 17:26'!spawnHierarchy	"Create and schedule a new hierarchy browser on the currently selected class or meta."	| newBrowser aSymbol aBehavior messageCatIndex selectedClassOrMetaClass |	(selectedClassOrMetaClass _ self selectedClassOrMetaClass)		ifNil: [^ self].	newBrowser _ HierarchyBrowser new initHierarchyForClass: selectedClassOrMetaClass.	((aSymbol _ self selectedMessageName) notNil and: [(MessageSet isPseudoSelector: aSymbol) not])		ifTrue: [			aBehavior _ selectedClassOrMetaClass.			messageCatIndex _ aBehavior organization numberOfCategoryOfElement: aSymbol.			newBrowser messageCategoryListIndex: messageCatIndex + 1.			newBrowser messageListIndex:				((aBehavior organization listAtCategoryNumber: messageCatIndex) indexOf: aSymbol)].				HierarchyBrowserWindow openNoSysCat: newBrowser label: newBrowser labelString.	newBrowser assureSelectionsShow! !!CodeProvider methodsFor: 'misc' stamp: 'jmv 4/15/2011 18:38'!modelWakeUpIn: aWindow	"The window has been activated.  Respond to possible changes that may have taken place while it was inactive"	self updateListsAndCodeIn: aWindow.	super modelWakeUpIn: aWindow! !!CodeProvider methodsFor: 'message list menu' stamp: 'jmv 3/21/2011 22:15'!browseFullProtocol	"Create and schedule a new protocol browser on the currently selected class or meta."	self selectedClassOrMetaClass ifNotNil: [ :classOrMetaclass |       	ProtocolBrowser openFullProtocolForClass: classOrMetaclass]! !!CodeProvider methodsFor: 'message list menu' stamp: 'jmv 3/21/2011 22:25'!classListKey: aChar from: view 	"Respond to a Command key.  I am a model with a list of classes and a 	code pane, and I also have a listView that has a list of methods.  The 	view knows how to get the list and selection."	aChar == $r ifTrue: [^ self recent].	aChar == $h ifTrue: [^ self spawnHierarchy].	aChar == $x ifTrue: [^ self removeClass].	^ self messageListKey: aChar from: view! !!CodeProvider methodsFor: 'accessing' stamp: 'jmv 4/15/2011 18:25'!currentCompiledMethod	^currentCompiledMethod! !!Browser methodsFor: 'class functions' stamp: 'jmv 3/21/2011 22:25'!classListMenu	"Set up the menu to apply to the receiver's class list, honoring the #shifted boolean"	| aMenu |	aMenu := MenuMorph new defaultTarget: self.	aMenu addList: #(		-		('browse full (b)'			browseMethodFull)		('browse hierarchy (h)'		spawnHierarchy)		('browse protocol (p)'		browseFullProtocol)		-		('fileOut'					fileOutClass)		-		('show hierarchy'			hierarchy)		('show definition'			editClass)		('show comment'			editComment)		-		('inst var refs...'				browseInstVarRefs)		('inst var defs...'			browseInstVarDefs)		-		('class var refs...'			browseClassVarRefs)		('class vars'					browseClassVariables)		('class refs (N)'				browseClassRefs)		-		('rename class ...'			renameClass)		('copy class...'				copyClass)		('remove class (x)'			removeClass)		-		('more...'					offerShiftedClassListMenu)).	^ aMenu! !!Browser methodsFor: 'class functions' stamp: 'jmv 4/15/2011 18:33'!editComment	"Retrieve the description of the class comment."	classListIndex = 0 ifTrue: [^ self].	self okToChange ifFalse: [^ self].	self messageCategoryListIndex: 0.	metaClassIndicated _ false.	self editSelection: #editComment.	self changed: #classSelectionChanged.	self changed: #messageCategoryList.	self changed: #messageList.	self acceptedContentsChanged! !!Browser methodsFor: 'message functions' stamp: 'jmv 3/21/2011 22:16'!shiftedMessageListMenu	"Fill aMenu with the items appropriate when the shift key is held down"	| aMenu |	aMenu := MenuMorph new defaultTarget: self.	aMenu addStayUpIcons.	aMenu addList: #(		('toggle diffing (D)'						toggleDiffing)		('implementors of sent messages'		browseAllMessages)		-		('local senders of...'						browseLocalSendersOfMessages)		('local implementors of...'				browseLocalImplementors)		-		('spawn sub-protocol'					browseProtocol)		('spawn full protocol'					browseFullProtocol)		-		('sample instance'						makeSampleInstance)		('inspect instances'						inspectInstances)		('inspect subinstances'					inspectSubInstances)).	self addExtraShiftedItemsTo: aMenu.	aMenu addList: #(		-		('change category...'					changeCategory)).	self canShowMultipleMessageCategories ifTrue: [ aMenu addList:		 #(('show category (C)'					showHomeCategory))].	aMenu addList: #(		-		('change sets with this method'			findMethodInChangeSets)		('revert to previous version'			revertToPreviousVersion)		('remove from current change set'		removeFromCurrentChanges)		('revert & remove from changes'		revertAndForget)		('add to current change set'			adoptMessageInCurrentChangeset)		-		('more...' 								openMenu)).	^ aMenu! !!Browser methodsFor: 'message list' stamp: 'jmv 4/15/2011 18:33'!messageListIndex: anInteger	"Set the selected message selector to be the one indexed by anInteger."	messageListIndex _ anInteger.	self editSelection: (anInteger > 0		ifTrue: [#editMessage]		ifFalse: [self messageCategoryListIndex > 0			ifTrue: [#newMessage]			ifFalse: [self classListIndex > 0				ifTrue: [#editClass]				ifFalse: [#newClass]]]).	self changed: #messageListIndex. "update my selection"	self acceptedContentsChanged! !!Browser methodsFor: 'metaclass' stamp: 'jmv 4/15/2011 18:33'!metaClassIndicated: trueOrFalse 	"Indicate whether browsing instance or class messages."	metaClassIndicated _ trueOrFalse.	self setClassOrganizer.	systemCategoryListIndex > 0 ifTrue:		[self editSelection: (classListIndex = 0			ifTrue: [metaClassIndicated				ifTrue: [#none]				ifFalse: [#newClass]]			ifFalse: [#editClass])].	messageCategoryListIndex _ 0.	messageListIndex _ 0.	self changed: #classSelectionChanged.	self changed: #messageCategoryList.	self changed: #messageList.	self acceptedContentsChanged! !!Browser methodsFor: 'system category functions' stamp: 'jmv 3/21/2011 17:29'!browseAllClasses	"Create and schedule a new browser on all classes alphabetically."	| newBrowser |	newBrowser _ HierarchyBrowser new initAlphabeticListing.	HierarchyBrowserWindow openNoSysCat: newBrowser label: 'All Classes Alphabetically'! !!Browser methodsFor: 'system category functions' stamp: 'jmv 3/21/2011 17:31'!openSystemCategoryBrowser	"Create and schedule a new system category browser with initial textual 	contents set to aString."	| newBrowser |	systemCategoryListIndex > 0		ifTrue: [			newBrowser _ Browser new.			newBrowser systemCategoryListIndex: systemCategoryListIndex.			newBrowser setClass: self selectedClassOrMetaClass selector: self selectedMessageName.				BrowserWindow openNoSysCat: newBrowser label: 'Classes in category ', newBrowser selectedSystemCategoryName]! !!Browser class methodsFor: 'instance creation' stamp: 'jmv 3/21/2011 17:48'!fullOnClass: aClass selector: aSelector	"Open a new full browser set to class."	| browser |	browser _ Browser new.	browser setClass: aClass selector: aSelector.	BrowserWindow open: browser label: browser labelString! !!ChangeList class methodsFor: 'public access' stamp: 'jmv 4/15/2011 14:35'!browseRecent: charCount on: origChangesFile 	"Opens a changeList on the end of the specified changes log file"		| changeList end changesFile |	changesFile _ origChangesFile readOnlyCopy.	end _ changesFile size.	changeList _ Cursor read showWhile: [		self new			scanFile: changesFile			from: (0 max: end - charCount)			to: end ].	changesFile close.	ChangeListWindow open: changeList label: 'Recent changes'! !!ChangeList class methodsFor: 'public access' stamp: 'jmv 4/15/2011 14:35'!browseStream: changesFile	"Opens a changeList on a fileStream"	| changeList charCount |	changesFile readOnly.	charCount _ changesFile size.	charCount > 1000000 ifTrue: [		(self confirm: 'The file ', changesFile name , 'is really long (' , charCount printString , ' characters).Would you prefer to view only the last million characters?')			ifTrue: [ charCount _ 1000000 ]].	changeList _ Cursor read showWhile: [		self new			scanFile: changesFile from: changesFile size-charCount to: changesFile size].	changesFile close.	ChangeListWindow open: changeList label: changesFile localName! !!ChangeList class methodsFor: 'fileIn/Out' stamp: 'jmv 4/15/2011 14:34'!browseMCZFile: fullName	"Browse the selected file in fileIn format."	| zipped unzipped changeList |	fullName ifNil: [ ^self beep ].	zipped _ (FileStream readOnlyFileNamed: fullName).	unzipped _ zipped asUnZippedStream: 'snapshot/source.st'.	unzipped ascii.	changeList _ Cursor read showWhile: [		self new			scanFile: unzipped from: 0 to: unzipped size].	ChangeListWindow open: changeList label: 'Changes in ', zipped localName! !!ChangeSorter methodsFor: 'access' stamp: 'jmv 4/15/2011 16:58'!myChangeSet	^myChangeSet! !!ChangeSorter class methodsFor: 'services' stamp: 'jmv 4/15/2011 16:18'!browseChangeSetsWithClass: class selector: selector	"Put up a menu comprising a list of change sets that hold changes for the given class and selector.  If the user selects one, open a single change-sorter onto it"	| hits index |	hits _ self allChangeSets select: 		[:cs | (cs atSelector: selector class: class) ~~ #none].	hits isEmpty ifTrue: [^ self inform: class name, '.', selector , 'is not in any change set'].	index _ hits size = 1		ifTrue:	[1]		ifFalse:	[(PopUpMenu labelArray: (hits collect: [:cs | cs name])					lines: #()) startUp].	index = 0 ifTrue: [^ self].	ChangeSorterWindow open: (ChangeSorter new myChangeSet: (hits at: index)) label: nil! !!ClassListBrowser methodsFor: 'initialization' stamp: 'jmv 3/21/2011 17:33'!initForClassesNamed: nameList title: aTitle	"Initialize the receiver for the class-name-list and title provided"	self systemOrganizer: SystemOrganization.	metaClassIndicated _ false.	defaultTitle _ aTitle.	classList _ nameList copy.	HierarchyBrowserWindow openNoSysCat: self label: aTitle	"ClassListBrowser new initForClassesNamed: #(Browser CategoryViewer) title: 'Frogs'"! !!CustomMenu methodsFor: 'initialize-release' stamp: 'jmv 4/15/2011 15:07'!initialize	labels _ OrderedCollection new.	selections _ OrderedCollection new.	dividers _ OrderedCollection new.	lastDivider _ 0.	arguments _ OrderedCollection new! !!Debugger methodsFor: 'initialize' stamp: 'jmv 4/15/2011 17:27'!debugAt: anInteger	self toggleContextStackIndex: anInteger. 	 self debug! !!Debugger methodsFor: 'initialize' stamp: 'jmv 4/15/2011 17:28'!openFullMorphicLabel: aLabelString	"Open a full morphic debugger with the given label"	| oldContextStackIndex |	oldContextStackIndex _ contextStackIndex.	self expandStack. "Sets contextStackIndex to zero."	DebuggerWindow open: self label: aLabelString.	self toggleContextStackIndex: oldContextStackIndex! !!Debugger methodsFor: 'initialize' stamp: 'jmv 4/15/2011 17:36'!openNotifierContents: msgString label: label	"Create and schedule a notifier view with the given label and message. A notifier view shows just the message or the first several lines of the stack, with a menu that allows the user to open a full debugger if so desired."	"NOTE: When this method returns, a new process has been scheduled to run the windows, and thus this notifier, but the previous active porcess has not been suspended.  The sender will do this."	| msg |	Sensor flushKeyboard.	savedCursor _ Sensor currentCursor.	Sensor currentCursor: Cursor normal.	(label beginsWith: 'Space is low')		ifTrue: [msg _ self lowSpaceChoices, (msgString ifNil: [''])]		ifFalse: [msg _ msgString].	DebuggerWindow openMorphicNotifierLabelled: label message: msg debugger: self.	errorWasInUIProcess _ ProjectX newProcessIfUIX: interruptedProcess.	^self! !!Debugger methodsFor: 'notifier menu' stamp: 'jmv 4/15/2011 17:28'!debug	"Open a full DebuggerView."	| topView |	topView _ self topView.	topView model: nil.  "so close won't release me."	self breakDependents.	topView delete.	self openFullMorphicLabel: topView label! !!Debugger methodsFor: 'context stack menu' stamp: 'jmv 4/15/2011 17:27'!implement: aMessage inClass: aClass		aClass		compile: aMessage createStubMethod		classified: (self askForCategoryIn: aClass default: 'as yet unclassified').	self selectedContext privRefreshWith: (aClass lookupSelector: aMessage selector).	self selectedContext method numArgs > 0 ifTrue:		[(self selectedContext tempAt: 1) arguments withIndexDo:			[:arg :index|			self selectedContext tempAt: index put: arg]].	self resetContext: self selectedContext.	self debug! !!Debugger methodsFor: 'private' stamp: 'jmv 4/15/2011 19:02'!contextStackIndex: anInteger oldContextWas: oldContext 	"Change the context stack index to anInteger, perhaps in response to user selection."	| isNewMethod selectedContextSlotName index |	contextStackIndex := anInteger.	anInteger = 0 ifTrue: [		currentCompiledMethod := nil.		self changed: #contextStackIndex.		self acceptedContentsChanged.		contextVariablesInspector object: nil.		receiverInspector object: self receiver.		^self].	selectedContextSlotName := contextVariablesInspector selectedSlotName.	isNewMethod := oldContext == nil					or: [oldContext method ~~ (currentCompiledMethod := self selectedContext method)].	isNewMethod ifTrue: [		self acceptedContentsChanged.		self pcRange ].	self changed: #contextStackIndex.	self changed: #decorateButtons.	contextVariablesInspector object: self selectedContext.	((index := contextVariablesInspector fieldList indexOf: selectedContextSlotName) ~= 0	 and: [index ~= contextVariablesInspector selectionIndex]) ifTrue: [		contextVariablesInspector toggleIndex: index].	receiverInspector object: self receiver.	isNewMethod ifFalse: [		self changed: #contentsSelection]! !!Debugger class methodsFor: 'opening' stamp: 'jmv 4/15/2011 17:23'!openInterrupt: aString onProcess: interruptedProcess	"Open a notifier in response to an interrupt. An interrupt occurs when the user types the interrupt key (cmd-. on Macs, ctrl-c or alt-. on other systems) or when the low-space watcher detects that memory is low."	| debugger |	<primitive: 19> "Simulation guard"	debugger _ self new.	debugger		process: interruptedProcess		controller: nil		context: interruptedProcess suspendedContext.	debugger externalInterrupt: true.Preferences logDebuggerStackToFile ifTrue:	[(aString includesSubString: 'Space') & 		(aString includesSubString: 'low') ifTrue: [			Smalltalk logError: aString inContext: debugger interruptedContext to: 'LowSpaceDebug.log']].	^ debugger		openNotifierContents: nil		label: aString! !!DualChangeSorter methodsFor: 'creation' stamp: 'jmv 4/15/2011 16:02'!buildLeftAndRight	leftCngSorter _ ChangeSorter new myChangeSet: ChangeSet current.	leftCngSorter parent: self.	rightCngSorter _ ChangeSorter new myChangeSet: ChangeSorter secondaryChangeSet.	rightCngSorter parent: self! !!DualChangeSorter methodsFor: 'accessing' stamp: 'jmv 4/15/2011 16:04'!leftSorter	^leftCngSorter! !!DualChangeSorter methodsFor: 'accessing' stamp: 'jmv 4/15/2011 16:04'!rightSorter	^rightCngSorter! !!FileContentsBrowser methodsFor: 'accessing' stamp: 'jmv 4/15/2011 11:19'!contentsSymbol	"Answer a symbol indicating what kind of content should be shown for the method"	^ contentsSymbol ifNil: [		contentsSymbol _ self defaultDiffsSymbol ]! !!FileContentsBrowser methodsFor: 'menus' stamp: 'jmv 4/15/2011 11:06'!contentsSymbolQuints	"Answer a list of quintuplets representing information on the alternative views available in the code pane.  For the file-contents browser, the choices are restricted to source and the diffing options"	^ self sourceAndDiffsQuintsOnly! !!FileContentsBrowser class methodsFor: 'instance creation' stamp: 'jmv 3/21/2011 17:02'!browseStream: aStream named: aString	| package organizer browser |	Cursor wait showWhile: [		organizer _ SystemOrganizer defaultList: Array new.		package _ (FilePackage new fullName: aString; fileInFrom: aStream).		organizer 			classifyAll: package classes keys 			under: package packageName.		(browser := self new)			systemOrganizer: organizer;			thePackage: package].	FileContentsBrowserWindow open: browser label: 'File Contents Browser'! !!HierarchyBrowser class methodsFor: 'as yet unclassified' stamp: 'jmv 3/21/2011 17:26'!newFor: aClass	"Open a new HierarchyBrowser on the given class"	|  newBrowser |	newBrowser _ HierarchyBrowser new initHierarchyForClass: aClass.	HierarchyBrowserWindow openNoSysCat: newBrowser label: newBrowser labelString.	newBrowser assureSelectionsShow"HierarchyBrowser newFor: Boolean"! !!Inspector methodsFor: 'menu commands' stamp: 'jmv 3/21/2011 22:16'!browseProtocol	"Spawn a protocol on browser on the receiver's selection"	| objectToRepresent |	objectToRepresent _ self selectionIndex = 0 ifTrue: [object] ifFalse: [self selection].	ProtocolBrowser openSubProtocolForClass: objectToRepresent class! !!Inspector methodsFor: 'message list menu' stamp: 'jmv 3/21/2011 22:15'!browseFullProtocol	"Spawn a window showing full protocol for the receiver's selection"	| objectToRepresent |	objectToRepresent _ self selectionIndex = 0 ifTrue: [object] ifFalse: [self selection].	ProtocolBrowser openFullProtocolForClass: objectToRepresent class! !!MessageSet methodsFor: 'message list' stamp: 'jmv 4/15/2011 18:36'!messageListIndex: anInteger 	"Set the index of the selected item to be anInteger."	messageListIndex _ anInteger.	self changed: #messageListIndex.	 "update my selection"	self editSelection: #editMessage.	self acceptedContentsChanged.	(messageListIndex ~= 0 and: [autoSelectString notNil])		ifTrue: [self changed: #autoSelect]! !!MessageSet class methodsFor: 'instance creation' stamp: 'jmv 3/21/2011 17:44'!open: aMessageSet name: aString 	"Create a standard system view for the messageSet, aMessageSet, whose label is aString."	MessageSetWindow open: aMessageSet label: aString! !!Morph methodsFor: 'as yet unclassified' stamp: 'jmv 3/22/2011 08:51'!hasUnacceptedEdits	"Answer true if any of the views on this object has unaccepted edits."	self flag: #ojo.	^ false! !!PasteUpMorph methodsFor: 'world menu' stamp: 'jmv 4/15/2011 17:08'!findAChangeSorter: evt	"Locate a change sorter, open it, and bring it to the front.  Create one if necessary"	self		findAWindowSatisfying: [ :aWindow |			(aWindow model isMemberOf: ChangeSorter) or: [ aWindow model isKindOf: DualChangeSorter ]]		orMakeOneUsing: [ DualChangeSorterWindow open: DualChangeSorter new label: nil ].! !!PasteUpMorph methodsFor: 'world menu' stamp: 'jmv 4/15/2011 16:12'!findAMessageNamesWindow: evt	"Locate a MessageNames tool, open it, and bring it to the front.  Create one if necessary"	self		findAWindowSatisfying: [ :aWindow |			aWindow model isKindOf: MessageNames ]		orMakeOneUsing: [			MessageNamesWindow open: MessageNames new label: 'Message Names' ]! !!PasteUpMorph methodsFor: 'world menu' stamp: 'jmv 3/21/2011 18:02'!openRecentSubmissionsBrowser: evt	"Locate a recent-submissions browser, open it, and bring it to the front.  Create one if necessary.  Only works in morphic"	self		findAWindowSatisfying: [ :aWindow |			aWindow model isKindOf: RecentMessageSet ]		orMakeOneUsing: [ Utilities openRecentSubmissionsWindow ]! !!Preferences class methodsFor: 'themes' stamp: 'jmv 4/15/2011 09:49'!juans	"	Preferences juans	"	self setPreferencesFrom:	#(		(balloonHelpEnabled false)		(browseWithPrettyPrint false)		(caseSensitiveFinds true)		(checkForSlips true)		(cmdDotEnabled true)		(collapseWindowsInPlace false)		(diffsInChangeList true)		(diffsWithPrettyPrint false)		(fastDragWindowForMorphic false)		(menuKeyboardControl true)		(optionalButtons true)		(extraDebuggerButtons true)		(restartAlsoProceeds false)		(simpleMenus false)		(smartUpdating true)		(subPixelRenderFonts true)		(thoroughSenders true)	)! !!Preferences class methodsFor: 'themes' stamp: 'jmv 4/15/2011 09:49'!slowMachine	self setPreferencesFrom: #(		(balloonHelpEnabled false)		(browseWithPrettyPrint false)		(caseSensitiveFinds true)		(checkForSlips false)		(cmdDotEnabled true)		(collapseWindowsInPlace false)		(diffsInChangeList false)		(diffsWithPrettyPrint false)		(fastDragWindowForMorphic true)		(menuKeyboardControl false)		(optionalButtons false)		(restartAlsoProceeds false)		(simpleMenus false)		(smartUpdating false)		(subPixelRenderFonts false)		(thoroughSenders false)	).	ClassicTheme beCurrent! !!Preferences class methodsFor: 'themes' stamp: 'jmv 4/15/2011 09:49'!smalltalk80	"A traditional monochrome Smalltalk-80 look and feel, clean and austere, and lacking many features added to Squeak in recent years. Caution: this theme removes the standard Squeak flaps, turns off the 'smartUpdating' feature that keeps multiple browsers in synch, and much more."	self setPreferencesFrom:	#(		(balloonHelpEnabled false)		(browseWithPrettyPrint false)		(caseSensitiveFinds true)		(checkForSlips false)		(cmdDotEnabled true)		(collapseWindowsInPlace false)		(diffsInChangeList false)		(diffsWithPrettyPrint false)		(menuKeyboardControl false)		(optionalButtons false)		(restartAlsoProceeds false)		(simpleMenus false)		(smartUpdating false)		(thoroughSenders false)	)! !!RecentMessageSet methodsFor: 'update' stamp: 'jmv 4/15/2011 19:04'!reformulateList	| myList |	"Reformulate the receiver's list.  Exclude methods now deleted"	myList _ Utilities recentMethodSubmissions reversed select: [ :each | each isValid].	self initializeMessageList: myList.	self messageListIndex: (messageList size min: 1).	"0 or 1"	self changed: #messageList.	self changed: #messageListIndex.	self changed: #decorateButtons! !!SmalltalkEditor methodsFor: 'menu messages' stamp: 'jmv 3/21/2011 17:49'!browseIt	"Launch a browser for the current selection, if appropriate"	| aSymbol anEntry browser |	Preferences alternativeBrowseIt ifTrue: [^ self browseClassFromIt].	self lineSelectAndEmptyCheck: [^ self].	(aSymbol _ self selectedSymbol) ifNil: [^ morph flash].	aSymbol first isUppercase		ifTrue: [			anEntry _ (Smalltalk				at: aSymbol				ifAbsent: [					Smalltalk browseAllImplementorsOf: aSymbol.					^ nil]).			anEntry ifNil: [^ morph flash].			(anEntry isKindOf: Class)				ifFalse:	[anEntry _ anEntry class].			browser _ Browser new.			browser setClass: anEntry selector: nil.			BrowserWindow open: browser label:'System Browser' ]		ifFalse:			[Smalltalk browseAllImplementorsOf: aSymbol]! !!SmalltalkEditor class methodsFor: 'keyboard shortcut tables' stamp: 'jmv 3/21/2011 18:06'!initializeCmdKeyShortcuts	"Initialize the (unshifted) command-key (or alt-key if not on Mac) shortcut table."	"NOTE: if you don't know what your keyboard generates, use Sensor test"	"SmalltalkEditor initialize"	| cmds |	self initializeBasicCmdKeyShortcuts.		cmds := #(		$q	#querySymbol:		$i	#inspectIt:		$p	#printIt:		$s	#save:		$d	#doIt:		$j	#doAgainOnce:		$l	#cancel:		$b	#browseIt:		$n	#sendersOfIt:		$m	#implementorsOfIt:		$T	#displayIfTrue:		$I	#exploreIt:		$A	#argAdvance:		$F	#displayIfFalse:		$G	#fileItIn:		$V	#pasteInitials:		$N	#referencesToIt:	).	1 to: cmds size		by: 2		do: [ :i | cmdActions at: (cmds at: i) asciiValue + 1 put: (cmds at: i + 1)]! !!FileContentsEditor class methodsFor: 'menu' stamp: 'jmv 4/15/2011 11:15'!paneMenu:  aMenu	"Construct aMenu to have items appropriate for the file browser's code pane, given the shift state provided"	| services maybeLine extraLines brevityState fileName theModel |	theModel _ aMenu defaultTarget textProvider.	fileName _ theModel fileName.	fileName ifNotNil: [		brevityState _ theModel brevityState.		services _ OrderedCollection new.		(#(briefHex briefFile needToGetBriefHex needToGetBrief) includes: brevityState) ifTrue: [			services add: theModel serviceGet].		(#(fullHex briefHex needToGetFullHex needToGetBriefHex) includes: brevityState) ifFalse: [			services add: theModel serviceGetHex].		maybeLine _ services size.		extraLines _ OrderedCollection new.		maybeLine > 0 ifTrue: [extraLines add: maybeLine].		services size > maybeLine ifTrue: [extraLines add: services size].		aMenu 			addServices: services			for: theModel fullName			extraLines: extraLines].	aMenu addList: {			{'find...(f)'.				#find}.			{'find again (g)'.			#findAgain}.			{'set search string (h)'.	#setSearchString}.			#-.			{'do again (j)'.			#again}.			{'undo (z)'.				#undo}.			#-.			{'copy (c)'.				#copySelection}.			{'cut (x)'.				#cut}.			{'paste (v)'.				#paste}.			{'paste...'.				#pasteRecent}.			#-.			{'do it (d)'.				#doIt}.			{'print it (p)'.			#printIt}.			{'inspect it (i)'.			#inspectIt}.			{'fileIn selection (G)'.	#fileItIn}.			#-.			{'accept (s)'.			#accept}.			{'cancel (l)'.				#cancel}}.	^ aMenu! !!SystemWindow methodsFor: 'label' stamp: 'jmv 3/21/2011 18:16'!externalName	"Answer the name by which the receiver is known in the UI"	^ self class name, ' labelled: ', labelString! !!SystemWindow methodsFor: 'panes' stamp: 'jmv 4/15/2011 14:46'!widgetsColor	| cc |	self flag: #ojo. "Duplicado con clases de ventanas de tools"	widgetsColor ifNotNil: [ ^ widgetsColor ].	cc _ Color white.	Display depth > 2 ifTrue: [		model ifNotNil: [			model isInMemory ifTrue: [ cc _ self windowColor ]]].	self widgetsColor: cc.	^ cc.! !!SystemWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:46'!windowColor	"Some default"	^model class windowColor! !!CodeWindow methodsFor: 'as yet unclassified' stamp: 'jmv 4/15/2011 11:49'!hasUnacceptedEdits"Esto ayuda un poco a evitar perdida de performance.En vez de pedir dependientes por todos lado, revisamos submorphs.Pero el problema existe.Al meter las systemWindow en la cadena de dependientes, se alenteja todo, porque las SystemWindow no son ni Model ni ActiveModel.Desafortunadamente, para avanzar en este sentido, hay que diseñar bien de entrada.Si no, el sistema empeora. Y si no lo llego a arreglar despues, la cague.... (El camino de Squeak, no? Evitarlo!!!!!!!!!!)""	^model hasUnacceptedEdits""Este halt, etc esta para evitar ejecutar el codigo en Object. Mejor seria sacar todo esto""self halt: 'que nunca caiga aca. No reemplazamos al modelo. (y ademas, arreglar esta porqueria)'.""es feo, si. Pero somos dependientes del modelo. Asi que se nos preguntara. Creo que la implementacion en object no deberia ser seudorecursiva, es que nunca deberia entrar en recursion.el modelo le pregunta a los dependientes y listo.""ver la implemtacion en Morph... Es una tonta manera de decir 'un morph no tiene dependientes'.....LIMPIAR"self flag: #ojo. "ok?????"	self submorphsDo: [:each | each hasUnacceptedEdits ifTrue: [^ true]].	^ false! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 13:57'!buildLowerPanes	| codeAndButtons codeButtonsAndAnnotations |	codeAndButtons _ LayoutMorph newColumn.	codeAndButtons		addMorph: self optionalButtonRow fixedHeight: self defaultButtonPaneHeight;		addAdjusterAndMorph: self buildMorphicCodePane proportionalHeight: 1.0.	codeButtonsAndAnnotations _ LayoutMorph newColumn.	codeButtonsAndAnnotations		addMorph: self buildMorphicAnnotationsPane fixedHeight: self defaultAnnotationPaneHeight;		addAdjusterAndMorph: codeAndButtons proportionalHeight: 1.0.	^codeButtonsAndAnnotations! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 13:56'!buildMorphicAnnotationsPane	| aTextMorph |	aTextMorph _ TextModelMorph		textProvider: model		textGetter: #annotation.	aTextMorph		askBeforeDiscardingEdits: false;		hideScrollBarsIndefinitely.	^aTextMorph! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 13:55'!buildMorphicCodePane	"Construct the pane that shows the code.	Respect the Preference for standardCodeFont.".	^TextModelMorph		textProvider: model		textGetter: #acceptedContents		textSetter: #contents:notifying:		selectionGetter: #contentsSelection! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:10'!defaultAnnotationPaneHeight	"Answer the receiver's preferred default height for new annotation panes."	^ StrikeFont default height * 2 + 8! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:09'!defaultButtonPaneHeight	"Answer the user's preferred default height for new button panes."	^Preferences standardButtonFont height * 14 // 8! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:33'!lineDiffButton	"Return a checkbox that lets the user decide whether regular diffs should be shown or not"	^ (PluggableButtonMorph		model: model		stateGetter: #showingLineDiffs		action: #toggleLineDiffing)			label: 'lineDiffs';			 setBalloonText: 'Show code differences from the previous version, line by line.'! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 15:01'!optionalButtonRow	"Answer a row of control buttons"	| row buttons widths buttonColor |	buttons _ OrderedCollection new.	widths _ OrderedCollection new.	buttonColor _ Theme current buttonColorFrom: self windowColor.	self optionalButtonTuples do: [ :tuple | | button |		widths add: tuple first.		button _ PluggableButtonMorph 					model: model					stateGetter: nil					action: tuple third.		button color: buttonColor.		button label: tuple second asString.		tuple size > 3 ifTrue: [button setBalloonText: tuple fourth].		buttons add: button ].	row _ LayoutMorph newRow.	row color: buttonColor.	row addMorphs: buttons widthProportionalTo: widths.	^row! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:08'!optionalButtonTuples	"Answer a tuple buttons, in the format:			button label			selector to send			help message"	| aList |	aList _ #(	(10	'browse'			browseMethodFull				'view this method in a browser')	(11	'senders' 			browseSendersOfMessages	'browse senders of...')	(16	'implementors'		browseMessages				'browse implementors of...')	(12	'versions'			browseVersions					'browse versions')), 	(Preferences decorateBrowserButtons		ifTrue:			[{#(13	'inheritance'		methodHierarchy 	'browse method inheritancegreen: sends to supertan: has override(s)mauve: both of the abovepink: is an override but doesn''t call superpinkish tan: has override(s), also is an override but doesn''t call super' )}]		ifFalse:			[{#(13	'inheritance'		methodHierarchy	'browse method inheritance')}]),	#(	(12	'hierarchy'			classHierarchy					'browse class hierarchy')	(10	'inst vars'			browseInstVarRefs				'inst var refs...')	(11	'class vars'			browseClassVarRefs			'class var refs...')	(10	'show...'				offerWhatToShowMenu		'menu of what to show in lower pane')).	^ aList! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:33'!prettyLineDiffButton	"Return a checkbox that lets the user decide whether prettyDiffs should be shown or not"	| button |	button _ PluggableButtonMorph		model: model		stateGetter: #showingPrettyLineDiffs		action: #togglePrettyLineDiffing.	button label: 'linePrettyDiffs'.	(self isKindOf: VersionsBrowser)		ifTrue: [ button setBalloonText: 'Show pretty-printed code differences from the previous version, line by line.' ]		ifFalse: [ button setBalloonText: 'Show pretty-printed code differences between the file-based method and the in-memory version, line by line.' ].	^button! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:33'!prettyWordDiffButton	"Return a checkbox that lets the user decide whether prettyDiffs should be shown or not"	| button |	button _ PluggableButtonMorph		model: model		stateGetter: #showingPrettyWordDiffs		action: #togglePrettyWordDiffing.	button label: 'wordPrettyDiffs'.	(self isKindOf: VersionsBrowser)		ifTrue: [ button setBalloonText: 'Show pretty-printed code differences from the previous version, word by word.' ]		ifFalse: [ button setBalloonText: 'Show pretty-printed code differences between the file-based method and the in-memory version, word by word.' ].	^button! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:45'!windowColor	self flag: #ojo. "remove"	^Color red! !!CodeWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:33'!wordDiffButton	"Return a checkbox that lets the user decide whether regular diffs should be shown or not"	^ (PluggableButtonMorph		model: model		stateGetter: #showingWordDiffs		action: #toggleWordDiffing)			label: 'wordDiffs';			 setBalloonText: 'Show code differences from the previous version, word by word.'! !!CodeWindow methodsFor: 'accessing' stamp: 'jmv 4/15/2011 18:24'!buttonWithSelector: aSelector 	"If receiver has a control button with the given action selector answer it, else answer nil.  morphic only at this point"	^self 		findDeepSubmorphThat: [ :m |			(m isKindOf: PluggableButtonMorph) and: [ m actionSelector == aSelector ]]		ifAbsent: [ ^nil ]! !!CodeWindow methodsFor: 'accessing' stamp: 'jmv 4/15/2011 18:24'!inheritanceButton	"If receiver has an Inheritance button, answer it, else answer nil.  morphic only at this point"	^ self buttonWithSelector: #methodHierarchy! !!CodeWindow methodsFor: 'updating' stamp: 'jmv 4/15/2011 18:39'!decorateButtons	"Change screen feedback for any buttons in the UI of the receiver that may wish it.  Initially, it is only the Inheritance button that is decorated, but one can imagine others."	self decorateForInheritance! !!CodeWindow methodsFor: 'updating' stamp: 'jmv 4/15/2011 19:07'!decorateForInheritance	"Check to see if the currently-viewed method has a super send or an override, and if so, change screen feedback, unless the #decorateBrowserButtons says not to."	| cm aColor aButton flags buttonColor |	(aButton _ self inheritanceButton) ifNil: [^ self].	buttonColor _ Theme current buttonColorFrom: self windowColor.	Preferences decorateBrowserButtons		ifFalse: [ ^aButton color: buttonColor ].	cm _ model currentCompiledMethod.	(cm isKindOf: CompiledMethod)		ifFalse: [ ^aButton color: buttonColor ].	flags _ 0.	model isThisAnOverride ifTrue: [ flags _ flags bitOr: 4 ].	cm sendsToSuper ifTrue: [ flags _ flags bitOr: 2 ].	model isThereAnOverride ifTrue: [ flags _ flags bitOr: 1 ].	aColor _ {		"This is NOTan override. There is no super implementation."		buttonColor.							"no sends to super. there is not override in any subclass"		Color tan.							"no sends to super. there is an override in some subclass"		Color red.							"sends to super. there is no override in any subclass. Error: no super to call (or calls super with a different message)"		Color red.							"sends to super. there is  an override in some subclass. Error: no super to call (or calls super with a different message)"		"This is an override. There is some super implementation"		Color red muchLighter.			"doesn't have sub; has super but doesn't call it"		Color r: 0.94 g: 0.823 b: 0.673.		"has sub; has super but doesn't call it"		Color green muchLighter.			"doesn't have sub; has super and callsl it"		Color blue muchLighter.			"has sub; has super and callsl it"	} at: flags + 1.	aButton color: aColor! !!CodeWindow methodsFor: 'updating' stamp: 'jmv 4/15/2011 19:01'!update: aSymbol	super update: aSymbol.	aSymbol == #decorateButtons ifTrue: [		self decorateButtons ]! !!CodeWindow methodsFor: 'top window' stamp: 'jmv 4/15/2011 18:38'!activateAndSendTopToBack: aBoolean	super activateAndSendTopToBack: aBoolean.	self isCollapsed 		ifFalse: [			self decorateButtons ]! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 3/21/2011 16:08'!buildLowerPanes	| codeAndButtons codeButtonsAndAnnotations comment separator |	comment _ self buildMorphicCommentPane.	separator _ LayoutAdjustingMorph new.	comment separator: separator.	codeAndButtons _ LayoutMorph newColumn.	codeAndButtons		addMorph: self optionalButtonRow fixedHeight: self defaultButtonPaneHeight;		addAdjusterAndMorph: self buildMorphicCodePane proportionalHeight: 2.0;		addMorph: separator fixedHeight: 4;		addMorph: comment proportionalHeight: 2.0.	codeButtonsAndAnnotations _ LayoutMorph newColumn.	codeButtonsAndAnnotations		addMorph: self buildMorphicAnnotationsPane fixedHeight: self defaultAnnotationPaneHeight;		addAdjusterAndMorph: codeAndButtons proportionalHeight: 1.0.	^codeButtonsAndAnnotations! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 3/21/2011 16:08'!buildMorphicClassColumn	| column |	column _ LayoutMorph newColumn.	column		addMorphUseAll: self buildMorphicClassList;		addAdjusterAndMorph: self buildMorphicSwitches fixedHeight:  StrikeFont default height *2-4.	^column! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:20'!buildMorphicClassList	| myClassList |	(myClassList _ PluggableListMorph new)		model: model		listGetter: #classList		indexGetter: #classListIndex		indexSetter: #classListIndex:		menuGetter: #classListMenu		keystrokeAction: #classListKey:from:.	myClassList enableDragNDrop: false.	^myClassList! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:35'!buildMorphicCommentPane	"Construct the pane that shows the class comment.	Respect the Preference for standardCodeFont."	| commentPane |	commentPane := BrowserCommentTextMorph				textProvider: model				textGetter: #classCommentText				textSetter: #newClassComment:.	commentPane styler: nil.	^ commentPane! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:18'!buildMorphicMessageCatList	| myMessageCatList |	(myMessageCatList := PluggableMessageCategoryListMorph new)		model: model		listGetter: #messageCategoryList		indexGetter: #messageCategoryListIndex		indexSetter: #messageCategoryListIndex:		menuGetter: #messageCategoryMenu		keystrokeAction: #arrowKey:from:		rawListGetter: #rawMessageCategoryList.	myMessageCatList enableDragNDrop: false.	^myMessageCatList! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:19'!buildMorphicMessageList	"Build a morphic message list, with #messageList as its list-getter"	| aListMorph |	aListMorph _ PluggableListMorph		model: model		listGetter: #messageList		indexGetter: #messageListIndex		indexSetter: #messageListIndex:		menuGetter: #messageListMenu		keystrokeAction: #messageListKey:from:.	aListMorph enableDragNDrop: false.	^aListMorph! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 15:01'!buildMorphicSwitches	| instanceSwitch commentSwitch classSwitch row buttonColor |	instanceSwitch := PluggableButtonMorph 				model: model				stateGetter: #instanceMessagesIndicated				action: #indicateInstanceMessages.	instanceSwitch		label: 'instance'.	commentSwitch := PluggableButtonMorph 				model: model				stateGetter: #classCommentIndicated				action: #plusButtonHit.	commentSwitch		label: '?' asText allBold;		setBalloonText: 'class comment'.	classSwitch := PluggableButtonMorph 				model: model				stateGetter: #classMessagesIndicated				action: #indicateClassMessages.	classSwitch		label: 'class'.	row _ LayoutMorph newRow.	row		addMorph: instanceSwitch proportionalWidth: 0.45;		addMorph: commentSwitch proportionalWidth: 0.22;		addMorph: classSwitch proportionalWidth: 0.33.	buttonColor _ Theme current buttonColorFrom: self windowColor.	row color: buttonColor.	{ 		instanceSwitch.		commentSwitch.		classSwitch} do: [:m | 				m color: buttonColor ].	^row! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:35'!buildMorphicSystemCatList	| dragNDropFlag myCatList |	dragNDropFlag _ false.	(myCatList _ PluggableListMorph new)		model: model		listGetter: #systemCategoryList		indexGetter: #systemCategoryListIndex		indexSetter: #systemCategoryListIndex:		menuGetter: #systemCategoryMenu		keystrokeAction: #systemCatListKey:from:.	myCatList enableDragNDrop: dragNDropFlag.	^myCatList! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:40'!buildMorphicWindow	"Create a pluggable version of all the morphs for a Browser in Morphic"	| upperPanes |	upperPanes _ LayoutMorph newRow.	upperPanes		addMorph: self buildMorphicSystemCatList proportionalWidth: 0.2;		addAdjusterAndMorph: self buildMorphicClassColumn proportionalWidth: 0.2;		addAdjusterAndMorph: self buildMorphicMessageCatList proportionalWidth: 0.2;		addAdjusterAndMorph: self buildMorphicMessageList proportionalWidth: 0.4.	self layoutMorph		addMorph: upperPanes proportionalHeight: 0.3;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.	self setUpdatablePanesFrom: #(systemCategoryList classList messageCategoryList messageList).	model changed: #editSelection! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:40'!buildNoSysCatMorphicWindow	"A Browser without the class categories list"	| mySingletonList upperPanes |	mySingletonList _ PluggableListMorph 				model: model				listGetter: #systemCategorySingleton				indexGetter: #indexIsOne				indexSetter: #indexIsOne:				menuGetter: #systemCatSingletonMenu				keystrokeAction: #systemCatSingletonKey:from:.	mySingletonList enableDragNDrop: false.	mySingletonList hideScrollBarsIndefinitely.	upperPanes _ LayoutMorph newRow.	upperPanes		addMorph: self buildMorphicClassColumn proportionalWidth: 0.3;		addAdjusterAndMorph: self buildMorphicMessageCatList proportionalWidth: 0.3;		addAdjusterAndMorph: self buildMorphicMessageList proportionalWidth: 0.4.	self layoutMorph		addMorph: mySingletonList fixedHeight: Preferences standardCodeFont height + 10;		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.	self setUpdatablePanesFrom: #(classList messageCategoryList messageList).	model changed: #editSelection! !!BrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:45'!windowColor	^ Theme current browser! !!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:22'!buildMorphicCodePane	^TextModelMorph		textProvider: model		textGetter: #acceptedContents! !!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:26'!buildMorphicWindow	"Open a morphic view for the messageSet, whose label is labelString. 	The listView may be either single or multiple selection type"	| listPane |	listPane _ PluggableListMorphOfMany		model: model		listGetter: #list		primarySelectionGetter: #listIndex		primarySelectionSetter: #toggleListIndex:		listSelectionGetter: #listSelectionAt:		listSelectionSetter: #listSelectionAt:put:		menuGetter: (model showsVersions			ifTrue: [#versionsMenu]			ifFalse: [#changeListMenu]).	listPane keystrokeActionSelector: #changeListKey:from:.		self layoutMorph		addMorph: listPane proportionalHeight: 0.4;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.6! !!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:29'!buttonSpecs	^#(		(11		'select all' 			selectAll				'select all entries')		(14		'deselect all'		deselectAll			'deselect all entries')		(18		'select conflicts'	selectAllConflicts	'select all methods that occur in any change set')		(19		'file in selections' 	fileInSelections		'file in all selected entries')	)! !!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 15:08'!optionalButtonRow	"Answer a row of buttons to occur in a tool pane"	| row buttons widths buttonColor |	buttons _ OrderedCollection new.	widths _ OrderedCollection new.	buttonColor _ Theme current buttonColorFrom: self windowColor.	self buttonSpecs do: [ :tuple | | button |		widths add: tuple first.		button _ PluggableButtonMorph 					model: model					stateGetter: nil					action: tuple third.		button color: buttonColor.		button label: tuple second asString.		buttons add: button.		button setBalloonText: tuple fourth].	buttons add: self lineDiffButton.	widths add: 14.	buttons add: self wordDiffButton.	widths add: 16.	model wantsPrettyDiffOption ifTrue: [		buttons add:  self prettyLineDiffButton.		widths add: 21.		buttons add:  self prettyWordDiffButton.		widths add: 23 ].	row _ LayoutMorph newRow.	row color: buttonColor.	row addMorphs: buttons widthProportionalTo: widths.	^row! !!ChangeListWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:51'!windowColor	^ Theme current changeList! !!ChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 16:06'!buildMorphicWindow	"Add a set of change sorter views to the given top view offset by the given amount. To create a single change sorter, call this once with an offset of 0@0. To create a dual change sorter, call it twice with offsets of 0@0 and 0.5@0."	| list1 list2 list3 upperPanes |	model myChangeSet ifNil: [ model myChangeSet: ChangeSet current ].	list1 _ (PluggableListMorphByItem 				model: model				listGetter: #changeSetList				indexGetter: #currentCngSet				indexSetter: #showChangeSetNamed:				menuGetter: #changeSetMenu				keystrokeAction: #changeSetListKey:from:)			autoDeselect: false.	list2 _ PluggableListMorphByItem 				model: model				listGetter: #classList				indexGetter: #currentClassName				indexSetter: #currentClassName:				menuGetter: #classListMenu				keystrokeAction: #classListKey:from:.	upperPanes _ LayoutMorph newRow.	upperPanes		addMorph: list1 proportionalWidth: 0.5;		addAdjusterAndMorph: list2 proportionalWidth: 0.5.	list3 _ PluggableListMorphByItem 				model: model				listGetter: #messageList				indexGetter: #currentSelector				indexSetter: #currentSelector:				menuGetter: #messageMenu				keystrokeAction: #messageListKey:from:.	self layoutMorph		addMorph: upperPanes proportionalHeight: 0.25;		addAdjusterAndMorph: list3 proportionalHeight: 0.25;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.5.	self setLabel: model labelString! !!ChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 16:09'!windowColor	^ Theme current changeSorter! !!CodeWindow class methodsFor: 'instance creation' stamp: 'jmv 4/15/2011 16:51'!open: model label: aString	|  window |	window _ self new.	aString ifNotNil: [ window setLabel: aString ].	window		model: model;		buildMorphicWindow;		openInWorld! !!CodeWindow class methodsFor: 'instance creation' stamp: 'jmv 3/21/2011 17:26'!openNoSysCat: model label: aString	self new		model: model;		buildNoSysCatMorphicWindow;		setLabel: aString;		openInWorld! !!BrowserWindow class methodsFor: 'GUI building' stamp: 'jmv 3/21/2011 17:02'!openBrowser	| browser |	browser _ Browser new.	self open: browser label: browser defaultBrowserTitle! !!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:17'!buildLowerPanes	| codeAndButtons codeButtonsAndAnnotations twoRowsOfButtons |	twoRowsOfButtons _ LayoutMorph newColumn.	twoRowsOfButtons		addMorph: self optionalButtonRow proportionalHeight: 0.5;		addAdjusterAndMorph: self customButtonRow proportionalHeight: 0.5.	codeAndButtons _ LayoutMorph newColumn.	codeAndButtons		addMorph: twoRowsOfButtons fixedHeight: self defaultButtonPaneHeight * 2;		addAdjusterAndMorph: self buildMorphicCodePane proportionalHeight: 1.0.	codeButtonsAndAnnotations _ LayoutMorph newColumn.	codeButtonsAndAnnotations		addMorph: self buildMorphicAnnotationsPane fixedHeight: self defaultAnnotationPaneHeight;		addAdjusterAndMorph: codeAndButtons proportionalHeight: 1.0.	^codeButtonsAndAnnotations! !!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:17'!buildMorphicWindow	"Open a full morphic debugger with the given label"	| upperMorph bottomMorph1 bottomMorph2 bottomMorph3 bottomMorph4 bottomMorph |	upperMorph _ PluggableListMorph		model: model 		listGetter: #contextStackList		indexGetter: #contextStackIndex		indexSetter: #toggleContextStackIndex:		menuGetter: #contextStackMenu		keystrokeAction: #contextStackKey:from:.	bottomMorph1 _ PluggableListMorph new			doubleClickSelector: #inspectSelection;			model: model receiverInspector			listGetter: #fieldList			indexGetter: #selectionIndex 			indexSetter: #toggleIndex:			menuGetter: #fieldListMenu			keystrokeAction: #inspectorKey:from:.	bottomMorph2 _ TextModelMorph 			textProvider: model receiverInspector			textGetter: #acceptedContents 			textSetter: #accept:			selectionGetter: #contentsSelection.	bottomMorph3 _ PluggableListMorph new			doubleClickSelector: #inspectSelection;			model: model contextVariablesInspector 			listGetter: #fieldList			indexGetter: #selectionIndex 			indexSetter: #toggleIndex:			menuGetter: #fieldListMenu			keystrokeAction: #inspectorKey:from:.	bottomMorph4 _ TextModelMorph 			textProvider: model contextVariablesInspector			textGetter: #acceptedContents 			textSetter: #accept:			selectionGetter: #contentsSelection.	bottomMorph _ LayoutMorph newRow.	bottomMorph		addMorph: bottomMorph1 proportionalWidth: 0.2;		addAdjusterAndMorph: bottomMorph2 proportionalWidth: 0.3;		addAdjusterAndMorph: bottomMorph3 proportionalWidth: 0.2;		addAdjusterAndMorph: bottomMorph4 proportionalWidth: 0.3.	self layoutMorph		addMorph: upperMorph proportionalHeight: 0.25;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.55;		addAdjusterAndMorph: bottomMorph proportionalHeight: 0.2! !!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:18'!customButtonRow	"Answer a button pane affording the user one-touch access to certain functions; the pane is given the formal name 'customButtonPane' by which it can be retrieved by code wishing to send messages to widgets residing on the pane"	| button buttons row buttonColor |		buttons _ OrderedCollection new.	buttonColor _ Theme current buttonColorFrom: self windowColor.	self customButtonSpecs do: [ :tuple | 		button := PluggableButtonMorph 					model: model					stateGetter: nil					action: tuple second.		button color: buttonColor.		button label: tuple first asString.		tuple size > 2 ifTrue: [button setBalloonText: tuple third].		buttons add: button].	row _ LayoutMorph newRow.	row color: buttonColor.	row addMorphs: buttons.	^row! !!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:19'!customButtonSpecs	"Answer an array of elements of the form wording, selector, help-message, that characterize the custom button row of a debugger."	| list |	list _ #(		('Proceed'		proceed				'close the debugger and proceed.')		('Restart'		restart				'reset this context to its start.')		('Into'			send					'step Into message sends')		('Over'			doStep				'step Over message sends')		('Through'		stepIntoBlock		'step into a block')		('Full Stack'		fullStack				'show full stack')		('Where'		where					'select current pc range')).	Preferences restartAlsoProceeds ifTrue: [		list _ list collect: [ :each |			each second == #restart				ifTrue: [ each copy at: 3 put: 'proceed from the beginning of this context.'; yourself ]				ifFalse: [ each ]]].	^ list! !!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:18'!optionalButtonTuples	"No [show...] button in debugger"	^super optionalButtonTuples reject: [ :tuple |		tuple third = #offerWhatToShowMenu ]! !!DebuggerWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:20'!windowColor	^ Theme current debugger! !!DebuggerWindow methodsFor: 'updating' stamp: 'jmv 4/15/2011 19:01'!update: aSymbol	super update: aSymbol.	aSymbol == #decorateButtons ifTrue: [		self decorateButtons ]! !!DebuggerWindow class methodsFor: 'Notifier window' stamp: 'jmv 4/15/2011 17:38'!buttonRowForPreDebugWindow: aDebugger	| row aButton quads buttons |	buttons _ OrderedCollection new.	quads _ OrderedCollection withAll: self preDebugButtonQuads.	(aDebugger interruptedContext selector == #doesNotUnderstand:) ifTrue: [		quads add: { 'Create'. #createMethod. #magenta. 'create the missing method' }	].	quads do: [ :quad |		aButton _ PluggableButtonMorph new model: aDebugger.		aButton color: Color transparent.		aButton action: quad second.		aButton label: quad first.		aButton color: (Color colorFrom: quad third) muchLighter.		aButton setBalloonText: quad fourth.		buttons add: aButton].		row _ LayoutMorph newRow.	row addMorphs: buttons.	^row! !!DebuggerWindow class methodsFor: 'Notifier window' stamp: 'jmv 4/15/2011 17:41'!openMorphicNotifierLabelled: label message: messageString debugger: aDebugger	| notifyPane window extentToUse |	aDebugger expandStack.	messageString		ifNil: [			notifyPane _ PluggableListMorph				model: aDebugger				listGetter: #contextStackList				indexGetter: #contextStackIndex				indexSetter: #debugAt:				menuGetter: nil				keystrokeAction: nil ]		ifNotNil: [			notifyPane _ TextModelMorph withText: messageString.			notifyPane askBeforeDiscardingEdits: false ].	window _ SystemWindow new model: aDebugger.	window layoutMorph		addMorph: (self buttonRowForPreDebugWindow: aDebugger) proportionalHeight: 0.2;		addAdjusterAndMorph: notifyPane proportionalHeight: 0.8.	window setLabel: label.	window widgetsColor: Theme current debugger.	extentToUse _ 650 @ 320.	"nice and wide to show plenty of the error msg"	^ window openInWorldExtent: extentToUse.! !!DebuggerWindow class methodsFor: 'Notifier window' stamp: 'jmv 4/15/2011 17:35'!preDebugButtonQuads	^{	{'Proceed'.		#proceed. 	#blue. 	'continue execution'}.	{'Abandon'.		#abandon. 	#black.	'abandon this execution by closing this window'}.	{'Debug'.		#debug.		#red. 		'bring up a debugger'}}! !!DualChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:05'!buildMorphicUIIn: aLayoutMorph	"Add a set of change sorter views to the given top view offset by the given amount. To create a single change sorter, call this once with an offset of 0@0. To create a dual change sorter, call it twice with offsets of 0@0 and 0.5@0."	| list1 list2 list3 upperPanes |	list1 _ (PluggableListMorphByItem 				model: model				listGetter: #changeSetList				indexGetter: #currentCngSet				indexSetter: #showChangeSetNamed:				menuGetter: #changeSetMenu				keystrokeAction: #changeSetListKey:from:)			autoDeselect: false.	list2 _ PluggableListMorphByItem 				model: model				listGetter: #classList				indexGetter: #currentClassName				indexSetter: #currentClassName:				menuGetter: #classListMenu				keystrokeAction: #classListKey:from:.	upperPanes _ LayoutMorph newRow.	upperPanes		addMorph: list1 proportionalWidth: 0.5;		addAdjusterAndMorph: list2 proportionalWidth: 0.5.	list3 _ PluggableListMorphByItem 				model: model				listGetter: #messageList				indexGetter: #currentSelector				indexSetter: #currentSelector:				menuGetter: #messageMenu				keystrokeAction: #messageListKey:from:.	aLayoutMorph addMorph: upperPanes proportionalHeight: 0.25.	aLayoutMorph addAdjusterAndMorph: list3 proportionalHeight: 0.25.	aLayoutMorph addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.5! !!DualChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 17:09'!buildMorphicWindow	| left right realModel |	model buildLeftAndRight.	self beRow.	left _ LayoutMorph newColumn.	realModel _ model.	model _ realModel leftSorter.	self buildMorphicUIIn: left.	right _ LayoutMorph newColumn.	model _ realModel rightSorter.	self buildMorphicUIIn: right.	model _ realModel.	self setLabel: model labelString.	self layoutMorph		addMorph: left proportionalWidth: 0.5;		addAdjusterAndMorph: right proportionalWidth: 0.5! !!DualChangeSorterWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 16:09'!windowColor	^ Theme current changeSorter! !!FileContentsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:40'!buildMorphicWindow	"Create a pluggable version of all the views for a Browser, including views and controllers."	| list1 list2 upperPanes |	model systemCategoryListIndex: 1.	list1 _ PluggableListMorph 			model: model 			listGetter: #systemCategorySingleton			indexGetter: #indexIsOne 			indexSetter: #indexIsOne:			menuGetter: #packageListMenu			keystrokeAction: #packageListKey:from:.	list1 hideScrollBarsIndefinitely.		list2 _ PluggableListMorph 			model: model 			listGetter: #messageCategoryList			indexGetter: #messageCategoryListIndex 			indexSetter: #messageCategoryListIndex:			menuGetter: #messageCategoryMenu.	upperPanes _ LayoutMorph newRow.	upperPanes		addMorph: self buildMorphicClassColumn proportionalWidth: 0.3;		addAdjusterAndMorph: list2 proportionalWidth: 0.3;		addAdjusterAndMorph: self buildMorphicMessageList proportionalWidth: 0.4.	self layoutMorph		addMorph: list1 fixedHeight: Preferences standardCodeFont height + 10;		addAdjusterAndMorph: upperPanes proportionalHeight: 0.3;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.7.	model changed: #editSelection! !!FileContentsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:45'!windowColor	^ Theme current browser! !!MessageSetWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:39'!buildMorphicWindow	"Answer a morphic window with the given label that can display the receiver"	self layoutMorph		addMorph: self buildMorphicMessageList proportionalHeight: 0.2;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.8.	self setUpdatablePanesFrom: #(messageList).	model changed: #editSelection! !!MessageSetWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:49'!windowColor	^ Theme current messageSet! !!MessageSetWindow methodsFor: 'updating' stamp: 'jmv 4/15/2011 19:01'!update: aSymbol	super update: aSymbol.	aSymbol == #decorateButtons ifTrue: [		self decorateButtons ]! !!MessageNamesWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 10:39'!buildMorphicWindow	"Answer a morphic window with the given initial search string, nil if none""MessageNames openMessageNames"	| selectorListView firstRow searchButton textMorph secondRow |	textMorph _ TextModelMorph 		textProvider: model		textGetter: #searchString 		textSetter: #searchString:.	textMorph setProperty: #alwaysAccept toValue: true.	textMorph askBeforeDiscardingEdits: false.	textMorph acceptOnCR: true.	textMorph setTextColor: Color brown.	textMorph hideScrollBarsIndefinitely.	textMorph textMorph		on: #mouseEnter send: #selectAll to: textMorph textMorph.	searchButton _ PluggableButtonMorph new 		model: textMorph;		label: 'Search';		action: #accept.	searchButton setBalloonText: 'Type some letters into the pane at right, and then press this Search button (or hit RETURN) and all method selectors that match what you typed will appear in the list pane below.  Click on any one of them, and all the implementors of that selector will be shown in the right-hand pane, and you can view and edit their code without leaving this tool.'.	firstRow _ LayoutMorph newRow.	firstRow		addMorph: searchButton proportionalWidth: 0.25;		addMorph: textMorph proportionalWidth: 0.75.	selectorListView _ PluggableListMorph 		model: model		listGetter: #selectorList		indexGetter: #selectorListIndex		indexSetter: #selectorListIndex:		menuGetter: #selectorListMenu		keystrokeAction: #selectorListKey:from:.	secondRow _  LayoutMorph newRow.	secondRow		addMorph: selectorListView proportionalWidth: 0.5;		addAdjusterAndMorph: self buildMorphicMessageList proportionalWidth: 0.5.	self layoutMorph		addMorph: firstRow fixedHeight: self defaultButtonPaneHeight+4;		addAdjusterAndMorph: secondRow proportionalHeight: 0.5;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.5.	model changed: #editSelection! !!MessageNamesWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:45'!windowColor	^ Theme current messageNames! !!TheWorldMenu methodsFor: 'action' stamp: 'jmv 4/15/2011 16:12'!openMessageNames	"Bring a MessageNames tool to the front"	MessageNamesWindow open: MessageNames new label: 'Message Names'! !!TheWorldMenu methodsFor: 'commands' stamp: 'jmv 3/21/2011 16:44'!openBrowser	BrowserWindow openBrowser! !!TheWorldMenu methodsFor: 'commands' stamp: 'jmv 4/15/2011 16:58'!openChangeSorter1	ChangeSorterWindow open: ChangeSorter new label: nil! !!TheWorldMenu methodsFor: 'commands' stamp: 'jmv 4/15/2011 17:02'!openChangeSorter2	DualChangeSorterWindow open: DualChangeSorter new label: nil! !!TheWorldMenu methodsFor: 'construction' stamp: 'jmv 4/15/2011 23:07'!changesMenu        "Build the changes menu for the world."        | menu |        menu _ self menu: 'changes...'.        self fillIn: menu from: {                { 'file out current change set' . { ChangeSet current . #verboseFileOut}.                                'Write the current change set out to a file whose name reflects the change set name and the current date & time.'}.                { 'create new change set...' . { ChangeSorter . #newChangeSet}. 'Create a new change set and make it the current one.'}.                { 'check change set for slips' . { self  . #lookForSlips}.                                'Check the current change set for halts, references to the Transcript, etc., and if any such thing is found, open up a message-list browser detailing all possible slips.'}.                nil.                { 'simple change sorter' . {self. #openChangeSorter1}.  'Open a 3-paned changed-set viewing tool'}.                { 'dual change sorter' . {self. #openChangeSorter2}.                                'Open a change sorter that shows you two change sets at a time, making it easy to copy and move methods and classes between them.'}.                nil.                { 'browse recent submissions' . { Utilities . #browseRecentSubmissions}.                                'Open a new recent-submissions browser.  A recent-submissions browser is a message-list browser that shows the most recent methods that have been submitted.  If you submit changes within that browser, it will keep up-to-date, always showing the most recent submissions.'}.                { 'find recent submissions' . { #myWorld . #openRecentSubmissionsBrowser:}.                                'Make an open recent-submissions browser be the front-window, expanding a collapsed one or creating a new one if necessary.  A recent-submissions browser is a message-list browser that shows the most recent methods that have been submitted, latest first.  If you submit changes within that browser, it will keep up-to-date, always showing the most recent submissions at the top of the browser.'}.                { 'recently logged changes...' . { ChangeList . #browseRecentLog}.'Open a change-list browser on the latter part of the changes log.  You can use this browser to recover logged changes which were not saved in your image, in the event of a crash or other interruption.'}.                nil.                { 'save world as morph file' . {self. #saveWorldInFile}. 'Save a file that, when reloaded, reconstitutes the current World.'}.        }.        ^ menu! !!TheWorldMenu methodsFor: 'construction' stamp: 'jmv 4/15/2011 09:41'!openMenu	"Build the open window menu for the world."	| menu |	menu _ self menu: 'open...'.	self fillIn: menu from: {		{'browser' . { self . #openBrowser}. 'A five-paned tool that lets you see all the code in the system'}.		{'workspace' . {self . #openWorkspace}. 'A window for evaluating Smalltalk expressions' }.		{'text editor' . {self . #openTextEditor}. 'A window for composing text' }.		{'file list' . {self . #openFileList} . 'A tool allowing you to browse any file' }.		{'transcript' . {self . #openTranscript}. 'A window used to report messages sent to Transcript' }.		{ 'process browser' . { ProcessBrowser . #open } }.		{ 'emergency evaluator'. { Transcripter. #emergencyEvaluator } }.		"{'inner world' . { WorldWindow . #test1} }."		nil.		{'message names' . { self . #openMessageNames} . 'A tool for finding and editing methods that contain any given keyword in their names.'}.		nil.		{'simple change sorter' . {self . #openChangeSorter1} . 'A tool allowing you to view the methods in a single change set' }.		{'dual change sorter' . {self . #openChangeSorter2} . 'A tool allowing you to compare and manipulate two change sets concurrently' }.		nil.	}.	self fillIn: menu from: self class registeredOpenCommands.	^menu! !!Theme methodsFor: 'tool colors' stamp: 'jmv 4/15/2011 14:59'!browser	^ self useUniformColors		ifTrue: [ self defaultWindowColor ]		ifFalse: [ Color r: 0.5 g: 0.7 b: 0.4]! !!TimeProfileBrowser methodsFor: 'private' stamp: 'jmv 4/15/2011 19:04'!runBlock: aBlock pollingEvery: pollPeriod 	| stream list result |	block := MessageSend 				receiver: self				selector: #runBlock:pollingEvery:				arguments: { 						aBlock.						pollPeriod}.	"so we can re-run it"	tally := MessageTally new.	tally		reportOtherProcesses: false;		maxClassNameSize: 1000;		maxClassPlusSelectorSize: 1000;		maxTabs: 100.	result := tally spyEvery: pollPeriod on: aBlock.	stream := ReadWriteStream 				with: (String streamContents: [ :s | 					tally report: s]).	stream reset.	list := OrderedCollection new.	[stream atEnd] whileFalse: [list add: stream nextLine].	self initializeMessageList: list.	self changed: #messageList.	self changed: #messageListIndex.	self changed: #decorateButtons.	^result! !!TimeProfileBrowser methodsFor: 'private' stamp: 'jmv 4/15/2011 19:04'!runProcess: aProcess forMilliseconds: msecDuration pollingEvery: pollPeriod 	| stream list result |	block := MessageSend 				receiver: self				selector: #runProcess:forMilliseconds:pollingEvery: 				arguments: { 						aProcess.						msecDuration.						pollPeriod}.	"so we can re-run it"	tally := MessageTally new.	tally		reportOtherProcesses: false;		maxClassNameSize: 1000;		maxClassPlusSelectorSize: 1000;		maxTabs: 100.	result := tally 				spyEvery: pollPeriod				onProcess: aProcess				forMilliseconds: msecDuration.	stream := ReadWriteStream 				with: (String streamContents: [ :s | 							tally report: s]).	stream reset.	list := OrderedCollection new.	[stream atEnd] whileFalse: [list add: stream nextLine].	self initializeMessageList: list.	self changed: #messageList.	self changed: #messageListIndex.	self changed: #decorateButtons.	^result! !!Utilities class methodsFor: 'recent method submissions' stamp: 'jmv 3/21/2011 18:02'!openRecentSubmissionsWindow	"Answer a SystemWindow holding recent submissions"	| recentMessages messageSet |	recentMessages _ RecentSubmissions copy reversed.	messageSet _ RecentMessageSet messageList: recentMessages.	messageSet autoSelectString: nil.	MessageSetWindow open: messageSet label: 'Recent submissions -- youngest first'	"Utilities recentSubmissionsWindow"! !!VersionsBrowser methodsFor: 'menu' stamp: 'jmv 4/15/2011 17:00'!findOriginalChangeSet	| changeSet |	self currentChange ifNil: [^ self].	changeSet _ self currentChange originalChangeSetForSelector: self selectedMessageName.	changeSet = #sources ifTrue:		[^ self inform: 'This version is in the .sources file.'].	changeSet ifNil:		[^ self inform: 'This version was not found in any changeset nor in the .sources file.'].	ChangeSorterWindow open: (ChangeSorter new myChangeSet: changeSet) label: nil! !!VersionsBrowser class methodsFor: 'as yet unclassified' stamp: 'jmv 4/15/2011 15:02'!browseVersionsOf: method class: class meta: meta category: msgCategory selector: selector lostMethodPointer: sourcePointer 	| changeList browser |	Cursor read showWhile: [		changeList _ (browser _ self new)			scanVersionsOf: method class: class meta: meta			category: msgCategory selector: selector].	changeList ifNil: [ self inform: 'No versions available'. ^nil ].	sourcePointer ifNotNil: [		changeList setLostMethodPointer: sourcePointer ].	VersionsBrowserWindow open: changeList label: 'Recent versions of ', selector.	^browser! !!ClassCommentVersionsBrowser class methodsFor: 'instance creation' stamp: 'jmv 4/15/2011 15:06'!browseCommentOf: class	Cursor read showWhile: [ | changeList |		changeList _ self new scanVersionsOf: class.	 	changeList ifNil: [^ self inform: 'No versions available'].		VersionsBrowserWindow open: changeList label: 'Recent versions of ', class name, '''s comments' ]! !!VersionsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:27'!buildMorphicWindow	"Open a morphic view for the messageSet, whose label is labelString. 	The listView may be either single or multiple selection type"	| listPane |	listPane _ PluggableListMorph		model: model		listGetter: #list		indexGetter: #listIndex		indexSetter: #toggleListIndex:		menuGetter: (model showsVersions			ifTrue: [#versionsMenu]			ifFalse: [#changeListMenu]).	listPane keystrokeActionSelector: #changeListKey:from:.		self layoutMorph		addMorph: listPane proportionalHeight: 0.4;		addAdjusterAndMorph: self buildLowerPanes proportionalHeight: 0.6! !!VersionsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:25'!buttonSpecs	^#(		(22		'compare to current'		compareToCurrentVersion		'opens a separate window which shows the text differences between the selected version and the current version')		(9		'revert'		fileInSelections		'reverts the method to the version selected')		(24		'remove from changes'		removeMethodFromChanges		'remove this method from the current change set')		(7		'help'		offerVersionsHelp		'further explanation about use of Versions browsers')	)! !!VersionsBrowserWindow methodsFor: 'GUI building' stamp: 'jmv 4/15/2011 14:52'!windowColor	^ Theme current versionsBrowser! !ClassCommentVersionsBrowser class removeSelector: #windowColor!VersionsBrowser class removeSelector: #windowColor!VersionsBrowser removeSelector: #buttonSpecs!Utilities class removeSelector: #recentSubmissionsWindow!DarkTheme removeSelector: #classCommentVersionsBrowser!DarkTheme removeSelector: #packageBrowser!Theme removeSelector: #classCommentVersionsBrowser!Theme removeSelector: #packageBrowser!MessageNamesWindow class removeSelector: #windowColor!!MessageNamesWindow class reorganize!('as yet unclassified')!MessageSetWindow class removeSelector: #windowColor!!MessageSetWindow class reorganize!('as yet unclassified')!MessageNamesWindow removeSelector: #selectorList!MessageNamesWindow removeSelector: #selectorListIndex!MessageNamesWindow removeSelector: #selectorListIndex:!MessageNamesWindow removeSelector: #selectorListKey:from:!MessageNamesWindow removeSelector: #selectorListMenu!!MessageNamesWindow reorganize!('GUI building' buildMorphicWindow windowColor)!!FileListWindow reorganize!('GUI building')!FileContentsBrowserWindow class removeSelector: #windowColor!!FileContentsBrowserWindow class reorganize!('as yet unclassified')!FileContentsBrowserWindow removeSelector: #messageCategoryMenu!FileContentsBrowserWindow removeSelector: #packageListKey:from:!FileContentsBrowserWindow removeSelector: #packageListMenu!!FileContentsBrowserWindow reorganize!('GUI building' buildMorphicWindow windowColor)!!DebuggerWindow reorganize!('GUI building' buildLowerPanes buildMorphicWindow customButtonRow customButtonSpecs optionalButtonTuples windowColor)('Notifier window')('updating' update:)!!ChangeSorterWindow class reorganize!('GUI building')!BrowserWindow class removeSelector: #windowColor!BrowserWindow removeSelector: #arrowKey:from:!BrowserWindow removeSelector: #browseClassVarRefs!BrowserWindow removeSelector: #browseInstVarRefs!BrowserWindow removeSelector: #browseMessages!BrowserWindow removeSelector: #browseMethodFull!BrowserWindow removeSelector: #browseSendersOfMessages!BrowserWindow removeSelector: #browseVersions!BrowserWindow removeSelector: #buildMorphicAnnotationsPane!BrowserWindow removeSelector: #buildMorphicCodePane!BrowserWindow removeSelector: #classCommentIndicated!BrowserWindow removeSelector: #classCommentText!BrowserWindow removeSelector: #classHierarchy!BrowserWindow removeSelector: #classList!BrowserWindow removeSelector: #classListIndex!BrowserWindow removeSelector: #classListIndex:!BrowserWindow removeSelector: #classListKey:from:!BrowserWindow removeSelector: #classListMenu!BrowserWindow removeSelector: #classMessagesIndicated!BrowserWindow removeSelector: #containingWindow!BrowserWindow removeSelector: #defaultAnnotationPaneHeight!BrowserWindow removeSelector: #defaultButtonPaneHeight!BrowserWindow removeSelector: #editSelection!BrowserWindow removeSelector: #editorClass!BrowserWindow removeSelector: #indexIsOne!BrowserWindow removeSelector: #indexIsOne:!BrowserWindow removeSelector: #indicateClassMessages!BrowserWindow removeSelector: #indicateInstanceMessages!BrowserWindow removeSelector: #instanceMessagesIndicated!BrowserWindow removeSelector: #labelString!BrowserWindow removeSelector: #messageCategoryList!BrowserWindow removeSelector: #messageCategoryListIndex!BrowserWindow removeSelector: #messageCategoryListIndex:!BrowserWindow removeSelector: #messageCategoryMenu!BrowserWindow removeSelector: #messageList!BrowserWindow removeSelector: #messageListIndex!BrowserWindow removeSelector: #messageListIndex:!BrowserWindow removeSelector: #messageListKey:from:!BrowserWindow removeSelector: #messageListMenu!BrowserWindow removeSelector: #methodHierarchy!BrowserWindow removeSelector: #newClassComment:!BrowserWindow removeSelector: #offerWhatToShowMenu!BrowserWindow removeSelector: #optionalButtonRow!BrowserWindow removeSelector: #optionalButtonTuples!BrowserWindow removeSelector: #plusButtonHit!BrowserWindow removeSelector: #rawMessageCategoryList!BrowserWindow removeSelector: #systemCatListKey:from:!BrowserWindow removeSelector: #systemCatSingletonKey:from:!BrowserWindow removeSelector: #systemCatSingletonMenu!BrowserWindow removeSelector: #systemCategoryList!BrowserWindow removeSelector: #systemCategoryListIndex!BrowserWindow removeSelector: #systemCategoryListIndex:!BrowserWindow removeSelector: #systemCategoryMenu!BrowserWindow removeSelector: #systemCategorySingleton!BrowserWindow removeSelector: #topView!BrowserWindow removeSelector: #update:!!BrowserWindow reorganize!('GUI building' buildLowerPanes buildMorphicClassColumn buildMorphicClassList buildMorphicCommentPane buildMorphicMessageCatList buildMorphicMessageList buildMorphicSwitches buildMorphicSystemCatList buildMorphicWindow buildNoSysCatMorphicWindow windowColor)!SystemDictionary removeSelector: #recover:!SystemDictionary removeSelector: #writeRecentCharacters:toFileNamed:!SystemDictionary removeSelector: #writeRecentToFile!SmalltalkEditor removeSelector: #browseItHere!SmalltalkEditor removeSelector: #browseItHere:!Preferences class removeSelector: #browseToolClass!Preferences class removeSelector: #browserShowsPackagePane!MessageNames class removeSelector: #openMessageNames!MessageNames class removeSelector: #windowColor!MessageSet class removeSelector: #windowColor!MessageNames removeSelector: #buildMorphicWindow!MessageSet removeSelector: #buildMorphicMessageList!MessageSet removeSelector: #buildMorphicWindow!LoopedSampledSound removeSelector: #edit!Inspector removeSelector: #spawnFullProtocol!Inspector removeSelector: #spawnProtocol!FileStream removeSelector: #edit!FileList2 removeSelector: #directory!FileList class removeSelector: #buildMorphicWindowOn:!FileList class removeSelector: #openEditorOn:!FileContentsBrowser class removeSelector: #browseFile:!FileContentsBrowser class removeSelector: #windowColor!FileContentsBrowser removeSelector: #buildMorphicWindow!!FileContentsBrowser reorganize!('accessing' acceptedStringOrText contents:notifying: contentsSymbol selectedPackage thePackage:)('removing' removeClass removeMessage removeMessageCategory removeUnmodifiedCategories removeUnmodifiedClasses removeUnmodifiedMethods)('class list' browseMethodFull classList findClass renameClass selectedClass)('edit pane' selectedBytecodes selectedMessage)('diffs' methodDiffFor:class:selector:meta: modifiedClassDefinition)('fileIn/fileOut' fileInClass fileInMessage fileInMessageCategories fileInPackage fileIntoNewChangeSet fileOutClass fileOutMessage fileOutMessageCategories fileOutPackage)('infoView' annotation extraInfo infoViewContents packageInfo: updateInfoView)('metaclass' selectedClassOrMetaClass setClassOrganizer)('other' browseSenders browseVersions changeMessageCategories: didCodeChangeElsewhere labelString methodHierarchy)('menus' classListMenu contentsSymbolQuints messageCategoryMenu messageListMenu packageListMenu shiftedClassListMenu)('keys' classListKey:from: messageListKey:from: packageListKey:from:)('initialize-release' defaultBrowserTitle)('*Shout-Styling' shoutAboutToStyle:)!DualChangeSorter removeSelector: #buildMorphicWindow!DualChangeSorter removeSelector: #isLeftSide:!DualChangeSorter removeSelector: #open!DualChangeSorter removeSelector: #openAsMorph!Debugger class removeSelector: #windowColor!!Debugger class reorganize!('class initialization' initialize openContext:label:contents:)('instance creation' context: informExistingDebugger:label:)('opening' openInterrupt:onProcess: openOn:context:label:contents:fullView:)!Debugger removeSelector: #buildLowerPanes!Debugger removeSelector: #buildMorphicWindow!Debugger removeSelector: #buttonRowForPreDebugWindow!Debugger removeSelector: #customButtonRow!Debugger removeSelector: #customButtonSpecs!Debugger removeSelector: #openMorphicNotifierLabelled:message:!Debugger removeSelector: #optionalButtonTuples!Debugger removeSelector: #preDebugButtonQuads!!Debugger reorganize!('initialize' debugAt: errorWasInUIProcess: initialExtent openFullMorphicLabel: openFullNoSuspendLabel: openNotifierContents:label: release windowIsClosing)('accessing' acceptedStringOrText contents:notifying: contextVariablesInspector debuggerMap interruptedContext interruptedProcess isNotifier labelString labelString: proceedValue proceedValue: receiver receiverInspector receiverInspectorObject:context:)('notifier menu' debug storeLog)('context stack (message list)' contextStackIndex contextStackList expandStack fullyExpandStack messageListIndex selectedMessage selectedMessageName toggleContextStackIndex:)('context stack menu' abandon abandon: askForCategoryIn:default: browseMessages browseSendersOfMessages browseVersions contextStackKey:from: contextStackMenu doStep down fullStack implement:inClass: messageListMenu peelToFirst proceed proceed: restart returnValue selectPC send shiftedContextStackMenu shiftedMessageListMenu stepIntoBlock up where)('code pane' contentsSelection doItContext doItReceiver pc pcRange)('code pane menu' perform:orSendTo: runToSelection:)('message category list' selectedMessageCategoryName)('class list' selectedClass selectedClassOrMetaClass)('dependents access' updateInspectors wantsSteps)('private' askForSuperclassOf:toImplement:ifCancel: checkContextSelection contextStackIndex:oldContextWas: createMethod externalInterrupt: lowSpaceChoices newStack: process:controller:context: resetContext: resumeProcess: selectedContext)('breakpoints' toggleBreakOnEntry)('*Shout-Styling' shoutAboutToStyle:)!ChangeSorter class removeSelector: #windowColor!!ChangeSorter class reorganize!('enumerating' allChangeSetNames allChangeSets allChangeSetsWithClass:selector: changeSetNamed: changeSetsNamedSuchThat: existingOrNewChangeSetNamed: gatherChangeSets highestNumberedChangeSet mostRecentChangeSetWithChangeForClass:selector: promoteToTop:)('class initialization' belongsInAll: belongsInNumbered: changeSetCategoryNamed: initialize unload)('adding' basicNewChangeSet: newChangeSet newChangeSet: newChangesFromStream:named:)('removing' removeChangeSet: removeChangeSetsNamedSuchThat: removeEmptyUnnamedChangeSets)('services' assuredChangeSetNamed: browseChangeSetsWithClass:selector: changeSetCategoryClass countOfChangeSetsWithClass:andSelector: doesAnyChangeSetHaveClass:andSelector: reorderChangeSets secondaryChangeSet)('fileIn/Out' fileIntoNewChangeSet: fileReaderServicesForFile:suffix: serviceFileIntoNewChangeSet services)!ChangeSorter removeSelector: #buildMorphicUIIn:!ChangeSorter removeSelector: #buildMorphicWindow!ChangeSorter removeSelector: #open!ChangeSorter removeSelector: #openAsMorph!ChangeList class removeSelector: #browseChangesFile:!ChangeList class removeSelector: #browseFile:!ChangeList class removeSelector: #open:name:multiSelect:!ChangeList class removeSelector: #windowColor!ChangeList removeSelector: #buildMorphicWindowMultiSelect:!ChangeList removeSelector: #buttonSpecs!ChangeList removeSelector: #optionalButtonRow!Browser class removeSelector: #openBrowser!Browser class removeSelector: #windowColor!Browser removeSelector: #browseSelectionInPlace!Browser removeSelector: #buildLowerPanes!Browser removeSelector: #buildMorphicClassColumn!Browser removeSelector: #buildMorphicClassList!Browser removeSelector: #buildMorphicCommentPane!Browser removeSelector: #buildMorphicMessageCatList!Browser removeSelector: #buildMorphicMessageList!Browser removeSelector: #buildMorphicSwitches!Browser removeSelector: #buildMorphicSystemCatList!Browser removeSelector: #buildMorphicWindow!Browser removeSelector: #buildNoSysCatMorphicWindow!Browser removeSelector: #couldBrowseAnyClass!Browser removeSelector: #findMethod!!Browser reorganize!('accessing' acceptedStringOrText contents:notifying: contentsSelection doItReceiver editSelection editSelection: noteSelectionIndex:for: request:initialAnswer:)('annotation' annotation)('breakpoints' toggleBreakOnEntry)('class comment pane' newClassComment:)('class functions' addAllMethodsToCurrentChangeSet classCommentText classDefinitionText classListMenu copyClass createInstVarAccessors defineClass:notifying: editClass editComment explainSpecial: fileOutClass hierarchy makeNewSubclass plusButtonHit removeClass renameClass shiftedClassListMenu)('class list' classList classListIndex classListIndex: recent selectClass: selectedClass selectedClassName)('code pane' compileMessage:notifying:)('copying' veryDeepInner:)('initialize-release' defaultBrowserTitle labelString methodCategoryChanged setClass:selector: setSelector: systemCatSingletonKey:from: systemOrganizer:)('message category functions' addCategory alphabetizeMessageCategories canShowMultipleMessageCategories categoryOfCurrentMethod changeMessageCategories: editMessageCategories fileOutMessageCategories messageCategoryMenu removeEmptyCategories removeMessageCategory renameCategory showHomeCategory)('message category list' categorizeAllUncategorizedMethods messageCategoryList messageCategoryListIndex messageCategoryListIndex: messageCategoryListSelection rawMessageCategoryList selectOriginalCategoryForCurrentMethod selectedMessageCategoryName setOriginalCategoryIndexForCurrentMethod)('message functions' addExtraShiftedItemsTo: defineMessageFrom:notifying: inspectInstances inspectSubInstances messageListMenu removeMessage removeMessageFromBrowser shiftedMessageListMenu)('message list' messageList messageListIndex messageListIndex: reformulateList selectedMessage selectedMessageName selectedMessageName:)('metaclass' classCommentIndicated classMessagesIndicated classOrMetaClassOrganizer indicateClassMessages indicateInstanceMessages instanceMessagesIndicated metaClassIndicated metaClassIndicated: selectedClassOrMetaClass setClassOrganizer)('system category functions' addSystemCategory alphabetizeSystemCategories browseAllClasses changeSystemCategories: classNotFound editSystemCategories fileOutSystemCategory findClass moveSystemCategoryBottom moveSystemCategoryDown moveSystemCategoryTop moveSystemCategoryUp openSystemCategoryBrowser potentialClassNames removeSystemCategory renameSystemCategory systemCatSingletonMenu systemCategoryMenu updateSystemCategories)('system category list' indexIsOne indexIsOne: selectCategoryForClass: selectedEnvironment selectedSystemCategoryName systemCategoryList systemCategoryListIndex systemCategoryListIndex: systemCategorySingleton)('*Shout-Styling' shoutAboutToStyle:)!CodeProvider removeSelector: #buildLowerPanes!CodeProvider removeSelector: #buildMorphicAnnotationsPane!CodeProvider removeSelector: #buildMorphicCodePane!CodeProvider removeSelector: #buttonWithSelector:!CodeProvider removeSelector: #decorateButtons!CodeProvider removeSelector: #decorateForInheritance!CodeProvider removeSelector: #defaultAnnotationPaneHeight!CodeProvider removeSelector: #defaultButtonPaneHeight!CodeProvider removeSelector: #inheritanceButton!CodeProvider removeSelector: #lineDiffButton!CodeProvider removeSelector: #optionalButtonRow!CodeProvider removeSelector: #optionalButtonTuples!CodeProvider removeSelector: #prettyLineDiffButton!CodeProvider removeSelector: #prettyWordDiffButton!CodeProvider removeSelector: #spawnFullProtocol!CodeProvider removeSelector: #spawnProtocol!CodeProvider removeSelector: #wordDiffButton!!CodeProvider reorganize!('annotation' addPriorVersionsCountForSelector:ofClass:to: annotation annotationForClassCommentFor: annotationForClassDefinitionFor: annotationForHierarchyFor: annotationForSelector:ofClass: annotationRequests annotationSeparator)('categories' categoryFromUserWithPrompt:for: categoryOfCurrentMethod changeCategory letUserReclassify:in: methodCategoryChanged selectedMessageCategoryName)('contents' acceptedContentsChanged acceptedStringOrText commentContents contentsSymbol contentsSymbol:)('commands' adoptMessageInCurrentChangeset browseImplementors browseProtocol browseSenders makeSampleInstance offerShiftedClassListMenu offerUnshiftedClassListMenu openExtraMenu openMenu removeClass showUnreferencedClassVars showUnreferencedInstVars spawnHierarchy)('controls' contentsSymbolQuints sourceAndDiffsQuintsOnly)('diffs' defaultDiffsSymbol diffFromPriorSourceFor: shouldDiffWords showDiffs: showLineDiffs: showPrettyLineDiffs: showPrettyWordDiffs: showWordDiffs: showingAnyKindOfDiffs showingAnyKindOfPrettyDiffs showingLineDiffs showingLineDiffsString showingPrettyLineDiffs showingPrettyLineDiffsString showingPrettyWordDiffs showingPrettyWordDiffsString showingWordDiffs showingWordDiffsString toggleDiffing toggleLineDiffing togglePlainSource togglePrettyLineDiffing togglePrettyPrint togglePrettyWordDiffing toggleWordDiffing)('misc' getSelectorAndSendQuery:to: getSelectorAndSendQuery:to:with: isThereAnOverride isThisAnOverride modelWakeUp modelWakeUpIn: okayToAccept priorSourceOrNil releaseCachedState sampleInstanceOfSelectedClass sendQuery:to: setClassAndSelectorIn: useSelector:orGetSelectorAndSendQuery:to:)('self-updating' didCodeChangeElsewhere stepIn: updateListsAndCodeIn: updatePaneIfNeeded wantsSteps)('what to show' addContentsTogglesTo: addModelItemsToWindowMenu: offerWhatToShowMenu prettyPrintString showByteCodes: showComment showDecompile: showDocumentation: showingByteCodes showingByteCodesString showingDecompile showingDecompileString showingDocumentation showingDocumentationString showingPlainSource showingPlainSourceString showingPrettyPrint showingSource toggleDecompile toggleShowDocumentation toggleShowingByteCodes)('message list' decompiledSource selectedBytecodes selectedMessage sourceStringPrettifiedAndDiffed validateMessageSource:forSelector:inClass:)('message list menu' browseAllMessages browseClassRefs browseClassVarRefs browseClassVariables browseFullProtocol browseInstVarDefs browseInstVarRefs browseLocalImplementors browseLocalSendersOfMessages browseMessages browseMethodFull browseSendersOfMessages browseUnusedMethods browseVersions classHierarchy classListKey:from: copyName copySelector fileOutMessage findMethodInChangeSets inspectInstances inspectSubInstances messageListKey:from: methodHierarchy openSingleMessageBrowser packageListKey:from: removeFromCurrentChanges revertAndForget revertToPreviousVersion selectMessageAndEvaluate: systemCatListKey:from: timeStamp)('message category functions' canShowMultipleMessageCategories)('testing' is: refusesToAccept)('code pane menu' editorClass)('*Shout-Styling' isModeStyleable shoutAboutToStyle:)('accessing' currentCompiledMethod selectedClass selectedClassOrMetaClass selectedMessageName)('evaluation' doItContext)!AIFFFileReader removeSelector: #edit!Smalltalk removeClassNamed: #PackagePaneBrowser!